<div id="ArithExtras">
<div class="head">
<h1>Theory ArithExtras</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Theory ArithExtras.thy (FOCUS streams)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Theory ArithExtras.thy"</span></span>

<span class="keyword1"><span class="command">theory</span></span> ArithExtras 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> 
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">datatype</span></span> natInf <span class="main">=</span> Fin <span class="quoted">nat</span> 
                <span class="main">|</span> Infty                     <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">∞</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">nat2inat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list <span class="main">⇒</span> natInf list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nat2inat</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">nat2inat</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Fin <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">nat2inat</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ListExtras">
<div class="head">
<h1>Theory ListExtras</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Theory ListExtras.thy
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2014
*)</span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary Theory ListExtras.thy›</span></span>

<span class="keyword1"><span class="command">theory</span></span> ListExtras 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">disjoint</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">disjoint</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">mem</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">mem</span>"</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">mem</span></span> <span class="main">[]</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">mem</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">mem</span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">memS</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">memS</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span>  <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_memS_eq<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mem</span> <span class="free">l</span> <span class="main">≡</span> memS <span class="free">x</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> memS_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">la</span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">la</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> memS_def<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mem_set_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mem</span> <span class="free">l</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> memS_def mem_memS_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_set_2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">l</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mem</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> memS_def mem_memS_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_inter_mem<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mem</span> <span class="free">l1</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mem</span> <span class="free">l2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">l1</span> <span class="main">∩</span> set <span class="free">l2</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI empty_iff mem_set_1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_notdisjoint<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mem</span> <span class="free">l1</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mem</span> <span class="free">l2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> disjoint <span class="free">l1</span> <span class="free">l2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_def set_inter_mem<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mem_notdisjoint2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"disjoint <span class="main">(</span><span class="free">schedule</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">schedule</span> <span class="free">B</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">mem</span> <span class="free">schedule</span> <span class="free">A</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="keyword1">mem</span> <span class="free">schedule</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="keyword1">mem</span> <span class="free">schedule</span> <span class="free">B</span>"</span></span>
     <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>  disjoint <span class="main">(</span><span class="free">schedule</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">schedule</span> <span class="free">B</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_notdisjoint<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="keyword1">mem</span> <span class="free">schedule</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Add_Less<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">&lt;</span> Suc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> list_length_hint1<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">l</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> list_length_hint1a<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">l</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> list_length_hint2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span>  <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">[</span>hd <span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Zero_neq_Suc list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> length_Suc_conv neq_Nil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_length_hint2a<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">l</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"tl <span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_length_hint2 list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> list_length_hint3<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">l</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Zero_neq_Suc list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_length_hint4<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_0_eq le_Suc_eq length_greater_0_conv less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_nonempty<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> length <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_greater_0_conv less_eq_Suc_le<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> last_nth_length<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">!</span> <span class="main">(</span><span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> last <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def last_conv_nth<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append0<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">z</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_append<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">x</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">x</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">x</span><span class="main">)</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_nth_append0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> list_nth_append2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">x</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">x</span> <span class="main">@</span> <span class="free">a</span> <span class="main">#</span> <span class="free">y</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_eq_appendI length_Suc_conv list_nth_append0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append3<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">y</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">x</span> <span class="main">@</span> <span class="free">a</span> <span class="main">#</span> <span class="free">y</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">=</span><span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">with</span></span> h1  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ii</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> Suc <span class="skolem">ii</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> h1  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append4<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append5<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> length <span class="free">x</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>  <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append6<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">-</span> length <span class="free">x</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append6a<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">-</span> length <span class="free">x</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span> 

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append7<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> length <span class="free">x</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append8<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> list_nth_append9<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  
<span class="keyword1"><span class="command">lemma</span></span> list_nth_append10<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">-</span> Suc <span class="main">(</span>length <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>Suc <span class="main">(</span>length <span class="free">x</span> <span class="main">+</span> length <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="arith_hints">
<div class="head">
<h1>Theory arith_hints</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Theory arith_hints.thy 
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary arithmetic lemmas›</span></span>

<span class="keyword1"><span class="command">theory</span></span> arith_hints
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arith_mod_neq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">b</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> arith_mod_nzero<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> arith_mult_neq_nzero1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="free">i</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arith_mod_neq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arith_mult_neq_nzero2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arith_mult_neq_nzero1 add.commute<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> arith_mult_neq_nzero3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">*</span> <span class="free">qc</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">*</span><span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">+</span> <span class="free">i</span>  <span class="main">≠</span> <span class="free">n</span> <span class="main">*</span> <span class="free">qc</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arith_mult_neq_nzero2<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span><span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">+</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> arith_modZero1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">mod</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mod_mult_self1_is_0 mult_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arith_modZero2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> Suc <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right add_Suc_shift mod_mult_self1_is_0 mult_Suc mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arith1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">=</span> Suc <span class="free">n</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_cancel2 mult.commute neq0_conv zero_less_Suc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arith2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="free">n</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">=</span> <span class="free">q</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arith1 mult_Suc<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="stream">
<div class="head">
<h1>Theory stream</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Theory  stream.thy (FOCUS streams)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"FOCUS streams: operators and lemmas"</span></span>
 
<span class="keyword1"><span class="command">theory</span></span> stream
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="ListExtras.html">ListExtras</a> <a href="ArithExtras.html">ArithExtras</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of the FOCUS stream types›</span></span>

<span class="comment1">― ‹Finite timed FOCUS stream›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> fstream <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list list"</span></span>

<span class="comment1">― ‹Infinite timed FOCUS stream›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> istream <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>

<span class="comment1">― ‹Infinite untimed FOCUS stream›</span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> iustream <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="comment1">― ‹FOCUS stream (general)›</span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> stream <span class="main">=</span> 
          FinT <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream"</span></span> <span class="comment1">― ‹finite timed streams›</span>
        <span class="main">|</span> FinU <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="comment1">― ‹finite untimed streams›</span>
        <span class="main">|</span> InfT <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream"</span></span> <span class="comment1">― ‹infinite timed streams›</span>
        <span class="main">|</span> InfU <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> iustream"</span></span> <span class="comment1">― ‹infinite untimed streams›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions of operators›</span></span>
  
<span class="comment1">― ‹domain of an infinite untimed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">infU_dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"natInf set"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">infU_dom</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>Fin <span class="bound">i</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">∞</span><span class="main">}</span>"</span></span>
  
<span class="comment1">― ‹domain of a finite untimed stream (using natural numbers enriched by Infinity)›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">finU_dom_natInf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> natInf set"</span></span>
   <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finU_dom_natInf</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>Fin <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="comment1">― ‹domain of a finite untimed stream›</span>
<span class="keyword1"><span class="command">primrec</span></span>
<span class="entity">finU_dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finU_dom</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">finU_dom</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="free">finU_dom</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹range of a finite timed stream›</span>
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">finT_range</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>  
  <span class="quoted"><span class="quoted">"<span class="free">finT_range</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">finT_range</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="free">finT_range</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="comment1">― ‹range of a finite untimed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">finU_range</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">finU_range</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> set <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="comment1">― ‹range of an infinite timed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">infT_range</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">infT_range</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">y</span> <span class="keyword1">mem</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="comment1">― ‹range of a finite untimed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">infU_range</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">infU_range</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">}</span>"</span></span>

<span class="comment1">― ‹range of a (general) stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">stream_range</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stream <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">stream_range</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span>
       FinT <span class="bound">x</span> <span class="main">⇒</span> finT_range <span class="bound">x</span> 
     <span class="main">|</span> FinU <span class="bound">x</span> <span class="main">⇒</span> finU_range <span class="bound">x</span> 
     <span class="main">|</span> InfT <span class="bound">x</span> <span class="main">⇒</span> infT_range <span class="bound">x</span>  
     <span class="main">|</span> InfU <span class="bound">x</span> <span class="main">⇒</span> infU_range <span class="bound">x</span>"</span></span> 

<span class="comment1">― ‹finite timed stream that consists of n empty time intervals›</span> 
<span class="keyword1"><span class="command">primrec</span></span>
   <span class="entity">nticks</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> fstream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nticks</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">nticks</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">#</span> <span class="main">(</span><span class="free">nticks</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹removing the first element from an infinite stream›</span>
<span class="comment1">― ‹in the case of an untimed stream: removing the first data element›</span>  
<span class="comment1">― ‹in the case of a timed stream: removing the first time interval›</span> 
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">inf_tl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_tl</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹removing i first elements from an infinite stream s›</span>  
<span class="comment1">― ‹in the case of an untimed stream: removing i first data elements›</span>  
<span class="comment1">― ‹in the case of a timed stream: removing i first time intervals›</span> 
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">inf_drop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_drop</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>  <span class="main">λ</span> <span class="bound">j</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">+</span><span class="bound">j</span><span class="main">)</span>"</span></span>  

<span class="comment1">― ‹finding the first nonempty time interval in a finite timed stream›</span>
<span class="keyword1"><span class="command">primrec</span></span>
 <span class="entity">fin_find1nonemp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">fin_find1nonemp</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_find1nonemp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">[]</span>
      <span class="keyword1">then</span> <span class="free">fin_find1nonemp</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
      <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">)</span>"</span></span>

<span class="comment1">― ‹finding the first nonempty time interval in an infinite timed stream›</span>
<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">inf_find1nonemp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">inf_find1nonemp</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> 
  <span class="main">≡</span>
  <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>
    <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">[]</span> <span class="main">)</span>"</span></span>

<span class="comment1">― ‹finding the index of the first nonempty time interval in a finite timed stream›</span>
<span class="keyword1"><span class="command">primrec</span></span>
 <span class="entity">fin_find1nonemp_index</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_find1nonemp_index</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_find1nonemp_index</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">[]</span>
      <span class="keyword1">then</span> Suc <span class="main">(</span><span class="free">fin_find1nonemp_index</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span>"</span></span>

<span class="comment1">― ‹finding the index of the first nonempty time interval in an infinite timed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">inf_find1nonemp_index</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">inf_find1nonemp_index</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> 
  <span class="main">≡</span>
  <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>
    <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">0</span> <span class="main">)</span>"</span></span>

<span class="comment1">― ‹length of a finite timed stream: number of data elements in this stream›</span>  
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">fin_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_length</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_length</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">fin_length</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹length of a (general) stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">stream_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stream <span class="main">⇒</span> natInf"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stream_length</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> 
      <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> 
                <span class="main">(</span>FinT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> Fin <span class="main">(</span>fin_length <span class="bound">x</span><span class="main">)</span> 
              <span class="main">|</span> <span class="main">(</span>FinU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> Fin <span class="main">(</span>length <span class="bound">x</span><span class="main">)</span>  
              <span class="main">|</span> <span class="main">(</span>InfT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">∞</span> 
              <span class="main">|</span> <span class="main">(</span>InfU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">∞</span>"</span></span>

<span class="comment1">― ‹removing the first k elements from a finite (nonempty) timed stream›</span>
<span class="keyword1"><span class="command">axiomatization</span></span>
  <span class="free">fin_nth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
   fin_nth_Cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_nth</span> <span class="main">(</span><span class="free">hds</span> <span class="main">#</span> <span class="free">tls</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> 
      <span class="main">(</span> <span class="keyword1">if</span> <span class="free">hds</span> <span class="main">=</span> <span class="main">[]</span>
        <span class="keyword1">then</span> <span class="free">fin_nth</span> <span class="free">tls</span> <span class="free">k</span>
        <span class="keyword1">else</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free">k</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">hds</span><span class="main">)</span><span class="main">)</span>
               <span class="keyword1">then</span> nth <span class="free">hds</span> <span class="free">k</span>
               <span class="keyword1">else</span> <span class="free">fin_nth</span> <span class="free">tls</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> length <span class="free">hds</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹removing i first data elements from an infinite timed stream s›</span>   
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">inf_nth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">inf_nth</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">inf_nth</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
        <span class="keyword1">then</span> <span class="main">(</span>nth <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">else</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>
               <span class="keyword1">then</span> <span class="main">(</span><span class="free">inf_nth</span> <span class="main">(</span>inf_tl <span class="main">(</span>inf_drop 
                     <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">)</span>
               <span class="keyword1">else</span> <span class="free">inf_nth</span> <span class="main">(</span>inf_tl <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹removing the first k data elements from a (general) stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
    <span class="entity">stream_nth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stream <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">stream_nth</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> 
         <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>FinT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> fin_nth <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>
                 <span class="main">|</span> <span class="main">(</span>FinU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> nth <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>
                 <span class="main">|</span> <span class="main">(</span>InfT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> inf_nth <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> 
                 <span class="main">|</span> <span class="main">(</span>InfU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>

<span class="comment1">― ‹prefix of an infinite stream›</span>
<span class="keyword1"><span class="command">primrec</span></span> 
  <span class="entity">inf_prefix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>   
  <span class="quoted"><span class="quoted">"<span class="free">inf_prefix</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_prefix</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">inf_prefix</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="comment1">― ‹prefix of a finite stream›</span>
<span class="keyword1"><span class="command">primrec</span></span> 
  <span class="entity">fin_prefix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>   
  <span class="quoted"><span class="quoted">"<span class="free">fin_prefix</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_prefix</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> 
     <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> 
      <span class="keyword1">then</span> False
      <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>hd <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">fin_prefix</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="comment1">― ‹prefix of a (general) stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">stream_prefix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stream <span class="main">⇒</span> <span class="tfree">'a</span> stream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stream_prefix</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>
   <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">of</span> 
        <span class="main">(</span>FinT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> 
        <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>FinT <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span>  <span class="main">(</span>fin_prefix <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
                 <span class="main">|</span> <span class="main">(</span>FinU <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False
                 <span class="main">|</span> <span class="main">(</span>InfT <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> inf_prefix <span class="bound">x</span> <span class="bound">y</span> <span class="main">0</span>
                 <span class="main">|</span> <span class="main">(</span>InfU <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False <span class="main">)</span>
      <span class="main">|</span> <span class="main">(</span>FinU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> 
        <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>FinT <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False
                 <span class="main">|</span> <span class="main">(</span>FinU <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span>  <span class="main">(</span>fin_prefix <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>
                 <span class="main">|</span> <span class="main">(</span>InfT <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False
                 <span class="main">|</span> <span class="main">(</span>InfU <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span>  inf_prefix <span class="bound">x</span> <span class="bound">y</span> <span class="main">0</span> <span class="main">)</span>    
      <span class="main">|</span> <span class="main">(</span>InfT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span>
        <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>FinT <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False
                 <span class="main">|</span> <span class="main">(</span>FinU <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False
                 <span class="main">|</span> <span class="main">(</span>InfT <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">y</span> <span class="bound">i</span><span class="main">)</span>
                 <span class="main">|</span> <span class="main">(</span>InfU <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False <span class="main">)</span> 
      <span class="main">|</span> <span class="main">(</span>InfU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span>
        <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>FinT <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False
                 <span class="main">|</span> <span class="main">(</span>FinU <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False
                 <span class="main">|</span> <span class="main">(</span>InfT <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> False
                 <span class="main">|</span> <span class="main">(</span>InfU <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">x</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">)</span>  <span class="main">)</span>"</span></span>

<span class="comment1">― ‹truncating a finite stream after the n-th element›</span>
<span class="keyword1"><span class="command">primrec</span></span>  
<span class="entity">fin_truncate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">fin_truncate</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_truncate</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> 
      <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="main">[]</span> 
         <span class="main">|</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">fin_truncate</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹truncating a finite stream after the n-th element›</span>
<span class="comment1">― ‹n is of type of natural numbers enriched by Infinity›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">fin_truncate_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> natInf <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
 <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_truncate_plus</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> 
  <span class="main">≡</span> 
  <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>Fin <span class="bound">i</span><span class="main">)</span> <span class="main">⇒</span> fin_truncate <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span>
           <span class="main">|</span>  <span class="main">∞</span>     <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> "</span></span>

<span class="comment1">― ‹truncating an infinite stream after the n-th element›</span>
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">inf_truncate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>   
   <span class="quoted"><span class="quoted">"<span class="free">inf_truncate</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">]</span>"</span></span> <span class="main">|</span>
   <span class="quoted"><span class="quoted">"<span class="free">inf_truncate</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">inf_truncate</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="comment1">― ‹truncating an infinite stream after the n-th element›</span>
<span class="comment1">― ‹n is of type of natural numbers enriched by Infinity›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">inf_truncate_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> natInf <span class="main">⇒</span> <span class="tfree">'a</span> stream"</span></span> 
 <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">inf_truncate_plus</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> 
  <span class="main">≡</span> 
  <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>Fin <span class="bound">i</span><span class="main">)</span> <span class="main">⇒</span> FinT <span class="main">(</span>inf_truncate <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span>
           <span class="main">|</span> <span class="main">∞</span>     <span class="main">⇒</span> InfT <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="comment1">― ‹concatanation of a finite and an infinite stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
    <span class="entity">fin_inf_append</span> <span class="main">::</span> 
        <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">fin_inf_append</span> <span class="free"><span class="bound"><span class="entity">us</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>  
 <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">then</span> <span class="main">(</span>nth <span class="free"><span class="bound"><span class="entity">us</span></span></span> <span class="bound">i</span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="bound">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">us</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> 
 
<span class="comment1">― ‹insuring that the infinite timed stream is time-synchronous›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">ts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">ts</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>  <span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹insuring that each time interval of an infinite timed stream contains at most n data elements›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">msg</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>  <span class="main">∀</span> <span class="bound">t</span><span class="main">.</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="comment1">― ‹insuring that each time interval of a finite timed stream contains at most n data elements›</span>
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">fin_msg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> list list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>   
 <span class="quoted"><span class="quoted">"<span class="free">fin_msg</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_msg</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">fin_msg</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="comment1">― ‹making a finite timed stream to a finite untimed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">fin_make_untimed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream  <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_make_untimed</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span>  concat <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="comment1">― ‹making an infinite timed stream to an infinite untimed stream›</span>
<span class="comment1">― ‹(auxiliary function)›</span>
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">inf_make_untimed1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> "</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
inf_make_untimed1_0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_make_untimed1</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="main">|</span>
inf_make_untimed1_Suc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_make_untimed1</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">then</span> nth <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>
             <span class="keyword1">then</span> <span class="main">(</span><span class="free">inf_make_untimed1</span> <span class="main">(</span>inf_tl <span class="main">(</span>inf_drop 
                          <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>
                           <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">)</span>
             <span class="keyword1">else</span> <span class="free">inf_make_untimed1</span> <span class="main">(</span>inf_tl <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">)</span><span class="main">)</span>"</span></span>
             
<span class="comment1">― ‹making an infinite timed stream to an infinite untimed stream›</span>
<span class="comment1">― ‹(main function)›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">inf_make_untimed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> "</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_make_untimed</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>
   <span class="main">≡</span> 
   <span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> inf_make_untimed1 <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span>"</span></span>

<span class="comment1">― ‹making a (general) stream untimed›</span>
<span class="keyword1"><span class="command">definition</span></span>
    <span class="entity">make_untimed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stream  <span class="main">⇒</span> <span class="tfree">'a</span> stream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">make_untimed</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> 
      <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>FinT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> FinU <span class="main">(</span>fin_make_untimed <span class="bound">x</span><span class="main">)</span>
              <span class="main">|</span> <span class="main">(</span>FinU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> FinU <span class="bound">x</span>
              <span class="main">|</span> <span class="main">(</span>InfT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> 
                <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">i</span><span class="main">.</span><span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>
                 <span class="keyword1">then</span> FinU <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="bound">x</span> 
                             <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span><span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="keyword1">else</span> InfU <span class="main">(</span>inf_make_untimed <span class="bound">x</span><span class="main">)</span><span class="main">)</span>
              <span class="main">|</span> <span class="main">(</span>InfU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> InfU <span class="bound">x</span>"</span></span>


<span class="comment1">― ‹finding the index of the time interval that contains the k-th data element›</span>
<span class="comment1">― ‹defined over a finite timed stream›</span>
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">fin_tm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_tm</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_tm</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">0</span>
     <span class="keyword1">then</span> <span class="main">0</span>
     <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≤</span> length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>
           <span class="keyword1">then</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>
           <span class="keyword1">else</span> Suc<span class="main">(</span><span class="free">fin_tm</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">-</span> length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹auxiliary lemma for the definition of the truncate operator›</span>
<span class="keyword1"><span class="command">lemma</span></span> inf_tm_hint1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="main">=</span> Suc <span class="free">i</span> <span class="main">-</span> length <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Suc <span class="free">i</span> <span class="main">≤</span> length <span class="free">a</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="main">&lt;</span> Suc <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="comment1">― ‹filtering a finite timed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">finT_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">=&gt;</span> <span class="tfree">'a</span> fstream <span class="main">=&gt;</span> <span class="tfree">'a</span> fstream"</span></span>   
<span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">finT_filter</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>  map <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> filter <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="comment1">― ‹filtering an infinite timed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">infT_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">=&gt;</span> <span class="tfree">'a</span> istream <span class="main">=&gt;</span> <span class="tfree">'a</span> istream"</span></span>  
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">infT_filter</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span> filter <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹removing duplications from a finite timed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">finT_remdups</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">=&gt;</span> <span class="tfree">'a</span> fstream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>  
  <span class="quoted"><span class="quoted">"<span class="free">finT_remdups</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>  map <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span><span class="main">.</span> remdups <span class="bound">s</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="comment1">― ‹removing duplications from an infinite timed stream›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">infT_remdups</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">=&gt;</span> <span class="tfree">'a</span> istream"</span></span>  
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">infT_remdups</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span> remdups <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹removing duplications from a time interval of a stream›</span>
<span class="keyword1"><span class="command">primrec</span></span>
   <span class="entity">fst_remdups</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">fst_remdups</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">fst_remdups</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">[]</span> 
     <span class="keyword1">then</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span>
     <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>hd <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
           <span class="keyword1">then</span> <span class="free">fst_remdups</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
           <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹time interval operator›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ti</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span>  
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">[]</span>
     <span class="keyword1">then</span> <span class="main">[]</span>
     <span class="keyword1">else</span> <span class="main">(</span>nth <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹insuring that a sheaf of channels is correctly defined›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">CorrectSheaf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">CorrectSheaf</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
 
<span class="comment1">― ‹insuring that all channels in a sheaf are disjunct›</span>
<span class="comment1">― ‹indices in the sheaf are represented using an extra specified set›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">inf_disjS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> istream<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_disjS</span> <span class="free"><span class="bound"><span class="entity">IdSet</span></span></span> <span class="free"><span class="bound"><span class="entity">nS</span></span></span>
   <span class="main">≡</span>
   <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">IdSet</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">j</span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">IdSet</span></span></span><span class="main">)</span> <span class="main">∧</span>  
   <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nS</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nS</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>  

<span class="comment1">― ‹insuring that all channels in a sheaf are disjunct›</span>
<span class="comment1">― ‹indices in the sheaf are represented using natural numbers›</span>
<span class="keyword1"><span class="command">definition</span></span>              
   <span class="entity">inf_disj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> istream<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inf_disj</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nS</span></span></span>
   <span class="main">≡</span>
   <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
   <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>  <span class="main">∧</span>  <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nS</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>  <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nS</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>  

<span class="comment1">― ‹taking the prefix of n data elements from a finite timed stream›</span>
<span class="comment1">― ‹(defined over natural numbers)›</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fin_get_prefix</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> fstream <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> fstream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_get_prefix</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fin_get_prefix</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> 
       <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free">fin_get_prefix</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span> <span class="main">[</span>take <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">)</span> "</span></span>

<span class="comment1">― ‹taking the prefix of n data elements from a finite timed stream›</span>
<span class="comment1">― ‹(defined over natural numbers enriched by Infinity)›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">fin_get_prefix_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> natInf <span class="main">⇒</span> <span class="tfree">'a</span> fstream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_get_prefix_plus</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> 
  <span class="main">≡</span> 
  <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>Fin <span class="bound">i</span><span class="main">)</span> <span class="main">⇒</span> fin_get_prefix<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span>
           <span class="main">|</span> <span class="main">∞</span>      <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> "</span></span>

<span class="comment1">― ‹auxiliary lemmas›</span>
<span class="keyword1"><span class="command">lemma</span></span> length_inf_drop_hint1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"length <span class="main">(</span>inf_drop <span class="free">k</span> <span class="free">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inf_drop_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_inf_drop_hint2<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> length <span class="main">(</span>inf_drop <span class="main">0</span> <span class="free">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="free">i</span> 
  <span class="main">⟶</span> Suc <span class="free">i</span> <span class="main">-</span> length <span class="main">(</span>inf_drop <span class="main">0</span> <span class="free">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_drop_def list_length_hint1<span class="main">)</span>

<span class="comment1">― ‹taking the prefix of n data elements from an infinite timed stream›</span>
<span class="comment1">― ‹(defined over natural numbers)›</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">infT_get_prefix</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> istream <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> fstream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>   
  <span class="quoted"><span class="quoted">"<span class="free">infT_get_prefix</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">infT_get_prefix</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>
      <span class="keyword1">then</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>
             <span class="keyword1">then</span> <span class="main">[]</span>
             <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> 
                     <span class="bound">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">k</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                     <span class="bound">s2</span> <span class="main">=</span> inf_drop <span class="main">(</span><span class="bound">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>
                   <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">=</span><span class="main">0</span><span class="main">)</span> 
                       <span class="keyword1">then</span> <span class="main">[]</span> 
                       <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span>length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">k</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> 
                             <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">k</span> <span class="main">#</span> <span class="free">infT_get_prefix</span> <span class="main">(</span><span class="bound">s2</span><span class="main">,</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>
                             <span class="keyword1">else</span> <span class="main">[</span>take <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">]</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">)</span>
      <span class="keyword1">else</span> 
        <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span> 
         <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">#</span> <span class="free">infT_get_prefix</span><span class="main">(</span> inf_drop <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>length <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="main">[</span>take <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span><span class="main">]</span> 
         <span class="main">)</span>
     <span class="main">)</span>"</span></span>

<span class="comment1">― ‹taking the prefix of n data elements from an infinite untimed stream›</span>
<span class="comment1">― ‹(defined over natural numbers)›</span>
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">infU_get_prefix</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">infU_get_prefix</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">infU_get_prefix</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> 
         <span class="main">=</span> <span class="main">(</span><span class="free">infU_get_prefix</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">]</span>"</span></span>

<span class="comment1">― ‹taking the prefix of n data elements from an infinite timed stream›</span>
<span class="comment1">― ‹(defined over natural numbers enriched by Infinity)›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">infT_get_prefix_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> natInf <span class="main">⇒</span> <span class="tfree">'a</span> stream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">infT_get_prefix_plus</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> 
  <span class="main">≡</span> 
  <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>Fin <span class="bound">i</span><span class="main">)</span> <span class="main">⇒</span> FinT <span class="main">(</span>infT_get_prefix<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">|</span> <span class="main">∞</span>     <span class="main">⇒</span> InfT <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="comment1">― ‹taking the prefix of n data elements from an infinite untimed stream›</span>
<span class="comment1">― ‹(defined over natural numbers enriched by Infinity)›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">infU_get_prefix_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> natInf <span class="main">⇒</span> <span class="tfree">'a</span> stream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">infU_get_prefix_plus</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> 
  <span class="main">≡</span> 
  <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>Fin <span class="bound">i</span><span class="main">)</span> <span class="main">⇒</span> FinU <span class="main">(</span>infU_get_prefix <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">i</span><span class="main">)</span> 
           <span class="main">|</span> <span class="main">∞</span>     <span class="main">⇒</span> InfU <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="comment1">― ‹taking the prefix of n data elements from an infinite stream›</span>
<span class="comment1">― ‹(defined over natural numbers enriched by Infinity)›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">take_plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"natInf <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">take_plus</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> 
  <span class="main">≡</span> 
  <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> <span class="main">(</span>Fin <span class="bound">i</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>take <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> 
           <span class="main">|</span> <span class="main">∞</span>      <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="comment1">― ‹taking the prefix of n data elements from a (general) stream›</span>
<span class="comment1">― ‹(defined over natural numbers enriched by Infinity)›</span>
<span class="keyword1"><span class="command">definition</span></span> 
   <span class="entity">get_prefix</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stream <span class="main">⇒</span> natInf <span class="main">⇒</span> <span class="tfree">'a</span> stream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">get_prefix</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> 
        <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">of</span>  <span class="main">(</span>FinT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> FinT <span class="main">(</span>fin_get_prefix_plus <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>
                 <span class="main">|</span> <span class="main">(</span>FinU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> FinU <span class="main">(</span>take_plus <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="bound">x</span><span class="main">)</span>
                 <span class="main">|</span> <span class="main">(</span>InfT <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> infT_get_prefix_plus <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>
                 <span class="main">|</span> <span class="main">(</span>InfU <span class="bound">x</span><span class="main">)</span> <span class="main">⇒</span> infU_get_prefix_plus <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>

<span class="comment1">― ‹merging time intervals of two finite timed streams›</span>
<span class="keyword1"><span class="command">primrec</span></span>
   <span class="entity">fin_merge_ti</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> <span class="tfree">'a</span> fstream <span class="main">⇒</span> <span class="tfree">'a</span> fstream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_merge_ti</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_merge_ti</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> 
    <span class="main">(</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
         <span class="main">|</span> <span class="main">(</span><span class="bound">z</span><span class="main">#</span><span class="bound">zs</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">@</span><span class="bound">z</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">fin_merge_ti</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="bound">zs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹merging time intervals of two infinite timed streams›</span>
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">inf_merge_ti</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> <span class="tfree">'a</span> istream <span class="main">⇒</span> <span class="tfree">'a</span> istream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">inf_merge_ti</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> 
  <span class="main">≡</span> 
  <span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹the last time interval of a finite timed stream›</span>
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">fin_last_ti</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>   
 <span class="quoted"><span class="quoted">"<span class="free">fin_last_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">=</span> hd <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_last_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">!</span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>
       <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">!</span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> 
       <span class="keyword1">else</span> <span class="free">fin_last_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹the last nonempty time interval of a finite timed stream›</span>
<span class="comment1">― ‹(can be applied to the streams which time intervals are empty from some moment)›</span>
<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">inf_last_ti</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>  
 <span class="quoted"><span class="quoted">"<span class="free">inf_last_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span>"</span></span> <span class="main">|</span>
 <span class="quoted"><span class="quoted">"<span class="free">inf_last_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>
       <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> 
       <span class="keyword1">else</span> <span class="free">inf_last_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_last_ti_nonempty_k<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inf_last_ti_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"inf_last_ti <span class="free">s</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arith_sum_t2k<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span> 

<span class="keyword1"><span class="command">lemma</span></span> inf_last_ti_Suc2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">dt</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">dt</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">dt</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">dt</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inf_last_ti_nonempty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arith_sum_t2k<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">dt</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">dt</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inf_last_ti_nonempty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for concatenation operator›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fin_length_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fin_length <span class="main">(</span><span class="free">x</span><span class="main">@</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fin_length <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>fin_length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_append_Nil<span class="main">:</span>  <span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[]</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_inf_append_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> correct_fin_inf_append1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">=</span> fin_inf_append <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_inf_append_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> correct_fin_inf_append2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="free">s</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_inf_append_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_append_com_Nil1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[]</span> <span class="main">(</span>fin_inf_append <span class="free">y</span> <span class="free">z</span><span class="main">)</span> 
   <span class="main">=</span> fin_inf_append <span class="main">(</span><span class="main">[]</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_append_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_append_com_Nil2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fin_inf_append <span class="free">x</span> <span class="main">(</span>fin_inf_append <span class="main">[]</span> <span class="free">z</span><span class="main">)</span> 
  <span class="main">=</span> fin_inf_append <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="main">[]</span><span class="main">)</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_append_Nil<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_append_com_i<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fin_inf_append <span class="free">x</span> <span class="main">(</span>fin_inf_append <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> fin_inf_append <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="free">i</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_append_com_Nil1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> Cons<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_append_com_Nil2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="skolem">la</span> <span class="keyword3"><span class="command">assume</span></span> Cons2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">la</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_inf_append_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_nth_append0<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for operators $ts$ and $msg$›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_msg1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"msg <span class="main">1</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_def msg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ts_inf_tl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"ts <span class="main">(</span>inf_tl <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_def inf_tl_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ts_length_hint1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">x</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_length_hint2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">x</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ts_Least_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ts_length_hint1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Least_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_tl_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"inf_tl <span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_tl_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> ts_Least_Suc0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">i</span><span class="main">.</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_length_hint1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Least_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_inf_make_untimed_inf_tl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"inf_make_untimed <span class="main">(</span>inf_tl <span class="free">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> inf_make_untimed <span class="free">x</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_make_untimed_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_less_eq gr_implies_not0 ts_length_hint1 ts_length_hint2<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> ts_inf_make_untimed1_inf_tl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"inf_make_untimed1 <span class="main">(</span>inf_tl <span class="free">x</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> inf_make_untimed1 <span class="free">x</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_make_untimed_def ts_inf_make_untimed_inf_tl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> msg_nonempty1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="free">aa</span> <span class="main">#</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> msg_nonempty2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span>  <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for $inf\_truncate$›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_truncate_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"inf_truncate <span class="free">z</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">from</span></span> assms  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> concat_inf_truncate_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"concat <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> concat_inf_truncate_nonempty_a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"concat <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> concat_inf_truncate_nonempty list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> concat_inf_truncate_nonempty_el<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"concat <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> concat_inf_truncate_nonempty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inf_truncate_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span> <span class="main">@</span> <span class="main">[</span><span class="free">z</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> inf_truncate <span class="free">z</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_truncate.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for $fin\_make\_untimed$›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> fin_make_untimed_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fin_make_untimed <span class="free">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span><span class="free">x</span> <span class="main">@</span> <span class="free">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> fin_make_untimed_inf_truncate_Nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">∈</span>set <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">k</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span><span class="main">∈</span>set <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_fin_make_untimed_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span><span class="free">z</span> <span class="main">@</span> <span class="main">[</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> last_fin_make_untimed_inf_truncate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> 0  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fin_make_untimed_append_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span><span class="free">z</span> <span class="main">@</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> fin_make_untimed <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_make_untimed_inf_truncate_append_a<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span> <span class="main">@</span> <span class="main">[</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> 
  <span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span> <span class="main">@</span> <span class="main">[</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_make_untimed_inf_truncate_Nonempty_all<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">⟶</span> fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  fin_make_untimed_inf_truncate_Nonempty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_make_untimed_inf_truncate_Nonempty_all0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_inf_truncate_Nonempty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_make_untimed_inf_truncate_Nonempty_all0a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_inf_truncate_Nonempty_all0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_make_untimed_inf_truncate_Nonempty_all_app<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="bound">i</span> <span class="main">@</span> <span class="main">[</span><span class="free">z</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_inf_truncate_Nonempty_all0a<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="skolem">i</span> <span class="main">@</span> <span class="main">[</span><span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fin_make_untimed_nth_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">!</span> 
     <span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>
    <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
<span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_fin_make_untimed_inf_truncate<span class="main">)</span>
<span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"concat <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_inf_truncate_nonempty_a<span class="main">)</span>
<span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def last_nth_length<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for $inf\_disj$ and $inf\_disjS$›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> inf_disj_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"inf_disj <span class="free">n</span> <span class="free">nS</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">nS</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span>  <span class="free">nS</span> <span class="bound">i</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">∧</span> <span class="free">nS</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">nS</span> <span class="bound">j</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_disj_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> inf_disjS_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"inf_disjS <span class="free">IdSet</span> <span class="free">nS</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">:</span><span class="free">IdSet</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">nS</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="bound">i</span><span class="main">:</span><span class="free">IdSet</span><span class="main">)</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="bound">i</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> <span class="free">k</span> <span class="main">∈</span> <span class="free">IdSet</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">IdSet</span> <span class="main">∧</span> <span class="free">nS</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">nS</span> <span class="bound">j</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_disjS_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="BitBoolTS">
<div class="head">
<h1>Theory BitBoolTS</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Theory BitBoolTS.thy
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Properties of time-synchronous streams of types bool and bit›</span></span>

<span class="keyword1"><span class="command">theory</span></span> BitBoolTS 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <a href="stream.html">stream</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> bit <span class="main">=</span> Zero <span class="main">|</span> One

<span class="keyword1"><span class="command">primrec</span></span> 
   <span class="entity">negation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit <span class="main">⇒</span> bit"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">negation</span> Zero <span class="main">=</span> One"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">negation</span> One <span class="main">=</span> Zero"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ts_bit_stream_One<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[</span>Zero<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">x</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> Cons<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Zero"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> One"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_bit_stream_Zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[</span>One<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">x</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> Cons<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> Zero"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> One"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_bool_True<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">x</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> Cons<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_bool_False<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">x</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> Cons<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_bool_True_False<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"bool istream"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> 
</pre>
</div><div id="JoinSplitTime">
<div class="head">
<h1>Theory JoinSplitTime</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Theory JoinSplitTime.thy
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span> 
<span class="comment1">(*&gt;*)</span>
 <span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Changing time granularity of the streams›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> JoinSplitTime
<span class="keyword2"><span class="keyword">imports</span></span> <a href="stream.html">stream</a> <a href="arith_hints.html">arith_hints</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span>  <span class="quoted"><span class="plain_text">‹Join time units›</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">join_ti</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
join_ti_0<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">join_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
join_ti_Suc<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">join_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">join_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span>
  <span class="entity">fin_join_ti</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fstream <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
fin_join_ti_0<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_join_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="main">=</span> nth <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
fin_join_ti_Suc<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">fin_join_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">fin_join_ti</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>nth <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">join_time</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> istream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">join_time</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">of</span> 
        <span class="main">0</span>  <span class="main">⇒</span> <span class="main">[]</span>
  <span class="main">|</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">⇒</span>  join_ti <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> join_ti_hint1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"join_ti <span class="free">s</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"join_ti <span class="free">s</span> <span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> join_ti_hint2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"join_ti <span class="free">s</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> join_ti_hint3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"join_ti <span class="free">s</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> join_ti_empty_join<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"join_ti <span class="free">s</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> join_ti_hint1 join_ti_hint2 le_SucE<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> join_ti_empty_ti<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> <span class="free">s</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"join_ti <span class="free">s</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
 
<span class="keyword1"><span class="command">lemma</span></span> join_ti_1nempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"join_ti <span class="free">s</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="free">s</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> join_time1t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">.</span> join_time <span class="free">s</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">s</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> join_time_def<span class="main">)</span>

 
<span class="keyword1"><span class="command">lemma</span></span> join_time1<span class="main">:</span> <span class="quoted"><span class="quoted">"join_time <span class="free">s</span> <span class="main">1</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff join_time_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> join_time_empty1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"join_time <span class="free">s</span> <span class="free">n</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">(</span><span class="free">n</span><span class="main">*</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> join_time_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"join_ti <span class="free">s</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>    
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> join_time_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> join_ti_empty_join<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fin_join_ti_hint1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fin_join_ti <span class="free">s</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"fin_join_ti <span class="free">s</span> <span class="free">x</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_join_ti_hint2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fin_join_ti <span class="free">s</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"nth <span class="free">s</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1"><span class="command">lemma</span></span> fin_join_ti_hint3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fin_join_ti <span class="free">s</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"nth <span class="free">s</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_join_ti_empty_join<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fin_join_ti <span class="free">s</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"nth <span class="free">s</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> Suc <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fin_join_ti_empty_ti<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">≤</span> <span class="free">n</span><span class="main">.</span> nth <span class="free">s</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"fin_join_ti <span class="free">s</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fin_join_ti_1nempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span> <span class="main">⟶</span> nth <span class="free">s</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"fin_join_ti <span class="free">s</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> nth <span class="free">s</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Split time units›</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">split_time</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> istream <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> istream"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">split_time</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">≡</span> 
  <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
    <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> split_time1t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">.</span> split_time <span class="free">s</span> <span class="main">1</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">s</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_time_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> split_time1<span class="main">:</span> <span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="main">1</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff split_time_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> split_time_mod<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="free">n</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_time_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> split_time_nempty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="free">n</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_time_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> split_time_nempty_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> split_time <span class="free">s</span> <span class="free">n</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span>  <span class="free">s</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_time_nempty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="free">n</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="free">t</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_time_nempty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> split_time_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="free">n</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arith_mod_nzero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_time_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> split_time_empty_Suc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span>  <span class="main">=</span> split_time <span class="free">s</span> <span class="free">n</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_time_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="free">n</span> <span class="main">(</span><span class="free">n</span> <span class="main">*</span> <span class="free">t</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_time_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> split_time_hint1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> Suc <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_time_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg4  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Duality of the split and the join operators›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> join_split_i<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"join_time <span class="main">(</span>split_time <span class="free">s</span> <span class="free">n</span><span class="main">)</span> <span class="free">n</span> <span class="free">i</span> <span class="main">=</span> <span class="free">s</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sg0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_time_nempty<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> Suc <span class="skolem">k</span> <span class="main">⟶</span> split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> split_time_empty<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"join_ti <span class="main">(</span>split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">=</span> 
                     <span class="main">(</span>split_time <span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="main">*</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> join_ti_1nempty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> join_time_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> join_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"join_time <span class="main">(</span>split_time <span class="free">s</span> <span class="free">n</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff join_split_i<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SteamBoiler">
<div class="head">
<h1>Theory SteamBoiler</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Theory SteamBoiler.thy (Steam Boiler System: Specification)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Steam Boiler System: Specification›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  SteamBoiler 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="stream.html">stream</a> <a href="BitBoolTS.html">BitBoolTS</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">ControlSystem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">ControlSystem</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span>  
  <span class="main">(</span>ts <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> 
   <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="numeral">200</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">∧</span> hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">800</span><span class="main">::</span> nat<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">SteamBoiler</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit istream <span class="main">⇒</span> nat istream <span class="main">⇒</span> nat istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">SteamBoiler</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span>  
  ts <span class="free"><span class="bound"><span class="entity">x</span></span></span> 
  <span class="main">⟶</span> 
  <span class="main">(</span><span class="main">(</span>ts <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>ts <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∧</span> 
   <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">500</span><span class="main">::</span>nat<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> 
   <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">r</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
                <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">10</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">∧</span> 
                hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                   <span class="main">(</span><span class="keyword1">if</span> hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> Zero 
                    <span class="keyword1">then</span> <span class="main">(</span>hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">r</span> 
                    <span class="keyword1">else</span> <span class="main">(</span>hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Converter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bit istream <span class="main">⇒</span> bit istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Converter</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> 
  <span class="main">≡</span> 
  <span class="main">(</span>ts <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> 
  <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
    hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span><span class="keyword1">if</span>  <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>
         <span class="keyword1">then</span>  
             Zero
         <span class="keyword1">else</span> 
             <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> 
                 <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> 
       <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Controller_L</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"nat istream <span class="main">⇒</span> bit iustream <span class="main">⇒</span> bit iustream <span class="main">⇒</span> bit istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Controller_L</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">lIn</span></span></span> <span class="free"><span class="bound"><span class="entity">lOut</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> 
  <span class="main">≡</span> 
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span><span class="main">)</span> 
  <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
  <span class="main">(</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lIn</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Zero 
    <span class="keyword1">then</span> <span class="main">(</span> <span class="keyword1">if</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">t</span><span class="main">)</span>  
           <span class="keyword1">then</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>    <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lOut</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Zero
           <span class="keyword1">else</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lOut</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> One 
          <span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">(</span> <span class="keyword1">if</span>  hd <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>  
           <span class="keyword1">then</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>     <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lOut</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> One   
           <span class="keyword1">else</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">lOut</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Zero <span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">Controller</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat istream <span class="main">⇒</span> bit istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Controller</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> 
  <span class="main">≡</span> 
  <span class="main">(</span>ts <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>
  <span class="main">⟶</span> 
  <span class="main">(</span><span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> Controller_L <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="bound">l</span><span class="main">)</span> <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">ControlSystemArch</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">ControlSystemArch</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> 
  <span class="main">≡</span> 
  <span class="main">∃</span> <span class="bound">x</span> <span class="bound">z</span> <span class="main">::</span> bit istream<span class="main">.</span> <span class="main">∃</span> <span class="bound">y</span> <span class="main">::</span> nat istream<span class="main">.</span>
    <span class="main">(</span> SteamBoiler <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">y</span> <span class="main">∧</span> Controller <span class="bound">y</span> <span class="bound">z</span> <span class="main">∧</span> Converter <span class="bound">z</span> <span class="bound">x</span> <span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> 
</pre>
</div><div id="SteamBoiler_proof">
<div class="head">
<h1>Theory SteamBoiler_proof</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Theory SteamBoiler_proof.thy (Steam Boiler System: Verification)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Steam Boiler System: Verification›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  SteamBoiler_proof 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SteamBoiler.html">SteamBoiler</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the Boiler Component›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L1_Boiler<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"SteamBoiler <span class="free">x</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L2_Boiler<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"SteamBoiler <span class="free">x</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> L3_Boiler<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"SteamBoiler <span class="free">x</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">200</span> <span class="main">≤</span> hd <span class="main">(</span><span class="free">s</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L4_Boiler<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"SteamBoiler <span class="free">x</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">800</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L5_Boiler<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"SteamBoiler <span class="free">x</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">x</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">10</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
   <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="numeral">10</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hd <span class="main">(</span><span class="free">x</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Zero <span class="keyword1">then</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span> <span class="keyword1">else</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L6_Boiler<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"SteamBoiler <span class="free">x</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">x</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">10</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
   <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="numeral">10</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hd <span class="main">(</span><span class="free">x</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Zero <span class="keyword1">then</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span> <span class="keyword1">else</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L7_Boiler<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"SteamBoiler <span class="free">x</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">x</span> <span class="free">j</span><span class="main">)</span> <span class="main">≠</span> Zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">10</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
   <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="numeral">10</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hd <span class="main">(</span><span class="free">x</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Zero <span class="keyword1">then</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span> <span class="keyword1">else</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L8_Boiler<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"SteamBoiler <span class="free">x</span> <span class="free">s</span> <span class="free">y</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">x</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">x</span> <span class="free">j</span><span class="main">)</span> <span class="main">≠</span> Zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">10</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≥</span> hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
   <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="numeral">10</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hd <span class="main">(</span><span class="free">x</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> Zero <span class="keyword1">then</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span> <span class="keyword1">else</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">j</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the Controller Component›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L1_Controller<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">s</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Controller_L_def fin_make_untimed_inf_truncate_Nonempty_all0a<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L2_Controller_Zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Controller_L_def correct_fin_inf_append1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L2_Controller_One<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Controller_L_def bit.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> correct_fin_inf_append2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L3_Controller_Zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Controller_L_def correct_fin_inf_append1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L3_Controller_One<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Controller_L_def bit.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> correct_fin_inf_append1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L4_Controller_Zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> 
       <span class="keyword1">then</span> <span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero 
       <span class="keyword1">else</span> <span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a11 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a12 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> Zero"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span> 
       <span class="keyword1">then</span> <span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One 
       <span class="keyword1">else</span> <span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a21 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> a22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a22 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> L4_Controller_One<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> 
       <span class="keyword1">then</span> <span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero 
       <span class="keyword1">else</span> <span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a11 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a12 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> Zero"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span> 
       <span class="keyword1">then</span> <span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One 
       <span class="keyword1">else</span> <span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a21 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> a22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> hd <span class="main">(</span><span class="free">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a22 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L5_Controller_Zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="free">lIn</span> <span class="free">lOut</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lIn</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lIn</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lIn</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lIn</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span> 
     <span class="keyword1">then</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> One 
     <span class="keyword1">else</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> One"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L5_Controller_One<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="free">lIn</span> <span class="free">lOut</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lIn</span> <span class="free">t</span> <span class="main">=</span> One"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lIn</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lIn</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> 
     <span class="keyword1">then</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> Zero 
     <span class="keyword1">else</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> One"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">lIn</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L5_Controller<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="free">lIn</span> <span class="free">lOut</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">lOut</span> <span class="free">t</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lIn</span> <span class="free">t</span> <span class="main">=</span> <span class="free">a</span>"</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L5_Controller_One L5_Controller_Zero bit.exhaust<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L6_Controller_Zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L4_Controller_Zero not_Cons_self2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L6_Controller_One<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> One"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L4_Controller_One list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L6_Controller<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> L5_Controller correct_fin_inf_append2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L7_Controller_Zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0  
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="skolem">t</span>"</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> Zero"</span></span>
     <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> Zero<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> One<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L4_Controller_Zero<span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
     <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_append_empty<span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span> 
     <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> One"</span></span>
     <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> Zero<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> One<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L4_Controller_Zero<span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
     <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span> 
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L7_Controller_One_l0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">500</span><span class="main">::</span>nat<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">0</span> <span class="main">=</span> Zero"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="free">l</span> <span class="main">0</span> <span class="main">=</span> Zero"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> Zero"</span></span> <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_inf_append_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L7_Controller_One<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">500</span><span class="main">::</span>nat<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> One"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">0</span> <span class="main">=</span> Zero"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L7_Controller_One_l0<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="skolem">t</span>"</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> Zero"</span></span>
     <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> One<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> Zero<span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L4_Controller_One<span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
     <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span> 
   <span class="keyword1"><span class="command">next</span></span> 
     <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> One"</span></span>
     <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> One<span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="skolem">t</span> <span class="main">=</span> Zero<span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L4_Controller_One<span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
     <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_make_untimed_def<span class="main">)</span> 
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L7_Controller<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">500</span><span class="main">::</span>nat<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="free">l</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> L7_Controller_One L7_Controller_Zero bit.exhaust<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L8_Controller<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">y</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∨</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> 
    <span class="keyword1">then</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero 
    <span class="keyword1">else</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a11 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a12 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="free">t</span> <span class="main">≠</span> Zero"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span> 
    <span class="keyword1">then</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> One 
    <span class="keyword1">else</span> <span class="free">z</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">t</span> <span class="main">=</span> Zero"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a21 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> hd <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a22 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L9_Controller<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Controller_L <span class="free">s</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">!</span>
              <span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span>  Zero"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span> <span class="free">i</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="free">r</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="numeral">10</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">200</span> <span class="main">≤</span> hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">i</span> <span class="main">=</span> Zero"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_nth_length<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> Zero"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> Zero"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> 
       <span class="keyword1">then</span> <span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> Zero 
       <span class="keyword1">else</span> <span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> One"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a11 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> a12 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="free">i</span> <span class="main">≠</span> Zero"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span> 
       <span class="keyword1">then</span> <span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> One 
       <span class="keyword1">else</span> <span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> Zero"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h8  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L10_Controller<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Controller_L <span class="free">s</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">!</span>
              <span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≠</span>  Zero"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">l</span> <span class="free">i</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">+</span> <span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="numeral">10</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">800</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">i</span> <span class="main">≠</span>  Zero"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> last_nth_length<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> Zero"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> Zero"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> 
       <span class="keyword1">then</span> <span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> Zero 
       <span class="keyword1">else</span> <span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>One<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> One"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a11 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">300</span> <span class="main">&lt;</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> a12 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="free">l</span> <span class="free">i</span> <span class="main">≠</span> Zero"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span> 
       <span class="keyword1">then</span> <span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> One 
       <span class="keyword1">else</span> <span class="free">z</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[</span>Zero<span class="main">]</span> <span class="main">∧</span> <span class="free">l</span> <span class="free">i</span> <span class="main">=</span> Zero"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_L_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">700</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the Converter Component›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L1_Converter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Converter <span class="free">z</span> <span class="free">x</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">x</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> 
                 <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Converter_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L1a_Converter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Converter <span class="free">z</span> <span class="free">x</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">x</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> 
                 <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="free">z</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> 
              <span class="main">=</span> Zero"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L1_Converter<span class="main">)</span>
 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the System›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L1_ControlSystem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ControlSystemArch <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">y</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"Converter <span class="skolem">z</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"SteamBoiler <span class="skolem">x</span> <span class="free">s</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ControlSystemArch_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>    
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ts <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Converter_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> L1_Boiler<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> L2_ControlSystem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ControlSystemArch <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">200</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">y</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"Converter <span class="skolem">z</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"SteamBoiler <span class="skolem">x</span> <span class="free">s</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"Controller <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ControlSystemArch_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Converter_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="skolem">y</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L2_Boiler<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">200</span> <span class="main">≤</span> hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L3_Boiler<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">s</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">atomize</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  L1_Controller<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> y0asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">500</span><span class="main">::</span>nat<span class="main">]</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> y0asm <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="skolem">l</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L7_Controller<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>
         aa0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
         aa1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="numeral">10</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
         aa2<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hd <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> Zero <span class="keyword1">then</span> hd <span class="main">(</span><span class="free">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span> <span class="keyword1">else</span> hd <span class="main">(</span><span class="free">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">assume</span></span> aaZero<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
       <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span>
         sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> 
             <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>  <span class="main">=</span> Zero"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L1_Converter<span class="main">)</span>
       <span class="keyword1"><span class="command">from</span></span> aa2 <span class="keyword2"><span class="keyword">and</span></span> aaZero <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> sg5  <span class="keyword2"><span class="keyword">and</span></span> sg8 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> aa1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> L9_Controller<span class="main">)</span>
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">assume</span></span> aaOne<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> Zero"</span></span>
       <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span>
         sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> 
             <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> Zero"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L1_Converter<span class="main">)</span>
       <span class="keyword1"><span class="command">from</span></span> aa2 <span class="keyword2"><span class="keyword">and</span></span> aaOne <span class="keyword1"><span class="command">have</span></span> sg9<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> L3_ControlSystem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ControlSystemArch <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">800</span><span class="main">::</span> nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">y</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"Converter <span class="skolem">z</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"SteamBoiler <span class="skolem">x</span> <span class="free">s</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"Controller <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ControlSystemArch_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Converter_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="skolem">y</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L2_Boiler<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">800</span><span class="main">::</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L4_Boiler<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"Controller_L <span class="free">s</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>Zero<span class="main">]</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Controller_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">atomize</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  L1_Controller<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> y0asm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="numeral">500</span><span class="main">::</span>nat<span class="main">]</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> y0asm <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="skolem">l</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L7_Controller<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>
         aa0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
         aa1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="numeral">10</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
         aa2<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> hd <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> Zero <span class="keyword1">then</span> hd <span class="main">(</span><span class="free">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span> <span class="keyword1">else</span> hd <span class="main">(</span><span class="free">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SteamBoiler_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">assume</span></span> aaZero<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> Zero"</span></span>
       <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span>
         sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> 
             <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span>  <span class="main">=</span> Zero"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L1_Converter<span class="main">)</span>
       <span class="keyword1"><span class="command">from</span></span> aa2 <span class="keyword2"><span class="keyword">and</span></span> aaZero <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">assume</span></span> aaOne<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="skolem">x</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> Zero"</span></span>
       <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span>
         sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> 
             <span class="main">(</span><span class="main">(</span>length <span class="main">(</span>fin_make_untimed <span class="main">(</span>inf_truncate <span class="skolem">z</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> Zero"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L1_Converter<span class="main">)</span>
       <span class="keyword1"><span class="command">from</span></span> aa2 <span class="keyword2"><span class="keyword">and</span></span> aaOne <span class="keyword1"><span class="command">have</span></span> sg9<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">s</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg9 <span class="keyword2"><span class="keyword">and</span></span> sg4  <span class="keyword2"><span class="keyword">and</span></span> aa1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> L10_Controller<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proof of the Refinement Relation›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L0_ControlSystem<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"ControlSystemArch <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"ControlSystem <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ControlSystem_def L1_ControlSystem L2_ControlSystem L3_ControlSystem<span class="main">)</span>
 
<span class="keyword2"><span class="keyword">end</span></span> 
</pre>
</div><div id="FR_types">
<div class="head">
<h1>Theory FR_types</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  FR_types.thy  (Input/Output Definitions)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span> 
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹FlexRay: Types›</span></span> 


<span class="keyword1"><span class="command">theory</span></span> FR_types 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="stream.html">stream</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> Message <span class="main">=</span> 
   message_id <span class="main">::</span> <span class="quoted">nat</span>
   ftcdata    <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> Frame <span class="main">=</span> 
   slot <span class="main">::</span> <span class="quoted">nat</span>
   dataF <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> Message<span class="main">)</span> list"</span></span>

<span class="keyword1"><span class="command">record</span></span> Config <span class="main">=</span> 
   schedule    <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span> 
   cycleLength <span class="main">::</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> nFrame <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> Frame<span class="main">)</span> istream"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> nNat <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat istream"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> nConfig <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> Config"</span></span>

<span class="keyword1"><span class="command">consts</span></span> sN <span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
  <span class="entity">sheafNumbers</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">sheafNumbers</span> <span class="main">≡</span> <span class="main">[</span>sN<span class="main">]</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FR">
<div class="head">
<h1>Theory FR</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title: FR.thy  (FlexRay: Specification)
   Author:    Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span> 
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹FlexRay: Specification›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  FR 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="FR_types.html">FR_types</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary predicates›</span></span>

<span class="comment1">― ‹The predicate DisjointSchedules is true  for sheaf of channels of type Config,›</span>
<span class="comment1">― ‹if all bus configurations have disjoint scheduling tables.›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">DisjointSchedules</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nConfig <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">DisjointSchedules</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span>
  <span class="main">≡</span>
  <span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> 
  disjoint <span class="main">(</span>schedule <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>schedule <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="comment1">― ‹The predicate IdenticCycleLength is true  for sheaf of channels of type Config,›</span> 
<span class="comment1">― ‹if all bus configurations have the equal length of the communication round.›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">IdenticCycleLength</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nConfig <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">IdenticCycleLength</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span>
   <span class="main">≡</span>
   <span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟶</span> 
   cycleLength <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> cycleLength <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="bound">j</span><span class="main">)</span>"</span></span>
   
<span class="comment1">― ‹The predicate FrameTransmission defines the correct message transmission:›</span>
<span class="comment1">― ‹if the time t is equal modulo the length of the cycle (Flexray communication round)›</span>
<span class="comment1">― ‹to the element of the scheduler table of the node k, then this and only this node›</span>
<span class="comment1">― ‹can send a data atn the $t$th time interval.›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">FrameTransmission</span> <span class="main">::</span> 
     <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> nNat <span class="main">⇒</span> nConfig <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FrameTransmission</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nStore</span></span></span> <span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="free"><span class="bound"><span class="entity">nGet</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span>
   <span class="main">≡</span>
   <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟶</span>
   <span class="main">(</span> <span class="keyword1">let</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">in</span> 
     <span class="main">(</span> <span class="bound">s</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>
       <span class="main">⟶</span>
       <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nGet</span></span></span> <span class="bound">k</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">s</span><span class="main">]</span> <span class="main">∧</span>  
       <span class="main">(</span><span class="main">∀</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≠</span> <span class="bound">k</span> <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nStore</span></span></span> <span class="bound">j</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="bound">k</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="comment1">― ‹The   predicate Broadcast describes properties of FlexRay broadcast.›</span>
<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">Broadcast</span> <span class="main">::</span> 
     <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Broadcast</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nSend</span></span></span> <span class="free"><span class="bound"><span class="entity">recv</span></span></span>
   <span class="main">≡</span> 
   <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
    <span class="main">(</span> <span class="keyword1">if</span> <span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nSend</span></span></span> <span class="bound">k</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>
      <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">recv</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nSend</span></span></span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nSend</span></span></span> <span class="bound">k</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">recv</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">)</span>"</span></span>  
      
<span class="comment1">― ‹The predicate Receive defines the  relations on the streams  to represent›</span> 
<span class="comment1">― ‹data receive by FlexRay controller.›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Receive</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Frame istream <span class="main">⇒</span> <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> nat istream <span class="main">⇒</span> bool"</span></span>     
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Receive</span> <span class="free"><span class="bound"><span class="entity">recv</span></span></span> <span class="free"><span class="bound"><span class="entity">store</span></span></span> <span class="free"><span class="bound"><span class="entity">activation</span></span></span>
   <span class="main">≡</span>
   <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span>
    <span class="main">(</span> <span class="keyword1">if</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">activation</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>
      <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">store</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">recv</span></span></span> <span class="bound">t</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">store</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="comment1">― ‹The predicate Send defines the  relations on the streams  to represent›</span>
<span class="comment1">― ‹sending data  by FlexRay controller.›</span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Send</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Frame istream <span class="main">⇒</span> <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> nat istream <span class="main">⇒</span> nat istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Send</span> <span class="free"><span class="bound"><span class="entity">return</span></span></span> <span class="free"><span class="bound"><span class="entity">send</span></span></span> <span class="free"><span class="bound"><span class="entity">get</span></span></span> <span class="free"><span class="bound"><span class="entity">activation</span></span></span>
   <span class="main">≡</span>
   <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
   <span class="main">(</span> <span class="keyword1">if</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">activation</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">get</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">send</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>
     <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">get</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">activation</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">send</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">return</span></span></span> <span class="bound">t</span><span class="main">)</span>  <span class="main">)</span>"</span></span>   
    
 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Specifications of the FlexRay components›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">FlexRay</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> nConfig <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> nNat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FlexRay</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="free"><span class="bound"><span class="entity">nStore</span></span></span> <span class="free"><span class="bound"><span class="entity">nGet</span></span></span>
   <span class="main">≡</span> 
   <span class="main">(</span>CorrectSheaf <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>  <span class="main">∧</span>  
   <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟶</span> <span class="main">(</span>msg <span class="main">1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span>DisjointSchedules <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>IdenticCycleLength <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span><span class="main">)</span> 
   <span class="main">⟶</span>
    <span class="main">(</span>FrameTransmission <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nStore</span></span></span> <span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="free"><span class="bound"><span class="entity">nGet</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟶</span> <span class="main">(</span>msg <span class="main">1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nGet</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>msg <span class="main">1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nStore</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> 
   <span class="entity">Cable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> bool"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Cable</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nSend</span></span></span> <span class="free"><span class="bound"><span class="entity">recv</span></span></span> 
   <span class="main">≡</span>
   <span class="main">(</span>CorrectSheaf <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> 
    <span class="main">∧</span>  
   <span class="main">(</span><span class="main">(</span>inf_disj <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nSend</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>Broadcast <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nSend</span></span></span> <span class="free"><span class="bound"><span class="entity">recv</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">Scheduler</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Config <span class="main">⇒</span> nat istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Scheduler</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">activation</span></span></span>
   <span class="main">≡</span> 
   <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span>
   <span class="main">(</span> <span class="keyword1">let</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">in</span>
       <span class="main">(</span> <span class="keyword1">if</span>  <span class="main">(</span><span class="bound">s</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>
         <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">activation</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">s</span><span class="main">]</span>
         <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">activation</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">)</span>"</span></span>
         
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">BusInterface</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"nat istream <span class="main">⇒</span> <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> 
     <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> nat istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BusInterface</span> <span class="free"><span class="bound"><span class="entity">activation</span></span></span> <span class="free"><span class="bound"><span class="entity">return</span></span></span> <span class="free"><span class="bound"><span class="entity">recv</span></span></span>  <span class="free"><span class="bound"><span class="entity">store</span></span></span> <span class="free"><span class="bound"><span class="entity">send</span></span></span> <span class="free"><span class="bound"><span class="entity">get</span></span></span>
   <span class="main">≡</span>
   <span class="main">(</span>Receive <span class="free"><span class="bound"><span class="entity">recv</span></span></span> <span class="free"><span class="bound"><span class="entity">store</span></span></span> <span class="free"><span class="bound"><span class="entity">activation</span></span></span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span>Send <span class="free"><span class="bound"><span class="entity">return</span></span></span> <span class="free"><span class="bound"><span class="entity">send</span></span></span> <span class="free"><span class="bound"><span class="entity">get</span></span></span> <span class="free"><span class="bound"><span class="entity">activation</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span>
   <span class="entity">FlexRayController</span> <span class="main">::</span> 
     <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> Frame istream <span class="main">⇒</span> <span class="tfree">'a</span> Frame istream <span class="main">⇒</span>  Config <span class="main">⇒</span>
      <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> <span class="tfree">'a</span> Frame istream <span class="main">⇒</span> nat istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FlexRayController</span> <span class="free"><span class="bound"><span class="entity">return</span></span></span> <span class="free"><span class="bound"><span class="entity">recv</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">store</span></span></span> <span class="free"><span class="bound"><span class="entity">send</span></span></span> <span class="free"><span class="bound"><span class="entity">get</span></span></span>
   <span class="main">≡</span>
  <span class="main">(</span><span class="main">∃</span> <span class="bound">activation</span><span class="main">.</span> 
     <span class="main">(</span>Scheduler <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">activation</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span>BusInterface <span class="bound">activation</span> <span class="free"><span class="bound"><span class="entity">return</span></span></span> <span class="free"><span class="bound"><span class="entity">recv</span></span></span> <span class="free"><span class="bound"><span class="entity">store</span></span></span> <span class="free"><span class="bound"><span class="entity">send</span></span></span> <span class="free"><span class="bound"><span class="entity">get</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FlexRayArchitecture</span> <span class="main">::</span> 
   <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> nConfig <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> nNat <span class="main">⇒</span> bool"</span></span>   
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FlexRayArchitecture</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="free"><span class="bound"><span class="entity">nStore</span></span></span> <span class="free"><span class="bound"><span class="entity">nGet</span></span></span>
   <span class="main">≡</span>
   <span class="main">(</span>CorrectSheaf <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∃</span> <span class="bound">nSend</span> <span class="bound">recv</span><span class="main">.</span>
     <span class="main">(</span>Cable <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">nSend</span> <span class="bound">recv</span><span class="main">)</span> <span class="main">∧</span> 
     <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟶</span>  
         FlexRayController <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="bound">recv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="bound">i</span><span class="main">)</span> 
                           <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nStore</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nGet</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
   
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">FlexRayArch</span> <span class="main">::</span> 
   <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> nConfig <span class="main">⇒</span> <span class="tfree">'a</span> nFrame <span class="main">⇒</span> nNat <span class="main">⇒</span> bool"</span></span>   
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">FlexRayArch</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="free"><span class="bound"><span class="entity">nStore</span></span></span> <span class="free"><span class="bound"><span class="entity">nGet</span></span></span>
   <span class="main">≡</span>
   <span class="main">(</span>CorrectSheaf <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>  <span class="main">∧</span> 
   <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟶</span> msg <span class="main">1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span>DisjointSchedules <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>IdenticCycleLength <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span><span class="main">)</span>    
    <span class="main">⟶</span>
    <span class="main">(</span>FlexRayArchitecture <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">nReturn</span></span></span> <span class="free"><span class="bound"><span class="entity">nC</span></span></span> <span class="free"><span class="bound"><span class="entity">nStore</span></span></span> <span class="free"><span class="bound"><span class="entity">nGet</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>    

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FR_proof">
<div class="head">
<h1>Theory FR_proof</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title: FR.thy  (FlexRay: Verification)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span> 
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹FlexRay: Verification›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  FR_proof
<span class="keyword2"><span class="keyword">imports</span></span> <a href="FR.html">FR</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the function Send›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Send_L1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Send <span class="free">return</span> <span class="free">send</span> <span class="free">get</span> <span class="free">activation</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">send</span> <span class="free">t</span>  <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">activation</span> <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Send_L2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Send <span class="free">return</span> <span class="free">send</span> <span class="free">get</span> <span class="free">activation</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">activation</span> <span class="free">t</span><span class="main">)</span>  <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">return</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">send</span> <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_def<span class="main">)</span> 


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the component Scheduler›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduler_L1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="free">C</span> <span class="free">activation</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">activation</span> <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
   <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span>  a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="free">C</span> <span class="keyword1">mem</span> schedule <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="free">C</span> <span class="keyword1">mem</span> schedule <span class="free">C</span> 
       <span class="keyword1">then</span> <span class="free">activation</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="free">C</span><span class="main">]</span>
       <span class="keyword1">else</span> <span class="free">activation</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_def Let_def<span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">activation</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>  sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduler_L2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Scheduler <span class="free">C</span> <span class="free">activation</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="free">C</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">activation</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_def Let_def<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> Scheduler_L3<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Scheduler <span class="free">C</span> <span class="free">activation</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="free">C</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">activation</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Scheduler_L4<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Scheduler <span class="free">C</span> <span class="free">activation</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="free">C</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">activation</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="free">C</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_def Let_def<span class="main">)</span>
 
<span class="keyword1"><span class="command">lemma</span></span> correct_DisjointSchedules1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"disjoint <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DisjointSchedules_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IdenticCycleLength_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_notdisjoint2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Disjoint Frames›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> disjointFrame_L1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>  
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">rcv</span> 
                      <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">i</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">j</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
   <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="free">rcv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
   <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">j</span><span class="main">)</span> <span class="free">rcv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation1</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="free">rcv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a3<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span> <span class="skolem">activation2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     a4<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation2</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">j</span><span class="main">)</span> <span class="free">rcv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">j</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"disjoint <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DisjointSchedules_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span>  sg4a<span class="main">:</span><span class="quoted"><span class="quoted">"Send <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  BusInterface_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg4a <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation1</span> <span class="free">t</span>  <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_L1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IdenticCycleLength_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_notdisjoint2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg8 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword1"><span class="command">have</span></span> sg9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> sg9 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword1"><span class="command">have</span></span> sg10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation2</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L2<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> sg11<span class="main">:</span><span class="quoted"><span class="quoted">"Send <span class="main">(</span><span class="free">nReturn</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">j</span><span class="main">)</span> <span class="skolem">activation2</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  BusInterface_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg11 <span class="keyword2"><span class="keyword">and</span></span> sg10 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> disjointFrame_L2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>  
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">rcv</span> 
                      <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inf_disj <span class="free">n</span> <span class="free">nSend</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_disj_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjointFrame_L1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> disjointFrame_L3<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>  
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">rcv</span> 
                      <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">j</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IdenticCycleLength_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"disjoint <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DisjointSchedules_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_notdisjoint2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span>
   <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">j</span><span class="main">)</span> <span class="free">rcv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg5 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span> <span class="skolem">activation2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation2</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">j</span><span class="main">)</span> <span class="free">rcv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">j</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation2</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L2<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"Send <span class="main">(</span><span class="free">nReturn</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">j</span><span class="main">)</span> <span class="skolem">activation2</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  BusInterface_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the sheaf of channels nSend›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_Send1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> frc<span class="main">:</span><span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> frc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    a1<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">activation</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
    a2<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"Send <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">activation</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BusInterface_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_Send2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
 <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
   <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">activation</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span>  sg4<span class="main">:</span><span class="quoted"><span class="quoted">"Send <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">activation</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  BusInterface_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_Send3<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_Send2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fr_Send4<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟶</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  fr_Send3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fr_Send5<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_Send2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_Send6<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fr_Send3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fr_Send7<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">j</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> disjointFrame_L3 fr_Send2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fr_Send8<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_Send7<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fr_nC_Send<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">j</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjointFrame_L3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_nSend<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="free">activation</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> length <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"Send <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span> <span class="free">activation</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BusInterface_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="free">activation</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="free">nGet</span> <span class="free">i</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="free">i</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>
    <span class="keyword1">else</span> <span class="free">nGet</span> <span class="free">i</span> <span class="free">t</span> <span class="main">=</span> <span class="free">activation</span> <span class="free">t</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="free">i</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nReturn</span> <span class="free">i</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">activation</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">activation</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">activation</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> msg_nSend<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"BusInterface <span class="free">activation</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nSend<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Broadcast_nSend_empty1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Broadcast <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">recv</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Broadcast_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the sheaf of channels  nGet›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_nGet1a<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation1</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"Send <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BusInterface_def<span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="skolem">activation1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>
     <span class="keyword1">else</span> <span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="skolem">activation1</span> <span class="free">t</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L4<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_nGet1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  fr_nGet1a<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fr_nGet2a<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation1</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"Send <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BusInterface_def<span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="skolem">activation1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>
     <span class="keyword1">else</span> <span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="skolem">activation1</span> <span class="free">t</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_nGet2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fr_nGet2a<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> length_nGet1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fr_nGet1a<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nGet</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fr_nGet2a<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> msg_nGet1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> length_nGet1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> msg_nGet2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> msg_nGet1<span class="main">)</span> 


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the sheaf of channels nStore›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_nStore_nReturn1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h0<span class="main">:</span><span class="quoted"><span class="quoted">"Broadcast <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"inf_disj <span class="free">n</span> <span class="free">nSend</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="free">k</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">nStore</span> <span class="free">j</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">j</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation1</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a3<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span> <span class="skolem">activation2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     a4<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation2</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">j</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">j</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">j</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"Receive <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">j</span><span class="main">)</span> <span class="skolem">activation2</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BusInterface_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="skolem">activation2</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="free">nStore</span> <span class="free">j</span> <span class="free">t</span> <span class="main">=</span> <span class="free">recv</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="free">nStore</span> <span class="free">j</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Receive_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation1</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L3<span class="main">)</span>
 <span class="keyword1"><span class="command">from</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IdenticCycleLength_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"disjoint <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DisjointSchedules_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mem_notdisjoint2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg6 <span class="keyword2"><span class="keyword">and</span></span> sg8 <span class="keyword1"><span class="command">have</span></span> sg9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> sg9 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword1"><span class="command">have</span></span> sg10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation2</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L2<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg10 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword1"><span class="command">have</span></span> sg11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nStore</span> <span class="free">j</span> <span class="free">t</span> <span class="main">=</span> <span class="free">recv</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h0 <span class="keyword1"><span class="command">have</span></span> sg15<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span> 
    <span class="keyword1">then</span> <span class="free">recv</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nSend</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="free">t</span>
    <span class="keyword1">else</span> <span class="free">recv</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Broadcast_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword1"><span class="command">have</span></span> sg16<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_Send8<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sg16 <span class="keyword2"><span class="keyword">and</span></span> sg15 <span class="keyword1"><span class="command">have</span></span> sg17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">recv</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> sg11 <span class="keyword2"><span class="keyword">and</span></span> sg17 <span class="keyword1"><span class="command">have</span></span> sg18<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nStore</span> <span class="free">j</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> a6 <span class="keyword1"><span class="command">have</span></span> sg19<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_Send6<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> a6 <span class="keyword1"><span class="command">have</span></span> sg20<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_Send3<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg20 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_disj_index<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sg15 <span class="keyword2"><span class="keyword">and</span></span> sg19 <span class="keyword1"><span class="command">have</span></span> sg22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">recv</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nSend</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="free">t</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> sg22 <span class="keyword2"><span class="keyword">and</span></span> sg21 <span class="keyword1"><span class="command">have</span></span> sg23<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">recv</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg24<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span>  <span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_Send2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sg11 <span class="keyword2"><span class="keyword">and</span></span> sg23 <span class="keyword2"><span class="keyword">and</span></span> sg24 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> fr_nStore_nReturn2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Cable <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> <span class="free">k</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">nStore</span> <span class="free">j</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"inf_disj <span class="free">n</span> <span class="free">nSend</span> <span class="main">⟶</span> Broadcast <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cable_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span>  h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"inf_disj <span class="free">n</span> <span class="free">nSend</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjointFrame_L2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"Broadcast <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_nStore_nReturn1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_nStore_empty1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Cable <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">nStore</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     a1<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     a2<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation1</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"Receive <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BusInterface_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="skolem">activation1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="free">nStore</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="free">recv</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="free">nStore</span> <span class="free">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Receive_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation1</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L3<span class="main">)</span>
 <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> fr_nStore_nReturn3<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Cable <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">mod</span> cycleLength <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">mem</span> schedule <span class="main">(</span><span class="free">nC</span> <span class="free">k</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">j</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">⟶</span> <span class="free">nStore</span> <span class="bound">j</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nReturn</span> <span class="free">k</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_nStore_nReturn2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> length_nStore<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"inf_disj <span class="free">n</span> <span class="free">nSend</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>  
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"Broadcast <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span> 
    <span class="keyword1">then</span> <span class="free">recv</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nSend</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="free">t</span> 
    <span class="keyword1">else</span> <span class="free">recv</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Broadcast_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nSend</span> <span class="skolem">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      a4<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      a5<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation1</span> <span class="main">(</span><span class="free">nReturn</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a5 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"Send <span class="main">(</span><span class="free">nReturn</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  BusInterface_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a5 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"Receive <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="skolem">k</span><span class="main">)</span> <span class="skolem">activation1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BusInterface_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">activation1</span> <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Send_L1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="skolem">activation1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> 
      <span class="keyword1">then</span> <span class="free">nStore</span> <span class="skolem">k</span> <span class="free">t</span> <span class="main">=</span> <span class="free">recv</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="free">nStore</span> <span class="skolem">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Receive_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sg8 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword1"><span class="command">have</span></span> sg9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">nStore</span> <span class="skolem">k</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword1"><span class="command">have</span></span> sg10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="keyword1">mod</span> <span class="main">(</span>cycleLength <span class="main">(</span><span class="free">nC</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mem</span> <span class="main">(</span>schedule <span class="main">(</span><span class="free">nC</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Scheduler_L1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> sg9 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> sg10 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> sg11<span class="main">:</span>
       <span class="quoted"><span class="quoted">"<span class="free">nStore</span> <span class="free">i</span> <span class="free">t</span> <span class="main">=</span> <span class="free">nReturn</span> <span class="skolem">k</span> <span class="free">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_nStore_nReturn1<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg12<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nReturn</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg13<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">nReturn</span> <span class="skolem">k</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> sg11 <span class="keyword2"><span class="keyword">and</span></span> sg13  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">nSend</span> <span class="bound">k</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> sg14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">recv</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Broadcast_nSend_empty1<span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">activation2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      a11<span class="main">:</span><span class="quoted"><span class="quoted">"Scheduler <span class="main">(</span><span class="free">nC</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">activation2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      a12<span class="main">:</span><span class="quoted"><span class="quoted">"BusInterface <span class="skolem">activation2</span> <span class="main">(</span><span class="free">nReturn</span> <span class="free">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayController_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a12 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Receive <span class="free">recv</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span> <span class="skolem">activation2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BusInterface_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg17<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="skolem">activation2</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> 
      <span class="keyword1">then</span> <span class="free">nStore</span> <span class="free">i</span> <span class="free">t</span> <span class="main">=</span> <span class="free">recv</span> <span class="free">t</span> <span class="keyword1">else</span> <span class="free">nStore</span> <span class="free">i</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Receive_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">activation2</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> aa3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation2</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> sg17 <span class="keyword2"><span class="keyword">and</span></span> aa3 <span class="keyword2"><span class="keyword">and</span></span> sg14 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nStore</span> <span class="free">i</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> aa4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">activation2</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> sg17 <span class="keyword2"><span class="keyword">and</span></span> aa4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nStore</span> <span class="free">i</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> msg_nStore<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inf_disj <span class="free">n</span> <span class="free">nSend</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>  
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Cable <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cable_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_nStore<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement Properties›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> fr_refinement_FrameTransmission<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Cable <span class="free">n</span> <span class="free">nSend</span> <span class="free">recv</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="free">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"FrameTransmission <span class="free">n</span> <span class="free">nStore</span> <span class="free">nReturn</span> <span class="free">nGet</span> <span class="free">nC</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FrameTransmission_def Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_nGet1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fr_nStore_nReturn3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> FlexRayArch_CorrectSheaf<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"FlexRayArch <span class="free">n</span> <span class="free">nReturn</span> <span class="free">nC</span> <span class="free">nStore</span> <span class="free">nGet</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"CorrectSheaf <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayArch_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> FlexRayArch_FrameTransmission<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"FlexRayArch <span class="free">n</span> <span class="free">nReturn</span> <span class="free">nC</span> <span class="free">nStore</span> <span class="free">nGet</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"FrameTransmission <span class="free">n</span> <span class="free">nStore</span> <span class="free">nReturn</span> <span class="free">nGet</span> <span class="free">nC</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nSend</span></span> <span class="skolem"><span class="skolem">recv</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    a1<span class="main">:</span><span class="quoted"><span class="quoted">"Cable <span class="free">n</span> <span class="skolem">nSend</span> <span class="skolem">recv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayArch_def  FlexRayArchitecture_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fr_refinement_FrameTransmission<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FlexRayArch_nGet<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"FlexRayArch <span class="free">n</span> <span class="free">nReturn</span> <span class="free">nC</span> <span class="free">nStore</span> <span class="free">nGet</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
 <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nSend</span></span> <span class="skolem"><span class="skolem">recv</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    a1<span class="main">:</span><span class="quoted"><span class="quoted">"Cable <span class="free">n</span> <span class="skolem">nSend</span> <span class="skolem">recv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayArch_def  FlexRayArchitecture_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> msg_nGet2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> FlexRayArch_nStore<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"FlexRayArch <span class="free">n</span> <span class="free">nReturn</span> <span class="free">nC</span> <span class="free">nStore</span> <span class="free">nGet</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"DisjointSchedules <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"IdenticCycleLength <span class="free">n</span> <span class="free">nC</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="free">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
 <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nSend</span></span> <span class="skolem"><span class="skolem">recv</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    a1<span class="main">:</span><span class="quoted"><span class="quoted">"Cable <span class="free">n</span> <span class="skolem">nSend</span> <span class="skolem">recv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> FlexRayController <span class="main">(</span><span class="free">nReturn</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">recv</span> <span class="main">(</span><span class="free">nC</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nStore</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">nSend</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">nGet</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRayArch_def  FlexRayArchitecture_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"inf_disj <span class="free">n</span> <span class="skolem">nSend</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjointFrame_L2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> a1  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> msg_nStore<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> main_fr_refinement<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"FlexRayArch <span class="free">n</span> <span class="free">nReturn</span> <span class="free">nC</span> <span class="free">nStore</span> <span class="free">nGet</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"FlexRay <span class="free">n</span> <span class="free">nReturn</span> <span class="free">nC</span> <span class="free">nStore</span> <span class="free">nGet</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FlexRay_def
                FlexRayArch_CorrectSheaf 
                FlexRayArch_FrameTransmission 
                FlexRayArch_nGet 
                FlexRayArch_nStore<span class="main">)</span>
     
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Gateway_types">
<div class="head">
<h1>Theory Gateway_types</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Gateway_types.thy  (Input/Output Definitions)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span> 
<span class="comment1">(*&gt;*)</span>
 <span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Gateway: Types›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> Gateway_types 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="stream.html">stream</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span>
   Coordinates <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">×</span> nat"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> 
   CollisionSpeed <span class="main">=</span> <span class="quoted"><span class="quoted">"nat"</span></span>

<span class="keyword1"><span class="command">record</span></span> ECall_Info <span class="main">=</span> 
   coord <span class="main">::</span> <span class="quoted">Coordinates</span>
   speed <span class="main">::</span> <span class="quoted">CollisionSpeed</span>

<span class="keyword1"><span class="command">datatype</span></span> GatewayStatus <span class="main">=</span> 
    init_state
  <span class="main">|</span> call
  <span class="main">|</span> connection_ok
  <span class="main">|</span> sending_data
  <span class="main">|</span> voice_com

<span class="keyword1"><span class="command">datatype</span></span> reqType <span class="main">=</span> init <span class="main">|</span> send

<span class="keyword1"><span class="command">datatype</span></span> stopType <span class="main">=</span> stop_vc

<span class="keyword1"><span class="command">datatype</span></span> vcType <span class="main">=</span> vc_com

<span class="keyword1"><span class="command">datatype</span></span> aType <span class="main">=</span> sc_ack

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Gateway">
<div class="head">
<h1>Theory Gateway</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Gateway.thy  (Gateway: Specification)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span> 
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Gateway: Specification›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Gateway 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Gateway_types.html">Gateway_types</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">ServiceCenter</span> <span class="main">::</span> 
   <span class="quoted"><span class="quoted">"ECall_Info istream <span class="main">⇒</span> aType istream <span class="main">⇒</span> bool "</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">ServiceCenter</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> 
  <span class="main">≡</span> 
  <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
  <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span>  <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">[]</span>  <span class="keyword1">else</span> <span class="main">[</span>sc_ack<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Loss</span> <span class="main">::</span>
   <span class="quoted"><span class="quoted">"bool istream <span class="main">⇒</span> aType istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> 
    aType istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Loss</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">i2</span></span></span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> 
  <span class="main">≡</span> 
  <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
  <span class="main">(</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="bound">t</span> <span class="main">=</span>  <span class="main">[</span>False<span class="main">]</span>
    <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i2</span></span></span> <span class="bound">t</span> 
    <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span>  <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span>   <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Delay</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"aType istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> nat <span class="main">⇒</span> 
   aType istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Delay</span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">i2</span></span></span> 
  <span class="main">≡</span> 
  <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span>  
   <span class="main">(</span><span class="bound">t</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i2</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> 
   <span class="main">(</span><span class="bound">t</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a2</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i2</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">tiTable_SampleT</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"reqType istream  <span class="main">⇒</span> aType istream <span class="main">⇒</span> 
  stopType istream <span class="main">⇒</span> bool istream <span class="main">⇒</span> 
  <span class="main">(</span>nat <span class="main">⇒</span> GatewayStatus<span class="main">)</span> <span class="main">⇒</span>  <span class="main">(</span>nat <span class="main">⇒</span> ECall_Info list<span class="main">)</span> <span class="main">⇒</span>
  GatewayStatus istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> vcType istream 
  <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> GatewayStatus<span class="main">)</span> <span class="main">⇒</span> bool "</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">tiTable_SampleT</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="free"><span class="bound"><span class="entity">buffer_in</span></span></span> 
         <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span>
  <span class="main">≡</span>
  <span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span> 
     <span class="main">(</span><span class="bound">r</span><span class="main">::</span>reqType list<span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>aType list<span class="main">)</span> 
     <span class="main">(</span><span class="bound">y</span><span class="main">::</span>stopType list<span class="main">)</span> <span class="main">(</span><span class="bound">z</span><span class="main">::</span>bool list<span class="main">)</span><span class="main">.</span>
   <span class="comment1">― ‹1:›</span>
   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> init_state <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>
     <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>call<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> call <span class="main">)</span> 
   <span class="main">∧</span>     
   <span class="comment1">― ‹2:›</span>
   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> init_state <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="bound">t</span> <span class="main">≠</span> <span class="main">[</span>init<span class="main">]</span>
     <span class="main">⟶</span>  <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> init_state <span class="main">)</span> 
   <span class="main">∧</span>
   <span class="comment1">― ‹3:›</span>
   <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> connection_ok <span class="main">∧</span> <span class="bound">r</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
     <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>
     <span class="main">⟶</span>  <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> connection_ok <span class="main">)</span> 
   <span class="main">∧</span>
   <span class="comment1">― ‹4:›</span>
   <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> connection_ok <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> sending_data<span class="main">)</span>
     <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>
     <span class="main">⟶</span>  <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> init_state <span class="main">)</span> 
   <span class="main">∧</span>
   <span class="comment1">― ‹5:›</span>
   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> connection_ok <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>
     <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">buffer_in</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> sending_data <span class="main">)</span> 
   <span class="main">∧</span>
   <span class="comment1">― ‹6:›</span>
   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> sending_data <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>
     <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> sending_data <span class="main">)</span> 
   <span class="main">∧</span>
   <span class="comment1">― ‹7:›</span>
   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> sending_data <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>
     <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>voice_com<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> voice_com <span class="main">)</span> 
   <span class="main">∧</span>
   <span class="comment1">― ‹8:›</span>
   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> voice_com <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>
     <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>voice_com<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> voice_com <span class="main">)</span> 
   <span class="main">∧</span>
   <span class="comment1">― ‹9:›</span>
   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> voice_com <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>
     <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>voice_com<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> voice_com <span class="main">)</span> 
   <span class="main">∧</span>
   <span class="comment1">― ‹10:›</span>
   <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="bound">t</span> <span class="main">=</span> voice_com <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span> 
     <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> 
         <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> init_state <span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Sample_L</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"reqType istream  <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> aType istream <span class="main">⇒</span> 
  stopType istream <span class="main">⇒</span> bool istream <span class="main">⇒</span> 
  <span class="main">(</span>nat <span class="main">⇒</span> GatewayStatus<span class="main">)</span> <span class="main">⇒</span>  <span class="main">(</span>nat <span class="main">⇒</span> ECall_Info list<span class="main">)</span> <span class="main">⇒</span>
  GatewayStatus istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> vcType istream 
  <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> GatewayStatus<span class="main">)</span>  <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> ECall_Info list<span class="main">)</span>
  <span class="main">⇒</span> bool "</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Sample_L</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="free"><span class="bound"><span class="entity">buffer_in</span></span></span> 
         <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span> <span class="free"><span class="bound"><span class="entity">buffer_out</span></span></span>
  <span class="main">≡</span>
  <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
   <span class="free"><span class="bound"><span class="entity">buffer_out</span></span></span> <span class="bound">t</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">buffer_in</span></span></span> <span class="bound">t</span>  <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="bound">t</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">∧</span> 
  <span class="main">(</span>tiTable_SampleT <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">st_in</span></span></span> <span class="free"><span class="bound"><span class="entity">buffer_in</span></span></span> 
                   <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="free"><span class="bound"><span class="entity">st_out</span></span></span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Sample</span> <span class="main">::</span>
 <span class="quoted"><span class="quoted">"reqType istream  <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> aType istream <span class="main">⇒</span> 
  stopType istream <span class="main">⇒</span> bool istream <span class="main">⇒</span> 
  GatewayStatus istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> vcType istream
  <span class="main">⇒</span> bool "</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Sample</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span>  <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> 
  <span class="main">≡</span>
  <span class="main">(</span><span class="main">(</span>msg <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span><span class="main">)</span> <span class="main">∧</span> 
   <span class="main">(</span>msg <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span><span class="main">)</span>  <span class="main">∧</span> 
   <span class="main">(</span>msg <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span><span class="main">)</span><span class="main">)</span> 
  <span class="main">⟶</span> 
  <span class="main">(</span><span class="main">∃</span> <span class="bound">st</span> <span class="bound">buffer</span><span class="main">.</span> 
  <span class="main">(</span>Sample_L <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="free"><span class="bound"><span class="entity">a1</span></span></span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> 
            <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="bound">st</span><span class="main">)</span>
            <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="bound">buffer</span><span class="main">)</span>
            <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="bound">st</span> <span class="bound">buffer</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Gateway</span> <span class="main">::</span> 
   <span class="quoted"><span class="quoted">"reqType istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> aType istream <span class="main">⇒</span> 
    stopType istream <span class="main">⇒</span> bool istream <span class="main">⇒</span> nat <span class="main">⇒</span>
    GatewayStatus istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> vcType istream
    <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">Gateway</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> 
  <span class="main">≡</span> <span class="main">∃</span> <span class="bound">i1</span> <span class="bound">i2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> 
    <span class="main">(</span>Sample <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">i1</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span>Delay <span class="bound">y</span> <span class="bound">i1</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="bound">x</span> <span class="bound">i2</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span>Loss <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">i2</span> <span class="bound">y</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">GatewaySystem</span> <span class="main">::</span> 
   <span class="quoted"><span class="quoted">"reqType istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> 
    stopType istream <span class="main">⇒</span> bool istream <span class="main">⇒</span> nat <span class="main">⇒</span>
    GatewayStatus istream <span class="main">⇒</span> vcType istream
    <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GatewaySystem</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> 
  <span class="main">≡</span>
  <span class="main">∃</span> <span class="bound">a</span> <span class="bound">i</span><span class="main">.</span> 
 <span class="main">(</span>Gateway <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="bound">a</span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">i</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span><span class="main">)</span> <span class="main">∧</span> 
 <span class="main">(</span>ServiceCenter <span class="bound">i</span> <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">GatewayReq</span> <span class="main">::</span> 
   <span class="quoted"><span class="quoted">"reqType istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> aType istream <span class="main">⇒</span> 
    stopType istream <span class="main">⇒</span> bool istream <span class="main">⇒</span> nat <span class="main">⇒</span>
    GatewayStatus istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> vcType istream
    <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GatewayReq</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> 
  <span class="main">≡</span>  
 <span class="main">(</span><span class="main">(</span>msg <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span>msg <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>  <span class="main">∧</span> 
  <span class="main">(</span>msg <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span>ts <span class="free"><span class="bound"><span class="entity">lose</span></span></span><span class="main">)</span><span class="main">)</span> 
   <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span>
  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span> <span class="main">∧</span> 
    <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>
    <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span><span class="main">)</span> 
  <span class="main">∧</span> 
  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span>  <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span>  
    <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span> inf_last_ti <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="bound">t</span> 
        <span class="main">∧</span>  <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span><span class="main">)</span>
  <span class="main">∧</span> 
  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span> <span class="main">∧</span>  
    <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> 
    <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="main">(</span><span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">GatewaySystemReq</span> <span class="main">::</span> 
   <span class="quoted"><span class="quoted">"reqType istream <span class="main">⇒</span> ECall_Info istream <span class="main">⇒</span> 
    stopType istream <span class="main">⇒</span> bool istream <span class="main">⇒</span> nat <span class="main">⇒</span>
    GatewayStatus istream <span class="main">⇒</span> vcType istream
    <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">GatewaySystemReq</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="free"><span class="bound"><span class="entity">dt</span></span></span>  <span class="free"><span class="bound"><span class="entity">stop</span></span></span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> 
  <span class="main">≡</span>
 <span class="main">(</span><span class="main">(</span>msg <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>msg <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">stop</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>ts <span class="free"><span class="bound"><span class="entity">lose</span></span></span><span class="main">)</span><span class="main">)</span>
   <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">t</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">k</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
  <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">ack</span></span></span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>
  <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="bound">k</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span><span class="main">)</span>
  <span class="main">∧</span>  <span class="free"><span class="bound"><span class="entity">req</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="numeral">3</span><span class="main">+</span><span class="bound">k</span><span class="main">)</span>  <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span>  inf_last_ti <span class="free"><span class="bound"><span class="entity">dt</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">j</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> 
     <span class="bound">j</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">lose</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> 
  <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">vc</span></span></span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">+</span> <span class="bound">k</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span><span class="main">)</span> <span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Gateway_proof_aux">
<div class="head">
<h1>Theory Gateway_proof_aux</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title:  Gateway_proof_aux.thy  (Gateway: Verification, aux. lemmas)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span> 
<span class="comment1">(*&gt;*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Gateway: Verification›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Gateway_proof_aux 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Gateway.html">Gateway</a> <a href="BitBoolTS.html">BitBoolTS</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the defined data types›</span></span>


<span class="keyword1"><span class="command">lemma</span></span> aType_empty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="skolem">l</span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span>"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">=</span> sc_ack"</span></span>
      <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aType_nonempty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="skolem">l</span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_nonempty1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span>"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">=</span> sc_ack"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aType_lemma<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aType_nonempty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> stopType_empty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> list_length_hint2 msg_nonempty2 stopType.exhaust<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> stopType_nonempty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stopType_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> stopType_lemma<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stopType_nonempty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vcType_empty<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> list_length_hint2 msg_nonempty2 vcType.exhaust<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vcType_lemma<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vcType_empty<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the Delay component›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Delay_L1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t1</span></span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">.</span> <span class="free">i1</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="free">y</span> <span class="free">i1</span> <span class="free">d</span> <span class="free">x</span> <span class="free">i2</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">+</span> <span class="free">d</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟶</span> <span class="free">i2</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Delay_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">t2</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="free">t2</span> <span class="main">⟶</span> <span class="free">i2</span> <span class="free">t2</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">(</span><span class="free">t2</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Delay_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="free">t2</span> <span class="main">=</span> <span class="free">i1</span> <span class="main">(</span><span class="free">t2</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Delay_L2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t1</span></span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">.</span> <span class="free">i1</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Delay <span class="free">y</span> <span class="free">i1</span> <span class="free">d</span> <span class="free">x</span> <span class="free">i2</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">i2</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Delay_L1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Delay_L3<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">y</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="free">y</span> <span class="free">i1</span> <span class="free">d</span> <span class="free">x</span> <span class="free">i2</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> <span class="free">d</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟶</span> <span class="free">x</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Delay_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">t2</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≤</span> <span class="free">t2</span> <span class="main">⟶</span> <span class="free">x</span> <span class="free">t2</span> <span class="main">=</span> <span class="free">y</span> <span class="main">(</span><span class="free">t2</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Delay_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t2</span> <span class="main">=</span> <span class="free">y</span> <span class="main">(</span><span class="free">t2</span> <span class="main">-</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Delay_L4<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">y</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Delay <span class="free">y</span> <span class="free">i1</span> <span class="free">d</span> <span class="free">x</span> <span class="free">i2</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">x</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Delay_L3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Delay_lengthOut1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> length <span class="main">(</span><span class="free">x</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="free">x</span> <span class="free">i1</span> <span class="free">d</span> <span class="free">y</span> <span class="free">i2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟶</span> <span class="free">y</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Delay_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≥</span> <span class="free">d</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">y</span> <span class="free">t</span> <span class="main">=</span> <span class="free">x</span> <span class="main">(</span><span class="free">t</span><span class="main">-</span><span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Delay_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> Delay_msg1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Delay <span class="free">x</span> <span class="free">i1</span> <span class="free">d</span> <span class="free">y</span> <span class="free">i2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def Delay_lengthOut1<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the Loss component›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_L1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span><span class="main">&lt;</span><span class="free">t</span><span class="main">.</span> <span class="free">i2</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">t</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Loss_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_L2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span><span class="main">&lt;</span><span class="free">t</span><span class="main">.</span> <span class="free">i2</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span><span class="main">&lt;</span><span class="free">t</span><span class="main">.</span> <span class="free">i</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Loss_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_L3<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span><span class="main">&lt;</span><span class="free">t</span><span class="main">.</span> <span class="free">a</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">t</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Loss_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_L4<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span><span class="main">&lt;</span><span class="free">t</span><span class="main">.</span> <span class="free">a</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span><span class="main">&lt;</span><span class="free">t</span><span class="main">.</span> <span class="free">y</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Loss_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_L5<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">a</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Loss_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_L5Suc<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">≤</span> <span class="free">d</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">j</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_L6<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">a</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">y</span> <span class="free">i</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t2</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">y</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Loss_L5<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_lengthOut1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> length <span class="main">(</span><span class="free">a</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">x</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">x</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span>  <span class="main">[</span>False<span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span>  <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="free">a</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_lengthOut2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> length <span class="main">(</span><span class="free">a</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">x</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> length <span class="main">(</span><span class="free">x</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_lengthOut1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_msg1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">x</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def Loss_def Loss_lengthOut1<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the composition of Delay and Loss components›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_Delay_length_y<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> length <span class="main">(</span><span class="free">a</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Delay <span class="free">x</span> <span class="free">i1</span> <span class="free">d</span> <span class="free">y</span> <span class="free">i2</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">x</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">y</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Delay_msg1 Loss_msg1 msg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Loss_Delay_msg_a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Delay <span class="free">x</span> <span class="free">i1</span> <span class="free">d</span> <span class="free">y</span> <span class="free">i2</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="free">i2</span> <span class="free">x</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def Loss_Delay_length_y<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary Lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_last_ti2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc inf_last_ti_nonempty_k<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> aux_ack_t2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t2</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg1 
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">t2</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span>"</span></span> 
                  <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="free">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">t2</span> <span class="main">-</span> Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="free">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux_lemma_lose_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ka</span><span class="main">≤</span>Suc <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">ka</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">ka</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">ka</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">ka</span>"</span></span>
                                     <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">ka</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">ka</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux_lemma_lose_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> aux_lemma_lose_3a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ka</span> <span class="main">≤</span> Suc <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">ka</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">ka</span><span class="main">)</span> <span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg1  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">ka</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                                         a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">ka</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">ka</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux_lemma_lose_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">ka</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">ka</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_lemma_lose_3a<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> aux_arith1_Gateway7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">-</span> <span class="free">t</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">t2</span> <span class="main">-</span> <span class="free">d</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">-</span> <span class="free">d</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> ts_lose_ack_st1ts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>  <span class="main">⟶</span>  <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>  <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>  <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span>  <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">st_out</span> <span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ts_bool_False<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ts_lose_ack_st1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>  <span class="main">⟶</span>  <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>  <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>  <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span>  <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">st_out</span> <span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_lose_ack_st2ts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">⟶</span> 
                 <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>  <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span> 
               <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">st_out</span> <span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ts_bool_True_False<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ts_lose_ack_st2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">⟶</span> 
                <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>  <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span> 
                <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">st_out</span> <span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_lose_ack_st2vc_com<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">⟶</span> 
             <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>  <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span> 
             <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">st_out</span> <span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> ag1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ts_lose_ack_st2send<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">⟶</span> 
      <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>  <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span> 
      <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="free">b</span> <span class="free">t</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">st_out</span> <span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_ack_st_splitten<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> init_state <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span> <span class="main">⟶</span> 
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>call<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> call"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> init_state <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>init<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> connection_ok"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data<span class="main">)</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="free">b</span> <span class="free">t</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> sending_data"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data <span class="main">∧</span> <span class="free">a1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> sending_data"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data <span class="main">∧</span> <span class="free">a1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>voice_com<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> voice_com <span class="main">∧</span> <span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>voice_com<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> voice_com <span class="main">∧</span> <span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>voice_com<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> voice_com <span class="main">∧</span> <span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">st_out</span> <span class="free">t</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True_False<span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a11 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a12 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ts_lose_ack_st2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ts_lose_ack_st2send<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ts_lose_ack_st2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> h10  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a41<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> h10 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ts_lose_ack_st2<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a42<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h2  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aType_nonempty<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a42 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> h10 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ts_lose_ack_st2vc_com<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> h11 <span class="keyword2"><span class="keyword">and</span></span> h12 <span class="keyword2"><span class="keyword">and</span></span> h13 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> h11 <span class="keyword2"><span class="keyword">and</span></span> h12 <span class="keyword2"><span class="keyword">and</span></span> h13 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ts_lose_ack_st2vc_com<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a52<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stopType_nonempty<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a52 <span class="keyword2"><span class="keyword">and</span></span> h13 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_ack_st<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">st_in</span> <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st_out</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> a1Msg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a1</span>"</span></span>      
       <span class="keyword2"><span class="keyword">and</span></span> stopMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span><span class="free">st_out</span> <span class="free">t</span><span class="main">]</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> init_state <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>call<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> call"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> init_state <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>init<span class="main">]</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> 
     <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
     <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> connection_ok"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data<span class="main">)</span> <span class="main">∧</span> 
     <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">⟶</span>
     <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="free">b</span> <span class="free">t</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> sending_data"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data <span class="main">∧</span> <span class="free">a1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> sending_data"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data <span class="main">∧</span> <span class="free">a1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>voice_com<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> voice_com <span class="main">∧</span> <span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>voice_com<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg9<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> voice_com <span class="main">∧</span> <span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>voice_com<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg10<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> voice_com <span class="main">∧</span> <span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tsLose <span class="keyword2"><span class="keyword">and</span></span> a1Msg1 <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> 
  sg6 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> sg8 <span class="keyword2"><span class="keyword">and</span></span> sg9 <span class="keyword2"><span class="keyword">and</span></span> sg10 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tiTable_ack_st_splitten<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_ack_st_hd<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">st_in</span> <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st_out</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a1</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  tiTable_ack_st<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_ack_connection_ok<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tbl<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">st_in</span> <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st_out</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ackCon<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> stopMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> 
         <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True_False<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> xMsg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aType_lemma<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stopType_lemma<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a11 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a12 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a21 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a22a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword1"><span class="command">have</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> 
         <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
         <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> connection_ok"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a22a <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword1"><span class="command">have</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data<span class="main">)</span> <span class="main">∧</span> 
         <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">⟶</span>
         <span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span> <span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st_out</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a31 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a32a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> a321<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a32a <span class="keyword2"><span class="keyword">and</span></span> a321 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a322<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a32a <span class="keyword2"><span class="keyword">and</span></span> a322 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a41<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a41 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a42<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a42a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> a421<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a42a <span class="keyword2"><span class="keyword">and</span></span> a421 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a422<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> xMsg1 <span class="keyword1"><span class="command">have</span></span> a422a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aType_empty<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a42a <span class="keyword2"><span class="keyword">and</span></span> a422a <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>  
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a51 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a52<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword1"><span class="command">have</span></span> a52a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stopType_empty<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> a521<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a52a <span class="keyword2"><span class="keyword">and</span></span> a521 <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a522<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a522a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a52a <span class="keyword2"><span class="keyword">and</span></span> a522a <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
     
<span class="keyword1"><span class="command">lemma</span></span> tiTable_i1_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> tbl<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">st_in</span> <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st_out</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call <span class="main">∨</span> <span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_connection_ok<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tbl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_ack_call<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> tbl<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">st_in</span> <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st_out</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ackCall<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>call<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> stopMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> init_state <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True_False<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> xMsg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aType_lemma<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stopType_lemma<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a11 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a12 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> call"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a21 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a22a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a22a <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> connection_ok"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a31 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a32a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> a321<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a32a <span class="keyword2"><span class="keyword">and</span></span> a321 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a322<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a32a <span class="keyword2"><span class="keyword">and</span></span> a322 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> sending_data"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a41<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a41 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a42<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a42a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> a421<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a42a <span class="keyword2"><span class="keyword">and</span></span> a421 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a422<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> xMsg1  <span class="keyword1"><span class="command">have</span></span> a422a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aType_empty<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a42a <span class="keyword2"><span class="keyword">and</span></span> a422a <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>  
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a51 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a52<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword1"><span class="command">have</span></span> a52a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stopType_empty<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> a521<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a52a <span class="keyword2"><span class="keyword">and</span></span> a521 <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a522<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a522a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a52a <span class="keyword2"><span class="keyword">and</span></span> a522a <span class="keyword2"><span class="keyword">and</span></span> ackCall <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_i1_2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> tbl<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">st_in</span> <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st_out</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a1</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>call<span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">st_in</span> <span class="free">t</span> <span class="main">=</span> init_state <span class="main">∧</span> <span class="free">req</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_call<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tbl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> tiTable_ack_init0<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> tbl<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> 
                  <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> 
                   <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> req0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> init_state"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_inf_append_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword2"><span class="keyword">and</span></span> req0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_ack_init<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> 
                  <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> 
                   <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">req</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_init0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="skolem">t</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> init_state"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_i1_3<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> tbl<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">x</span> <span class="free">stop</span> <span class="free">lose</span> 
                  <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span>  <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> stopMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">req</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_init<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="free">t</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> init_state"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True_False<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> xMsg1 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aType_lemma<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stopType_lemma<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span> <span class="free">t</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span> <span class="free">t</span> <span class="main">=</span> init_state"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span> <span class="free">t</span> <span class="main">=</span> call"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a21 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a22a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a22a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span> <span class="free">t</span> <span class="main">=</span> connection_ok"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a31<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a31 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a32<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a32a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> h5 <span class="keyword1"><span class="command">have</span></span> a322<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a32a <span class="keyword2"><span class="keyword">and</span></span> a322 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span> <span class="free">t</span> <span class="main">=</span> sending_data"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a41<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a41 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a42<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a42a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> a421<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a42a <span class="keyword2"><span class="keyword">and</span></span> a421 <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a422<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> xMsg1 <span class="keyword1"><span class="command">have</span></span> a422a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aType_empty<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a42a <span class="keyword2"><span class="keyword">and</span></span> a422a <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span> <span class="free">t</span> <span class="main">=</span> voice_com"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a51<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a51 <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a52<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>stop_vc<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword1"><span class="command">have</span></span> a52a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">stop</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stopType_empty<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> a521<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a52a <span class="keyword2"><span class="keyword">and</span></span> a521 <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a522<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> a522a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_False<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword2"><span class="keyword">and</span></span> a52a <span class="keyword2"><span class="keyword">and</span></span> a522a <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_st_call_ok<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> tbl<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">x</span> <span class="free">stop</span> <span class="free">lose</span> 
                  <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> 
                   <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> call"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> connection_ok"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> h4 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> call"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append2<span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span> <span class="main">∨</span> <span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ts_bool_True_False<span class="main">)</span> 
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>   
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_i1_4b<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">x</span> <span class="free">stop</span> <span class="free">lose</span> 
                  <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">req</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">≤</span> <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_i1_3<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">t2</span> <span class="main">≤</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_init<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="free">t</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> init_state"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> call"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">=</span> Suc <span class="free">t</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">=</span> Suc <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">≠</span> Suc <span class="free">t</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> connection_ok"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_st_call_ok<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">st</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">=</span>  Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">=</span>  Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> a5 <span class="keyword1"><span class="command">have</span></span> sg9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> sg9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  tiTable_i1_1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">≠</span> Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a6 <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg10<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> sg10 <span class="keyword1"><span class="command">have</span></span> sg11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t2</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_ack_t2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> a6 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> sg8 <span class="keyword2"><span class="keyword">and</span></span> sg11 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  tiTable_i1_1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> tiTable_i1_4<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> 
                  <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">req</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t2</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">i1</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_i1_4b<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_ack_ok<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> stopMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a1Msg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> reqNsend<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ackCon<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tbl<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="free">b</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword2"><span class="keyword">and</span></span> a1Msg1 <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="free">t</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> ackCon <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span>  connection_ok"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sg3a<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg3a <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> reqNsend <span class="keyword2"><span class="keyword">and</span></span> tbl <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L7a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gw<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> aMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> stopMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> reqMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> loseFalse<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nsend<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ackNCon<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> gw <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword2"><span class="keyword">and</span></span> reqMsg1 <span class="keyword2"><span class="keyword">and</span></span> nsend <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    ah1<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="skolem">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ah2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="skolem">a2</span> <span class="skolem">i1</span> <span class="free">d</span> <span class="skolem">a1</span> <span class="skolem">i2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ah3<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="skolem">i2</span> <span class="skolem">a2</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ah2 <span class="keyword2"><span class="keyword">and</span></span> ah3 <span class="keyword2"><span class="keyword">and</span></span> aMsg1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">a1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_Delay_msg_a<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> ah1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword2"><span class="keyword">and</span></span> reqMsg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">buffer</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    ah4<span class="main">:</span><span class="quoted"><span class="quoted">"Sample_L <span class="free">req</span> <span class="free">dt</span> <span class="skolem">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> 
             <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span>
             <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span> <span class="skolem">st</span> <span class="skolem">buffer</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ah4 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="skolem">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> 
         <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span>
         <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span> <span class="skolem">st</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> loseFalse <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> 
           nsend <span class="keyword2"><span class="keyword">and</span></span> ackNCon <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_ok<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Sample_L_buffer<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    <span class="quoted"><span class="quoted">"Sample_L <span class="free">req</span> <span class="free">dt</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span>
          <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="free">buffer</span><span class="main">)</span>
           <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span> <span class="free">buffer</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">buffer</span> <span class="free">t</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="free">buffer</span> <span class="bound">t</span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">dt</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="free">buffer</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="free">dt</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_L_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_inf_append_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">dt</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">dt</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">dt</span> <span class="skolem">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span>  tiTable_SampleT_i1_buffer<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> reqSend<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> loseFalse<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> buf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">buffer</span> <span class="free">t</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="free">t</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> tbl<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> 
      <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="free">buffer</span><span class="main">)</span> <span class="free">ack</span>
      <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> conOk<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> connection_ok"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span>Suc <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> loseFalse <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> connection_ok <span class="main">∧</span> 
    <span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> 
    <span class="free">lose</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> 
    <span class="free">i1</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="free">buffer</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="free">vc</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">st</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> sending_data"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> conOk <span class="keyword2"><span class="keyword">and</span></span> reqSend <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="free">buffer</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> buf <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> Sample_L_i1_buffer<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> stopMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a1Msg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ackCon<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> reqSend<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> loseFalse<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> smpl<span class="main">:</span><span class="quoted"><span class="quoted">"Sample_L <span class="free">req</span> <span class="free">dt</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> 
                <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> 
                <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="free">buffer</span><span class="main">)</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span> <span class="free">buffer</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span>  <span class="free">buffer</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> smpl <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">buffer</span> <span class="free">t</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_L_buffer<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> smpl <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="free">buffer</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">dt</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="free">buffer</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="free">dt</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> smpl <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> 
      <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="free">buffer</span><span class="main">)</span> <span class="free">ack</span>
      <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_L_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword2"><span class="keyword">and</span></span> a1Msg1 <span class="keyword2"><span class="keyword">and</span></span> stopMsg1 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">st</span> <span class="free">t</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> ackCon <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> connection_ok"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ackCon <span class="keyword2"><span class="keyword">and</span></span> reqSend <span class="keyword2"><span class="keyword">and</span></span> loseFalse <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> 
           sg3 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="free">t</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_i1_buffer<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tiTable_SampleT_sending_data<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tbl<span class="main">:</span> <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span><span class="main">)</span> 
         <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="free">buffer</span><span class="main">)</span>
         <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="free">st</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> loseFalse<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a1e<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t4</span></span><span class="main">≤</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">a1</span> <span class="bound">t4</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> snd<span class="main">:</span><span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="free">st</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sending_data"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="free">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> loseFalse <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> a1e <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> tbl <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> snd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Sample_sending_data<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> stopMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tsLose<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> reqMsg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a1Msg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> loseFalse<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ackSnd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> smpl<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> xdd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t4</span></span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">a1</span> <span class="bound">t4</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> stopMsg1 <span class="keyword2"><span class="keyword">and</span></span> reqMsg1 <span class="keyword2"><span class="keyword">and</span></span> a1Msg1 <span class="keyword2"><span class="keyword">and</span></span> smpl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">buffer</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"Sample_L <span class="free">req</span> <span class="free">dt</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> 
             <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span> <span class="free">ack</span>
             <span class="free">i1</span> <span class="free">vc</span> <span class="skolem">st</span> <span class="skolem">buffer</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">a1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> 
        <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span>
         <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="skolem">st</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">buffer</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">dt</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="free">dt</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_L_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> stopMsg1 <span class="keyword2"><span class="keyword">and</span></span> tsLose <span class="keyword2"><span class="keyword">and</span></span> a1Msg1 <span class="keyword2"><span class="keyword">and</span></span> ackSnd <span class="keyword2"><span class="keyword">and</span></span> xdd <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">st</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span> 
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span>  
     <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sending_data"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_inf_append_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> loseFalse <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_sending_data<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the ServiceCenter component›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ServiceCenter_a_l<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ServiceCenter <span class="free">i</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ServiceCenter_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ServiceCenter_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ServiceCenter_a_msg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ServiceCenter <span class="free">i</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> msg_def ServiceCenter_a_l<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ServiceCenter_L1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t2</span></span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">.</span> <span class="free">i</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ServiceCenter <span class="free">i</span> <span class="free">a</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> 0 
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ServiceCenter_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ServiceCenter_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ServiceCenter_L2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t2</span></span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">.</span> <span class="free">i</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ServiceCenter <span class="free">i</span> <span class="free">a</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t3</span></span> <span class="main">≤</span> <span class="free">x</span><span class="main">.</span> <span class="free">a</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ServiceCenter_L1<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹General properties of stream values›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue1<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">D</span> <span class="main">+</span> <span class="main">(</span><span class="free">z</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">≤</span> <span class="free">D</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">j</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">j</span> <span class="main">+</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">D</span> <span class="main">+</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="free">j</span> <span class="main">+</span> <span class="free">z</span> <span class="main">=</span> <span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span> 
    <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">D</span> <span class="main">+</span> <span class="main">(</span><span class="free">z</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">D</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> streamValue1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue3<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">D</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">D</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">j</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> streamValue4<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">D</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">D</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">hypsubst_thin</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> streamValue3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue5<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">D</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">≤</span> <span class="free">D</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.left_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">D</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">D</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> streamValue5<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> Suc <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">≤</span> Suc <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> Suc <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> Suc <span class="free">d</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> Suc <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≠</span> Suc <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">≤</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">j</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> sg5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue8<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> Suc <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">j</span></span><span class="main">≤</span> Suc <span class="free">d</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms streamValue7
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> arith_streamValue9aux<span class="main">:</span>
<span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue9<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">≤</span><span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> Suc <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="free">d</span><span class="main">)</span> <span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">+</span> Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arith_streamValue9aux<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>     

<span class="keyword1"><span class="command">lemma</span></span> streamValue10<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">d</span><span class="main">.</span> <span class="free">str</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> Suc <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> streamValue9<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> arith_sum1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span>  <span class="free">t</span> <span class="main">+</span> <span class="free">i</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> arith_sum2<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> arith_sum4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue11<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">≤</span>Suc <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">j</span> <span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arith_sum2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> streamValue12<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> streamValue11<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> streamValue43<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> streamValue2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> Suc <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> streamValue4<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> streamValue6<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Gateway_proof">
<div class="head">
<h1>Theory Gateway_proof</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">(*
   Title: Gateway_proof.thy  (Gateway: Verification)
   Author: Maria Spichkova &lt;maria.spichkova at rmit.edu.au&gt;, 2013
*)</span> 
<span class="comment1">(*&gt;*)</span>

<span class="comment1">(* header {*Gateway: Verification *} *)</span>

<span class="keyword1"><span class="command">theory</span></span> Gateway_proof 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Gateway_proof_aux.html">Gateway_proof_aux</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the Gateway›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="skolem">y</span> <span class="skolem">i1</span> <span class="free">d</span> <span class="skolem">x</span> <span class="skolem">i2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="skolem">i2</span> <span class="skolem">y</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Gateway_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_Delay_msg_a<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">buffer</span></span> <span class="keyword2"><span class="keyword">where</span></span> a4<span class="main">:</span>
    <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> 
        <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span> <span class="free">ack</span>
         <span class="skolem">i1</span> <span class="free">vc</span> <span class="skolem">st</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_def Sample_L_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">st</span> <span class="free">t</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> init_state"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">st</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> call"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg4 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> call"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="skolem">y</span> <span class="skolem">i1</span> <span class="free">d</span> <span class="skolem">x</span> <span class="skolem">i2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="skolem">i2</span> <span class="skolem">y</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Gateway_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_Delay_msg_a<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">buffer</span></span> <span class="keyword2"><span class="keyword">where</span></span> a4<span class="main">:</span>
    <span class="quoted"><span class="quoted">"Sample_L <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> 
         <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span> <span class="skolem">st</span> <span class="skolem">buffer</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">buffer</span> <span class="free">t</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_L_buffer<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span>  <span class="skolem">buffer</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_L_i1_buffer<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>  <span class="main">=</span>  <span class="skolem">i1</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Delay_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>  <span class="main">=</span>  <span class="skolem">i2</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="skolem">y</span> <span class="skolem">i1</span> <span class="free">d</span> <span class="skolem">x</span> <span class="skolem">i2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="skolem">i2</span> <span class="skolem">y</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Gateway_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_Delay_msg_a<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">buffer</span></span> <span class="keyword2"><span class="keyword">where</span></span> a4<span class="main">:</span>
    <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> 
        <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span> <span class="free">ack</span>
         <span class="skolem">i1</span> <span class="free">vc</span> <span class="skolem">st</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_def Sample_L_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">st</span> <span class="free">t</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> connection_ok"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h8 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">st</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> sending_data"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">st</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="skolem">y</span> <span class="skolem">i1</span> <span class="free">d</span> <span class="skolem">x</span> <span class="skolem">i2</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="skolem">i2</span> <span class="skolem">y</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Gateway_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_Delay_msg_a<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">buffer</span></span> <span class="keyword2"><span class="keyword">where</span></span> a4<span class="main">:</span>
    <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> 
        <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span> <span class="free">ack</span>
         <span class="skolem">i1</span> <span class="free">vc</span> <span class="skolem">st</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_def Sample_L_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">st</span> <span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="free">d</span><span class="main">)</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sending_data"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span>  <span class="main">=</span>  <span class="free">a</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">(</span><span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span>  <span class="main">=</span>  <span class="skolem">y</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Delay_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h8 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg6 <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">≤</span> Suc <span class="free">d</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">⟶</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="free">d</span><span class="main">+</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="skolem">y</span> <span class="skolem">i1</span> <span class="free">d</span> <span class="skolem">x</span> <span class="skolem">i2</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="skolem">i2</span> <span class="skolem">y</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Gateway_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_Delay_msg_a<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">buffer</span></span> <span class="keyword2"><span class="keyword">where</span></span> a4<span class="main">:</span>
    <span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> 
        <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span> <span class="free">ack</span>
         <span class="skolem">i1</span> <span class="free">vc</span> <span class="skolem">st</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_def Sample_L_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="free">d</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">+</span> Suc <span class="skolem">j</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span> 
       <span class="quoted"><span class="quoted">"<span class="skolem">st</span> <span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="free">d</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="free">d</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> a0 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="free">d</span><span class="main">+</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sending_data"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> correct_fin_inf_append1<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> a0  <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">d</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> sg6 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> a0 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Loss_L5Suc<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg8a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Delay_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> sg9<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>  
      <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> sg10<span class="main">:</span>
        <span class="quoted"><span class="quoted">"fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sending_data <span class="main">∧</span> 
         <span class="skolem">x</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> 
         <span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
         <span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> h8 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword1"><span class="command">have</span></span> sg11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">+</span> Suc <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> sg11 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
     <span class="keyword1"><span class="command">from</span></span> sg10 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg8a <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L6_induction<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="free">x1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="free">x2</span> <span class="free">i1</span> <span class="free">d</span> <span class="free">x1</span> <span class="free">i2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h10<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">x</span> <span class="free">i2</span> <span class="free">x2</span> <span class="free">i</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">x1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Loss_Delay_msg_a<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">buffer</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    a1<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="free">x1</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> 
         <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span> <span class="free">ack</span> <span class="free">i1</span> <span class="free">vc</span> <span class="skolem">st</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> 
    a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">.</span> <span class="skolem">buffer</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">dt</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="free">dt</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_def Sample_L_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">st</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span>  hd <span class="main">(</span><span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_ack_st_hd<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> connection_ok"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_inf_append_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_SampleT_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L6<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_L6_induction<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L6a<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gateway_L6<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> aux_k3req<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span><span class="free">k</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux3lose<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">≤</span><span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Gateway_L7<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">)</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="free">t</span><span class="main">.</span> <span class="free">req</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t2</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">.</span> <span class="free">i</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h10 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h10 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 
     <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_L1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_k3req<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> h10 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux3lose<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span>  <span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gateway_L6a<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    a1<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="skolem">y</span> <span class="skolem">i1</span> <span class="free">d</span> <span class="skolem">x</span> <span class="skolem">i2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a3<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="skolem">i2</span> <span class="skolem">y</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3  <span class="keyword1"><span class="command">have</span></span> sg8<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Loss_Delay_msg_a<span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> sg8 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">st</span></span> <span class="skolem"><span class="skolem">buffer</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    a4<span class="main">:</span><span class="quoted"><span class="quoted">"tiTable_SampleT <span class="free">req</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="main">(</span>fin_inf_append <span class="main">[</span>init_state<span class="main">]</span> <span class="skolem">st</span><span class="main">)</span> 
         <span class="main">(</span>fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span><span class="main">)</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span> <span class="skolem">st</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> 
    a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t</span><span class="main">.</span> <span class="skolem">buffer</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">dt</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> fin_inf_append <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="skolem">buffer</span> <span class="bound">t</span> <span class="keyword1">else</span> <span class="free">dt</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_def Sample_L_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg8 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h11 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword2"><span class="keyword">and</span></span> h10 
    <span class="keyword1"><span class="command">have</span></span> sg9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t1</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i1</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tiTable_i1_4<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg9 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t2</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">.</span> <span class="skolem">i2</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Delay_L2<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg10 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Loss_L2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L8a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t3</span></span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">a</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    a1<span class="main">:</span><span class="quoted"><span class="quoted">"Sample <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">ack</span> <span class="skolem">i1</span> <span class="free">vc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a2<span class="main">:</span><span class="quoted"><span class="quoted">"Delay <span class="skolem">y</span> <span class="skolem">i1</span> <span class="free">d</span> <span class="skolem">x</span> <span class="skolem">i2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a3<span class="main">:</span><span class="quoted"><span class="quoted">"Loss <span class="free">lose</span> <span class="free">a</span> <span class="skolem">i2</span> <span class="skolem">y</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h8 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t3</span></span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="skolem">y</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Loss_L6<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t4</span></span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="skolem">x</span> <span class="bound">t4</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Delay_L4<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> a3 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Loss_Delay_msg_a<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sample_sending_data<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Gateway_L8<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t3</span></span> <span class="main">≤</span> <span class="free">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">a</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_L8a<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proof of the Refinement Relation for the Gateway Requirements›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Gateway_L0<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"GatewayReq <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewayReq_def Gateway_L1 Gateway_L2 Gateway_L3 Gateway_L4<span class="main">)</span> 
 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas about Gateway Requirements›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GatewayReq_L1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h10<span class="main">:</span><span class="quoted"><span class="quoted">"GatewayReq <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h9 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">ka</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">ka</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_lemma_lose_1<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h10 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span> 
    <span class="free">req</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewayReq_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GatewayReq_L2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span>  h1<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"GatewayReq <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> h8 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">d</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span><span class="main">+</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_lemma_lose_2<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h8 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">ka</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">ka</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_lemma_lose_1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h9 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span> 
    <span class="free">req</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">i</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewayReq_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_last_ti_nonempty_k<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of the Gateway System›</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> GatewaySystem_L1aux<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span> <span class="main">∧</span> msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span> <span class="main">∧</span> msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span> <span class="main">∧</span> ts <span class="free">lose</span> <span class="main">⟶</span> 
        <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">ack</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span>
          <span class="free">req</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">∧</span> 
          <span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="free">ack</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span> <span class="free">req</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> 
         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="free">i</span> <span class="main">(</span>Suc <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">ack</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="free">ack</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="free">vc</span> <span class="main">(</span>Suc <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span>
          <span class="free">a</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span> <span class="main">∧</span> 
         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">ka</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="bound">ka</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
         <span class="free">vc</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> GatewaySystem_L3aux<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span> <span class="main">∧</span> msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span> <span class="main">∧</span> msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span> <span class="main">∧</span> ts <span class="free">lose</span> <span class="main">⟶</span> 
        <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">ack</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span> <span class="main">∧</span>
          <span class="free">req</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span> <span class="main">∧</span> <span class="free">lose</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">∧</span> 
          <span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span> <span class="main">⟶</span>
          <span class="free">ack</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="free">ack</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span> <span class="free">req</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> 
         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="free">i</span> <span class="main">(</span>Suc <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">ack</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="free">ack</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">k</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
          <span class="free">vc</span> <span class="main">(</span>Suc <span class="main">(</span><span class="bound">t</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span>
         <span class="free">req</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> 
         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
         <span class="free">i</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> GatewaySystem_L1<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span>  h2<span class="main">:</span><span class="quoted"><span class="quoted">"ServiceCenter <span class="free">i</span> <span class="free">a</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"GatewayReq <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">[</span>sc_ack<span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ServiceCenter_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">i</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="main">[</span>sc_ack<span class="main">]</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> h11 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span> <span class="main">∧</span> 
     <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">ka</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="bound">ka</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
     <span class="free">vc</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> GatewayReq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> GatewaySystem_L1aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h9 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">ka</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="bound">ka</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aux_lemma_lose_3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sg5a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg5a <span class="keyword1"><span class="command">have</span></span> sg5b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">ka</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="bound">ka</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> sg7<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword2"><span class="keyword">and</span></span> sg5b <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword2"><span class="keyword">and</span></span> sg7 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux4lose1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">j</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux4lose2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arith_sum1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aux4req<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound"><span class="bound">m</span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> GatewaySystem_L2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"ServiceCenter <span class="free">i</span> <span class="free">a</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"GatewayReq <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t1</span></span><span class="main">≤</span><span class="free">t</span><span class="main">.</span> <span class="free">req</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h13<span class="main">:</span><span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewayReq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> aux4lose1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h11 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> aux4req<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="comment1">(* stable connection *)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gateway_L6<span class="main">)</span>
  <span class="comment1">(* sending data*)</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h12 <span class="keyword2"><span class="keyword">and</span></span> h14 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg10<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewayReq_L1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h12 <span class="keyword2"><span class="keyword">and</span></span> h13 <span class="keyword2"><span class="keyword">and</span></span> h14 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg11<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewayReq_L2<span class="main">)</span>
  <span class="comment1">(* waiting for sc-ack *)</span>
  <span class="keyword1"><span class="command">from</span></span> h11 <span class="keyword1"><span class="command">have</span></span> sg12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword1"><span class="command">have</span></span> sg13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> sg12 
          <span class="keyword2"><span class="keyword">and</span></span> h12 <span class="keyword2"><span class="keyword">and</span></span> h8 <span class="keyword2"><span class="keyword">and</span></span> sg13 <span class="keyword2"><span class="keyword">and</span></span> h10
    <span class="keyword1"><span class="command">have</span></span> sg14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t2</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">.</span> <span class="free">i</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_L7<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg14 <span class="keyword2"><span class="keyword">and</span></span> h2 <span class="keyword1"><span class="command">have</span></span> sg15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t3</span></span> <span class="main">≤</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">.</span> <span class="free">a</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ServiceCenter_L2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword1"><span class="command">have</span></span> sg18<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> streamValue43<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h14  <span class="keyword1"><span class="command">have</span></span> sg16a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> streamValue2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sg16b<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> sg16a <span class="keyword2"><span class="keyword">and</span></span> sg16b <span class="keyword1"><span class="command">have</span></span> sg16<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span> <span class="main">+</span> Suc <span class="main">(</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> sg18 <span class="keyword2"><span class="keyword">and</span></span> sg10 <span class="keyword2"><span class="keyword">and</span></span> sg15 <span class="keyword1"><span class="command">have</span></span> sg19<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_L8<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg19 <span class="keyword1"><span class="command">have</span></span> sg19a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sg16 <span class="keyword1"><span class="command">have</span></span> sg20a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span>Suc <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> streamValue10<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> sg20b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword2"><span class="keyword">and</span></span> sg20b <span class="keyword1"><span class="command">have</span></span> sg20c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> aux4lose2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg20a <span class="keyword2"><span class="keyword">and</span></span> sg20c <span class="keyword1"><span class="command">have</span></span> sg20<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> streamValue8<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword1"><span class="command">have</span></span> sg21<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span> <span class="main">∧</span> 
      <span class="free">a</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="free">vc</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> GatewayReq_def<span class="main">)</span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> GatewaySystem_L1aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>  
   <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg11 <span class="keyword1"><span class="command">have</span></span> sg22<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sc_ack<span class="main">]</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ServiceCenter_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> sg21 <span class="keyword2"><span class="keyword">and</span></span> sg19a <span class="keyword2"><span class="keyword">and</span></span> sg22 <span class="keyword2"><span class="keyword">and</span></span> sg20 <span class="keyword1"><span class="command">have</span></span> sg23<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
   <span class="keyword1"><span class="command">from</span></span> sg23 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> GatewaySystem_L3<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> h1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span><span class="quoted"><span class="quoted">"ServiceCenter <span class="free">i</span> <span class="free">a</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h3<span class="main">:</span><span class="quoted"><span class="quoted">"GatewayReq <span class="free">req</span> <span class="free">dt</span> <span class="free">a</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">i</span> <span class="free">vc</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h4<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">req</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h5<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">stop</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h6<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="free">a</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h7<span class="main">:</span><span class="quoted"><span class="quoted">"ts <span class="free">lose</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dt</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="free">dt</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[</span>init_state<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>init<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t1</span></span><span class="main">≤</span><span class="free">t</span><span class="main">.</span> <span class="free">req</span> <span class="bound">t1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> h13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> h14<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vc_com<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">lose</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h10 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword1"><span class="command">have</span></span> sg3<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewayReq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword1"><span class="command">have</span></span> sg4<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">k</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> aux4lose1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h12 <span class="keyword1"><span class="command">have</span></span> sg5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> aux4req<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>  
  <span class="comment1">(* stable connection *)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> sg5 <span class="keyword2"><span class="keyword">and</span></span> sg4 <span class="keyword2"><span class="keyword">and</span></span> sg3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg6<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">≤</span> <span class="free">k</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Gateway_L6<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg6a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">(* sending data*)</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h13 <span class="keyword2"><span class="keyword">and</span></span> h14 <span class="keyword2"><span class="keyword">and</span></span> sg6 <span class="keyword1"><span class="command">have</span></span> sg10<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewayReq_L1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword1"><span class="command">have</span></span> sg11a<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>connection_ok<span class="main">]</span> <span class="main">∧</span>
    <span class="free">req</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">i</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> GatewayReq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> GatewaySystem_L3aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> sg12<span class="main">:</span><span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> h13 <span class="keyword2"><span class="keyword">and</span></span> sg12 <span class="keyword1"><span class="command">have</span></span> sg12a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">req</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>send<span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword1"><span class="command">have</span></span> sg13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span>Suc <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> streamValue12<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg11a <span class="keyword2"><span class="keyword">and</span></span> sg6a <span class="keyword2"><span class="keyword">and</span></span> h13 <span class="keyword2"><span class="keyword">and</span></span> sg12a <span class="keyword2"><span class="keyword">and</span></span> sg13 <span class="keyword1"><span class="command">have</span></span> sg14<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> inf_last_ti <span class="free">dt</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h8 <span class="keyword1"><span class="command">have</span></span> sg15<span class="main">:</span><span class="quoted"><span class="quoted">"inf_last_ti <span class="free">dt</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inf_last_ti_Suc2<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> sg14 <span class="keyword2"><span class="keyword">and</span></span> sg15 <span class="keyword1"><span class="command">have</span></span> sg16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arith_sum4<span class="main">)</span>
  <span class="comment1">(* waiting for sc-ack *)</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword1"><span class="command">have</span></span> sg17<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">k</span> <span class="main">+</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h12 <span class="keyword1"><span class="command">have</span></span> sg18<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">)</span><span class="main">.</span> <span class="free">req</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[</span>send<span class="main">]</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h10 <span class="keyword2"><span class="keyword">and</span></span> sg18 <span class="keyword2"><span class="keyword">and</span></span> h13 <span class="keyword2"><span class="keyword">and</span></span> h9 <span class="keyword2"><span class="keyword">and</span></span> sg17 <span class="keyword2"><span class="keyword">and</span></span> h11 
    <span class="keyword1"><span class="command">have</span></span> sg19<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t2</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">.</span> <span class="free">i</span> <span class="bound">t2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_L7<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> sg19 <span class="keyword1"><span class="command">have</span></span> sg20<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">t3</span></span> <span class="main">≤</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span><span class="main">.</span> <span class="free">a</span> <span class="bound">t3</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ServiceCenter_L2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h14 <span class="keyword1"><span class="command">have</span></span> sg21<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">d</span><span class="main">.</span> <span class="free">lose</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> streamValue43<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> sg21 <span class="keyword2"><span class="keyword">and</span></span> sg10 <span class="keyword2"><span class="keyword">and</span></span> sg20 <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span> <span class="main">≤</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">.</span> <span class="free">ack</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">k</span> <span class="main">+</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>sending_data<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_L8<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> h2 <span class="keyword2"><span class="keyword">and</span></span> h3 <span class="keyword2"><span class="keyword">and</span></span> h4 <span class="keyword2"><span class="keyword">and</span></span> h5 <span class="keyword2"><span class="keyword">and</span></span> h6 <span class="keyword2"><span class="keyword">and</span></span> h7 <span class="keyword2"><span class="keyword">and</span></span> h14 <span class="keyword2"><span class="keyword">and</span></span> sg16 <span class="keyword2"><span class="keyword">and</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewaySystem_L1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proof of the Refinement for the Gateway System›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> GatewaySystem_L0<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"GatewaySystem <span class="free">req</span> <span class="free">dt</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">vc</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>    <span class="quoted"><span class="quoted">"GatewaySystemReq <span class="free">req</span> <span class="free">dt</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="free">vc</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    a1<span class="main">:</span><span class="quoted"><span class="quoted">"Gateway <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="skolem">i</span> <span class="free">vc</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    a2<span class="main">:</span><span class="quoted"><span class="quoted">"ServiceCenter <span class="skolem">i</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewaySystem_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> sg1<span class="main">:</span><span class="quoted"><span class="quoted">"GatewayReq <span class="free">req</span> <span class="free">dt</span> <span class="skolem">x</span> <span class="free">stop</span> <span class="free">lose</span> <span class="free">d</span> <span class="free">ack</span> <span class="skolem">i</span> <span class="free">vc</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Gateway_L0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> sg2<span class="main">:</span><span class="quoted"><span class="quoted">"msg <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ServiceCenter_a_msg<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> a2 <span class="keyword2"><span class="keyword">and</span></span> sg1 <span class="keyword2"><span class="keyword">and</span></span> sg2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewaySystemReq_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewaySystem_L3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewaySystem_L3<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewaySystem_L3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> GatewaySystem_L2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>