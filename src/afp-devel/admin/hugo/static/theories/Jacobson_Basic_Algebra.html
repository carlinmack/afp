<div id="Set_Theory">
<div class="head">
<h1>Theory Set_Theory</h1>
</div>
<pre class="source"><span class="comment1">(*
  Copyright (c) 2014-2019 by Clemens Ballarin
  This file is licensed under the 3-clause BSD license.
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Set_Theory <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> map
<span class="keyword1"><span class="command">hide_const</span></span> partition

<span class="keyword1"><span class="command">no_notation</span></span> divide <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/</span>"</span> 70<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> inverse_divide <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Each statement in the formal text is annotated with the location of the originating statement
  in Jacobson's text <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> Jacobson1985<span class="antiquote"><span class="antiquote">}</span></span></span></span>.  Each fact that Jacobson states explicitly is marked
  as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> theorem<span class="antiquote"><span class="antiquote">}</span></span></span></span> unless it is translated to a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> sublocale<span class="antiquote"><span class="antiquote">}</span></span></span></span> declaration.
  Literal quotations from Jacobson's text are reproduced in double quotes.

  Auxiliary results needed for the formalisation that cannot be found in Jacobson's text are marked
  as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> lemma<span class="antiquote"><span class="antiquote">}</span></span></span></span> or are <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">command</span></span> interpretation<span class="antiquote"><span class="antiquote">}</span></span></span></span>s.  Such results are annotated with the
  location of a related statement.  For example, the introduction rule of a constant is annotated
  with the location of the definition of the corresponding operation.
›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Concepts from Set Theory.  The Integers›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Cartesian Product Set.  Maps›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Maps as extensional HOL functions›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 5, ll 21--25›</span></span>
<span class="keyword1"><span class="command">locale</span></span> map <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">α</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> graph <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">T</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 5, ll 21--25›</span></span>
<span class="keyword1" id="Set_Theory-map_closed"><span class="command">lemma</span></span> map_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">α</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> graph <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 5, ll 21--25›</span></span>
<span class="keyword1" id="Set_Theory-map_undefined"><span class="command">lemma</span></span> map_undefined <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">α</span> <span class="free">a</span> <span class="main">=</span> undefined"</span></span>
<span class="keyword1"><span class="command">using</span></span> graph <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* map *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 7, ll 7--8›</span></span>
<span class="keyword1"><span class="command">locale</span></span> surjective_map <span class="main">=</span> map <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> surjective <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">`</span> <span class="free">S</span> <span class="main">=</span> <span class="free">T</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 7, ll 8--9›</span></span>
<span class="keyword1"><span class="command">locale</span></span> injective_map <span class="main">=</span> map <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> injective <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">α</span> <span class="free">S</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Enables locale reasoning about the inverse <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"restrict <span class="main"><span class="main">(</span></span>inv_into <span class="free"><span class="free">S</span></span> <span class="free"><span class="free">α</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">T</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">α</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 7, ll 9--10›</span></span>
<span class="keyword1"><span class="command">locale</span></span> bijective <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">α</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">T</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bijective <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">α</span> <span class="free">S</span> <span class="free">T</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Exploit existing knowledge about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">bij_betw</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> rather than extending <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> surjective_map<span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> injective_map<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 7, ll 9--10›</span></span>
<span class="keyword1"><span class="command">locale</span></span> bijective_map <span class="main">=</span> map <span class="main">+</span> bijective <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 7, ll 9--10›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> surjective_map <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_imp_surj_on<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 7, ll 9--10›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> injective_map <span class="keyword1"><span class="command">using</span></span> bij_betw_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 9, ll 12--13›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> inverse<span class="main">:</span> map <span class="quoted"><span class="quoted">"restrict <span class="main">(</span>inv_into <span class="free">S</span> <span class="free">α</span><span class="main">)</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">S</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_into_into surjective<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 9, ll 12--13›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> inverse<span class="main">:</span> bijective <span class="quoted"><span class="quoted">"restrict <span class="main">(</span>inv_into <span class="free">S</span> <span class="free">α</span><span class="main">)</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">S</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_inv_into surjective<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* bijective_map *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 8, ll 14--15›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">identity</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> map <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 8, ll 18--20; p 9, ll 1--8›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> bij_betw_iff_has_inverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bij_betw <span class="free">α</span> <span class="free">S</span> <span class="free">T</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">β</span> <span class="main">∈</span> <span class="free">T</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span><span class="main">.</span> compose <span class="free">S</span> <span class="bound">β</span> <span class="free">α</span> <span class="main">=</span> identity <span class="free">S</span> <span class="main">∧</span> compose <span class="free">T</span> <span class="free">α</span> <span class="bound">β</span> <span class="main">=</span> identity <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">β</span> <span class="main">∈</span> <span class="free">T</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span><span class="main">.</span> <span class="var">?INV</span> <span class="bound">β</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?inv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span>inv_into <span class="free">S</span> <span class="free">α</span><span class="main">)</span> <span class="free">T</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">α</span> <span class="free">S</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?INV</span> <span class="var">?inv</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?inv</span> <span class="main">∈</span> <span class="free">T</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compose_inv_into_id bij_betw_imp_surj_on compose_id_inv_into bij_betw_imp_funcset bij_betw_inv_into<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">β</span> <span class="main">∈</span> <span class="free">T</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span><span class="main">.</span> <span class="var">?INV</span> <span class="bound">β</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">β</span> <span class="main">∈</span> <span class="free">T</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span><span class="main">.</span> <span class="var">?INV</span> <span class="bound">β</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">→</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">→</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="skolem">β</span> <span class="main">(</span><span class="free">α</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">T</span> <span class="main">⟹</span> <span class="free">α</span> <span class="main">(</span><span class="skolem">β</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PiE_restrict compose_eq graph restrict_PiE restrict_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">α</span> <span class="free">S</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* map *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Equivalence Relations.  Factoring a Map Through an Equivalence Relation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 6--11›</span></span>
<span class="keyword1"><span class="command">locale</span></span> equivalence <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">E</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> reflexive <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> symmetric <span class="main">[</span><span class="operator">sym</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> transitive <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span><span class="main">;</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 6--11›</span></span>
<span class="keyword1" id="Set_Theory-left_closed"><span class="command">lemma</span></span> left_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="comment1">(* inefficient as a simp rule *)</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 6--11›</span></span>
<span class="keyword1" id="Set_Theory-right_closed"><span class="command">lemma</span></span> right_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="comment1">(* inefficient as a simp rule *)</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* equivalence *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 16--20›</span></span>
<span class="keyword1"><span class="command">locale</span></span> partition <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">P</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊆</span> Pow <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> non_vacuous<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="free">P</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">P</span><span class="main">;</span> <span class="free">B</span> <span class="main">∈</span> <span class="free">P</span><span class="main">;</span> <span class="free">A</span> <span class="main">≠</span> <span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> equivalence <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 24--26›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Class</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">b</span></span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 24--26›</span></span>
<span class="keyword1" id="Set_Theory-Class_closed"><span class="command">lemma</span></span> Class_closed <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> Class <span class="free">b</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Class_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 24--26›</span></span>
<span class="keyword1" id="Set_Theory-Class_closed2"><span class="command">lemma</span></span> Class_closed2 <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> Class <span class="free">a</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Class_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 24--26›</span></span>
<span class="keyword1" id="Set_Theory-Class_undefined"><span class="command">lemma</span></span> Class_undefined <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">⟹</span> Class <span class="free">a</span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Class_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 24--26›</span></span>
<span class="keyword1" id="Set_Theory-ClassI"><span class="command">lemma</span></span> ClassI <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> Class <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Class_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_closed right_closed<span class="main">)</span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 24--26›</span></span>
<span class="keyword1" id="Set_Theory-Class_revI"><span class="command">lemma</span></span> Class_revI <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> Class <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> symmetric<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 24--26›</span></span>
<span class="keyword1" id="Set_Theory-ClassD"><span class="command">lemma</span></span> ClassD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">b</span> <span class="main">∈</span> Class <span class="free">a</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Class_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 30--31›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_self <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> Class <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Class_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, l 31; p 12, l 1›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_Union <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">a</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> Class <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 2--3›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟹</span> Class <span class="free">a</span> <span class="main">⊆</span> Class <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> Class <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>›</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> Class <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 11, ll 3--4›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟹</span> Class <span class="free">a</span> <span class="main">=</span> Class <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Class_subset <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> symmetric<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 1--5›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_equivalence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> Class <span class="free">a</span> <span class="main">=</span> Class <span class="free">b</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"Class <span class="skolem">a</span> <span class="main">=</span> Class <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Class <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹Class <span class="skolem">a</span> <span class="main">=</span> Class <span class="skolem">b</span>›</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">S</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> Class_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 5--7›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> not_disjoint_implies_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"Class <span class="free">a</span> <span class="main">∩</span> Class <span class="free">b</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Class <span class="free">a</span> <span class="main">=</span> Class <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> not_disjoint <span class="keyword2"><span class="keyword">and</span></span> closed <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> witness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> Class <span class="free">a</span> <span class="main">∩</span> Class <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">with</span></span> closed <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> witness <span class="keyword2"><span class="keyword">and</span></span> closed <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Class_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 7--8›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Partition</span> <span class="main">=</span> Class <span class="main">`</span> <span class="free">S</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 7--8›</span></span>
<span class="keyword1" id="Set_Theory-Class_in_Partition"><span class="command">lemma</span></span> Class_in_Partition <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> Class <span class="free">a</span> <span class="main">∈</span> Partition"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Partition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 7--8›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> partition<span class="main">:</span>
  <span class="quoted"><span class="quoted">"partition <span class="free">S</span> Partition"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">B</span>
  <span class="keyword3"><span class="command">assume</span></span> closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> Partition"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> Partition"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> Class <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> Class <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Partition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="skolem">B</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_np<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> not_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∩</span> <span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> not_disjoint_implies_equal ab<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Partition_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* equivalence *)</span>

<span class="keyword1"><span class="command">context</span></span> partition <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 9--10›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> block_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">A</span><span class="main">.</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> complete <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 9--10›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> block_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">P</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">B</span><span class="main">;</span> <span class="free">B</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 9--10›</span></span>
<span class="keyword1" id="Set_Theory-block_closed"><span class="command">lemma</span></span> block_closed <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="comment1">(* inefficient as a simp rule *)</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> complete <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 9--10›</span></span>
<span class="keyword1" id="Set_Theory-element_exists"><span class="command">lemma</span></span> element_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> non_vacuous block_closed all_not_in_conv<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 9--10›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Block</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">P</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 9--10›</span></span>
<span class="keyword1" id="Set_Theory-Block_closed"><span class="command">lemma</span></span> Block_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Block <span class="free">a</span> <span class="main">∈</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> block_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Block_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> block_unique<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 9--10›</span></span>
<span class="keyword1" id="Set_Theory-Block_undefined"><span class="command">lemma</span></span> Block_undefined <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">⟹</span> Block <span class="free">a</span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Block_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 9--10›</span></span>
<span class="keyword1" id="Set_Theory-Block_self"><span class="command">lemma</span></span> Block_self<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> Block <span class="free">a</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Block_def block_closed<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> block_unique<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 10--11›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Equivalence</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">A</span> <span class="main">∈</span> <span class="free">P</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 11--12›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> equivalence<span class="main">:</span> <span class="quoted"><span class="quoted">"equivalence <span class="free">S</span> Equivalence"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Equivalence <span class="main">⊆</span> <span class="free">S</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Equivalence_def <span class="keyword1"><span class="command">using</span></span> subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> Equivalence"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Equivalence_def <span class="keyword1"><span class="command">using</span></span> complete <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> Equivalence"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> Equivalence"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Equivalence_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> Equivalence"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> Equivalence"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> Equivalence"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Equivalence_def <span class="keyword1"><span class="command">using</span></span> disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Temporarily introduce equivalence associated to partition.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 12--14›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> equivalence <span class="quoted"><span class="free">S</span></span> <span class="quoted">Equivalence</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equivalence<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 12--14›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_is_Block<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Class <span class="free">a</span> <span class="main">=</span> Block <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> block_exists <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> block<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> <span class="skolem">A</span> <span class="main">∈</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Block_def Class_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> block<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> block block_unique<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> block_unique <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Equivalence_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, l 14›</span></span>
<span class="keyword1" id="Set_Theory-Class_equals_Block"><span class="command">lemma</span></span> Class_equals_Block<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Class <span class="main">=</span> Block"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Class <span class="skolem">x</span> <span class="main">=</span> Block <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Class_is_Block<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, l 14›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> partition_of_equivalence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Partition <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Partition_def Class_equals_Block image_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Block_self element_exists<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* partition *)</span>

<span class="keyword1"><span class="command">context</span></span> equivalence <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 14--17›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> partition <span class="quoted"><span class="free">S</span></span> <span class="quoted">Partition</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> partition<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 14--17›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> equivalence_of_partition<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Equivalence <span class="main">=</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Equivalence_def <span class="keyword1"><span class="command">unfolding</span></span> Partition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> ClassD Class_closed Class_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* equivalence *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, l 14›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> partition <span class="main">⊆</span> equivalence <span class="quoted"><span class="free">S</span></span> <span class="quoted">Equivalence</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"equivalence.Partition <span class="free">S</span> Equivalence <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"equivalence.Class <span class="free">S</span> Equivalence <span class="main">=</span> Block"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equivalence<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> partition_of_equivalence<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Class_equals_Block<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 14--17›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> equivalence <span class="main">⊆</span> partition <span class="quoted"><span class="free">S</span></span> <span class="quoted">Partition</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"partition.Equivalence Partition <span class="main">=</span> <span class="free">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"partition.Block <span class="free">S</span> Partition <span class="main">=</span> Class"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> partition<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equivalence_of_partition<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equivalence_of_partition partition partition.Class_equals_Block<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Unfortunately only effective on input›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 18--20›</span></span>
<span class="keyword1"><span class="command">notation</span></span> equivalence.Partition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/</span>"</span> 75<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> equivalence <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 18--20›</span></span>
<span class="keyword1" id="Set_Theory-representant_exists"><span class="command">lemma</span></span> representant_exists <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">/</span> <span class="free">E</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">A</span> <span class="main">=</span> Class <span class="bound">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Block_self element_exists<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 18--20›</span></span>
<span class="keyword1" id="Set_Theory-quotient_ClassE"><span class="command">lemma</span></span> quotient_ClassE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">/</span> <span class="free">E</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>Class <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> representant_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* equivalence *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 21--23›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> equivalence <span class="main">⊆</span> natural<span class="main">:</span> surjective_map <span class="quoted">Class</span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">/</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Technical device to achieve Jacobson's syntax; context where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">α</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not a parameter.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 25--26›</span></span>
<span class="keyword1"><span class="command">locale</span></span> fiber_relation_notation <span class="main">=</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 25--26›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Fiber_Relation</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">E'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Fiber_Relation</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">α</span></span></span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* fiber_relation_notation *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Context where classes and the induced map are defined through the fiber relation.
  This will be the case for monoid homomorphisms but not group homomorphisms.
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Avoids infinite interpretation chain.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 25--26›</span></span>
<span class="keyword1"><span class="command">locale</span></span> fiber_relation <span class="main">=</span> map <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Install syntax›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 25--26›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> fiber_relation_notation <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 12, ll 26--27›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> equivalence <span class="keyword2"><span class="keyword">where</span></span> E <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">E(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Fiber_Relation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹``define $\bar{\alpha}$ by $\bar{\alpha}(\bar{a}) = \alpha(a)$''›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 13, ll 8--9›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">induced</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">/</span> <span class="keyword1">E(</span><span class="free">α</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">α</span> <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 13, l 10›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Fiber_equality<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> Class <span class="free">a</span> <span class="main">=</span> Class <span class="free">b</span> <span class="main">⟷</span> <span class="free">α</span> <span class="free">a</span> <span class="main">=</span> <span class="free">α</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Class_equivalence <span class="keyword1"><span class="command">unfolding</span></span> Fiber_Relation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 13, ll 8--9›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> induced_Fiber_simp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"induced <span class="main">(</span>Class <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span>Class <span class="free">a</span><span class="main">.</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">α</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fiber_equality <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Block_self block_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> induced_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 13, ll 10--11›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> induced<span class="main">:</span> map <span class="quoted">induced</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">/</span> <span class="keyword1">E(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">T</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">/</span> <span class="keyword1">E(</span><span class="free">α</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> element_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">α</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">T</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fiber_equality <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Block_self block_closed<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced <span class="skolem">A</span> <span class="main">∈</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> induced_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> induced_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 13, ll 12--13›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> induced<span class="main">:</span> injective_map <span class="quoted">induced</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">/</span> <span class="keyword1">E(</span><span class="free">α</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">T</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on induced Partition"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Fiber_equality Block_self element_exists induced_Fiber_simp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 13, ll 16--19›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> factorization_lemma<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> compose <span class="free">S</span> induced Class <span class="free">a</span> <span class="main">=</span> <span class="free">α</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compose_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 13, ll 16--19›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> factorization <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"compose <span class="free">S</span> induced Class <span class="main">=</span> <span class="free">α</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compose_def map_undefined<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 14, ll 2--4›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> uniqueness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">/</span> <span class="keyword1">E(</span><span class="free">α</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">T</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> factorization<span class="main">:</span> <span class="quoted"><span class="quoted">"compose <span class="free">S</span> <span class="free">β</span> Class <span class="main">=</span> <span class="free">α</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> induced"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">A</span> <span class="main">=</span> induced <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">/</span> <span class="keyword1">E(</span><span class="free">α</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> Class <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">(</span>Class <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">α</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_eq factorization<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> induced <span class="main">(</span>Class <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> induced_def PiE_arb <span class="main"><span class="main">[</span></span><span class="operator">OF</span> map<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* fiber_relation *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Group_Theory">
<div class="head">
<h1>Theory Group_Theory</h1>
</div>
<pre class="source"><span class="comment1">(*
  Copyright (c) 2014-2019 by Clemens Ballarin
  This file is licensed under the 3-clause BSD license.
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Group_Theory <span class="keyword2"><span class="keyword">imports</span></span> <a href="Set_Theory.html">Set_Theory</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> monoid
<span class="keyword1"><span class="command">hide_const</span></span> group
<span class="keyword1"><span class="command">hide_const</span></span> inverse

<span class="keyword1"><span class="command">no_notation</span></span> quotient <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/'/</span>"</span> 90<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Monoids and Groups›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Monoids of Transformations and Abstract Monoids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Def 1.1›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 28, ll 28--30›</span></span>
<span class="keyword1"><span class="command">locale</span></span> monoid <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">⋅</span></span></span></span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">𝟭</span></span></span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> composition_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> unit_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> associative <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="free">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> left_unit <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main"><span class="free">𝟭</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> right_unit <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="free">a</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 29, ll 27--28›</span></span>
<span class="keyword1"><span class="command">locale</span></span> submonoid <span class="main">=</span> monoid <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">N</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sub_composition_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">N</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sub_unit_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 29, ll 27--28›</span></span>
<span class="keyword1" id="Group_Theory-sub"><span class="command">lemma</span></span> sub <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 29, ll 32--33›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> sub<span class="main">:</span> monoid <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sub_composition_closed sub_unit_closed<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* submonoid *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 29, ll 33--34›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> submonoid_transitive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"submonoid <span class="free">K</span> <span class="free">N</span> <span class="free">composition</span> <span class="free">unit</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"submonoid <span class="free">N</span> <span class="free">M</span> <span class="free">composition</span> <span class="free">unit</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"submonoid <span class="free">K</span> <span class="free">M</span> <span class="free">composition</span> <span class="free">unit</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> K<span class="main">:</span> submonoid <span class="quoted"><span class="free">K</span></span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">composition</span></span> <span class="quoted"><span class="free">unit</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> M<span class="main">:</span> submonoid <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">composition</span></span> <span class="quoted"><span class="free">unit</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 28, l 23›</span></span>
<span class="keyword1"><span class="command">locale</span></span> transformations <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>

<span class="comment1">(*  assumes non_vacuous: "S ≠ {}" *)</span> <span class="comment1">(* Jacobson requires this but we don't need it, strange. *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Monoid of all transformations›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 28, ll 23--24›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> transformations <span class="main">⊆</span> monoid <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PiE_def compose_eq compose_assoc Id_compose compose_Id<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">N</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a monoid of transformations of the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 29, ll 34--36›</span></span>
<span class="keyword1"><span class="command">locale</span></span> transformation_monoid <span class="main">=</span>
  transformations <span class="quoted"><span class="free">S</span></span> <span class="main">+</span> submonoid <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 29, ll 34--36›</span></span>
<span class="keyword1" id="Group_Theory-transformation_closed"><span class="command">lemma</span></span> transformation_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">α</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PiE_iff sub<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 29, ll 34--36›</span></span>
<span class="keyword1" id="Group_Theory-transformation_undefined"><span class="command">lemma</span></span> transformation_undefined <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">α</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span> <span class="free">x</span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PiE_arb sub<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* transformation_monoid *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Groups of Transformations and Abstract Groups›</span></span>

<span class="keyword1"><span class="command">context</span></span> monoid <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Invertible elements›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 3--5›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">invertible</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="free">invertible</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="bound">v</span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 3--5›</span></span>
<span class="keyword1" id="Group_Theory-invertibleI"><span class="command">lemma</span></span> invertibleI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">;</span> <span class="free">v</span> <span class="main"><span class="free">⋅</span></span> <span class="free">u</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> invertible <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 3--5›</span></span>
<span class="keyword1" id="Group_Theory-invertibleE"><span class="command">lemma</span></span> invertibleE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">u</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="bound">v</span> <span class="main"><span class="free">⋅</span></span> <span class="free">u</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invertible_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 6--7›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> inverse_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v'</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">;</span> <span class="free">v</span> <span class="main"><span class="free">⋅</span></span> <span class="free">u</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span>  <span class="free">v</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">v'</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> associative left_unit right_unit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inverse</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inverse</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">v</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="bound">v</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">u</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> inverse_equality<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">;</span> <span class="free">v</span> <span class="main"><span class="free">⋅</span></span> <span class="free">u</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> inverse <span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inverse_def <span class="keyword1"><span class="command">using</span></span> inverse_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1" id="Group_Theory-invertible_inverse_closed"><span class="command">lemma</span></span> invertible_inverse_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> inverse <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inverse_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1" id="Group_Theory-inverse_undefined"><span class="command">lemma</span></span> inverse_undefined <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∉</span> <span class="free">M</span> <span class="main">⟹</span> inverse <span class="free">u</span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1" id="Group_Theory-invertible_left_inverse"><span class="command">lemma</span></span> invertible_left_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> inverse <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> <span class="free">u</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inverse_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1" id="Group_Theory-invertible_right_inverse"><span class="command">lemma</span></span> invertible_right_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="free">u</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inverse_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1" id="Group_Theory-invertible_left_cancel"><span class="command">lemma</span></span> invertible_left_cancel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> associative invertible_def left_unit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1" id="Group_Theory-invertible_right_cancel"><span class="command">lemma</span></span> invertible_right_cancel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> associative invertible_def right_unit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1" id="Group_Theory-inverse_unit"><span class="command">lemma</span></span> inverse_unit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inverse_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 7--8›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> invertible_inverse_invertible <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> invertible <span class="main">(</span>inverse <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_left_inverse invertible_right_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 8›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> invertible_inverse_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> inverse <span class="main">(</span>inverse <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_equality<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid *)</span>

<span class="keyword1"><span class="command">context</span></span> submonoid <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Reasoning about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">invertible</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">inverse</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in submonoids.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1" id="Group_Theory-submonoid_invertible"><span class="command">lemma</span></span> submonoid_invertible <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sub.invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟧</span> <span class="main">⟹</span> invertible <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertibleI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 7›</span></span>
<span class="keyword1" id="Group_Theory-submonoid_inverse_closed"><span class="command">lemma</span></span> submonoid_inverse_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sub.invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">N</span> <span class="main">⟧</span> <span class="main">⟹</span> inverse <span class="free">u</span> <span class="main">∈</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inverse_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* submonoid *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Def 1.2›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 9--10›</span></span>
<span class="keyword1"><span class="command">locale</span></span> group <span class="main">=</span>
  monoid <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> invertible <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> invertible <span class="free">u</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 11--12›</span></span>
<span class="keyword1"><span class="command">locale</span></span> subgroup <span class="main">=</span> submonoid <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="main">+</span> sub<span class="main">:</span> group <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Reasoning about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">invertible</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">inverse</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in subgroups.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 11--12›</span></span>
<span class="keyword1" id="Group_Theory-subgroup_inverse_equality"><span class="command">lemma</span></span> subgroup_inverse_equality <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> inverse <span class="free">u</span> <span class="main">=</span> sub.inverse <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_equality<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 11--12›</span></span>
<span class="keyword1" id="Group_Theory-subgroup_inverse_iff"><span class="command">lemma</span></span> subgroup_inverse_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> inverse <span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_inverse_inverse sub.invertible_inverse_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* subgroup *)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 11--12›</span></span>
<span class="keyword1" id="Group_Theory-subgroup_transitive"><span class="command">lemma</span></span> subgroup_transitive <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">K</span> <span class="free">H</span> <span class="free">composition</span> <span class="free">unit</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span> <span class="free">composition</span> <span class="free">unit</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">K</span> <span class="free">G</span> <span class="free">composition</span> <span class="free">unit</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> K<span class="main">:</span> subgroup <span class="quoted"><span class="free">K</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">composition</span></span> <span class="quoted"><span class="free">unit</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">composition</span></span> <span class="quoted"><span class="free">unit</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> monoid <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Jacobson states both directions, but the other one is trivial.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 12--15›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> subgroupI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset <span class="main">[</span><span class="operator">THEN</span> subsetD<span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span> <span class="bound">h</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">g</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> invertible <span class="bound">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> inverse <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">G</span> <span class="free">M</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> sub<span class="main">:</span> monoid <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sub.invertible <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> invertible_left_inverse invertible_right_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 16›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Units</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">u</span></span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> invertible <span class="bound">u</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 16›</span></span>
<span class="keyword1" id="Group_Theory-mem_UnitsI"><span class="command">lemma</span></span> mem_UnitsI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> Units"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Units_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 16›</span></span>
<span class="keyword1" id="Group_Theory-mem_UnitsD"><span class="command">lemma</span></span> mem_UnitsD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">u</span> <span class="main">∈</span> Units <span class="main">⟧</span> <span class="main">⟹</span> invertible <span class="free">u</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Units_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 16--21›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> units<span class="main">:</span> subgroup <span class="quoted">Units</span> <span class="quoted"><span class="free">M</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subgroupI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u1</span> <span class="skolem">u2</span>
  <span class="keyword3"><span class="command">assume</span></span> Units <span class="main">[</span><span class="operator">THEN</span> mem_UnitsD<span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">∈</span> Units"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span> <span class="main">∈</span> Units"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u2</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>inverse <span class="skolem">u2</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="skolem">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">u2</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="skolem">u1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> invertible_left_inverse invertible_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u2</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>inverse <span class="skolem">u2</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="skolem">u1</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  <span class="comment1">― ‹ll 16--18›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="skolem">u2</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="skolem">u1</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">u1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inverse <span class="skolem">u2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>inverse <span class="skolem">u1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u1</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> invertible_left_inverse invertible_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> inv2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="skolem">u2</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="skolem">u1</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">u1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  <span class="comment1">― ‹l 9, “and similarly”›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u2</span> <span class="main">∈</span> Units"</span></span> <span class="keyword1"><span class="command">using</span></span> inv1 inv2 invertibleI mem_UnitsI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Units_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 21--22›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> group_of_Units <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"group Units <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 19›</span></span>
<span class="keyword1" id="Group_Theory-composition_invertible"><span class="command">lemma</span></span> composition_invertible <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">x</span><span class="main">;</span> invertible <span class="free">y</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> invertible <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mem_UnitsD mem_UnitsI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 20›</span></span>
<span class="keyword1" id="Group_Theory-unit_invertible"><span class="command">lemma</span></span> unit_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"invertible <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Useful simplification rules›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 22›</span></span>
<span class="keyword1" id="Group_Theory-invertible_right_inverse2"><span class="command">lemma</span></span> invertible_right_inverse2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>inverse <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 22›</span></span>
<span class="keyword1" id="Group_Theory-invertible_left_inverse2"><span class="command">lemma</span></span> invertible_left_inverse2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> invertible <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> inverse <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">u</span> <span class="main"><span class="free">⋅</span></span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 22›</span></span>
<span class="keyword1" id="Group_Theory-inverse_composition_commute"><span class="command">lemma</span></span> inverse_composition_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"invertible <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> inverse <span class="free">y</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inverse <span class="free">y</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="free">x</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_left_inverse2 associative<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> invertible_left_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, l 24›</span></span>
<span class="keyword1"><span class="command">context</span></span> transformations <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 25--26›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> invertible_is_bijective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invertible <span class="free">α</span> <span class="main">⟷</span> bij_betw <span class="free">α</span> <span class="free">S</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> dom <span class="keyword1"><span class="command">interpret</span></span> map <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">S</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_iff_has_inverse invertible_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 26--27›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Units_bijective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Units <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">α</span></span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span><span class="main">.</span> bij_betw <span class="bound">α</span> <span class="free">S</span> <span class="free">S</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Units_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_is_bijective<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 26--27›</span></span>
<span class="keyword1" id="Group_Theory-Units_bij_betwI"><span class="command">lemma</span></span> Units_bij_betwI <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">∈</span> Units <span class="main">⟹</span> bij_betw <span class="free">α</span> <span class="free">S</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Units_bijective<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 26--27›</span></span>
<span class="keyword1" id="Group_Theory-Units_bij_betwD"><span class="command">lemma</span></span> Units_bij_betwD <span class="main">[</span><span class="operator">dest</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">α</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span><span class="main">;</span> bij_betw <span class="free">α</span> <span class="free">S</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span> <span class="main">∈</span> Units"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Units_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 28--29›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sym</span> <span class="main">≡</span> Units"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 26--28›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> symmetric<span class="main">:</span> group <span class="quoted"><span class="quoted">"Sym"</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> group_of_Units<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* transformations *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 32, ll 18--19›</span></span>
<span class="keyword1"><span class="command">locale</span></span> transformation_group <span class="main">=</span>
  transformations <span class="quoted"><span class="free">S</span></span> <span class="main">+</span> symmetric<span class="main">:</span> subgroup <span class="quoted"><span class="free">G</span></span> <span class="quoted">Sym</span> <span class="quoted"><span class="quoted">"compose <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 32, ll 18--19›</span></span>
<span class="keyword1" id="Group_Theory-transformation_group_closed"><span class="command">lemma</span></span> transformation_group_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">α</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bij_betwE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 32, ll 18--19›</span></span>
<span class="keyword1" id="Group_Theory-transformation_group_undefined"><span class="command">lemma</span></span> transformation_group_undefined <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">α</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">x</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">α</span> <span class="free">x</span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_def symmetric.sub.right_unit restrict_apply<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* transformation_group *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Isomorphisms.  Cayley's Theorem›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Def 1.3›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 37, ll 7--11›</span></span>
<span class="keyword1"><span class="command">locale</span></span> monoid_isomorphism <span class="main">=</span>
  bijective_map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">M'</span></span> <span class="main">+</span>  source<span class="main">:</span> monoid <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="main">+</span> target<span class="main">:</span> monoid <span class="quoted"><span class="free">M'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">η</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition'</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅''</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭''</span>"</span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> commutes_with_composition<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">η</span> <span class="free">x</span> <span class="main"><span class="free">⋅'</span></span> <span class="free">η</span> <span class="free">y</span> <span class="main">=</span> <span class="free">η</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> commutes_with_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 37, l 10›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">isomorphic_as_monoids</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≅<span class="hidden">⇩</span><sub>M</sub></span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ℳ</span></span></span> <span class="keyword1"><span class="free">≅<span class="hidden">⇩</span><sub>M</sub></span></span> <span class="free"><span class="bound"><span class="entity">ℳ'</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">M</span><span class="main">,</span> <span class="bound">composition</span><span class="main">,</span> <span class="bound">unit</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ℳ</span></span></span><span class="main">;</span> <span class="main">(</span><span class="bound">M'</span><span class="main">,</span> <span class="bound">composition'</span><span class="main">,</span> <span class="bound">unit'</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ℳ'</span></span></span> <span class="keyword1">in</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">η</span><span class="main">.</span> monoid_isomorphism <span class="bound">η</span> <span class="bound">M</span> <span class="bound">composition</span> <span class="bound">unit</span> <span class="bound">M'</span> <span class="bound">composition'</span> <span class="bound">unit'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 37, ll 11--12›</span></span>
<span class="keyword1"><span class="command">locale</span></span> monoid_isomorphism' <span class="main">=</span>
  bijective_map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">M'</span></span> <span class="main">+</span>  source<span class="main">:</span> monoid <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="main">+</span> target<span class="main">:</span> monoid <span class="quoted"><span class="free">M'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">η</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition'</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅''</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭''</span>"</span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> commutes_with_composition<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">η</span> <span class="free">x</span> <span class="main"><span class="free">⋅'</span></span> <span class="free">η</span> <span class="free">y</span> <span class="main">=</span> <span class="free">η</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 37, ll 11--12›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_isomorphism <span class="main">⊆</span> monoid_isomorphism'
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> commutes_with_composition<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Both definitions are equivalent.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 37, ll 12--15›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_isomorphism' <span class="main">⊆</span> monoid_isomorphism
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">M'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_iff surjective<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main"><span class="free">⋅'</span></span> <span class="free">η</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> commutes_with_composition <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="main"><span class="free">𝟭'</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> commutes_with_composition<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> monoid_isomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 37, ll 30--33›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> inverse_monoid_isomorphism<span class="main">:</span>
  <span class="quoted"><span class="quoted">"monoid_isomorphism <span class="main">(</span>restrict <span class="main">(</span>inv_into <span class="free">M</span> <span class="free">η</span><span class="main">)</span> <span class="free">M'</span><span class="main">)</span> <span class="free">M'</span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span> <span class="free">M</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> commutes_with_composition commutes_with_unit surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid_isomorphism *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We only need that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">η</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is symmetric.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 37, ll 28--29›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> isomorphic_as_monoids_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">composition</span><span class="main">,</span> <span class="free">unit</span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="free">M'</span><span class="main">,</span> <span class="free">composition'</span><span class="main">,</span> <span class="free">unit'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">M'</span><span class="main">,</span> <span class="free">composition'</span><span class="main">,</span> <span class="free">unit'</span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="free">composition</span><span class="main">,</span> <span class="free">unit</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_as_monoids_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> monoid_isomorphism.inverse_monoid_isomorphism<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, l 4›</span></span>
<span class="keyword1"><span class="command">locale</span></span> left_translations_of_monoid <span class="main">=</span> monoid <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*
  We take the liberty of omitting "left_" from the name of the translation operation.  The derived
  transformation monoid and group won't be qualified with "left" either.  This avoids qualifications
  such as "left.left_...".  In contexts where left and right translations are used simultaneously,
  notably subgroup_of_group, qualifiers are needed.
*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 5--7›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">translation</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">')<span class="hidden">⇩</span><sub>L</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">translation</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> <span class="main">λ</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> <span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 5--7›</span></span>
<span class="keyword1" id="Group_Theory-translation_map"><span class="command">lemma</span></span> translation_map <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">∈</span> <span class="free">M</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> translation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 5--7›</span></span>
<span class="keyword1" id="Group_Theory-Translations_maps"><span class="command">lemma</span></span> Translations_maps <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"translation <span class="main">`</span> <span class="free">M</span> <span class="main">⊆</span> <span class="free">M</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 5--7›</span></span>
<span class="keyword1" id="Group_Theory-translation_apply"><span class="command">lemma</span></span> translation_apply<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> translation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 5--7›</span></span>
<span class="keyword1" id="Group_Theory-translation_exist"><span class="command">lemma</span></span> translation_exist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> translation <span class="main">`</span> <span class="free">M</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">M</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 5--7›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> Translations_E <span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">=</span> translation_exist <span class="main">[</span><span class="operator">THEN</span> bexE<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, l 10›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> translation_unit_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"identity <span class="free">M</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">𝟭</span></span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> translation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 10--11›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> translation_composition_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">M</span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">b</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> translation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative compose_def<span class="main">)</span>

<span class="comment1">(* Activate @{locale monoid} to simplify subsequent proof. *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 7--9›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> transformation<span class="main">:</span> transformations <span class="quoted"><span class="free">M</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 7--9›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Translations_transformation_monoid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transformation_monoid <span class="main">(</span>translation <span class="main">`</span> <span class="free">M</span><span class="main">)</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 7--9›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> transformation<span class="main">:</span> transformation_monoid <span class="quoted"><span class="quoted">"translation <span class="main">`</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">M</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Translations_transformation_monoid<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, l 12›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> map <span class="quoted">translation</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"translation <span class="main">`</span> <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> translation_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 12--16›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> translation_isomorphism <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"monoid_isomorphism translation <span class="free">M</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">(</span>translation <span class="main">`</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span>compose <span class="free">M</span><span class="main">)</span> <span class="main">(</span>identity <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on translation <span class="free">M</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">b</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">b</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> translation_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw translation <span class="free">M</span> <span class="main">(</span>translation <span class="main">`</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_imp_bij_betw<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 12--16›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_isomorphism <span class="quoted">translation</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="quoted">"translation <span class="main">`</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* left_translations_of_monoid *)</span>

<span class="keyword1"><span class="command">context</span></span> monoid <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 1--2›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> left_translations_of_monoid <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 1--2›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> cayley_monoid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M'</span> <span class="bound">composition'</span> <span class="bound">unit'</span><span class="main">.</span> transformation_monoid <span class="bound">M'</span> <span class="free">M</span> <span class="main">∧</span> <span class="main">(</span><span class="free">M</span><span class="main">,</span> <span class="main"><span class="free">(⋅)</span></span><span class="main">,</span> <span class="main"><span class="free">𝟭</span></span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="bound">M'</span><span class="main">,</span> <span class="bound">composition'</span><span class="main">,</span> <span class="bound">unit'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_as_monoids_def<span class="main">)</span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Translations_transformation_monoid<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, l 17›</span></span>
<span class="keyword1"><span class="command">locale</span></span> left_translations_of_group <span class="main">=</span> group <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 17--18›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> left_translations_of_monoid <span class="keyword2"><span class="keyword">where</span></span> M <span class="main">=</span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 17--18›</span></span>
<span class="keyword1"><span class="command">notation</span></span> translation <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">')<span class="hidden">⇩</span><sub>L</sub></span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The group of left translations is a subgroup of the symmetric group,
  hence <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">transformation.sub.invertible</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 20--22›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> translation_invertible <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"transformation.sub.invertible <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span>inverse <span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> identity <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> <span class="main">(</span>inverse <span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="main">=</span> identity <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 19--20›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> translation_bijective <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> bij_betw <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span> <span class="free">G</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> transformation.invertible_is_bijective <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 18--20›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Translations_transformation_group<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transformation_group <span class="main">(</span>translation <span class="main">`</span> <span class="free">G</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>translation <span class="main">`</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> transformation.Sym"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> transformation.Units_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span>
  <span class="keyword3"><span class="command">assume</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> translation <span class="main">`</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>L</sub></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> translation_invertible <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transformation.sub.invertible <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 18--20›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> transformation<span class="main">:</span> transformation_group <span class="quoted"><span class="quoted">"translation <span class="main">`</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="free">G</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Translations_transformation_group<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* left_translations_of_group *)</span>

<span class="keyword1"><span class="command">context</span></span> group <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 2--3›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> left_translations_of_group <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 38, ll 2--3›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> cayley_group<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">G'</span> <span class="bound">composition'</span> <span class="bound">unit'</span><span class="main">.</span> transformation_group <span class="bound">G'</span> <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="main"><span class="free">(⋅)</span></span><span class="main">,</span> <span class="main"><span class="free">𝟭</span></span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>M</sub></span> <span class="main">(</span><span class="bound">G'</span><span class="main">,</span> <span class="bound">composition'</span><span class="main">,</span> <span class="bound">unit'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_as_monoids_def<span class="main">)</span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Translations_transformation_group<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Exercise 3›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1"><span class="command">locale</span></span> right_translations_of_group <span class="main">=</span> group <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">translation</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">')<span class="hidden">⇩</span><sub>R</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">translation</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="main">λ</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Translations</span> <span class="main">≡</span> translation <span class="main">`</span> <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The isomorphism that will be established is a map different from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">translation</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> aux<span class="main">:</span> map <span class="quoted">translation</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted">Translations</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> translation_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1" id="Group_Theory-translation_map"><span class="command">lemma</span></span> translation_map <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">∈</span> <span class="free">G</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> translation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1" id="Group_Theory-Translation_maps"><span class="command">lemma</span></span> Translation_maps <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Translations <span class="main">⊆</span> <span class="free">G</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1" id="Group_Theory-translation_apply"><span class="command">lemma</span></span> translation_apply<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> translation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1" id="Group_Theory-translation_exist"><span class="command">lemma</span></span> translation_exist<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> Translations <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="bound">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> Translations_E <span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">=</span> translation_exist <span class="main">[</span><span class="operator">THEN</span> bexE<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 9--10›</span></span>
<span class="keyword1" id="Group_Theory-translation_unit_eq"><span class="command">lemma</span></span> translation_unit_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"identity <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">𝟭</span></span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> translation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1" id="Group_Theory-translation_composition_eq"><span class="command">lemma</span></span> translation_composition_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">b</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> translation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative compose_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> transformation<span class="main">:</span> transformations <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1" id="Group_Theory-Translations_transformation_monoid"><span class="command">lemma</span></span> Translations_transformation_monoid<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transformation_monoid Translations <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> transformation<span class="main">:</span> transformation_monoid <span class="quoted">Translations</span> <span class="quoted"><span class="free">G</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Translations_transformation_monoid<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1" id="Group_Theory-translation_invertible"><span class="command">lemma</span></span> translation_invertible <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"transformation.sub.invertible <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>inverse <span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">=</span> identity <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> <span class="main">(</span>inverse <span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">=</span> identity <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1" id="Group_Theory-translation_bijective"><span class="command">lemma</span></span> translation_bijective <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> bij_betw <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">G</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> transformation.invertible_is_bijective <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Translations_transformation_group<span class="main">:</span>
  <span class="quoted"><span class="quoted">"transformation_group Translations <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Translations <span class="main">⊆</span> transformation.Sym"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> transformation.Units_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span>
  <span class="keyword3"><span class="command">assume</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> Translations"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> translation_invertible <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transformation.sub.invertible <span class="skolem">α</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> transformation<span class="main">:</span> transformation_group <span class="quoted">Translations</span> <span class="quoted"><span class="free">G</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Translations_transformation_group<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1" id="Group_Theory-translation_inverse_eq"><span class="command">lemma</span></span> translation_inverse_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"transformation.sub.inverse <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">=</span> <span class="main">(</span>inverse <span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> transformation.sub.inverse_equality<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span>inverse <span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">=</span> identity <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> <span class="main">(</span>inverse <span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">=</span> identity <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> translation_inverse_monoid_isomorphism <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"monoid_isomorphism <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> transformation.symmetric.inverse <span class="main">(</span><span class="bound">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span><span class="main">)</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> Translations <span class="main">(</span>compose <span class="free">G</span><span class="main">)</span> <span class="main">(</span>identity <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"monoid_isomorphism <span class="var">?inv</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?inv</span> <span class="main">∈</span> <span class="free">G</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> Translations"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> translation_unit_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">note</span></span> bij_betw_compose <span class="main">[</span><span class="operator">trans</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw inverse <span class="free">G</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">inverse</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw translation <span class="free">G</span> Translations"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betwI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">α</span></span></span><span class="main"><span class="main"><span class="main">∈</span></span></span>Translations<span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">α</span></span></span> <span class="main"><span class="free"><span class="main"><span class="free"><span class="main"><span class="free">𝟭</span></span></span></span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> translation_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="var">?inv</span> <span class="free">G</span> Translations"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> bij_betw_cong <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compose_eq <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> translation_unit_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> <span class="main">(</span><span class="var">?inv</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?inv</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?inv</span> <span class="main">(</span><span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_composition_commute <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> translation_unit_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?inv</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> identity <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> translation_unit_eq<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 39, ll 10--11›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_isomorphism
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">a</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> transformation.symmetric.inverse <span class="main">(</span><span class="bound">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted">Translations</span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* right_translations_of_group *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generalized Associativity.  Commutativity›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 40, l 27; p 41, ll 1--2›</span></span>
<span class="keyword1"><span class="command">locale</span></span> commutative_monoid <span class="main">=</span> monoid <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> commutative<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 41, l 2›</span></span>
<span class="keyword1"><span class="command">locale</span></span> abelian_group <span class="main">=</span> group <span class="main">+</span> commutative_monoid <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Orbits.  Cosets of a Subgroup›</span></span>

<span class="keyword1"><span class="command">context</span></span> transformation_group <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 51, ll 18--20›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Orbit_Relation</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Orbit_Relation</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">α</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">α</span> <span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 51, ll 18--20›</span></span>
<span class="keyword1" id="Group_Theory-Orbit_Relation_memI"><span class="command">lemma</span></span> Orbit_Relation_memI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∃</span><span class="bound">α</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="free">y</span> <span class="main">=</span> <span class="bound">α</span> <span class="free">x</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Orbit_Relation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Orbit_Relation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 51, ll 18--20›</span></span>
<span class="keyword1" id="Group_Theory-Orbit_Relation_memE"><span class="command">lemma</span></span> Orbit_Relation_memE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Orbit_Relation<span class="main">;</span> <span class="main">⋀</span><span class="bound">α</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">α</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="free">y</span> <span class="main">=</span> <span class="bound">α</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Orbit_Relation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 51, ll 20--23, 26--27›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> orbit<span class="main">:</span> equivalence <span class="quoted"><span class="free">S</span></span> <span class="quoted">Orbit_Relation</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Orbit_Relation_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> identity <span class="free">S</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">α</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">α</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">α</span>
  <span class="keyword3"><span class="command">assume</span></span> α<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> x id <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> compose <span class="free">S</span> <span class="main">(</span>symmetric.inverse <span class="skolem">α</span><span class="main">)</span> <span class="skolem">α</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> x α <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">α'</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">α'</span> <span class="main">(</span><span class="skolem">α</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_eq symmetric.sub.invertible symmetric.submonoid_inverse_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">β</span>
  <span class="keyword3"><span class="command">assume</span></span> β<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">(</span><span class="skolem">α</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> compose <span class="free">S</span> <span class="skolem">β</span> <span class="skolem">α</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compose_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> α β <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">γ</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="skolem">β</span> <span class="main">(</span><span class="skolem">α</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">γ</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 51, ll 23--24›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> orbit_equality<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> orbit.Class <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="bound">α</span> <span class="free">x</span> <span class="main">|</span> <span class="bound">α</span><span class="main">.</span> <span class="bound">α</span> <span class="main">∈</span> <span class="free">G</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orbit.Class_def<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.symmetric <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> orbit.symmetric<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* transformation_group *)</span>

<span class="keyword1"><span class="command">context</span></span> monoid_isomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, ll 16--17›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> image_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">G</span> <span class="free">M</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">G</span><span class="main">)</span> <span class="free">M'</span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> image<span class="main">:</span> monoid <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">`</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> commutes_with_composition commutes_with_unit <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"image.invertible <span class="main">(</span><span class="free">η</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">(</span>sub.inverse <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">η</span> <span class="main">`</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> x commutes_with_composition commutes_with_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid_isomorphism *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Technical device to achieve Jacobson's notation for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">Right_Coset</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">Left_Coset</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.  The
  definitions are pulled out of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">subgroup_of_group</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to a context where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">H</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not a parameter.
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, l 20›</span></span>
<span class="keyword1"><span class="command">locale</span></span> coset_notation <span class="main">=</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>  <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equation 23›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, l 20›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Right_Coset</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">|⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main"><span class="free">|⋅</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">h</span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">|</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 53, ll 8--9›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Left_Coset</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅|</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⋅|</span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⋅</span></span> <span class="bound">h</span> <span class="main">|</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, l 20›</span></span>
<span class="keyword1" id="Group_Theory-Right_Coset_memI"><span class="command">lemma</span></span> Right_Coset_memI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">|⋅</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Right_Coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, l 20›</span></span>
<span class="keyword1" id="Group_Theory-Right_Coset_memE"><span class="command">lemma</span></span> Right_Coset_memE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">|⋅</span> <span class="free">x</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">h</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Right_Coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 53, ll 8--9›</span></span>
<span class="keyword1" id="Group_Theory-Left_Coset_memI"><span class="command">lemma</span></span> Left_Coset_memI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">h</span> <span class="main">∈</span> <span class="free">x</span> <span class="main">⋅|</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Left_Coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 53, ll 8--9›</span></span>
<span class="keyword1" id="Group_Theory-Left_Coset_memE"><span class="command">lemma</span></span> Left_Coset_memE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">x</span> <span class="main">⋅|</span> <span class="free">H</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> <span class="free">a</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">h</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Left_Coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* coset_notation *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, l 12›</span></span>
<span class="keyword1"><span class="command">locale</span></span> subgroup_of_group <span class="main">=</span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="main">+</span> coset_notation <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="main">+</span> group <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">H</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, ll 12--14›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> left<span class="main">:</span> left_translations_of_group <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> right<span class="main">:</span> right_translations_of_group <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"left.translation <span class="main"><span class="main">`</span></span> <span class="free"><span class="free">H</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes Jacobson's <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"H<span class="hidden">⇩</span><sub>L</sub>(G)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"left.translation <span class="main"><span class="main">`</span></span> <span class="free"><span class="free">G</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes Jacobson's <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"G<span class="hidden">⇩</span><sub>L</sub>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, ll 16--18›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> left_translations_of_subgroup_are_transformation_group <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"transformation_group <span class="main">(</span>left.translation <span class="main">`</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>left.translation <span class="main">`</span> <span class="free">H</span><span class="main">)</span> <span class="main">(</span>left.translation <span class="main">`</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>compose <span class="free">G</span><span class="main">)</span> <span class="main">(</span>identity <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> left.image_subgroup<span class="main">)</span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>left.translation <span class="main">`</span> <span class="free">G</span><span class="main">)</span> left.transformation.Sym <span class="main">(</span>compose <span class="free">G</span><span class="main">)</span> <span class="main">(</span>identity <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">interpret</span></span> right_coset<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"left.translation <span class="main">`</span> <span class="free">H</span>"</span></span> <span class="quoted">left.transformation.Sym</span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, l 18›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> transformation_group <span class="quoted"><span class="quoted">"left.translation <span class="main">`</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, ll 19--20›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Right_Coset_is_orbit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">H</span> <span class="main">|⋅</span> <span class="free">x</span> <span class="main">=</span> orbit.Class <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> left.translation_apply <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_equality Right_Coset_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> imageI sub<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, ll 24--25›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Right_Coset_Union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="free">H</span> <span class="main">|⋅</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Right_Coset_is_orbit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, l 26›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Right_Coset_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> G <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>inverse <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">H</span> <span class="main">|⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span> <span class="main">|⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imageI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>inverse <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">H</span> <span class="main">|⋅</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Right_Coset_is_orbit right.translation_apply orbit.block_closed<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inverse <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">`</span> <span class="main">(</span><span class="free">H</span> <span class="main">|⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">H</span> <span class="main">|⋅</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right.translation_apply associative invertible_right_inverse2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, ll 25--26›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Right_Cosets_cardinality<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> card <span class="main">(</span><span class="free">H</span> <span class="main">|⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span><span class="free">H</span> <span class="main">|⋅</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bij_betw_same_card Right_Coset_bij<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, l 27›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Right_Coset_unit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">|⋅</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Right_Coset_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, l 27›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Right_Coset_cardinality<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> card <span class="main">(</span><span class="free">H</span> <span class="main">|⋅</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> card <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Right_Coset_unit Right_Cosets_cardinality unit_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, ll 31--32›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">index</span> <span class="main">=</span> card orbit.Partition"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.5›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 52, ll 33--35; p 53, ll 1--2›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> lagrange<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="free">G</span> <span class="main">⟹</span> card <span class="free">G</span> <span class="main">=</span> card <span class="free">H</span> <span class="main">*</span> index"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> index_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> card_partition<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_UnionD orbit.complete orbit.disjoint<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Right_Coset_cardinality Right_Coset_is_orbit orbit.Block_self orbit.element_exists<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* subgroup_of_group *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Left cosets›</span></span>

<span class="keyword1"><span class="command">context</span></span> subgroup <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 31, ll 11--12›</span></span>
<span class="keyword1" id="Group_Theory-image_of_inverse"><span class="command">lemma</span></span> image_of_inverse <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> inverse <span class="main">`</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_eqI sub.invertible sub.invertible_inverse_closed sub.invertible_inverse_inverse subgroup_inverse_equality<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* subgroup *)</span>

<span class="keyword1"><span class="command">context</span></span> group <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Does Jacobson show this somewhere? *)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 53, ll 6--7›</span></span>
<span class="keyword1" id="Group_Theory-inverse_subgroupI"><span class="command">lemma</span></span> inverse_subgroupI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>inverse <span class="main">`</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sub <span class="keyword1"><span class="command">interpret</span></span> subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> inv<span class="main">:</span> monoid <span class="quoted"><span class="quoted">"inverse <span class="main">`</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> subgroup_inverse_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> inv<span class="main">:</span> group <span class="quoted"><span class="quoted">"inverse <span class="main">`</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> subgroup_inverse_equality<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> subgroup_inverse_equality<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 53, ll 6--7›</span></span>
<span class="keyword1" id="Group_Theory-inverse_subgroupD"><span class="command">lemma</span></span> inverse_subgroupD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>inverse <span class="main">`</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> Units"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="free">H</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>inverse <span class="main">`</span> inverse <span class="main">`</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inverse_subgroupI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> inv <span class="main">[</span><span class="operator">THEN</span> subsetD<span class="main">,</span> <span class="operator">simplified</span> Units_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">`</span> inverse <span class="main">`</span> <span class="free">H</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> image_cong <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group *)</span>

<span class="keyword1"><span class="command">context</span></span> subgroup_of_group <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 53, l 6›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> right_translations_of_group <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"translation <span class="main"><span class="main">`</span></span> <span class="free"><span class="free">H</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes Jacobson's <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"H<span class="hidden">⇩</span><sub>R</sub>(G)"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Translations"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes Jacobson's <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">"G<span class="hidden">⇩</span><sub>R</sub>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 53, ll 6--7›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> right_translations_of_subgroup_are_transformation_group <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"transformation_group <span class="main">(</span>translation <span class="main">`</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> transformation.symmetric.inverse <span class="main">(</span><span class="bound">a</span><span class="keyword1">)<span class="hidden">⇩</span><sub>R</sub></span><span class="main">)</span> <span class="main">`</span> <span class="free">H</span><span class="main">)</span> Translations <span class="main">(</span>compose <span class="free">G</span><span class="main">)</span> <span class="main">(</span>identity <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_subgroup<span class="main">)</span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgroup Translations transformation.Sym <span class="main">(</span>compose <span class="free">G</span><span class="main">)</span> <span class="main">(</span>identity <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">interpret</span></span> left_coset<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"translation <span class="main">`</span> <span class="free">H</span>"</span></span> <span class="quoted">transformation.Sym</span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> transformation.symmetric.inverse_subgroupD <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> image_cong
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_image transformation.symmetric.Units_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> translation_unit_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 53, ll 6--7›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> transformation_group <span class="quoted"><span class="quoted">"translation <span class="main">`</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equation 23 for left cosets›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 53, ll 7--8›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Left_Coset_is_orbit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⋅|</span> <span class="free">H</span> <span class="main">=</span> orbit.Class <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> translation_apply
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_equality Left_Coset_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> imageI sub<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* subgroup_of_group *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Congruences.  Quotient Monoids and Groups›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Def 1.4›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 54, ll 19--22›</span></span>
<span class="keyword1"><span class="command">locale</span></span> monoid_congruence <span class="main">=</span> monoid <span class="main">+</span> equivalence <span class="keyword2"><span class="keyword">where</span></span> S <span class="main">=</span> <span class="quoted"><span class="free">M</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">a'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span><span class="main">;</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">b'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">,</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 54, ll 26--28›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Class <span class="free">a</span> <span class="main">=</span> Class <span class="free">a'</span><span class="main">;</span> Class <span class="free">b</span> <span class="main">=</span> Class <span class="free">b'</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">a'</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">b'</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> Class <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Class <span class="main">(</span><span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Class_equivalence cong<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 54, ll 28--30›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quotient_composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[⋅]</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quotient_composition</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">/</span> <span class="free">E</span><span class="main">.</span> <span class="main">λ</span><span class="bound">B</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">/</span> <span class="free">E</span><span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">C</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">b</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">C</span> <span class="main">=</span> Class <span class="main">(</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 54, ll 28--30›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_commutes_with_composition<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> Class <span class="free">a</span> <span class="main">[⋅]</span> Class <span class="free">b</span> <span class="main">=</span> Class <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quotient_composition_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Class_cong <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Class_eq Class_eq<span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> equalityI<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 54, ll 30--31›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> quotient_composition_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">/</span> <span class="free">E</span><span class="main">;</span> <span class="free">B</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">/</span> <span class="free">E</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">[⋅]</span> <span class="free">B</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">/</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> quotient_ClassE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Class_commutes_with_composition<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 54, l 32; p 55, ll 1--3›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> quotient<span class="main">:</span> monoid <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">/</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Class_commutes_with_composition associative <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> quotient_ClassE<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid_congruence *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, ll 16--17›</span></span>
<span class="keyword1"><span class="command">locale</span></span> group_congruence <span class="main">=</span> group <span class="main">+</span> monoid_congruence <span class="keyword2"><span class="keyword">where</span></span> M <span class="main">=</span> <span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, ll 16--17›</span></span>
<span class="keyword1"><span class="command">notation</span></span> quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[⋅]</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, l 18›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_right_inverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> Class <span class="free">a</span> <span class="main">[⋅]</span> Class <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="main">=</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Class_commutes_with_composition<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, l 18›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_left_inverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> Class <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="main">[⋅]</span> Class <span class="free">a</span> <span class="main">=</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Class_commutes_with_composition<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, l 18›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> quotient.invertible <span class="main">(</span>Class <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Class_right_inverse Class_left_inverse<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, l 18›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_commutes_with_inverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> quotient.inverse <span class="main">(</span>Class <span class="free">a</span><span class="main">)</span> <span class="main">=</span> Class <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quotient.inverse_equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Class_right_inverse Class_left_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, l 17›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> quotient<span class="main">:</span> group <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">/</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">metis</span> Block_self Class_invertible element_exists<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group_congruence *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Def 1.5›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, ll 22--25›</span></span>
<span class="keyword1"><span class="command">locale</span></span> normal_subgroup <span class="main">=</span>
  subgroup_of_group <span class="quoted"><span class="free">K</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">K</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> normal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">k</span> <span class="main">∈</span> <span class="free">K</span> <span class="main">⟧</span> <span class="main">⟹</span> inverse <span class="free">g</span> <span class="main"><span class="free">⋅</span></span> <span class="free">k</span> <span class="main"><span class="free">⋅</span></span> <span class="free">g</span> <span class="main">∈</span> <span class="free">K</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lemmas from the proof of Thm 1.6›</span></span>

<span class="keyword1"><span class="command">context</span></span> subgroup_of_group <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We use <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">K</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 14--16›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Left_equals_Right_coset_implies_normality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">g</span> <span class="main">⋅|</span> <span class="free">H</span> <span class="main">=</span> <span class="free">H</span> <span class="main">|⋅</span> <span class="bound">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"normal_subgroup <span class="free">H</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="main">⋅|</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">g</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative invertible_left_inverse2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* subgroup_of_group *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Thm 1.6, first part›</span></span>

<span class="keyword1"><span class="command">context</span></span> group_congruence <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Jacobson's $K$›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, l 29›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Normal</span> <span class="main">=</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 3--6›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> subgroup <span class="quoted"><span class="quoted">"Normal"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Normal_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subgroupI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k1</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">k2</span>
  <span class="keyword3"><span class="command">assume</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">∈</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">∈</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k2</span> <span class="main">∈</span> Class <span class="main">(</span><span class="skolem">k1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="skolem">k1</span> <span class="main">[⋅]</span> Class <span class="skolem">k2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Class_commutes_with_composition Class_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="main"><span class="free">𝟭</span></span> <span class="main">[⋅]</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ClassD Class_eq unit_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k2</span> <span class="main">∈</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">k</span> <span class="main">∈</span> Class <span class="main">(</span>inverse <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> quotient.inverse <span class="main">(</span>Class <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Class_commutes_with_inverse K <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> quotient.inverse <span class="main">(</span>Class <span class="main"><span class="free">𝟭</span></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Block_self K <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quotient.inverse_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">k</span> <span class="main">∈</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Coset notation›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 5--6›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> subgroup_of_group <span class="quoted"><span class="quoted">"Normal"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equation 25 for right cosets›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, ll 29--30; p 56, ll 6--11›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Right_Coset_Class_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Normal <span class="main">|⋅</span> <span class="free">g</span> <span class="main">=</span> Class <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Normal_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>  <span class="comment1">― ‹ll 6--8›</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Class <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="free">g</span> <span class="main">∈</span> Class <span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="skolem">a</span> <span class="main">[⋅]</span> Class <span class="main">(</span>inverse <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Class_commutes_with_composition block_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="free">g</span> <span class="main">[⋅]</span> quotient.inverse <span class="main">(</span>Class <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Block_self Class_commutes_with_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Class <span class="main"><span class="free">𝟭</span></span> <span class="main">|⋅</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Right_Coset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Class_closed a associative g inverse_equality invertible invertible_def right_unit<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>  <span class="comment1">― ‹ll 8--9›</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Class <span class="main"><span class="free">𝟭</span></span> <span class="main">|⋅</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main"><span class="free">⋅</span></span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Class <span class="skolem">a</span> <span class="main">=</span> Class <span class="skolem">k</span> <span class="main">[⋅]</span> Class <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Class_commutes_with_composition <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="main"><span class="free">𝟭</span></span> <span class="main">[⋅]</span> Class <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Block_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Class <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g eq k composition_closed quotient.unit_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equation 25 for left cosets›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, ll 29--30; p 56, ll 6--11›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Left_Coset_Class_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⋅|</span> Normal <span class="main">=</span> Class <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Normal_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>  <span class="comment1">― ‹ll 6--8›</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Class <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> a g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">∈</span> Class <span class="main">(</span>inverse <span class="free">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="main">(</span>inverse <span class="free">g</span><span class="main">)</span> <span class="main">[⋅]</span> Class <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Class_commutes_with_composition block_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> quotient.inverse <span class="main">(</span>Class <span class="free">g</span><span class="main">)</span> <span class="main">[⋅]</span> Class <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Block_self Class_commutes_with_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">⋅|</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Left_Coset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Class_closed a associative g inverse_equality invertible invertible_def right_unit<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>  <span class="comment1">― ‹ll 8--9, ``the same thing holds''›</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">⋅|</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Class <span class="skolem">a</span> <span class="main">=</span> Class <span class="free">g</span> <span class="main">[⋅]</span> Class <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Class_commutes_with_composition <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="free">g</span> <span class="main">[⋅]</span> Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Block_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Class <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> Class <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g eq k composition_closed quotient.unit_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Thm 1.6, statement of first part›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, ll 28--29; p 56, ll 12--16›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_unit_is_normal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"normal_subgroup Normal <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⋅|</span> Normal <span class="main">=</span> Normal <span class="main">|⋅</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Right_Coset_Class_unit Left_Coset_Class_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Left_equals_Right_coset_implies_normality<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> normal<span class="main">:</span> normal_subgroup <span class="quoted">Normal</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Class_unit_is_normal<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group_congruence *)</span>

<span class="keyword1"><span class="command">context</span></span> normal_subgroup <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 16--19›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Left_equals_Right_coset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span> <span class="main">=</span> <span class="free">K</span> <span class="main">|⋅</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="main">|⋅</span> <span class="free">g</span> <span class="main">⊆</span> <span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">K</span> <span class="main">|⋅</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main"><span class="free">⋅</span></span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Right_Coset_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>inverse <span class="free">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k</span> <span class="main"><span class="free">⋅</span></span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative invertible_right_inverse2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> normal <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Left_Coset_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span> <span class="main">⊆</span> <span class="free">K</span> <span class="main">|⋅</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Left_Coset_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>inverse <span class="main">(</span>inverse <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> invertible_right_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> normal <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">g</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">K</span> <span class="main">|⋅</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Right_Coset_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">K</span> <span class="main">|⋅</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Thm 1.6, second part›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, ll 31--32; p 56, ll 20--21›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Congruence</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> inverse <span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">K</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 21--22›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> right_translations_of_group <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 21--22›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> transformation_group <span class="quoted"><span class="quoted">"translation <span class="main">`</span> <span class="free">K</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"Orbit_Relation <span class="main">=</span> Congruence"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> transformation_group <span class="quoted"><span class="quoted">"translation <span class="main">`</span> <span class="free">K</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Orbit_Relation <span class="main">=</span> Congruence"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Orbit_Relation_def Congruence_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> invertible_left_inverse2 invertible_right_inverse2 translation_apply <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> restrict_apply<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">rule</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 20--21›</span></span>
<span class="keyword1" id="Group_Theory-CongruenceI"><span class="command">lemma</span></span> CongruenceI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="free">k</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">k</span> <span class="main">∈</span> <span class="free">K</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> Congruence"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Congruence_def associative inverse_composition_commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 20--21›</span></span>
<span class="keyword1" id="Group_Theory-CongruenceD"><span class="command">lemma</span></span> CongruenceD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> Congruence <span class="main">⟹</span> <span class="main">∃</span><span class="bound">k</span><span class="main">∈</span><span class="free">K</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> orbit.symmetric<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Congruence_def invertible_right_inverse2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  ``We showed in the last section that the relation we are considering is an equivalence relation in
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for any subgroup <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">K</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.  We now proceed to show that normality of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">K</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  ensures that [...] $a \equiv b \pmod{K}$ is a congruence.''
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 55, ll 30--32; p 56, ll 1, 22--28›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> group_congruence <span class="keyword2"><span class="keyword">where</span></span> E <span class="main">=</span> <span class="quoted">Congruence</span> <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"Normal <span class="main">=</span> <span class="free">K</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"group_congruence <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> Congruence"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command">note</span></span> CongruenceI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span> CongruenceD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">g</span> <span class="skolem">b</span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> Congruence"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">∈</span> Congruence"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Congruence_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">∈</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">∈</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> G Left_equals_Right_coset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="main">|⋅</span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">⋅|</span> <span class="free">K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> k1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k3</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">h</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k3</span> <span class="main">∈</span> <span class="free">K</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Left_Coset_def Right_Coset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> G k1 k2 a b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">h</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> G k1 k3 c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">h</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k3</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">h</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">k3</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">k2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> G k2 k3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> associative<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">h</span><span class="main">)</span> <span class="main">∈</span> Congruence"</span></span> <span class="keyword1"><span class="command">using</span></span> G k2 k3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> group_congruence <span class="keyword2"><span class="keyword">where</span></span> E <span class="main">=</span> <span class="quoted">Congruence</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Normal <span class="main">=</span> <span class="free">K</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Normal_def orbit.Class_def <span class="keyword1"><span class="command">unfolding</span></span> Congruence_def
    <span class="keyword1"><span class="command">using</span></span> invertible_inverse_inverse submonoid_inverse_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* normal_subgroup *)</span>  <span class="comment1">(* deletes translations and orbits, recovers Class for congruence class *)</span>

<span class="keyword1"><span class="command">context</span></span> group <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Pulled out of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> normal_subgroup<span class="antiquote"><span class="antiquote">}</span></span></span></span> to achieve standard notation.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 31--32›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Factor_Group</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/'/</span>"</span> 75<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main"><span class="free">//</span></span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">/</span> <span class="main">(</span>normal_subgroup.Congruence <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group *)</span>

<span class="keyword1"><span class="command">context</span></span> normal_subgroup <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 28--29›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_unit_normal_subgroup<span class="main">:</span> <span class="quoted"><span class="quoted">"Class <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="free">K</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Class_def <span class="keyword1"><span class="command">unfolding</span></span> Congruence_def
  <span class="keyword1"><span class="command">using</span></span> invertible_inverse_inverse submonoid_inverse_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 1--2; p 56, l 29›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> Class_is_Left_Coset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> Class <span class="free">g</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Left_Coset_Class_unit Class_unit_normal_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, l 29›</span></span>
<span class="keyword1" id="Group_Theory-Left_CosetE"><span class="command">lemma</span></span> Left_CosetE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">//</span> <span class="free">K</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⋅|</span> <span class="free">K</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Class_is_Left_Coset quotient_ClassE<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equation 26›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, ll 32--34›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> factor_composition <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">h</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span><span class="main">)</span> <span class="main">[⋅]</span> <span class="main">(</span><span class="free">h</span> <span class="main">⋅|</span> <span class="free">K</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main"><span class="free">⋅</span></span> <span class="free">h</span> <span class="main">⋅|</span> <span class="free">K</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Class_commutes_with_composition Class_is_Left_Coset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, l 35›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> factor_unit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">⋅|</span> <span class="free">K</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Class_is_Left_Coset Class_unit_normal_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 56, l 35›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> factor_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> quotient.inverse <span class="main">(</span><span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>inverse <span class="free">g</span> <span class="main">⋅|</span> <span class="free">K</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Class_commutes_with_inverse Class_is_Left_Coset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* normal_subgroup *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 57, ll 4--5›</span></span>
<span class="keyword1"><span class="command">locale</span></span> subgroup_of_abelian_group <span class="main">=</span> subgroup_of_group <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="main">+</span> abelian_group <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">H</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 57, ll 4--5›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> subgroup_of_abelian_group <span class="main">⊆</span> normal_subgroup <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> commutative invertible_right_inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Homomorphims›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Def 1.6›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 58, l 33; p 59, ll 1--2›</span></span>
<span class="keyword1"><span class="command">locale</span></span> monoid_homomorphism <span class="main">=</span>
  map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">M'</span></span><span class="main">+</span>  source<span class="main">:</span> monoid <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="main">+</span> target<span class="main">:</span> monoid <span class="quoted"><span class="free">M'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">η</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition'</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅''</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭''</span>"</span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> commutes_with_composition<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">M</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">η</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">η</span> <span class="free">x</span> <span class="main"><span class="free">⋅'</span></span> <span class="free">η</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> commutes_with_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Jacobson notes that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] commutes_with_unit<span class="antiquote"><span class="antiquote">}</span></span></span></span> is not necessary for groups, but doesn't make use of that later.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 58, l 33; p 59, ll 1--2›</span></span>
<span class="keyword1"><span class="command">notation</span></span> source.invertible <span class="main">(</span><span class="quoted">"<span class="keyword1">invertible</span> _"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> source.inverse <span class="main">(</span><span class="quoted">"<span class="keyword1">inverse</span> _"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> target.invertible <span class="main">(</span><span class="quoted">"<span class="keyword1">invertible''</span> _"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> target.inverse <span class="main">(</span><span class="quoted">"<span class="keyword1">inverse''</span> _"</span> <span class="main">[</span>100<span class="main">]</span> 100<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid_homomorphism *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 59, ll 29--30›</span></span>
<span class="keyword1"><span class="command">locale</span></span> monoid_epimorphism <span class="main">=</span> monoid_homomorphism <span class="main">+</span> surjective_map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">M'</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 59, l 30›</span></span>
<span class="keyword1"><span class="command">locale</span></span> monoid_monomorphism <span class="main">=</span> monoid_homomorphism <span class="main">+</span> injective_map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">M'</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 59, ll 30--31›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_isomorphism <span class="main">⊆</span> monoid_epimorphism
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_composition commutes_with_unit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 59, ll 30--31›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_isomorphism <span class="main">⊆</span> monoid_monomorphism
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_composition commutes_with_unit<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> monoid_homomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 59, ll 33--34›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> invertible_image_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">invertible</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="free">a</span> <span class="main"><span class="free">⋅'</span></span> <span class="free">η</span> <span class="main">(</span><span class="keyword1">inverse</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟭'</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">(</span><span class="keyword1">inverse</span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅'</span></span> <span class="free">η</span> <span class="free">a</span> <span class="main">=</span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms commutes_with_composition commutes_with_unit source.inverse_equality
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> source.invertible_inverse_closed source.invertible_left_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 59, l 34; p 60, l 1›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> invertible_target_invertible <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">invertible</span> <span class="free">a</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1">invertible'</span> <span class="main">(</span><span class="free">η</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_image_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 60, l 1›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> invertible_commutes_with_inverse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">invertible</span> <span class="free">a</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">M</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">η</span> <span class="main">(</span><span class="keyword1">inverse</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">inverse'</span> <span class="main">(</span><span class="free">η</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_image_lemma target.inverse_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid_homomorphism *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 60, ll 32--34; p 61, l 1›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_congruence <span class="main">⊆</span> natural<span class="main">:</span> monoid_homomorphism <span class="quoted">Class</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">/</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> PiE_I Class_commutes_with_composition<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Fundamental Theorem of Homomorphisms of Monoids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 61, ll 5, 14--16›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_homomorphism <span class="main">⊆</span> image<span class="main">:</span> submonoid <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">`</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">M'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_composition <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> commutes_with_unit <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 61, l 4›</span></span>
<span class="keyword1"><span class="command">locale</span></span> monoid_homomorphism_fundamental <span class="main">=</span> monoid_homomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 61, ll 17--18›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> fiber_relation <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">M'</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">notation</span></span> Fiber_Relation <span class="main">(</span><span class="quoted">"<span class="keyword1">E'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 61, ll 6--7, 18--20›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_congruence <span class="keyword2"><span class="keyword">where</span></span> E <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">E(</span><span class="free">η</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Class_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">rule</span> Class_equivalence <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> left_closed right_closed commutes_with_composition Fiber_equality<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 61, ll 7--9›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">induced</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes Jacobson's $\bar{\eta}$.  We have the commutativity of the diagram, where
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">induced</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is unique: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] factorization<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] uniqueness<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 61, l 20›</span></span>
<span class="keyword1"><span class="command">notation</span></span> quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[⋅]</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 61, ll 7--8, 22--25›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> induced<span class="main">:</span> monoid_homomorphism <span class="quoted">induced</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">/</span> <span class="keyword1">E(</span><span class="free">η</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_unit<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_composition commutes_with_unit Class_commutes_with_composition<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 61, ll 9, 26›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> natural<span class="main">:</span> monoid_epimorphism <span class="quoted">Class</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">/</span> <span class="keyword1">E(</span><span class="free">η</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 61, ll 9, 26--27›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> induced<span class="main">:</span> monoid_monomorphism <span class="quoted">induced</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">/</span> <span class="keyword1">E(</span><span class="free">η</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">M'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid_homomorphism_fundamental *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 12--13›</span></span>
<span class="keyword1"><span class="command">locale</span></span> group_homomorphism <span class="main">=</span>
  monoid_homomorphism <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="free">G'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span> <span class="main">+</span>
  source<span class="main">:</span> group <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="main">+</span> target<span class="main">:</span> group <span class="quoted"><span class="free">G'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">η</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">G'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">composition'</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅''</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭''</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, l 13›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> image<span class="main">:</span> subgroup <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">`</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="free">G'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_image_lemma <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 13--14›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ker</span> <span class="main">=</span> <span class="free">η</span> <span class="main">-`</span> <span class="main">{</span><span class="main"><span class="free">𝟭'</span></span><span class="main">}</span> <span class="main">∩</span> <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 13--14›</span></span>
<span class="keyword1" id="Group_Theory-Ker_equality"><span class="command">lemma</span></span> Ker_equality<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ker <span class="main">=</span> <span class="main">{</span><span class="bound">a</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="free">η</span> <span class="bound">a</span> <span class="main">=</span> <span class="main"><span class="free">𝟭'</span></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ker_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 13--14›</span></span>
<span class="keyword1" id="Group_Theory-Ker_closed"><span class="command">lemma</span></span> Ker_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> Ker <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ker_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 13--14›</span></span>
<span class="keyword1" id="Group_Theory-Ker_image"><span class="command">lemma</span></span> Ker_image <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="comment1">(* loops as a simprule *)</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> Ker <span class="main">⟹</span> <span class="free">η</span> <span class="free">a</span> <span class="main">=</span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ker_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 13--14›</span></span>
<span class="keyword1" id="Group_Theory-Ker_memI"><span class="command">lemma</span></span> Ker_memI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="comment1">(* loops as a simprule *)</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">η</span> <span class="free">a</span> <span class="main">=</span> <span class="main"><span class="free">𝟭'</span></span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> Ker"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Ker_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 15--16›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> kernel<span class="main">:</span> normal_subgroup <span class="quoted">Ker</span> <span class="quoted"><span class="free">G</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> kernel<span class="main">:</span> submonoid <span class="quoted">Ker</span> <span class="quoted"><span class="free">G</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Ker_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_composition commutes_with_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> kernel<span class="main">:</span> subgroup <span class="quoted">Ker</span> <span class="quoted"><span class="free">G</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> source.invertible_right_inverse <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ker_image invertible_commutes_with_inverse<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"normal_subgroup Ker <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Ker_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_composition invertible_image_lemma<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 17--20›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> injective_iff_kernel_unit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on <span class="free">η</span> <span class="free">G</span> <span class="main">⟷</span> Ker <span class="main">=</span> <span class="main">{</span><span class="main"><span class="free">𝟭</span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Not_eq_iff <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> iffI<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Ker <span class="main">≠</span> <span class="main">{</span><span class="main"><span class="free">𝟭</span></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> Ker"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">η</span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ker_image<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inj_on <span class="free">η</span> <span class="free">G</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inj_onD kernel.sub source.unit_closed<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inj_on <span class="free">η</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="skolem">a</span> <span class="main">=</span> <span class="free">η</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inverse</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">(</span><span class="keyword1">inverse</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ab source.invertible_right_inverse2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> <span class="main">(</span><span class="operator">metis</span> ab commutes_with_composition invertible_image_lemma<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> source.invertible source.invertible_inverse_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">inverse</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> Ker"</span></span> <span class="keyword1"><span class="command">using</span></span> Ker_memI ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ker <span class="main">≠</span> <span class="main">{</span><span class="main"><span class="free">𝟭</span></span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">inverse</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main"><span class="free">𝟭</span></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group_homomorphism *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, l 24›</span></span>
<span class="keyword1"><span class="command">locale</span></span> group_epimorphism <span class="main">=</span> group_homomorphism <span class="main">+</span> monoid_epimorphism <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="free">G'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, l 21›</span></span>
<span class="keyword1"><span class="command">locale</span></span> normal_subgroup_in_kernel <span class="main">=</span>
  group_homomorphism <span class="main">+</span> contained<span class="main">:</span> normal_subgroup <span class="quoted"><span class="free">L</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">L</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">⊆</span> Ker"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, l 21›</span></span>
<span class="keyword1"><span class="command">notation</span></span> contained.quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[⋅]</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹"homomorphism onto <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">G</span></span> <span class="main"><span class="main">//</span></span> <span class="free"><span class="free">L</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 23--24›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> natural<span class="main">:</span> group_epimorphism <span class="quoted">contained.Class</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">//</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"contained.Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 25--26›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> left_coset_equality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⋅|</span> <span class="free">L</span> <span class="main">=</span> <span class="free">b</span> <span class="main">⋅|</span> <span class="free">L</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="free">a</span> <span class="main">=</span> <span class="free">η</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∈</span> <span class="free">L</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b contained.Class_is_Left_Coset contained.Class_self eq kernel.Left_Coset_memE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="free">a</span> <span class="main">=</span> <span class="free">η</span> <span class="free">a</span> <span class="main"><span class="free">⋅'</span></span> <span class="free">η</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ker_image monoid_homomorphism.commutes_with_composition subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">η</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> commutes_with_composition l<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹$\bar{\eta}$›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 26--27›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">induced</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">A</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">//</span> <span class="free">L</span><span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="bound">a</span> <span class="main">⋅|</span> <span class="free">L</span> <span class="main">=</span> <span class="bound">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">η</span> <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 26--27›</span></span>
<span class="keyword1" id="Group_Theory-induced_closed"><span class="command">lemma</span></span> induced_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">//</span> <span class="free">L</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"induced <span class="free">A</span> <span class="main">∈</span> <span class="free">G'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⋅|</span> <span class="free">L</span> <span class="main">=</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> contained.Class_is_Left_Coset contained.Partition_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="bound">a</span> <span class="main">⋅|</span> <span class="free">L</span> <span class="main">=</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">η</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> left_coset_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> induced_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 26--27›</span></span>
<span class="keyword1" id="Group_Theory-induced_undefined"><span class="command">lemma</span></span> induced_undefined <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∉</span> <span class="free">G</span> <span class="main">//</span> <span class="free">L</span> <span class="main">⟹</span> induced <span class="free">A</span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> induced_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 26--27›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> induced_left_coset_closed <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> induced <span class="main">(</span><span class="free">a</span> <span class="main">⋅|</span> <span class="free">L</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> contained.Class_is_Left_Coset contained.Class_in_Partition <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 26--27›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> induced_left_coset_equality <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"induced <span class="main">(</span><span class="free">a</span> <span class="main">⋅|</span> <span class="free">L</span><span class="main">)</span> <span class="main">=</span> <span class="free">η</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a'</span> <span class="main">∈</span> <span class="free">G</span><span class="main">.</span> <span class="bound">a'</span> <span class="main">⋅|</span> <span class="free">L</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⋅|</span> <span class="free">L</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="free">η</span> <span class="bound">a'</span><span class="main">)</span> <span class="main">=</span> <span class="free">η</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> left_coset_equality<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> induced_def
    <span class="keyword1"><span class="command">using</span></span> contained.Class_is_Left_Coset contained.Class_in_Partition <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, l 27›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> induced_Left_Coset_commutes_with_composition <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> induced <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">⋅|</span> <span class="free">L</span><span class="main">)</span> <span class="main">[⋅]</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅|</span> <span class="free">L</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> induced <span class="main">(</span><span class="free">a</span> <span class="main">⋅|</span> <span class="free">L</span><span class="main">)</span> <span class="main"><span class="free">⋅'</span></span> induced <span class="main">(</span><span class="free">b</span> <span class="main">⋅|</span> <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> commutes_with_composition<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 27--28›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> induced_group_homomorphism<span class="main">:</span>
  <span class="quoted"><span class="quoted">"group_homomorphism induced <span class="main">(</span><span class="free">G</span> <span class="main">//</span> <span class="free">L</span><span class="main">)</span> <span class="main">([⋅])</span> <span class="main">(</span>contained.Class <span class="main"><span class="free">𝟭</span></span><span class="main">)</span> <span class="free">G'</span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> contained.Left_CosetE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_composition commutes_with_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> contained.factor_unit induced_left_coset_equality <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> contained.Class_unit_normal_subgroup<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, l 28›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> induced<span class="main">:</span> group_homomorphism <span class="quoted">induced</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">//</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"contained.Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="free">G'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> induced_group_homomorphism<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 28--29›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> factorization_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> compose <span class="free">G</span> induced contained.Class <span class="free">a</span> <span class="main">=</span> <span class="free">η</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> compose_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contained.Class_is_Left_Coset<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 29--30›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> factorization <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> induced contained.Class <span class="main">=</span> <span class="free">η</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compose_def contained.Class_is_Left_Coset map_undefined<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Jacobson does not state the uniqueness of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">induced</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> explicitly but he uses it later,
  for rings, on p 107.
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, l 30›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> uniqueness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">//</span> <span class="free">L</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">G'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> factorization<span class="main">:</span> <span class="quoted"><span class="quoted">"compose <span class="free">G</span> <span class="free">β</span> contained.Class <span class="main">=</span> <span class="free">η</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">=</span> induced"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="skolem">A</span> <span class="main">=</span> induced <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">//</span> <span class="free">L</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> contained.Class <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">(</span>contained.Class <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">η</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_eq factorization<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> induced <span class="main">(</span>contained.Class <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contained.Class_is_Left_Coset<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> induced_def PiE_arb <span class="main"><span class="main">[</span></span><span class="operator">OF</span> map<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, l 31›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> induced_image<span class="main">:</span>
  <span class="quoted"><span class="quoted">"induced <span class="main">`</span> <span class="main">(</span><span class="free">G</span> <span class="main">//</span> <span class="free">L</span><span class="main">)</span> <span class="main">=</span> <span class="free">η</span> <span class="main">`</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> factorization contained.natural.surjective surj_compose<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, l 33›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> L<span class="main">:</span> normal_subgroup <span class="quoted"><span class="free">L</span></span> <span class="quoted">Ker</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> kernel.sub kernel.subgroup_inverse_equality contained.normal<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 31--33›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> induced_kernel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"induced.Ker <span class="main">=</span> Ker <span class="main">/</span> L.Congruence"</span></span> <span class="comment1">(* Ker // L is apparently not the right thing *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced.Ker <span class="main">=</span> <span class="main">{</span> <span class="bound">a</span> <span class="main">⋅|</span> <span class="free">L</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> Ker <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> induced.Ker_equality
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">)</span></span> contained.Class_is_Left_Coset Ker_image Ker_memI
        induced_left_coset_equality contained.Class_in_Partition contained.representant_exists<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Ker <span class="main">/</span> L.Congruence"</span></span>
    <span class="keyword1"><span class="command">using</span></span> L.Class_is_Left_Coset L.Class_in_Partition
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> L.Class_is_Left_Coset L.representant_exists kernel.sub<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 34--35›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> induced_inj_on<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on induced <span class="main">(</span><span class="free">G</span> <span class="main">//</span> <span class="free">L</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">L</span> <span class="main">=</span> Ker"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> induced.injective_iff_kernel_unit induced_kernel contained.Class_unit_normal_subgroup<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">using</span></span> L.block_exists <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> L.Block_self L.Class_unit_normal_subgroup L.quotient.unit_closed L.representant_exists
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* normal_subgroup_in_kernel *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Fundamental Theorem of Homomorphisms of Groups›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 1›</span></span>
<span class="keyword1"><span class="command">locale</span></span> group_homomorphism_fundamental <span class="main">=</span> group_homomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 1›</span></span>
<span class="keyword1"><span class="command">notation</span></span> kernel.quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[⋅]</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 1›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> normal_subgroup_in_kernel <span class="keyword2"><span class="keyword">where</span></span> L <span class="main">=</span> <span class="quoted">Ker</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">rule</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 62, ll 36--37; p 63, l 1›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">induced</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes Jacobson's $\bar{\eta}$.  We have the commutativity of the diagram, where
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">induced</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is unique: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] factorization<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] uniqueness<span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group_homomorphism_fundamental *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 5›</span></span>
<span class="keyword1"><span class="command">locale</span></span> group_isomorphism <span class="main">=</span> group_homomorphism <span class="main">+</span> bijective_map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">G'</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 5›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> monoid_isomorphism <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="free">G'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_composition<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 6›</span></span>
<span class="keyword1" id="Group_Theory-inverse_group_isomorphism"><span class="command">lemma</span></span> inverse_group_isomorphism<span class="main">:</span>
  <span class="quoted"><span class="quoted">"group_isomorphism <span class="main">(</span>restrict <span class="main">(</span>inv_into <span class="free">G</span> <span class="free">η</span><span class="main">)</span> <span class="free">G'</span><span class="main">)</span> <span class="free">G'</span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> commutes_with_composition commutes_with_unit surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group_isomorphism *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 6›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">isomorphic_as_groups</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≅<span class="hidden">⇩</span><sub>G</sub></span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">𝒢</span></span></span> <span class="keyword1"><span class="free">≅<span class="hidden">⇩</span><sub>G</sub></span></span> <span class="free"><span class="bound"><span class="entity">𝒢'</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">G</span><span class="main">,</span> <span class="bound">composition</span><span class="main">,</span> <span class="bound">unit</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">𝒢</span></span></span><span class="main">;</span> <span class="main">(</span><span class="bound">G'</span><span class="main">,</span> <span class="bound">composition'</span><span class="main">,</span> <span class="bound">unit'</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">𝒢'</span></span></span> <span class="keyword1">in</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">η</span><span class="main">.</span> group_isomorphism <span class="bound">η</span> <span class="bound">G</span> <span class="bound">composition</span> <span class="bound">unit</span> <span class="bound">G'</span> <span class="bound">composition'</span> <span class="bound">unit'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 6›</span></span>
<span class="keyword1" id="Group_Theory-isomorphic_as_groups_symmetric"><span class="command">lemma</span></span> isomorphic_as_groups_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">composition</span><span class="main">,</span> <span class="free">unit</span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>G</sub></span> <span class="main">(</span><span class="free">G'</span><span class="main">,</span> <span class="free">composition'</span><span class="main">,</span> <span class="free">unit'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">G'</span><span class="main">,</span> <span class="free">composition'</span><span class="main">,</span> <span class="free">unit'</span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>G</sub></span> <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">composition</span><span class="main">,</span> <span class="free">unit</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_as_groups_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> group_isomorphism.inverse_group_isomorphism<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 1›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> group_isomorphism <span class="main">⊆</span> group_epimorphism <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, l 1›</span></span>
<span class="keyword1"><span class="command">locale</span></span> group_epimorphism_fundamental <span class="main">=</span> group_homomorphism_fundamental <span class="main">+</span> group_epimorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, ll 1--2›</span></span>
<span class="keyword1"><span class="command">interpretation</span></span> image<span class="main">:</span> group_homomorphism <span class="quoted">induced</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">//</span> Ker"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"kernel.Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> surjective group_homomorphism_fundamental.intro induced_group_homomorphism<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, ll 1--2›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> image<span class="main">:</span> group_isomorphism <span class="quoted">induced</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">//</span> Ker"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"kernel.Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> induced_group_homomorphism
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def induced_image induced_inj_on induced.commutes_with_composition<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group_epimorphism_fundamental *)</span>

<span class="keyword1"><span class="command">context</span></span> group_homomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 63, ll 5--7›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> image_isomorphic_to_factor_group<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">K</span> <span class="bound">composition</span> <span class="bound">unit</span><span class="main">.</span> normal_subgroup <span class="bound">K</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">G</span><span class="main">,</span> <span class="main"><span class="free">(⋅')</span></span><span class="main">,</span> <span class="main"><span class="free">𝟭'</span></span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>G</sub></span> <span class="main">(</span><span class="free">G</span> <span class="main">//</span> <span class="bound">K</span><span class="main">,</span> <span class="bound">composition</span><span class="main">,</span> <span class="bound">unit</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> image<span class="main">:</span> group_epimorphism_fundamental <span class="keyword2"><span class="keyword">where</span></span> G' <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">`</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> commutes_with_composition<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group_isomorphism image.induced <span class="main">(</span><span class="free">G</span> <span class="main">//</span> Ker<span class="main">)</span> <span class="main">([⋅])</span> <span class="main">(</span>kernel.Class <span class="main"><span class="free">𝟭</span></span><span class="main">)</span> <span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">G</span><span class="main">,</span> <span class="main"><span class="free">(⋅')</span></span><span class="main">,</span> <span class="main"><span class="free">𝟭'</span></span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>G</sub></span> <span class="main">(</span><span class="free">G</span> <span class="main">//</span> Ker<span class="main">,</span> <span class="main">([⋅])</span><span class="main">,</span> kernel.Class <span class="main"><span class="free">𝟭</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_as_groups_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> group_isomorphism.inverse_group_isomorphism<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_subgroup Ker <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group_homomorphism *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Ring_Theory">
<div class="head">
<h1>Theory Ring_Theory</h1>
</div>
<pre class="source"><span class="comment1">(*
  Copyright (c) 2015--2019 by Clemens Ballarin
  This file is licensed under the 3-clause BSD license.
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Ring_Theory <span class="keyword2"><span class="keyword">imports</span></span> <a href="Group_Theory.html">Group_Theory</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> plus <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> minus <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">-</span>"</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> uminus <span class="main">(</span><span class="quoted">"<span class="keyword1">-</span> _"</span> <span class="main">[</span>81<span class="main">]</span> 80<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> quotient <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/'/</span>"</span> 90<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Rings›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and Elementary Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Def 2.1›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 86, ll 20--28›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ring <span class="main">=</span> additive<span class="main">:</span> abelian_group <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="main">+</span> multiplicative<span class="main">:</span> monoid <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distributive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">c</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="free">c</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main"><span class="free">+</span></span> <span class="free">c</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 86, ll 20--28›</span></span>
<span class="keyword1"><span class="command">notation</span></span> additive.inverse <span class="main">(</span><span class="quoted">"<span class="keyword1">-</span> _"</span> <span class="main">[</span>66<span class="main">]</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">subtraction</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">-</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">-</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>  <span class="comment1">(* or, alternatively, a definition *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ring *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 87, ll 10--12›</span></span>
<span class="keyword1"><span class="command">locale</span></span> subring <span class="main">=</span>
  additive<span class="main">:</span> subgroup <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="main">+</span> multiplicative<span class="main">:</span> submonoid <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> ring <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 88, ll 26--28›</span></span>
<span class="keyword1" id="Ring_Theory-right_zero"><span class="command">lemma</span></span> right_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">+</span></span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distributive <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> additive.left_unit additive.right_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">-</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">+</span></span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">-</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.associative <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> additive.invertible_left_cancel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 88, l 29›</span></span>
<span class="keyword1" id="Ring_Theory-left_zero"><span class="command">lemma</span></span> left_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distributive <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> additive.left_unit additive.right_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">-</span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">-</span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.associative <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> additive.invertible_left_cancel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 88, ll 29--30; p 89, ll 1--2›</span></span>
<span class="keyword1" id="Ring_Theory-left_minus"><span class="command">lemma</span></span> left_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">=</span> <span class="main">-</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distributive <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> additive.invertible_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="main">-</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.associative <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> additive.invertible_left_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 89, l 3›</span></span>
<span class="keyword1" id="Ring_Theory-right_minus"><span class="command">lemma</span></span> right_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distributive <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> additive.invertible_right_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="main">-</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main"><span class="free">+</span></span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.associative <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> additive.invertible_left_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ring *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ideals, Quotient Rings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 2--5›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ring_congruence <span class="main">=</span> ring <span class="main">+</span>
  additive<span class="main">:</span> group_congruence <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="free">E</span></span> <span class="main">+</span>
  multiplicative<span class="main">:</span> monoid_congruence <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="free">E</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">E</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 2--5›</span></span>
<span class="keyword1"><span class="command">notation</span></span> additive.quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[+]</span>"</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> additive.quotient.inverse <span class="main">(</span><span class="quoted">"<span class="keyword1">[-]</span> _"</span> <span class="main">[</span>66<span class="main">]</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> multiplicative.quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[⋅]</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 5--11›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> quotient<span class="main">:</span> ring <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">/</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([+])</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"additive.Class <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"additive.Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> additive.Class_commutes_with_composition additive.associative additive.commutative
     multiplicative.Class_commutes_with_composition distributive <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> additive.quotient_ClassE<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ring_congruence *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 12--13›</span></span>
<span class="keyword1"><span class="command">locale</span></span> subgroup_of_additive_group_of_ring <span class="main">=</span>
  additive<span class="main">:</span> subgroup <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="main">+</span> ring <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">I</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 13--14›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Ring_Congruence</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">-</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">I</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 13--14›</span></span>
<span class="keyword1" id="Ring_Theory-Ring_CongruenceI"><span class="command">lemma</span></span> Ring_CongruenceI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ring_Congruence_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 13--14›</span></span>
<span class="keyword1" id="Ring_Theory-Ring_CongruenceD"><span class="command">lemma</span></span> Ring_CongruenceD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence <span class="main">⟹</span> <span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Ring_Congruence_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Jacobson's definition of ring congruence deviates from that of group congruence; this complicates
  the proof.
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 12--14›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> additive<span class="main">:</span> subgroup_of_abelian_group <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span>  <span class="comment1">(* implies normal_subgroup *)</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> additive_congruence<span class="main">:</span> <span class="quoted"><span class="quoted">"additive.Congruence <span class="main">=</span> Ring_Congruence"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subgroup_of_abelian_group <span class="free">I</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> additive.commutative additive.invertible_right_inverse2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> additive<span class="main">:</span> subgroup_of_abelian_group <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟷</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.commutative additive.inverse_composition_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟷</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"additive.Congruence <span class="main">=</span> Ring_Congruence"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> additive.Congruence_def Ring_Congruence_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, l 14›</span></span>
<span class="keyword1"><span class="command">notation</span></span> additive.Left_Coset <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+|</span>"</span> 65<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* subgroup_of_additive_group_of_ring *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Def 2.2›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 21--22›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ideal <span class="main">=</span> subgroup_of_additive_group_of_ring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> subgroup_of_additive_group_of_ring <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 14--17›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> multiplicative_congruence_implies_ideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monoid_congruence <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> Ring_Congruence"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">I</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> multiplicative<span class="main">:</span> monoid_congruence <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted">Ring_Congruence</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> congs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> additive.ClassD additive.Class_unit_normal_subgroup<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> congs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">,</span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence"</span></span> <span class="keyword1"><span class="command">using</span></span> multiplicative.cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> additive.Class_unit_normal_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> congs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span><span class="main">,</span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence"</span></span> <span class="keyword1"><span class="command">using</span></span> multiplicative.cong <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> additive.Class_unit_normal_subgroup <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* subgroup_of_additive_group_of_ring *)</span>

<span class="keyword1"><span class="command">context</span></span> ideal <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 17--20›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> multiplicative_congruence <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">a'</span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">b'</span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">,</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b'</span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> Ring_CongruenceI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span> Ring_CongruenceD <span class="main">[</span><span class="operator">dest</span><span class="main">]</span>
  <span class="keyword1"><span class="command">from</span></span> a b <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b'</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">a'</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">-</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">a'</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distributive left_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">-</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>  <span class="comment1">― ‹ll 18--19›</span>
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">-</span> <span class="free">b'</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">-</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b'</span> <span class="main">=</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">b'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distributive right_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> a'b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">-</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b'</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>  <span class="comment1">― ‹l 19›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">-</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b'</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">-</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">-</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.associative<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.associative <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab a'b' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">,</span> <span class="free">a'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b'</span><span class="main">)</span> <span class="main">∈</span> Ring_Congruence"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  <span class="comment1">― ‹ll 19--20›</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 23--24›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> ring_congruence <span class="keyword2"><span class="keyword">where</span></span> E <span class="main">=</span> <span class="quoted">Ring_Congruence</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">rule</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ideal *)</span>

<span class="keyword1"><span class="command">context</span></span> ring <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Pulled out of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">locale</span></span> ideal<span class="antiquote"><span class="antiquote">}</span></span></span></span> to achieve standard notation.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 24--26›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Quotient_Ring</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/'/</span>"</span> 75<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main"><span class="free">//</span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">/</span> <span class="main">(</span>subgroup_of_additive_group_of_ring.Ring_Congruence <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ring *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 24--26›</span></span>
<span class="keyword1"><span class="command">locale</span></span> quotient_ring <span class="main">=</span> ideal <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, ll 24--26›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> quotient<span class="main">:</span> ring <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">//</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([+])</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"additive.Class <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"additive.Class <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, l 26›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> Left_Coset <span class="main">=</span> additive.Left_CosetE

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equation 17 (1)›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, l 28›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> quotient_addition <span class="main">=</span> additive.factor_composition

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Equation 17 (2)›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, l 29›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> quotient_multiplication <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">+|</span> <span class="free">I</span><span class="main">)</span> <span class="main">[⋅]</span> <span class="main">(</span><span class="free">b</span> <span class="main">+|</span> <span class="free">I</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">+|</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> multiplicative.Class_commutes_with_composition additive.Class_is_Left_Coset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 101, l 30›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> quotient_zero <span class="main">=</span> additive.factor_unit
<span class="keyword1"><span class="command">lemmas</span></span> quotient_negative <span class="main">=</span> additive.factor_inverse

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* quotient_ring *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Homomorphisms of Rings.  Basic Theorems›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Def 2.3›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, ll 7--9›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ring_homomorphism <span class="main">=</span>
  map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">R'</span></span> <span class="main">+</span> source<span class="main">:</span> ring <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="main">+</span> target<span class="main">:</span> ring <span class="quoted"><span class="free">R'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬'</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span> <span class="main">+</span>
  additive<span class="main">:</span> group_homomorphism <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="free">R'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬'</span></span>"</span></span> <span class="main">+</span>
  multiplicative<span class="main">:</span> monoid_homomorphism <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="free">R'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">η</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">R'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition'</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+''</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication'</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅''</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬''</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭''</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, l 17›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ring_epimorphism <span class="main">=</span> ring_homomorphism <span class="main">+</span> surjective_map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">R'</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, ll 14--18›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> quotient_ring <span class="main">⊆</span> natural<span class="main">:</span> ring_epimorphism
  <span class="keyword2"><span class="keyword">where</span></span> η <span class="main">=</span> <span class="quoted">additive.Class</span> <span class="keyword2"><span class="keyword">and</span></span> R' <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">//</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> addition' <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">([+])</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> multiplication' <span class="main">=</span>  <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero' <span class="main">=</span> <span class="quoted"><span class="quoted">"additive.Class <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> unit' <span class="main">=</span> <span class="quoted"><span class="quoted">"additive.Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">context</span></span> ring_homomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Jacobson reasons via <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">b</span></span> <span class="main"><span class="main">∈</span></span> additive.Ker"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> being a congruence; we prefer the direct proof,
  since it is very simple.
›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, ll 19--21›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> kernel<span class="main">:</span> ideal <span class="keyword2"><span class="keyword">where</span></span> I <span class="main">=</span> <span class="quoted">additive.Ker</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> additive.Ker_image multiplicative.commutes_with_composition<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ring_homomorphism *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, l 22›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ring_monomorphism <span class="main">=</span> ring_homomorphism <span class="main">+</span> injective_map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">R'</span></span>

<span class="keyword1"><span class="command">context</span></span> ring_homomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, ll 21--23›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> ring_monomorphism_iff_kernel_unit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ring_monomorphism <span class="free">η</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="free">R'</span> <span class="main"><span class="free">(+')</span></span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟬'</span></span> <span class="main"><span class="free">𝟭'</span></span> <span class="main">⟷</span> additive.Ker <span class="main">=</span> <span class="main">{</span><span class="main"><span class="free">𝟬</span></span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?monom</span> <span class="main">⟷</span> <span class="var">?ker</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?monom</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ring_monomorphism <span class="keyword1"><span class="command">.</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?ker</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.injective_iff_kernel_unit <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?ker</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?monom</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.injective_iff_kernel_unit<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ring_homomorphism *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, ll 23--25›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> ring_homomorphism <span class="main">⊆</span> image<span class="main">:</span> subring <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">`</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="free">R'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬'</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, ll 26--27›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ideal_in_kernel <span class="main">=</span>
  ring_homomorphism <span class="main">+</span> contained<span class="main">:</span> ideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">I</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> additive.Ker"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, ll 26--27›</span></span>
<span class="keyword1"><span class="command">notation</span></span> contained.additive.quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[+]</span>"</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> contained.multiplicative.quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[⋅]</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Provides <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">text</span></span> <span class="raw_text"><span class="raw_text">additive.induced</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which Jacobson calls $\bar{\eta}$.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, l 30›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> additive<span class="main">:</span> normal_subgroup_in_kernel <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="free">R'</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬'</span></span>"</span></span> <span class="quoted"><span class="free">I</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"normal_subgroup.Congruence <span class="free">I</span> <span class="free">R</span> <span class="free">addition</span> <span class="free">zero</span> <span class="main">=</span> contained.Ring_Congruence"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">rule</span> subset contained.additive_congruence<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Only the multiplicative part needs some work.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, ll 27--30›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> induced<span class="main">:</span> ring_homomorphism <span class="quoted">additive.induced</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">//</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([+])</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">([⋅])</span>"</span></span> <span class="quoted"><span class="quoted">"contained.additive.Class <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"contained.additive.Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> contained.multiplicative.Class_commutes_with_composition
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> contained.additive.Left_CosetE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> contained.additive.Class_is_Left_Coset multiplicative.commutes_with_composition multiplicative.commutes_with_unit<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 106, l 30; p 107, ll 1--3›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">additive.induced</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes Jacobson's $\bar{\eta}$.  We have the commutativity of the diagram, where
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">additive.induced</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is unique: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] additive.factorization<span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] additive.uniqueness<span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ideal_in_kernel *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Fundamental Theorem of Homomorphisms of Rings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, l 6›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ring_homomorphism_fundamental <span class="main">=</span> ring_homomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, l 6›</span></span>
<span class="keyword1"><span class="command">notation</span></span> kernel.additive.quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[+]</span>"</span> 65<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> kernel.multiplicative.quotient_composition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[⋅]</span>"</span> 70<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, l 6›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> ideal_in_kernel <span class="keyword2"><span class="keyword">where</span></span> I <span class="main">=</span> <span class="quoted">additive.Ker</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">rule</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, ll 8--9›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> natural<span class="main">:</span> ring_epimorphism
  <span class="keyword2"><span class="keyword">where</span></span> η <span class="main">=</span> <span class="quoted">kernel.additive.Class</span> <span class="keyword2"><span class="keyword">and</span></span> R' <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">//</span> additive.Ker"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> addition' <span class="main">=</span> <span class="quoted"><span class="quoted">"kernel.additive.quotient_composition"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> multiplication' <span class="main">=</span> <span class="quoted"><span class="quoted">"kernel.multiplicative.quotient_composition"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero' <span class="main">=</span> <span class="quoted"><span class="quoted">"kernel.additive.Class <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> unit' <span class="main">=</span> <span class="quoted"><span class="quoted">"kernel.additive.Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, l 9›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> induced<span class="main">:</span> ring_monomorphism
  <span class="keyword2"><span class="keyword">where</span></span> η <span class="main">=</span> <span class="quoted">additive.induced</span> <span class="keyword2"><span class="keyword">and</span></span> R <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">//</span> additive.Ker"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> addition <span class="main">=</span> <span class="quoted"><span class="quoted">"kernel.additive.quotient_composition"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> multiplication <span class="main">=</span> <span class="quoted"><span class="quoted">"kernel.multiplicative.quotient_composition"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zero <span class="main">=</span> <span class="quoted"><span class="quoted">"kernel.additive.Class <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> unit <span class="main">=</span> <span class="quoted"><span class="quoted">"kernel.additive.Class <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.induced_inj_on<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ring_homomorphism_fundamental *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, l 11›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ring_isomorphism <span class="main">=</span> ring_homomorphism <span class="main">+</span> bijective_map <span class="quoted"><span class="free">η</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">R'</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, l 11›</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> ring_monomorphism <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">sublocale</span></span> ring_epimorphism <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, l 11›</span></span>
<span class="keyword1" id="Ring_Theory-inverse_ring_isomorphism"><span class="command">lemma</span></span> inverse_ring_isomorphism<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ring_isomorphism <span class="main">(</span>restrict <span class="main">(</span>inv_into <span class="free">R</span> <span class="free">η</span><span class="main">)</span> <span class="free">R'</span><span class="main">)</span> <span class="free">R'</span> <span class="main"><span class="free">(+')</span></span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟬'</span></span> <span class="main"><span class="free">𝟭'</span></span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> additive.commutes_with_composition <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> additive.commutes_with_unit
    multiplicative.commutes_with_composition <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> multiplicative.commutes_with_unit surjective
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ring_isomorphsim *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, l 11›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">isomorphic_as_rings</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≅<span class="hidden">⇩</span><sub>R</sub></span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">ℛ</span></span></span> <span class="keyword1"><span class="free">≅<span class="hidden">⇩</span><sub>R</sub></span></span> <span class="free"><span class="bound"><span class="entity">ℛ'</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">R</span><span class="main">,</span> <span class="bound">addition</span><span class="main">,</span> <span class="bound">multiplication</span><span class="main">,</span> <span class="bound">zero</span><span class="main">,</span> <span class="bound">unit</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ℛ</span></span></span><span class="main">;</span> <span class="main">(</span><span class="bound">R'</span><span class="main">,</span> <span class="bound">addition'</span><span class="main">,</span> <span class="bound">multiplication'</span><span class="main">,</span> <span class="bound">zero'</span><span class="main">,</span> <span class="bound">unit'</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ℛ'</span></span></span> <span class="keyword1">in</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">η</span><span class="main">.</span> ring_isomorphism <span class="bound">η</span> <span class="bound">R</span> <span class="bound">addition</span> <span class="bound">multiplication</span> <span class="bound">zero</span> <span class="bound">unit</span> <span class="bound">R'</span> <span class="bound">addition'</span> <span class="bound">multiplication'</span> <span class="bound">zero'</span> <span class="bound">unit'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, l 11›</span></span>
<span class="keyword1" id="Ring_Theory-isomorphic_as_rings_symmetric"><span class="command">lemma</span></span> isomorphic_as_rings_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">,</span> <span class="free">addition</span><span class="main">,</span> <span class="free">multiplication</span><span class="main">,</span> <span class="free">zero</span><span class="main">,</span> <span class="free">unit</span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">R'</span><span class="main">,</span> <span class="free">addition'</span><span class="main">,</span> <span class="free">multiplication'</span><span class="main">,</span> <span class="free">zero'</span><span class="main">,</span> <span class="free">unit'</span><span class="main">)</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">R'</span><span class="main">,</span> <span class="free">addition'</span><span class="main">,</span> <span class="free">multiplication'</span><span class="main">,</span> <span class="free">zero'</span><span class="main">,</span> <span class="free">unit'</span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">R</span><span class="main">,</span> <span class="free">addition</span><span class="main">,</span> <span class="free">multiplication</span><span class="main">,</span> <span class="free">zero</span><span class="main">,</span> <span class="free">unit</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_as_rings_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> ring_isomorphism.inverse_ring_isomorphism<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> ring_homomorphism <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Corollary›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹p 107, ll 11--12›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> image_is_isomorphic_to_quotient_ring<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">K</span> <span class="bound">add</span> <span class="bound">mult</span> <span class="bound">zero</span> <span class="bound">one</span><span class="main">.</span> ideal <span class="bound">K</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">R</span><span class="main">,</span> <span class="main"><span class="free">(+')</span></span><span class="main">,</span> <span class="main"><span class="free">(⋅')</span></span><span class="main">,</span> <span class="main"><span class="free">𝟬'</span></span><span class="main">,</span> <span class="main"><span class="free">𝟭'</span></span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">R</span> <span class="main">//</span> <span class="bound">K</span><span class="main">,</span> <span class="bound">add</span><span class="main">,</span> <span class="bound">mult</span><span class="main">,</span> <span class="bound">zero</span><span class="main">,</span> <span class="bound">one</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> image<span class="main">:</span> ring_homomorphism_fundamental <span class="keyword2"><span class="keyword">where</span></span> R' <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">`</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> target.additive.commutative additive.commutes_with_composition
      multiplicative.commutes_with_composition target.distributive multiplicative.commutes_with_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_isomorphism image.additive.induced <span class="main">(</span><span class="free">R</span> <span class="main">//</span> additive.Ker<span class="main">)</span> <span class="main">([+])</span> <span class="main">([⋅])</span> <span class="main">(</span>kernel.additive.Class <span class="main"><span class="free">𝟬</span></span><span class="main">)</span> <span class="main">(</span>kernel.additive.Class <span class="main"><span class="free">𝟭</span></span><span class="main">)</span> <span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">R</span><span class="main">)</span> <span class="main"><span class="free">(+')</span></span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟬'</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image.additive.induced_image bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">R</span><span class="main">,</span> <span class="main"><span class="free">(+')</span></span><span class="main">,</span> <span class="main"><span class="free">(⋅')</span></span><span class="main">,</span> <span class="main"><span class="free">𝟬'</span></span><span class="main">,</span> <span class="main"><span class="free">𝟭'</span></span><span class="main">)</span> <span class="keyword1">≅<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">R</span> <span class="main">//</span> additive.Ker<span class="main">,</span> <span class="main">([+])</span><span class="main">,</span> <span class="main">([⋅])</span><span class="main">,</span> kernel.additive.Class <span class="main"><span class="free">𝟬</span></span><span class="main">,</span> kernel.additive.Class <span class="main"><span class="free">𝟭</span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isomorphic_as_rings_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> ring_isomorphism.inverse_ring_isomorphism<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal additive.Ker <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ring_homomorphism *)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>