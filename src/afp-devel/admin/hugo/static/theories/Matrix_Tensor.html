<div id="Matrix_Tensor">
<div class="head">
<h1>Theory Matrix_Tensor</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Tensor Product of Matrices
    Author:      T. V. H. Prathamesh (prathamesh@imsc.res.in)
    Maintainer:  T. V. H. Prathamesh
*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
We define Tensor Product of Matrics and prove properties such as associativity and mixed product 
property(distributivity) of the tensor product.›</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Tensor Product of Matrices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Matrix_Tensor
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Matrix/Utility.html">Matrix.Utility</a> <a href="../Matrix/Matrix_Legacy.html">Matrix.Matrix_Legacy</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Defining the Tensor Product›</span></span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define a multiplicative locale here - mult, 
where the multiplication satisfies commutativity, 
associativity and contains a left and right identity›</span></span>

<span class="keyword1"><span class="command">locale</span></span> mult <span class="main">=</span> 
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">id</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">" <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> "</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1">*</span></span>"</span> 60<span class="main">)</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> comm<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">f</span> <span class="free">a</span>  <span class="free">b</span> <span class="main">=</span> <span class="free">f</span> <span class="free">b</span>  <span class="free">a</span> "</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> assoc<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> left_id<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">f</span> <span class="free">id</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> right_id<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="free">id</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
 
<span class="keyword1"><span class="command">context</span></span> mult
<span class="keyword2"><span class="keyword">begin</span></span>   


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹times a v , gives us the product of the vector v with 
multiplied pointwise with a›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">times</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">times</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">times</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">times</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> times_scalar_id<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="free">id</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>left_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> times_vector_id<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="free">v</span> <span class="main">[</span><span class="free">id</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">v</span><span class="main">]</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>right_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> preserving_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>times <span class="free">n</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹vec$\_$vec$\_$Tensor is the tensor product of two vectors. It is 
illustrated by the following relation
 
$vec\_vec\_Tensor (v_1,v_2,...v_n) (w_1,w_2,...w_m) 
                 = (v_1 \cdot w_1,...,v_1 \cdot w_m,...
                          , v_n \cdot w_1 , ..., v_n \cdot w_m)$›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">vec_vec_Tensor</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">vec_vec_Tensor</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vec_vec_Tensor</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">(</span>times <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="free">vec_vec_Tensor</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> vec_vec_Tensor_left_id<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_vec_Tensor <span class="main">[</span><span class="free">id</span><span class="main">]</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>left_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_vec_Tensor_right_id<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_vec_Tensor <span class="free">v</span> <span class="main">[</span><span class="free">id</span><span class="main">]</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>right_id<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> vec_vec_Tensor_length <span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">(</span>length<span class="main">(</span>vec_vec_Tensor <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">x</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preserving_length<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> vec_length<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">m</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">n</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vec <span class="main">(</span><span class="free">m</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>vec_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>vec_vec_Tensor_length<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> vec_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹vec$\_$mat$\_$Tensor is the tensor product of two vectors. It is 
illusstrated by the following relation
 
vec\_mat\_Tensor ($v_1,v_2,...v_n) (C_1,C_2,...C_m) 
                 = (v_1 \cdot C_1,...,v_n \cdot C_1,
                               ...,v_1 \cdot C_m , ..., v_n \cdot C_m$)›</span></span>


<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">vec_mat_Tensor</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span><span class="tfree">'a</span> mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">vec_mat_Tensor</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">[]</span>  <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vec_mat_Tensor</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">yss</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">vec_mat_Tensor</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">yss</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> vec_mat_Tensor_vector_id<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_mat_Tensor <span class="main">[</span><span class="free">id</span><span class="main">]</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_scalar_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_mat_Tensor_matrix_id<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_mat_Tensor  <span class="free">v</span> <span class="main">[</span><span class="main">[</span><span class="free">id</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free">v</span><span class="main">]</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_id<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> vec_mat_Tensor_length<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"length<span class="main">(</span>vec_mat_Tensor <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> length_matrix<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec <span class="main">(</span><span class="free">nr</span><span class="main">*</span><span class="free">k</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="free">y</span><span class="main">#</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="free">y</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="free">ys</span><span class="main">)</span>"</span></span>  
       <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">y</span> <span class="main">=</span> <span class="free">nr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms mat_def 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_member member_rec<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> vec_def<span class="main">)</span>
 <span class="keyword1"><span class="command">from</span></span> this
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">nr</span><span class="main">*</span><span class="free">k</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> assms vec_vec_Tensor_length  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">from</span></span> this 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> <span class="free">nr</span><span class="main">*</span><span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹vec_vec_Tensor <span class="free">v</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>›</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">from</span></span> this 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec <span class="main">(</span><span class="free">nr</span><span class="main">*</span><span class="free">k</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">from</span></span> this 
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_set_list<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">M</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">∈</span> set <span class="free">M</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ys</span><span class="main">.</span><span class="main">∃</span><span class="bound">zs</span><span class="main">.</span><span class="main">(</span><span class="bound">ys</span><span class="main">@</span><span class="free">x</span><span class="main">#</span><span class="bound">zs</span> <span class="main">=</span> <span class="free">M</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> assms set_def in_set_conv_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">reduct</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">reduct</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">reduct</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> length_reduct<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>reduct <span class="free">m</span><span class="main">)</span> <span class="main">+</span><span class="main">1</span>  <span class="main">=</span> <span class="main">(</span>length <span class="free">m</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 assms list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> neq_Nil_conv reduct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_empty_column_length<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nc</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">M</span> <span class="main">=</span> <span class="free">nc</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">from</span></span> this 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nc</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">from</span></span> this 
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> vec_uniqueness<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">m</span> <span class="free">v</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vec <span class="free">n</span> <span class="free">v</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> vec_def assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> mat_uniqueness<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr1</span> <span class="free">nc</span> <span class="free">M</span>"</span></span> 
 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr2</span> <span class="free">nc</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> hd <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>set <span class="free">M</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="free">nr1</span> <span class="main">=</span> <span class="free">nr2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> set <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> set_def mat_def 
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_in_set<span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">(</span>vec <span class="free">nr1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_def assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="free">nr1</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ball_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">(</span>vec <span class="free">nr2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_def assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> step2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="free">nr2</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ball_def assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">from</span></span> step1 <span class="keyword2"><span class="keyword">and</span></span> step2 
   <span class="keyword1"><span class="command">have</span></span> step3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec <span class="free">nr1</span> <span class="bound">x</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>vec <span class="free">nr2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹Ball <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">(</span>vec <span class="free">nr1</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Ball <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">(</span>vec <span class="free">nr2</span><span class="main">)</span>›</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>vec <span class="free">nr1</span> <span class="free">x</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>vec <span class="free">nr2</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">nr1</span> <span class="main">=</span> <span class="free">nr2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vec_uniqueness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> step3  
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="free">nr1</span> <span class="main">=</span> <span class="free">nr2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_uniqueness<span class="main">)</span> 
 <span class="keyword1"><span class="command">then</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>set <span class="free">M</span><span class="main">)</span><span class="main">.</span><span class="main">(</span><span class="free">nr1</span> <span class="main">=</span> <span class="free">nr2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">then</span></span> 
     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

 
<span class="keyword1"><span class="command">lemma</span></span> mat_empty_row_length<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">0</span> <span class="free">nc</span> <span class="free">M</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">M</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_def assms  empty_set  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">(</span>vec <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">0</span> <span class="free">nc</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_def assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> gen_length_code<span class="main">(</span>1<span class="main">)</span> length_code
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> <span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">null_matrix</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">null_matrix</span> <span class="main">≡</span> <span class="main">[</span>Nil<span class="main">]</span> "</span></span>

<span class="keyword1"><span class="command">lemma</span></span> null_mat<span class="main">:</span><span class="quoted"><span class="quoted">"null_matrix <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_matrix<span class="main">:</span><span class="quoted"><span class="quoted">" mat <span class="main">0</span> <span class="main">0</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mat_def in_set_insert insert_Nil list.size<span class="main">(</span>3<span class="main">)</span> not_Cons_self2
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹row\_length gives the length of the first row of a matrix. For a `valid'
matrix, it is equal to the number of rows›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">row_length</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">row_length</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">(</span>length <span class="main">(</span>hd <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> row_length_Nil<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"row_length <span class="main">[]</span> <span class="main">=</span><span class="main">0</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> row_length_Null<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"row_length <span class="main">[</span><span class="main">[]</span><span class="main">]</span> <span class="main">=</span><span class="main">0</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> row_length_vect_mat<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="free">m</span><span class="main">)</span>  <span class="main">=</span> length <span class="free">v</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> row_length_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_mat_Tensor <span class="free">v</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">[]</span><span class="main">)</span>  <span class="main">=</span> length <span class="free">v</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> mult_0_right <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> length <span class="free">v</span> <span class="main">*</span> row_length <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> 
         <span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">a</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> row_length_def   list.distinct<span class="main">(</span>1<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_mat_Tensor <span class="free">v</span>  <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor_def vec_mat_Tensor.simps<span class="main">(</span>2<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 
       <span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> row_length_def   list.distinct<span class="main">(</span>1<span class="main">)</span>  vec_mat_Tensor.simps<span class="main">(</span>2<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> vec_vec_Tensor_length <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> A  <span class="keyword1"><span class="command">have</span></span> 
         <span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Tensor is the tensor product of matrices›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">Tensor</span><span class="main">::</span><span class="quoted"><span class="quoted">" <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span><span class="tfree">'a</span> mat"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊗</span>"</span> 63<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Tensor</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">Tensor</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">(</span>vec_mat_Tensor <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="free">Tensor</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Tensor_null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">⊗</span><span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Tensor commutes with left and right identity›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Tensor_left_id<span class="main">:</span> <span class="quoted"><span class="quoted">"  <span class="main">[</span><span class="main">[</span><span class="free">id</span><span class="main">]</span><span class="main">]</span> <span class="main">⊗</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>times_scalar_id<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Tensor_right_id<span class="main">:</span> <span class="quoted"><span class="quoted">"  <span class="free">xs</span> <span class="main">⊗</span> <span class="main">[</span><span class="main">[</span><span class="free">id</span><span class="main">]</span><span class="main">]</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_vec_Tensor_right_id<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹row$\_$length of tensor product of matrices is the product of 
their respective row lengths›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> row_length_mat<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="main">(</span><span class="free">m1</span><span class="main">⊗</span><span class="free">m2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="free">m1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">m2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m1</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="main">[]</span><span class="main">⊗</span><span class="free">m2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Tensor.simps<span class="main">(</span>1<span class="main">)</span> row_length_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="main">[]</span><span class="main">⊗</span><span class="free">m2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">m2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  row_length_Nil   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">m1</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">m1</span> <span class="main">⊗</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> row_length <span class="skolem">m1</span> <span class="main">*</span> row_length <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> 
    <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">*</span> row_length <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m1</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">a</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> row_length_def   list.distinct<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">m2</span><span class="main">)</span> <span class="main">=</span> row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">*</span> row_length <span class="free">m2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m2</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> Nil
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Tensor_null row_length_def  mult_0_right <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="skolem">m2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">m1</span> <span class="main">⊗</span> <span class="skolem">m2</span><span class="main">)</span> <span class="main">=</span> row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">*</span> row_length <span class="skolem">m2</span>"</span></span>
     <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span><span class="main">=</span> 
      <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">m1</span> <span class="main">⊗</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">m2</span><span class="main">)</span> 
                  <span class="main">=</span> row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">m1</span><span class="main">)</span> <span class="main">*</span> row_length <span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">m2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> non_zero<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">m1</span><span class="main">⊗</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">=</span> hd <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m1</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m1</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> row_length <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> row_length_def  Nil_is_append_conv non_zero Tensor.simps<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">=</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span>row_length<span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> row_length_vect_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>   
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> s1  
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span>row_length<span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> B 
             <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">=</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">m1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span>row_length<span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">m2</span><span class="main">)</span>"</span></span>    
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">from</span></span> this  <span class="keyword2"><span class="keyword">and</span></span> s1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> hd_set<span class="main">:</span><span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span><span class="main">∈</span><span class="main">(</span>set <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> set_def assms set_ConsD  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹for every valid matrix can also be written in the following form›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> matrix_row_length<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">M</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="free">M</span><span class="main">=</span> <span class="main">0</span> "</span></span> 
       <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">M</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">0</span> <span class="main">0</span> <span class="free">M</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> zero_matrix Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
       <span class="keyword1"><span class="command">using</span></span> mat_empty_row_length row_length_def mat_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">N</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> assms Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> hd_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"vec <span class="free">nr</span> <span class="skolem">a</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ball_set_list_all list_all_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">a</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> row_length_def Cons  list.distinct<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" vec <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span>  <span class="main">=</span> <span class="free">nr</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> vec_uniqueness Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">nc</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> mat_def <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">with</span></span> 3 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span> <span class="free">M</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> reduct_matrix<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">using</span></span> row_length_def zero_matrix Nil  list.size<span class="main">(</span>3<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">next</span></span>   
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">N</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">M</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> set_def  Cons ListMem_iff elem  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> mat_def Ball_def assms 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>length <span class="free">a</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> row_length_def  list.distinct<span class="main">(</span>1<span class="main">)</span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>length <span class="free">a</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>vec <span class="main">(</span>length <span class="free">a</span><span class="main">)</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> assms in_set_member mat_def member_rec<span class="main">(</span>1<span class="main">)</span> vec_def
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec <span class="main">(</span>length <span class="skolem">b</span><span class="main">)</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">b</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> vec_uniqueness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>length <span class="skolem">b</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"row_length <span class="free">M</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">b</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> row_length_def   Cons list.distinct<span class="main">(</span>1<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> Cons 5 6 assms in_set_member mat_def member_rec<span class="main">(</span>1<span class="main">)</span> 
         vec_uniqueness
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="free">M</span><span class="main">)</span> <span class="main">(</span>vec <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> Ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">theorem</span></span> well_defined_vec_mat_Tensor<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span>
                  <span class="main">(</span>mat 
                    <span class="main">(</span><span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span>length <span class="free">M</span><span class="main">)</span> 
                           <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span> 
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor.simps<span class="main">(</span>1<span class="main">)</span> Nil  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> row_length_def Nil 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
       <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">[]</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> zero_matrix <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_zero_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">M</span>
 <span class="keyword3"><span class="command">assume</span></span> hyp <span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="skolem">M</span> 
           <span class="main">⟹</span> mat <span class="main">(</span>row_length <span class="skolem">M</span> <span class="main">*</span> length <span class="free">v</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span>"</span></span>                      
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">=</span> 
   <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">*</span> length <span class="free">v</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="skolem">M</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> hyp<span class="main">(</span>2<span class="main">)</span> reduct_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> step2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="skolem">M</span> <span class="main">*</span> length <span class="free">v</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">M</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> hyp<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"mat 
        <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">*</span> length <span class="free">v</span><span class="main">)</span> 
        <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> Nil 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">]</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor.simps Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">[</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>  <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">[</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>length <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span>
        <span class="quoted"><span class="quoted">"length <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> row_length_def  list.distinct<span class="main">(</span>1<span class="main">)</span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>length <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nil mat_def vec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span>
        <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">*</span> length <span class="free">v</span><span class="main">)</span> 
             <span class="main">(</span>length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 4 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">next</span></span> 
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">L</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> hd_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> mat_def Ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> row_length_def  list.distinct<span class="main">(</span>1<span class="main">)</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> <span class="main">(</span>set <span class="skolem">M</span><span class="main">)</span><span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">b</span> <span class="main">∈</span> <span class="main">(</span>set <span class="skolem">M</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span>  hyp<span class="main">(</span>2<span class="main">)</span> in_set_member mat_def member_rec<span class="main">(</span>1<span class="main">)</span> vec_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> vec_def vec_uniqueness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="skolem">M</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> row_length_def   Cons list.distinct<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="skolem">M</span> <span class="main">*</span> length <span class="free">v</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">M</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> step2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span>
          <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> mat_def Ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span>   vec_vec_Tensor_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">" vec <span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor_length vec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> row_length_def   list.distinct<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> 
                   <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">M</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span>  hd_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 4 6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">⟶</span>  vec <span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 7 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">⟶</span>  vec <span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">⟶</span>  vec <span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span> <span class="quoted">"3"</span> <span class="quoted">"6"</span> <span class="quoted">"7"</span> hd_set vec_mat_Tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"Ball 
            <span class="main">(</span>set <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> Ball_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">with</span></span> 6  7 <span class="keyword1"><span class="command">have</span></span> 
               <span class="quoted"><span class="quoted">"mat 
                 <span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> mat_def  <span class="quoted">"5"</span> length_code
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span>  hyp  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorem  gives length of tensor product of two matrices›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> length_Tensor<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span>length <span class="main">(</span><span class="free">M1</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M1</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">M1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> Tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span>
          <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">=</span> length <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">+</span> length <span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> append_def
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">M2</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor_length <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span>  Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 2 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>length <span class="skolem">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span>
    <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>length <span class="skolem">M1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 1  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> append_reduct_matrix<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="free">M1</span><span class="main">@</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M1</span><span class="main">@</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">M1</span><span class="main">@</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span>
<span class="main">⟹</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M1</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil append.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">M1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">M1</span> <span class="main">@</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">M1</span> <span class="main">@</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">M1</span> <span class="main">@</span> <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> reduct_matrix Cons.prems append_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span><span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorem proves that tensor product of two valid matrices
is a valid matrix›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> well_defined_Tensor<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span> 
<span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
<span class="main">⟹</span><span class="main">(</span>mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">M1</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M1</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> row_length_def  mult_zero_left  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">[]</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span>  mult_zero_left list.size<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">⊗</span> <span class="free">M2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> Tensor.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
       <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">[]</span><span class="main">*</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="main">[]</span><span class="main">*</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="main">[]</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> zero_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">M1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span>"</span></span> 
             <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">M1</span><span class="main">)</span>"</span></span> 
             <span class="keyword1"><span class="command">using</span></span> reduct_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">M2</span><span class="main">)</span>"</span></span> 
             <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> step2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="skolem">M1</span> <span class="main">*</span> row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M1</span> <span class="main">*</span> length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">a</span>"</span></span> 
             <span class="keyword1"><span class="command">using</span></span> row_length_def  list.distinct<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
           <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span><span class="main">*</span>row_length <span class="free">M2</span><span class="main">)</span> 
           <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span><span class="main">*</span>length <span class="free">M2</span><span class="main">)</span> 
                           <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">M1</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> Nil 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Cons.prems well_defined_vec_mat_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> length <span class="free">M2</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span> <span class="main">=</span> <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Nil Tensor.simps append.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span>mat 
            <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">N1</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="skolem">M1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> hd_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> mat_def Ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> row_length_def  list.distinct<span class="main">(</span>1<span class="main">)</span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> <span class="main">(</span>set <span class="skolem">M1</span><span class="main">)</span><span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">b</span> <span class="main">∈</span> <span class="main">(</span>set <span class="skolem">M1</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="skolem">b</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span>  Cons.prems in_set_member mat_def member_rec<span class="main">(</span>1<span class="main">)</span> vec_def
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> vec_def vec_uniqueness <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="skolem">M1</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span> 
               <span class="keyword1"><span class="command">using</span></span> row_length_def Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                    <span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span> <span class="main">*</span> row_length <span class="free">M2</span><span class="main">)</span> 
                    <span class="main">(</span>length <span class="skolem">M1</span> <span class="main">*</span> length <span class="free">M2</span><span class="main">)</span> 
                                    <span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> step2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span><span class="skolem">M1</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span> 
                <span class="keyword1"><span class="command">using</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span>
         <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> Ball_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
              <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> 
                 <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span>"</span></span> 
                 <span class="keyword1"><span class="command">using</span></span> well_defined_vec_mat_Tensor Cons.prems 
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ball 
                    <span class="main">(</span>set <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                 <span class="keyword1"><span class="command">using</span></span> mat_def
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">∨</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>  
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span><span class="free">M2</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> Tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">⟶</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> set_def append_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span>  <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span>
        <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>vec <span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> Ball_def 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> 7 8
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                     <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span> <span class="main">*</span> row_length <span class="free">M2</span><span class="main">)</span> 
                       <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span><span class="main">)</span> <span class="main">*</span> length <span class="free">M2</span><span class="main">)</span> 
                                <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0"</span>  length_Tensor<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> effective_well_defined_Tensor<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat 
            <span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span><span class="free">M1</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> well_defined_Tensor assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">natmod</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">nmod</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">natmod</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> nat <span class="main">(</span><span class="main">(</span>int <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>int <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> times_elements<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>times <span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="main">[]</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>times <span class="free">a</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> times.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>times <span class="free">a</span> <span class="main">[]</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="main">[]</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>times <span class="free">a</span> <span class="main">[]</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="main">[]</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>   
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span>length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟶</span><span class="main">(</span><span class="main">(</span>times <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span>length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span><span class="main">(</span>times <span class="free">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>  
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>times <span class="free">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 0 times.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>times <span class="free">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>times <span class="free">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>times <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> times.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>times <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>times <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span>length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> One_nat_def Suc Suc_eq_plus1 list.size<span class="main">(</span>4<span class="main">)</span> not_less_eq 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>times <span class="free">a</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.hyps<span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_Cons_Suc<span class="main">)</span>
     <span class="keyword1"><span class="command">with</span></span> 1 2 4  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">)</span> 
                            <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>times <span class="free">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span>length <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>times <span class="free">a</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> simpl_times_elements<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">)</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>times <span class="free">a</span> <span class="free">v</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> times_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*some lemmas which are used to prove theorems*)</span>
<span class="keyword1"><span class="command">lemma</span></span> append_simpl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> nth_append  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> append_simpl2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span><span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">ys</span><span class="main">!</span><span class="main">(</span><span class="free">i</span><span class="main">-</span> <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> nth_append less_asym  leD  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> append_simpl3<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="free">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">zs</span><span class="main">)</span><span class="main">+</span><span class="main">1</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">⟶</span> <span class="free">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">zs</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="main">(</span><span class="free">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">+</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">+</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> append_simpl4<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
         <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="free">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> append_simpl3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_vec_Tensor_simpl<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span>times <span class="free">z</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="free">i</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_vec_Tensor <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>times <span class="free">z</span> <span class="free">y</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="free">zs</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>times <span class="free">z</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> preserving_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="main">(</span>times <span class="free">z</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>times <span class="free">z</span> <span class="free">y</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="free">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span>times <span class="free">z</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> append_simpl <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>times <span class="free">z</span> <span class="free">y</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="free">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span>times <span class="free">z</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span>  a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span>times <span class="free">z</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="free">i</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> vec_vec_Tensor_simpl2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="free">z</span><span class="main">#</span><span class="free">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="free">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span><span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor.simps<span class="main">(</span>2<span class="main">)</span> append_simpl2  preserving_length 
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> division_product<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>int<span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span><span class="free">b</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span><span class="free">b</span> <span class="main">≥</span><span class="main">0</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> div_mult_self2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">with</span></span> 1 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">div</span> <span class="free">b</span>"</span></span> 
     <span class="keyword1"><span class="command">using</span></span> less_int_code<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> int_nat_div<span class="main">:</span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">a</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>int <span class="free">b</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> zdiv_int<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> int_nat_eq<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> int <span class="free">b</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span>  assms of_nat_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> nat_div<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">b</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> division_product <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="free">a</span><span class="main">)</span><span class="main">&gt;</span><span class="main">(</span>int <span class="free">b</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>int <span class="free">a</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>int <span class="free">b</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>int <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>int <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> division_product <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">from</span></span> int_nat_div <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>int <span class="free">a</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>int <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span> <span class="free">a</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">from</span></span> int_nat_div assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span>int <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>int <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>int <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less_asym not_less of_nat_diff<span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> int <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> 2 3 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> int_nat_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mod_eq<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> mod_mult_self1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> nat_mod_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"int <span class="free">m</span> <span class="keyword1">mod</span> int <span class="free">n</span> <span class="main">=</span> int <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_mod<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nat_mod<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span> <span class="free">n</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">m</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="free">m</span> <span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms mod_if not_less_iff_gr_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> logic<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⟶</span> <span class="free">B</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">A</span> <span class="main">⟶</span> <span class="free">B</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> vec_vec_Tensor_elements<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">y</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">x</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
             <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>vec_vec_Tensor <span class="main">[]</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="main">(</span>vec_vec_Tensor <span class="main">[]</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_vec_Tensor <span class="main">[]</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="main">(</span>vec_vec_Tensor <span class="main">[]</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"vec_vec_Tensor <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span>times <span class="skolem">z</span> <span class="free">y</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">zs</span> <span class="free">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span>times <span class="skolem">z</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> times_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span> 
           <span class="main">⟶</span> <span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>times <span class="skolem">z</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor_simpl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>  <span class="keyword1"><span class="command">have</span></span> 35<span class="main">:</span>
           <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">)</span> calculation<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span> <span class="main">&gt;</span><span class="main">0</span> "</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nth_Cons_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 2 6  
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟶</span> <span class="main">(</span>times <span class="skolem">z</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> 
                 <span class="main">=</span> <span class="free">f</span>  <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">x</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> 
                      <span class="main">=</span>  <span class="free">f</span>  
                             <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">(</span><span class="free">y</span><span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> step2<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span><span class="main">)</span> 
           <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⟶</span><span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                          <span class="main">=</span> <span class="free">f</span> 
                              <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> 
           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
               <span class="main">⟶</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">-</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> nat_div <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span><span class="main">!</span><span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">zs</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> 
           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
              <span class="main">⟶</span> <span class="main">(</span><span class="skolem">zs</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
               <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> nat_mod <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="free">y</span><span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main">!</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">⟶</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> 
                                <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="skolem">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor_simpl2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span>
             <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                                 <span class="main">=</span> <span class="free">f</span> 
                                    <span class="main">(</span><span class="skolem">zs</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                    <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">=</span> <span class="free">f</span> 
                                  <span class="main">(</span><span class="skolem">zs</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                      <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                                <span class="main">=</span> <span class="free">f</span> 
                                                    <span class="main">(</span><span class="skolem">zs</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                                    <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> 6 <span class="keyword1"><span class="command">have</span></span> 
           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">=</span> <span class="free">f</span> 
                               <span class="main">(</span><span class="skolem">zs</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">-</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>  <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> 2 3 4 <span class="keyword1"><span class="command">have</span></span>  
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span><span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                         <span class="main">=</span>  <span class="free">f</span> 
                               <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">)</span> 
                     <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                          <span class="main">=</span> <span class="free">f</span> 
                                              <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                              <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                        <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="skolem">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="main">0</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor_simpl2   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> length <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> length <span class="free">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> 4 assms div_self less_numeral_extra<span class="main">(</span>3<span class="main">)</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> length <span class="free">y</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                               <span class="main">=</span> <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">zs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> length <span class="free">y</span><span class="main">)</span> 
                              <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">zs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">⟶</span><span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                                             <span class="main">=</span> <span class="free">f</span> 
                                                 <span class="main">(</span><span class="main">(</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                                 <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> length <span class="free">y</span><span class="main">)</span> 
                           <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> 
                                       <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                         <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                               <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                                <span class="main">=</span> <span class="free">f</span> 
                                                    <span class="main">(</span><span class="main">(</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                                    <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">0</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">zs</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">zs</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> 
                                           <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">zs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">0</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> 7 8 Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span>  4 5 8 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> length <span class="free">y</span><span class="main">)</span> 
                            <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                                     <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">zs</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> 
                                             <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 1 2 5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">=</span> length <span class="free">y</span><span class="main">)</span> 
                             <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                            <span class="main">=</span> <span class="free">f</span> 
                                                 <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                                 <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> step2 <span class="keyword1"><span class="command">have</span></span> step4<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">⟶</span>  <span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                    <span class="main">=</span> <span class="free">f</span> 
                                         <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                         <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step1 step4 <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="free">f</span> 
                                    <span class="main">(</span><span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                     <span class="main">(</span><span class="free">y</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> logic <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"6"</span> <span class="quoted">"7"</span> 35<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹a few more results that will be used later on›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nat_int<span class="main">:</span>  <span class="quoted"><span class="quoted">"nat <span class="main">(</span>int <span class="free">x</span> <span class="main">+</span> int <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> nat_int of_nat_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> int_nat_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> nat <span class="main">(</span>int <span class="main">1</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">=</span> <span class="main">-</span>int <span class="main">1</span>"</span></span> 
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>nat <span class="main">(</span>int <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> 
                 <span class="main">⟶</span> nat <span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">+</span> <span class="main">(</span>nat <span class="main">(</span>int <span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">=</span>  <span class="main">(</span>nat <span class="main">(</span><span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span>  <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> of_nat_add nat_int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">(</span><span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span>  <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">(</span><span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span>  <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">(</span><span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span>  <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> nat <span class="main">(</span><span class="main">(</span>int <span class="free">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span> <span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> list_int_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="free">k</span> <span class="main">=</span> <span class="free">xs</span><span class="main">!</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="free">k</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">fix</span></span>  <span class="skolem">j</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span><span class="main">!</span><span class="free">k</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> 
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">k</span> <span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  int_nat_equiv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span><span class="main">!</span><span class="free">k</span> <span class="main">=</span> <span class="free">xs</span><span class="main">!</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="free">k</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Suc_eq_plus1 int_nat_equiv nth_Cons_Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> row_length_eq<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>mat  <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> 
   <span class="main">⟶</span> 
    <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat  <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">⟶</span> <span class="main">(</span><span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span>mat  <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">⟶</span> <span class="main">(</span>Ball <span class="main">(</span>set <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>vec <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat  <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">⟶</span> <span class="main">(</span><span class="free">b</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">⟶</span> <span class="main">(</span>vec <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span>"</span></span>  
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat  <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">⟶</span> <span class="main">(</span>length <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat  <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">⟶</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> 
                                       <span class="main">=</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">b</span><span class="main">#</span><span class="free">N</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorem tells us the relationship between entries of 
vec\_mat\_Tensor v M and entries of v and M respectivety›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> vec_mat_Tensor_elements<span class="main">:</span> 
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span>
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span>
   <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="free">M</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
               <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">M</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> this 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> this 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> False"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_mat_Tensor <span class="free">v</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">[]</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">[]</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> this 
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">M</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="free">f</span> 
                      <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> False"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
                 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> 
                                   <span class="free">f</span> 
                                        <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                        <span class="main">(</span><span class="main">[]</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil 1 less_nat_zero_code <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">M</span><span class="main">!</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="skolem">M</span><span class="main">)</span>
             <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> 
                                               <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                               <span class="main">(</span><span class="skolem">M</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span>
         <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">⟶</span>  <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> 
                                               <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                               <span class="main">(</span><span class="skolem">a</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor_elements Cons.hyps mult.commute 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute vec_vec_Tensor_elements<span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">with</span></span> 2 4 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> 
       <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⟶</span>  <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">0</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                                   <span class="main">=</span> <span class="free">f</span> 
                                       <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                       <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">0</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">⟶</span>
                    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>  
                         <span class="main">⟶</span>  <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                               <span class="main">=</span> <span class="free">f</span> 
                                    <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                    <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">⟶</span>  
           <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> 
                                <span class="free">f</span> 
                                         <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                         <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span>   
                  <span class="main">⟶</span>  <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                 <span class="main">=</span> <span class="free">f</span> 
                                    <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                     <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> 6 Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">N</span><span class="main">)</span>
       <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>mat  <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">⟶</span> row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> row_length_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
            <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">=</span> <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> list_int_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
                 <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span><span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">⟶</span>  
             <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                    <span class="main">=</span> <span class="free">f</span> 
                      <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Cons.hyps Cons mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
                 <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
          <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>   <span class="main">⟶</span>  
                    <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
            <span class="main">=</span> <span class="free">f</span> 
                <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Cons.hyps Cons mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">with</span></span> 8 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
                 <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>   
                      <span class="main">⟶</span>  
         <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                    <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="main">(</span><span class="main">(</span>int <span class="skolem">j</span><span class="main">)</span><span class="main">+</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> list_int_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> 
                    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>   
                     <span class="main">⟶</span>  
                         <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                  <span class="main">=</span> <span class="free">f</span> 
                                      <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                      <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  
           <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
             <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>   
                 <span class="main">⟶</span>  
                        <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="free">f</span> 
                                    <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                    <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> reduct_matrix <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
       <span class="keyword1"><span class="command">moreover</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">⟶</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"7"</span> Cons<span class="main">)</span>
       <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> 
                     <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>   <span class="main">⟶</span>  
                         <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                    <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> calculation<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">with</span></span> 6 10 logic <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">∧</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>   
            <span class="main">⟶</span>  
                <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="free">f</span> 
                          <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">b</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span>  Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorem tells us about the relationship between
entries of tensor products of two matrices and the entries of matrices›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> matrix_Tensor_elements<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M1</span> <span class="free">M2</span>
<span class="keyword2"><span class="keyword">shows</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
            <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> 
                     <span class="free">f</span>  
                        <span class="main">(</span><span class="free">M1</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M1</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> False"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>
                 <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span> 
                                                 <span class="main">⟶</span> False"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span> <span class="main">[]</span><span class="main">)</span>
           <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span> 
               <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> 
                           <span class="free">f</span>  
                             <span class="main">(</span><span class="main">[]</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">[]</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">M</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span> <span class="main">=</span> <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>Tensor <span class="skolem">M</span> <span class="free">M2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> append_simpl vec_mat_Tensor_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">a</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">a</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> step0<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
               <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="skolem">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>Tensor <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>  
                     <span class="main">=</span> <span class="free">f</span> 
                         <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 2 1  calculation<span class="main">(</span>1<span class="main">)</span> vec_mat_Tensor_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span> 
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span>  <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
                 <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>Tensor <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>
                   <span class="free">f</span> 
                     <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> row_length_def  step0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor_length add.commute append_simpl2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="skolem">M</span><span class="main">)</span>
                 <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
               <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
              <span class="main">=</span> <span class="free">f</span> 
                 <span class="main">(</span><span class="skolem">M</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">⟶</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> reduct_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
         <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
              <span class="main">=</span> <span class="free">f</span> 
                <span class="main">(</span><span class="skolem">M</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 4 calculation<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">⟶</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">⟶</span> 
               <span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟶</span> 
          <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  add_diff_cancel_left' div_add_self1 div_by_0 
                 le_imp_diff_is_add add.commute zero_diff
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">⟶</span> 
          <span class="skolem">M</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="skolem">M</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> step2<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
      <span class="main">⟶</span>
       <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> 
                          <span class="free">f</span> 
                         <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">M2</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> row_length_def Nil mult_0_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> False"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">⟶</span> False"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">N</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">M</span><span class="main">!</span><span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="skolem">k</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span>   not_one_le_zero nth_Cons' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  div_le_mono div_self length_0_conv neq_Nil_conv  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">-</span> <span class="main">1</span>  <span class="main">≥</span> <span class="main">0</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">⟶</span> <span class="skolem">M</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">-</span> <span class="main">1</span> <span class="main">)</span> 
                                 <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>1<span class="main">)</span> not_one_le_zero nth_Cons' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this 7 <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">⟶</span>  <span class="skolem">M</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                   <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">⟶</span>  <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                   <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> mod_if not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">with</span></span> 5 9  <span class="keyword1"><span class="command">have</span></span> 
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> 
     <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
          <span class="main">=</span> <span class="free">f</span> 
              <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                 <span class="main">=</span> <span class="free">f</span> 
                    <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> 
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
            <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
            <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> 
                    <span class="free">f</span> 
                    <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> 3 Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                    <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> Nil 
      <span class="keyword1"><span class="command">have</span></span> Nil0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Nil1<span class="main">:</span>
             <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil nat_mult_1<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="skolem">v</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Nil2<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">=</span> <span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="skolem">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> Nil3<span class="main">:</span>
                 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Nil4<span class="main">:</span>
                 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Nil5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> vec_mat_Tensor <span class="skolem">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> Nil Tensor.simps<span class="main">(</span>2<span class="main">)</span> Tensor.simps<span class="main">(</span>1<span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> vec_mat_Tensor_elements <span class="keyword1"><span class="command">have</span></span> 
                      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="skolem">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                                    <span class="main">=</span> <span class="free">f</span> 
                                       <span class="main">(</span><span class="skolem">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                       <span class="main">(</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>
         <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                    <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Nil1 Nil2 Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                     <span class="main">=</span> <span class="free">f</span> 
                        <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Nil3 Nil4  Nil5 Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
             <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
             <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="free">f</span> 
                         <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">(</span><span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">u</span> <span class="skolem">P</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons row_length_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> this 11 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> this step1 step2 logic <span class="keyword1"><span class="command">have</span></span>  
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span><span class="main">(</span><span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>        
      <span class="main">⟶</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> 
                 <span class="main">=</span> <span class="free">f</span> 
                     <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span>  mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
   

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹we restate the theorem in two different forms for convenience 
of reuse›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> effective_matrix_tensor_elements<span class="main">:</span>
  <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">∧</span><span class="main">(</span><span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span>
  <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
 <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> 
   <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">M1</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
       <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> matrix_Tensor_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> effective_matrix_tensor_elements2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">" <span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> 
             <span class="main">(</span><span class="free">M1</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main"><span class="free">*</span></span> <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms matrix_Tensor_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹the following lemmas are useful in proving associativity of tensor
products›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> div_left_ineq<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">*</span><span class="free">z</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
 <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="keyword1">div</span> <span class="free">z</span> <span class="main">≥</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">z</span><span class="main">)</span><span class="main">*</span><span class="free">z</span> <span class="main">≥</span> <span class="free">y</span><span class="main">*</span><span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">z</span><span class="main">)</span><span class="main">*</span><span class="free">z</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> div_mult_mod_eq 
          add_leD1 assms minus_mod_eq_div_mult <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> le_diff_conv2 mod_less_eq_dividend not_less
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">z</span><span class="main">)</span><span class="main">*</span><span class="free">z</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≥</span> <span class="free">y</span><span class="main">*</span><span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="keyword1">div</span> <span class="free">z</span> <span class="main">≥</span> <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">z</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                
 <span class="keyword1"><span class="command">with</span></span> 6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≥</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 3 assms div_self less_nat_zero_code mult_zero_left 
          mult.commute mod_div_mult_eq
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> calculation  less_nat_zero_code <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_less<span class="main">)</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span><span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 7 8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> div_right_ineq<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">*</span><span class="free">z</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms div_left_ineq mult.commute   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the following theorem, we obtain columns of vec$\_$mat$\_$Tensor of 
a vector v and a matrix M in terms of the vector v and columns of the 
matrix M›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> col_vec_mat_Tensor_prelim<span class="main">:</span>
 <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span> 
     <span class="main">⟶</span>
      col <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="free">M</span><span class="main">)</span> <span class="bound">j</span> <span class="main">=</span> vec_vec_Tensor <span class="free">v</span> <span class="main">(</span>col <span class="free">M</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> col_def 
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">N</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> Cons_1<span class="main">:</span><span class="quoted"><span class="quoted">"vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> 
                        <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">w</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor.simps Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span>  <span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span>  
              <span class="keyword1"><span class="command">using</span></span> Cons_1 Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">k</span> <span class="main">&lt;</span> length <span class="skolem">N</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Suc  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Suc_conv not_less_eq<span class="main">)</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">N</span><span class="main">)</span> 
                  <span class="main">⟹</span> <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">N</span><span class="main">)</span><span class="main">!</span><span class="skolem">k</span> <span class="main">=</span>   vec_vec_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">N</span><span class="main">!</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Cons.hyps  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> col_vec_mat_Tensor<span class="main">:</span><span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">j</span> <span class="free">M</span> <span class="free">v</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"col <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="free">M</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span> vec_vec_Tensor <span class="free">v</span> <span class="main">(</span>col <span class="free">M</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> col_vec_mat_Tensor_prelim assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>  col_formula<span class="main">:</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M1</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M2</span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span>
         <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
         <span class="main">⟶</span> col <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="bound">j</span> 
                <span class="main">=</span>  vec_vec_Tensor 
                        <span class="main">(</span>col <span class="free">M1</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span>col <span class="free">M2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M1</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">M</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> 
       <span class="main">∧</span> mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> 
       <span class="main">∧</span> mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span> <span class="main">⟹</span>
       <span class="main">(</span>col <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span> 
                 <span class="main">=</span> vec_vec_Tensor 
                            <span class="main">(</span>col <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                            <span class="main">(</span>col <span class="free">M2</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> 
              <span class="main">∧</span> mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> 
              <span class="main">∧</span> mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="skolem">M</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reduct_matrix<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span> length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">+</span>  <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> 
                          <span class="main">⟹</span> <span class="skolem">j</span><span class="main">-</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> add_0_iff add_diff_inverse diff_is_0_eq 
                   less_diff_conv less_imp_le linorder_cases add.commute 
                   neq0_conv
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span> <span class="main">=</span> <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> Tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>col <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>col <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span> 
                   <span class="main">⟹</span> <span class="main">(</span>col <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>col <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">unfolding</span></span> col_def <span class="keyword1"><span class="command">using</span></span> append_simpl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">M2</span> <span class="main">⟹</span>
                        <span class="main">(</span>col <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>col <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">M2</span> <span class="main">⟹</span>  
                  <span class="main">(</span>col <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span> 
                                      <span class="main">=</span>  vec_vec_Tensor <span class="skolem">v</span> <span class="main">(</span>col <span class="free">M2</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> col_vec_mat_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
           <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span> length <span class="free">M2</span> <span class="main">⟹</span> 
                 <span class="main">(</span>col <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span> 
                            <span class="main">=</span>  vec_vec_Tensor 
                                            <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                            <span class="main">(</span>col <span class="free">M2</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> step_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">&lt;</span> length <span class="free">M2</span> <span class="main">⟹</span> 
                 <span class="main">(</span>col <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span> 
                             <span class="main">=</span>  vec_vec_Tensor 
                                             <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                             <span class="main">(</span>col <span class="free">M2</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> length <span class="free">M2</span> 
                  <span class="main">⟹</span> <span class="main">(</span>col <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">unfolding</span></span> col_def  <span class="keyword1"><span class="command">using</span></span> 3 append_simpl2 vec_mat_Tensor_length 
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span>
         <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> length <span class="free">M2</span> <span class="main">⟹</span> 
              col <span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span>length <span class="free">M2</span><span class="main">)</span> 
                     <span class="main">=</span> vec_vec_Tensor 
                                <span class="main">(</span>col <span class="skolem">M</span> <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span>length <span class="free">M2</span><span class="main">)</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">(</span>col <span class="free">M2</span> <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span> length <span class="free">M2</span><span class="main">)</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 1 0 2 Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span>
         <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> length <span class="free">M2</span> <span class="main">⟹</span> 
                 <span class="main">(</span><span class="skolem">j</span> <span class="main">-</span> length <span class="free">M2</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 2  div_0 div_self 
                   le_neq_implies_less less_nat_zero_code 
                   monoid_add_class.add.right_neutral mult_0 mult_cancel2 
                   add.commute nat_div neq0_conv div_add_self1 le_add_diff_inverse      
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
           <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> length <span class="free">M2</span> <span class="main">⟹</span> 
                    <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span> length <span class="free">M2</span><span class="main">)</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> le_mod_geq <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">with</span></span> 6  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span>
         <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> length <span class="free">M2</span> <span class="main">⟹</span> 
              col <span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span>length <span class="free">M2</span><span class="main">)</span> 
                     <span class="main">=</span> vec_vec_Tensor <span class="main">(</span>col <span class="skolem">M</span> <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span>length <span class="free">M2</span><span class="main">)</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">(</span>col <span class="free">M2</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>col <span class="skolem">M</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>col <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">unfolding</span></span> col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> length <span class="free">M2</span> <span class="main">⟹</span> 
              col <span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span><span class="main">-</span>length <span class="free">M2</span><span class="main">)</span> 
                     <span class="main">=</span> vec_vec_Tensor <span class="main">(</span>col <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">(</span>col <span class="free">M2</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword3"><span class="command">assume</span></span> temp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> length <span class="free">M2</span> "</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">j</span><span class="main">-</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>    
             <span class="keyword1"><span class="command">using</span></span> 2 temp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span><span class="main">-</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> div_right_ineq mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
     <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
                 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">&lt;</span><span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> 
                     <span class="main">⟶</span> <span class="main">(</span>col <span class="skolem">M</span> <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                          <span class="main">=</span> <span class="main">(</span>col <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">unfolding</span></span> col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> temp1<span class="main">:</span>
                      <span class="quoted"><span class="quoted">"<span class="main">(</span>col <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span>length <span class="free">M2</span><span class="main">)</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">=</span> <span class="main">(</span>col <span class="skolem">M</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span>length <span class="free">M2</span><span class="main">)</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>col <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">j</span><span class="main">-</span>length <span class="free">M2</span><span class="main">)</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> 
                                   <span class="main">=</span> <span class="main">(</span>col <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> 6 temp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> temp1 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> temp<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≥</span> length <span class="free">M2</span> <span class="main">⟹</span> 
              col <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">j</span> 
                     <span class="main">=</span> vec_vec_Tensor <span class="main">(</span>col <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">(</span>col <span class="free">M2</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> col_def 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
             <span class="keyword1"><span class="command">using</span></span> step_1  col_def le_refl nat_less_le nat_neq_iff
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> row_Cons<span class="main">:</span><span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">v</span><span class="main">#</span><span class="free">M</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>row <span class="free">M</span> <span class="free">i</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> row_def map_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> row_append<span class="main">:</span><span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">A</span><span class="main">@</span><span class="free">B</span><span class="main">)</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span>row <span class="free">A</span> <span class="free">i</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>row <span class="free">B</span> <span class="free">i</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> row_def map_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> row_empty<span class="main">:</span><span class="quoted"><span class="quoted">"row <span class="main">[]</span> <span class="free">i</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> vec_vec_Tensor_right_empty<span class="main">:</span><span class="quoted"><span class="quoted">"vec_vec_Tensor <span class="free">x</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor.simps times.simps  length_0_conv mult_0_right vec_vec_Tensor_length  
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="main">[]</span><span class="main">#</span><span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span> "</span></span>
 <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vec_vec_Tensor_right_empty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">0</span> <span class="main">⟶</span> <span class="main">[</span><span class="main">[]</span><span class="main">!</span><span class="free">i</span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> row_vec_mat_Tensor_prelim<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span>
     <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>mat <span class="free">nr</span> <span class="main">(</span>length <span class="free">M</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span> 
      <span class="main">⟶</span> row <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="free">M</span><span class="main">)</span> <span class="bound">i</span> 
            <span class="main">=</span> times <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> row_length <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>row <span class="free">M</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> row_length <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code mult_0_right row_length_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">N</span><span class="main">)</span> 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> 
                      <span class="main">=</span>  row <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">w</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> vec_mat_Tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">...</span>   <span class="main">=</span> <span class="main">(</span><span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">w</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>row <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">N</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> row_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">w</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="free">nr</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">nr</span> <span class="main">=</span> length <span class="skolem">w</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> hd_in_set list.distinct<span class="main">(</span>1<span class="main">)</span> mat_uniqueness matrix_row_length <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">∧</span> <span class="main">(</span>mat <span class="free">nr</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">⟹</span> row <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> 
                           <span class="main">=</span> times 
                                 <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">(</span>row <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">∧</span> <span class="main">(</span>mat <span class="free">nr</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>   
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>    
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">N</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">w</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 1 vec_mat_Tensor.simps  Nil row_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> Nil vec_vec_Tensor_right_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> Nil row_length_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">[</span><span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="main">[]</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> assms less_nat_zero_code <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
             <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor.simps row_empty Nil assms list.distinct<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">w1</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> assms row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">w</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span>  
                                       <span class="main">=</span> <span class="free">f</span> 
                                           <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                           <span class="main">(</span><span class="skolem">w</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor_elements 1 allI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>
                                <span class="main">=</span> times 
                                      <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                      <span class="main">(</span>row <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> Cons vec_mat_Tensor.simps row_def  row_length_def 2 Nil row_Cons 
                   row_empty times.simps<span class="main">(</span>1<span class="main">)</span> times.simps<span class="main">(</span>2<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> row_def 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w1</span> <span class="skolem">N1</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> Cons_0<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="skolem">N</span> <span class="main">=</span> length <span class="skolem">w1</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> Cons row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> assms Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_1<span class="main">:</span>
                     <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span>"</span></span> 
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_row_length<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_2<span class="main">:</span>
                     <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span>"</span></span> 
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reduct_matrix<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> Cons_1 
             <span class="keyword1"><span class="command">unfolding</span></span> mat_def row_length_def Ball_def vec_def 
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span> Cons_0 Cons_1 local.Cons row_length_eq<span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_4<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span>"</span></span>                
             <span class="keyword1"><span class="command">using</span></span> 3 Cons_2 assms hd_conv_nth list.distinct<span class="main">(</span>1<span class="main">)</span> nth_Cons_0 row_length_def
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w1</span><span class="main">#</span><span class="skolem">N1</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> assms Cons_3 row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_5<span class="main">:</span><span class="quoted"><span class="quoted">"row <span class="main">(</span>vec_mat_Tensor <span class="free">v</span> <span class="skolem">N</span><span class="main">)</span> <span class="skolem">i</span> 
                                  <span class="main">=</span> times 
                                      <span class="main">(</span><span class="free">v</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> 
                                      <span class="main">(</span>row <span class="skolem">N</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> Cons  Cons.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Nil vec_vec_Tensor_right_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Nil row_length_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">[</span><span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="main">[]</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor.simps row_empty Nil assms
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>               
       <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">w2</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> assms row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ConsCons_2<span class="main">:</span>
                     <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_vec_Tensor <span class="free">v</span> <span class="skolem">w</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> 
                                                 <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                                 <span class="main">(</span><span class="skolem">w</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor_elements 1 allI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
                      <span class="quoted"><span class="quoted">"times 
                              <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">(</span>row <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> <span class="main">(</span><span class="free">f</span> 
                                 <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">(</span><span class="skolem">w</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">#</span><span class="main">(</span>times <span class="main">(</span><span class="free">v</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="skolem">N</span><span class="main">)</span><span class="main">)</span> 
                                          <span class="main">(</span>row <span class="skolem">N</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
         <span class="keyword1"><span class="command">have</span></span> temp<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="skolem">N</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> row_length_def 2 Cons_3 Cons_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                       <span class="main">#</span><span class="main">(</span>row <span class="skolem">N</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                     <span class="keyword1"><span class="command">unfolding</span></span> row_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                     
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span>
                              <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                        <span class="main">#</span><span class="main">(</span>row <span class="skolem">N</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
                     <span class="keyword1"><span class="command">using</span></span> Cons_3 3 assms 2 neq_Nil_conv row_Cons row_empty 
                           row_length_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"times 
                           <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  
                           <span class="main">(</span><span class="main">(</span><span class="skolem">w</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">#</span><span class="main">(</span>row <span class="skolem">N</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">=</span> <span class="main">(</span><span class="free">f</span>  
                                     <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                     <span class="main">(</span><span class="skolem">w</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                         <span class="main">#</span><span class="main">(</span>times  <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                                      <span class="main">(</span>row <span class="skolem">N</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="free">f</span>  
                                       <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> 
                                       <span class="main">(</span><span class="skolem">w</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                         <span class="main">#</span><span class="main">(</span>times  <span class="main">(</span><span class="free">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>
                                                  <span class="main">(</span>row <span class="skolem">N</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="skolem">N</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>         
                     <span class="keyword1"><span class="command">using</span></span> 3 Cons_3 assms temp row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
                   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> times.simps 2 row_Cons temp <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
                 <span class="keyword1"><span class="command">qed</span></span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_5 ConsCons_2 1 
                                row_Cons vec_mat_Tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>         
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>             
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemma gives us a formula for the row of a tensor of 
two matrices›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  row_formula<span class="main">:</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M1</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M2</span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span>
          <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
             <span class="main">⟶</span> row <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="bound">i</span> 
                        <span class="main">=</span>  vec_vec_Tensor 
                                 <span class="main">(</span>row <span class="free">M1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">M1</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code mult_0 row_length_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">M</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>  
    <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
     <span class="main">⟹</span> row <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span>  vec_vec_Tensor 
                                    <span class="main">(</span>row <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                    <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span>
                 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="skolem">v</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> assms row_length_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="skolem">M</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> assms  reduct_matrix <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> row <span class="main">(</span><span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">i</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>row <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>row <span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> row_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>row <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> Nil 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span>  times 
                                                <span class="main">(</span><span class="skolem">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                                <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> row_vec_mat_Tensor_prelim assms 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor_def 
             Nil append_Nil2 vec_vec_Tensor.simps<span class="main">(</span>1<span class="main">)</span> 
             vec_vec_Tensor.simps<span class="main">(</span>2<span class="main">)</span> row_Cons row_empty  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
     <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">N</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> Cons_Cons_1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">M</span><span class="main">)</span> <span class="skolem">M</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> assms reduct_matrix <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">N</span><span class="main">)</span> <span class="main">=</span> row_length <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> assms Cons <span class="keyword1"><span class="command">unfolding</span></span> mat_def Ball_def vec_def  
                        <span class="keyword1"><span class="command">using</span></span> append_Cons  hd_in_set list.distinct<span class="main">(</span>1<span class="main">)</span> 
                        rotate1.simps<span class="main">(</span>2<span class="main">)</span> set_rotate1
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_Cons_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="skolem">M</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> assms Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_Cons_3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>row <span class="main">(</span><span class="skolem">M</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>  vec_vec_Tensor 
                                          <span class="main">(</span>row <span class="skolem">M</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                           <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> Cons.hyps Cons_Cons_1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span>vec_mat_Tensor <span class="skolem">v</span> <span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span>   
                                            <span class="main">=</span>  times 
                                               <span class="main">(</span><span class="skolem">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                               <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> row_vec_mat_Tensor_prelim assms 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">⊗</span><span class="free">M2</span><span class="main">)</span> <span class="skolem">i</span> <span class="main">=</span> 
                           <span class="main">(</span>times 
                                   <span class="main">(</span><span class="skolem">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                    <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                      <span class="main">@</span><span class="main">(</span>vec_vec_Tensor 
                                          <span class="main">(</span>row <span class="skolem">M</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                                           <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>   
                        <span class="keyword1"><span class="command">using</span></span> 2 Cons_Cons_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor 
                                        <span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
                                             <span class="main">#</span><span class="main">(</span>row <span class="skolem">M</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                        <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>vec_vec_Tensor <span class="main">(</span>row <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
                                           <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="skolem">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                        <span class="keyword1"><span class="command">using</span></span> row_Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span>  effective_row_formula<span class="main">:</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M1</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">M2</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"row <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="free">i</span> 
               <span class="main">=</span>  vec_vec_Tensor 
                       <span class="main">(</span>row <span class="free">M1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">(</span>row <span class="free">M2</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms row_formula <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> alt_effective_matrix_tensor_elements<span class="main">:</span>
 <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
 <span class="main">∧</span><span class="main">(</span><span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
 <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
 <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="free">M3</span><span class="main">)</span>
 <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
<span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> matrix_Tensor_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            

<span class="keyword1"><span class="command">lemma</span></span> trans_impl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">R</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">i</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">R</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">div</span> <span class="free">y</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">y</span><span class="main">*</span><span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> div_mult2_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> not_null<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> <span class="bound">y</span><span class="main">#</span><span class="bound">ys</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neq_Nil_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="keyword1">mod</span> <span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> mod_less_divisor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> mod_prop1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">c</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True mult_0_right<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">c</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">c</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="keyword1">mod</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">m</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="var">?x</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_mult_mod_eq<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">m1</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="var">?x</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="skolem">m1</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span><span class="main">(</span> <span class="var">?x</span> <span class="main">=</span> <span class="bound">m</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mod_div_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="var">?x</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="skolem">m1</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="var">?z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">-</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>›</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">m1</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="var">?z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">=</span> <span class="skolem">m1</span> <span class="main">*</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> 
        <span class="main">=</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">c</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
        ab_semigroup_mult_class.mult_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">m1</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="var">?z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_mult_distrib2 mult.commute<span class="main">)</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">n</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="var">?y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">*</span> <span class="free">c</span> <span class="main">+</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">c</span>›</span></span> mod_mult_self3<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="var">?y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m1</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="var">?z</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="var">?y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m1</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">*</span><span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">-</span> <span class="var">?z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m1</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">*</span><span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="var">?y</span> <span class="main">-</span> <span class="var">?z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_mult_distrib2 mult.commute<span class="main">)</span>     
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="var">?y</span> <span class="main">-</span> <span class="var">?z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_triv_right<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mod_less_divisor False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mod_less_divisor False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">-</span> <span class="var">?z</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> calculation<span class="main">(</span>2<span class="main">)</span> less_imp_diff_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">-</span> <span class="var">?z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_imp_mod_0 mod_less<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> mod_add_right_eq mod_mult_self2 add.commute mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mod_div_relation<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> T_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="free">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> T_1 False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
   <span class="keyword1"><span class="command">have</span></span> F_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">x</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> mod_div_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span>  div_add1_eq mod_add_self1 mod_add_self2 
       mod_by_0 mod_div_trivial mod_prop1 mod_self
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span>"</span></span>    
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_1 nonzero_mult_div_cancel_left mult.commute neq0_conv<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="bound">y</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute mod_div_mult_eq<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> F_2 <span class="keyword1"><span class="command">have</span></span> F_3<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_mult_distrib2 mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F_4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_eq_mod_eq_0 mod_mult_self1_is_0 mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> F_5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span>  <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_1 mod_less_divisor<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False mod_less_divisor neq0_conv<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_1 div_left_ineq nonzero_mult_div_cancel_right neq0_conv<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation div_right_ineq mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> F_4 F_5 
    <span class="keyword1"><span class="command">have</span></span> F_6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less_imp_diff_less nat_dvd_not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> F_3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> "</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> diff_mult_distrib2 mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F_7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_eq_mod_eq_0 mod_mult_self1_is_0  mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> F_8<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span>  <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_1 mod_less_divisor<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False mod_less_divisor neq0_conv<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_1 div_left_ineq  nonzero_mult_div_cancel_right neq0_conv<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation div_right_ineq  mult.commute<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> F_7 F_8 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_2 cancel_comm_monoid_add_class.diff_cancel mod_if mod_mult_self3<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> F_6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">div</span> <span class="free">c</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">b</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>         
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following lemma proves that the tensor product of matrices
is associative›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> associativity<span class="main">:</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">M3</span>
 <span class="keyword2"><span class="keyword">shows</span></span>
      <span class="quoted"><span class="quoted">" <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span> 
      <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="free">M3</span><span class="main">)</span>
        <span class="main">⟹</span>
           <span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">⟹</span><span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
 <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"  <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span> 
           <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
           <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="free">M3</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span> 
                    <span class="main">=</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Tensor<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">=</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult.assoc length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" length <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Tensor<span class="main">)</span>
   <span class="keyword1"><span class="command">ultimately</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mult.assoc length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span> 
                    <span class="main">=</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> row_length_mat assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">=</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> row_length_mat assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" row_length <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> 
                                   <span class="main">=</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">using</span></span> row_length_mat  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> row_length_mat assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 0 matrix_Tensor_elements 1 2 effective_well_defined_Tensor 
             length_Tensor row_length_mat
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>  
                          <span class="main">⟶</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>div_left_ineq<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">⟶</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> 
                                         <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>div_left_ineq<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⟶</span> 
                <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> allI 0  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span> 
           <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⟶</span>
       <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
          <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
               <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
             <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span>  effective_matrix_tensor_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
 <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⟶</span>  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
       <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
            <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
            <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                   <span class="main">(</span><span class="free">f</span> 
                     <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> div_mult2_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> div_mult2_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                   <span class="main">(</span><span class="free">f</span> 
       <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 6  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> <span class="quoted">"5"</span> div_mult2_eq<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                   <span class="main">(</span><span class="free">f</span> 
       <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute<span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span>  <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span><span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 0 matrix_Tensor_elements 1 2 effective_well_defined_Tensor 
             length_Tensor row_length_mat
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span><span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> length_Tensor row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span><span class="free">M3</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> mult.commute <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span>
       <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> length_Tensor True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  less_nat_zero_code<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span>  <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mod_less_divisor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span>  True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> row_length_mat<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span>  <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mod_less_divisor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">with</span></span> 8 <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">⟶</span> 
                <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">⟶</span> 
                <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                              <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span>
                <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length  <span class="free">M3</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> length_Tensor row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span> 
           <span class="main">∧</span> <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="free">M3</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                 <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span><span class="main">⊗</span><span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
       <span class="main">⟶</span>
       <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                  <span class="main">(</span><span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> matrix_Tensor_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span>
         <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="main">)</span>
             <span class="main">⟶</span> 
           <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">=</span> 
       <span class="free">f</span> 
       <span class="main">(</span><span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
            <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
           <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>   
           <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span>
                         <span class="main">=</span> <span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span>                  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">=</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span>
                                 <span class="main">=</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>   
            <span class="keyword1"><span class="command">using</span></span> mod_prop1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span>
                         <span class="main">=</span> <span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span>                  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                       <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span>
                                 <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>   
            <span class="keyword1"><span class="command">using</span></span> mod_prop1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span>
                            <span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span>
                            <span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="main">)</span>
                       <span class="main">⟶</span> 
                          <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                       <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span>  <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>   
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span>
                    <span class="main">=</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">=</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mod_div_relation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span>
                    <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">=</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mod_div_relation <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span>
                      <span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="main">)</span>
             <span class="main">⟶</span> 
                 <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="free">f</span> 
                          <span class="main">(</span><span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                           <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span>  <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>   
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">with</span></span> 7 <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length  <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="free">f</span> 
       <span class="main">(</span><span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span>  <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
           <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
                    <span class="keyword1"><span class="command">using</span></span> length_Tensor row_length_mat  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span> <span class="free">f</span> 
                    <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length  <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span><span class="free">f</span> 
                   <span class="main">(</span><span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span>  <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
           <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> 
                    <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length  <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>                  
                    <span class="main">(</span><span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span>  <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> 13 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> 
                <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> 
                    <span class="main">(</span><span class="main">(</span><span class="free">M1</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length  <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>                  
                    <span class="main">(</span><span class="main">(</span><span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">!</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span><span class="free">M3</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span>  <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> step1 <span class="keyword1"><span class="command">have</span></span> step2<span class="main">:</span> 
       <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∧</span><span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⟶</span> 
            <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span><span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 0 effective_well_defined_Tensor  row_length_mat length_Tensor 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span><span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  0 effective_well_defined_Tensor row_length_mat length_Tensor 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> row_length_mat length_Tensor mult.assoc 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_Tensor row_length_mat  semigroup_mult_class.mult.assoc<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span><span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 0 effective_well_defined_Tensor row_length_mat length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span><span class="main">(</span>length <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M3</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span> <span class="main">)</span><span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>  0 effective_well_defined_Tensor  row_length_mat length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> row_length_mat length_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc<span class="main">)</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mat_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>     
  
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="bound">b</span><span class="main">.</span><span class="main">(</span>times  <span class="bound">a</span>  <span class="bound">b</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span>times  <span class="bound">b</span>  <span class="bound">a</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Associativity and Distributive properties›</span></span>

<span class="keyword1"><span class="command">locale</span></span> plus_mult <span class="main">=</span> 
 mult <span class="main">+</span> 
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">zer</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span><span class="main">::</span><span class="quoted"><span class="quoted">" <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> "</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 60<span class="main">)</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">inver</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span>  <span class="tfree">'a</span>"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> plus_comm<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">g</span> <span class="free">a</span>  <span class="free">b</span> <span class="main">=</span> <span class="free">g</span> <span class="free">b</span> <span class="free">a</span> "</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> plus_assoc<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">g</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="free">a</span> <span class="main">(</span><span class="free">g</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> plus_left_id<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="free">g</span> <span class="free">zer</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> plus_right_id<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="free">zer</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> plus_left_distributivity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">g</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="free">c</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> plus_right_distributivity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> plus_left_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="free">x</span> <span class="main">(</span><span class="free">inver</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> plus_right_inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">inver</span> <span class="free">x</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
 

<span class="keyword1"><span class="command">context</span></span> plus_mult
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">M3</span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span><span class="main">)</span> 
            <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span><span class="main">)</span>
            <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free">M3</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M3</span><span class="main">)</span> <span class="free">M3</span><span class="main">)</span>
             <span class="main">⟹</span> <span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">M2</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span> <span class="main">⊗</span> <span class="free">M3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> associativity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹matrix$\_$mult refers to multiplication of matrices in the locale 
plus\_mult›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">matrix_mult</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">∘</span>"</span> 65<span class="main">)</span>
 <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">matrix_mult</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span> <span class="main">≡</span> <span class="main">(</span>mat_multI <span class="free">zer</span> <span class="free">g</span> <span class="free">f</span> <span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">M1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">M1</span></span></span> <span class="free"><span class="bound"><span class="entity">M2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">scalar_product</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span> vec <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">scalar_product</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> scalar_prodI <span class="free">zer</span> <span class="free">g</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ma <span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">n</span> <span class="free">m1</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat_multI <span class="free">zer</span> <span class="free">g</span> <span class="free">f</span> <span class="free">nr</span> <span class="free">m1</span> <span class="free">m2</span> <span class="main">!</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span> 
                  <span class="main">=</span> scalar_prodI <span class="free">zer</span> <span class="free">g</span> <span class="free">f</span> <span class="main">(</span>row <span class="free">m1</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>col <span class="free">m2</span> <span class="free">j</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> mat_mult_index i j wf1 wf2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">m1</span><span class="main">)</span> <span class="free">n</span> <span class="free">m1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">m1</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"matrix_mult  <span class="free">m1</span> <span class="free">m2</span> <span class="main">!</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span> 
                 <span class="main">=</span> scalar_product  <span class="main">(</span>row <span class="free">m1</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>col <span class="free">m2</span> <span class="free">j</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> wf1 wf2 i j ma scalar_product_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> unique_row_col<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr1</span> <span class="free">nc1</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr2</span> <span class="free">nc2</span> <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">nr1</span> <span class="main">=</span> <span class="free">nr2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">nc1</span> <span class="main">=</span> <span class="free">nc2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">nr1</span> <span class="main">=</span> <span class="free">nr2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">M</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">v</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">v</span> <span class="main">=</span> <span class="free">nr1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> mat_def Ball_def vec_def  Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">v</span> <span class="main">=</span> <span class="free">nr2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>2<span class="main">)</span> mat_def Ball_def vec_def  Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">nr1</span> <span class="main">=</span> <span class="free">nr2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">M</span> <span class="main">=</span> <span class="free">nc1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mat_def assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">M</span> <span class="main">=</span> <span class="free">nc2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mat_def assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">nc1</span> <span class="main">=</span> <span class="free">nc2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_mult_index<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">n</span> <span class="free">m1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">nc</span> <span class="free">m2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">nr</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">nc</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"matrix_mult  <span class="free">m1</span> <span class="free">m2</span> <span class="main">!</span> <span class="free">j</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> scalar_product  <span class="main">(</span>row <span class="free">m1</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>col <span class="free">m2</span> <span class="free">j</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> matrix_index unique_row_col assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_row_length<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹the following definition checks if the given four matrices
 are such that the compositions in the mixed-product property which
 will be proved, hold true. It further checks that the matrices are 
 non empty and valid›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix_match</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span><span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat  <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matrix_match</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="free"><span class="bound"><span class="entity">A2</span></span></span> <span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="free"><span class="bound"><span class="entity">B2</span></span></span> <span class="main">≡</span> 
    <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span>
   <span class="main">∧</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="main">=</span> row_length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span>
   <span class="main">∧</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="main">=</span> row_length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A2</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B2</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> non_empty_mat_mult<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">n</span> <span class="free">A</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="free">n</span> <span class="free">nc</span> <span class="free">B</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="free">B</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∘</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">(</span><span class="free">A</span> <span class="main">∘</span> <span class="free">B</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> mat_mult  assms<span class="main">(</span>3<span class="main">)</span> matrix_row_length unique_row_col<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">A</span> <span class="main">∘</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="free">nc</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nc</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">B</span> <span class="main">=</span> <span class="free">nc</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> mat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">A</span> <span class="main">∘</span> <span class="free">B</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>  
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tensor_compose_distribution1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A1</span><span class="main">)</span> <span class="free">A1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span> <span class="free">A2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B1</span><span class="main">)</span> <span class="free">B1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wf4<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="free">B2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> matchAA<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">A1</span> <span class="main">=</span> row_length <span class="free">A2</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> matchBB<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">B1</span> <span class="main">=</span> row_length <span class="free">B2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> non_Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">A2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span> <span class="main">(</span>matrix_mult <span class="free">A1</span> <span class="free">A2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> wf1 wf2  mat_mult matchAA  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>matrix_mult <span class="free">A1</span> <span class="free">A2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_row_length<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span> <span class="main">=</span> length <span class="free">A2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> non_empty_mat_mult unique_row_col 0  
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv mat_empty_column_length non_Nil<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0"</span> <span class="quoted">"1"</span> mat_empty_column_length unique_row_col<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="main">(</span>matrix_mult <span class="free">B1</span> <span class="free">B2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> wf3 wf4 matchBB mat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>matrix_mult <span class="free">B1</span> <span class="free">B2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_row_length<span class="main">)</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row_length <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span> <span class="main">=</span> length <span class="free">B2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> non_empty_mat_mult unique_row_col 3
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> length_0_conv mat_empty_column_length non_Nil<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> <span class="quoted">"4"</span> mat_empty_column_length unique_row_col<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> 1 4 5 well_defined_Tensor 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span> calculation<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>     

<span class="keyword1"><span class="command">lemma</span></span> effective_tensor_compose_distribution1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> <span class="main">⟹</span> mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tensor_compose_distribution1 <span class="keyword1"><span class="command">unfolding</span></span> matrix_match_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> tensor_compose_distribution2<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A1</span><span class="main">)</span> <span class="free">A1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span> <span class="free">A2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B1</span><span class="main">)</span> <span class="free">B1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wf4<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="free">B2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> matchAA<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">A1</span> <span class="main">=</span> row_length <span class="free">A2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> matchBB<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">B1</span> <span class="main">=</span> row_length <span class="free">B2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> non_Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">A2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
           <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span>  
           <span class="main">(</span><span class="main">(</span>length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
             <span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> wf1 wf3 well_defined_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat 
                   <span class="main">(</span><span class="main">(</span>row_length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B2</span><span class="main">)</span><span class="main">)</span>  
                   <span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">(</span><span class="free">A2</span><span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> wf2 wf4 well_defined_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">=</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> matchAA matchBB <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> mat_mult row_length_mat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">theorem</span></span> tensor_non_empty<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊗</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span>  assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> length_0_conv length_Tensor mult_is_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">theorem</span></span> non_empty_distribution<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr1</span> <span class="free">n1</span> <span class="free">A1</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">n1</span> <span class="free">nc1</span> <span class="free">A2</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr2</span> <span class="free">n2</span> <span class="free">B1</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">n2</span> <span class="free">nc2</span> <span class="free">B2</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A2</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B2</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms  non_empty_mat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms  non_empty_mat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> tensor_non_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> effective_tensor_compose_distribution2<span class="main">:</span><span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> <span class="main">⟹</span> 
   mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span> <span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tensor_compose_distribution2 <span class="keyword1"><span class="command">unfolding</span></span> matrix_match_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> effective_matrix_Tensor_elements<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M1</span> <span class="free">M2</span> <span class="free">i</span> <span class="free">j</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">M1</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
<span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> matrix_Tensor_elements assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> effective_matrix_Tensor_elements2<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M1</span> <span class="free">M2</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M1</span><span class="main">)</span> <span class="free">M1</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span> <span class="free">M2</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
    <span class="main">∀</span><span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="free">M1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span>
       <span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="free">M1</span> <span class="main">⊗</span> <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">M1</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">(</span><span class="free">M2</span><span class="main">!</span><span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">M2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">M2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> matrix_Tensor_elements assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matrix_compose_cond</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span><span class="tfree">'a</span> mat <span class="main">⇒</span> <span class="tfree">'a</span> mat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matrix_compose_cond</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="free"><span class="bound"><span class="entity">A2</span></span></span> <span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="free"><span class="bound"><span class="entity">B2</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> 
     <span class="main">(</span>mat <span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span>
      <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span>
    <span class="main">∧</span><span class="main">(</span>mat <span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span>

   <span class="main">∧</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="main">=</span> row_length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span>
   <span class="main">∧</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="main">=</span> row_length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span>
   <span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A2</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B1</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B2</span></span></span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> 
<span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">A1</span></span></span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free"><span class="bound"><span class="entity">B1</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">&lt;</span> <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">A2</span></span></span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">B2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">theorem</span></span> elements_matrix_distribution_1<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A1</span><span class="main">)</span> <span class="free">A1</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span> <span class="free">A2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B1</span><span class="main">)</span> <span class="free">B1</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> wf4<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="free">B2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> matchAA<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">A1</span> <span class="main">=</span> row_length <span class="free">A2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> matchBB<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">B1</span> <span class="main">=</span> row_length <span class="free">B2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> non_Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">A2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>matrix_mult <span class="free">A1</span>  <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>matrix_mult <span class="free">B1</span>  <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span>
  <span class="main">=</span>  <span class="free">f</span> <span class="main">(</span>scalar_product <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span>scalar_product <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>matrix_mult <span class="free">A1</span>  <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>matrix_mult <span class="free">B1</span>  <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> non_empty_distribution assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> tensor_compose_distribution1 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length  <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span>length  <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> matrix_row_length<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">=</span> <span class="main">(</span>row_length  <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length  <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 0 1 unique_row_col 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
       <span class="keyword1"><span class="command">using</span></span> 0 1 2 unique_row_col <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>  
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length  <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">=</span> <span class="main">(</span><span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>length  <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 3 <span class="quoted"><span class="quoted">‹length <span class="free">A2</span> <span class="main">*</span> length <span class="free">B2</span> <span class="main">=</span> length <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span> <span class="main">⊗</span> <span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span>›</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span> <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms mat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span>  matrix_row_length  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="free">A1</span> <span class="main">=</span> row_length <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"0"</span> Tensor.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> unique_row_col<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">with</span></span> 4 5 <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">A2</span> <span class="main">=</span> length <span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span>"</span></span>  
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  mat_empty_column_length unique_row_col<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>           
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms mat_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span>  matrix_row_length  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">with</span></span> 7 8 <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span><span class="quoted"><span class="quoted">"row_length <span class="free">B1</span> <span class="main">=</span> row_length <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span> <span class="quoted">"6"</span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> less_nat_zero_code mult_cancel2 mult_is_0 mult.commute row_length_mat<span class="main">)</span>
 <span class="keyword1"><span class="command">with</span></span> 7 8 9  <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">B2</span> <span class="main">=</span> length <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span>"</span></span>  
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  mat_empty_column_length unique_row_col<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>                    
 <span class="keyword1"><span class="command">from</span></span> 6 10 <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span>
               <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length  <span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">i</span> <span class="main">&lt;</span> <span class="main">(</span>row_length  <span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">from</span></span> 7 11 <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span>   
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                         <span class="main">=</span> <span class="main">(</span><span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>length  <span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">j</span> <span class="main">&lt;</span> <span class="main">(</span>length  <span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> step_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span>
            <span class="main">=</span>  <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 5 9 13 15 effective_matrix_Tensor_elements <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span>
            <span class="main">=</span>  <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="free">B2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 10 11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span>scalar_product <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span>col <span class="free">A2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> div_left_ineq assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms div_left_ineq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>length <span class="free">A1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span> <span class="free">A2</span>"</span></span>
                             <span class="keyword1"><span class="command">using</span></span> wf2 matchAA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   <span class="keyword1"><span class="command">using</span></span> wf1  non_Nil matrix_mult_index  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
               <span class="main">=</span> <span class="main">(</span>scalar_product 
                                 <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> 
                                 <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation less_nat_zero_code mod_less_divisor mult_is_0 neq0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> less_nat_zero_code mod_less_divisor mult_is_0 neq0_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="main">(</span>length <span class="free">B1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="free">B2</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> wf4 matchBB <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
                   <span class="keyword1"><span class="command">using</span></span> wf3 non_Nil matrix_mult_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> effective_elements_matrix_distribution1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"matrix_compose_cond <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span>
 <span class="main">(</span><span class="main">(</span>matrix_mult <span class="free">A1</span>  <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>matrix_mult <span class="free">B1</span>  <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span>
  <span class="main">=</span>  <span class="free">f</span> <span class="main">(</span>scalar_product <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span>scalar_product <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  elements_matrix_distribution_1 matrix_compose_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      

<span class="keyword1"><span class="command">lemma</span></span> matrix_match_condn_1<span class="main">:</span>
<span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> 
      <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∧</span><span class="main">(</span><span class="free">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">⟹</span>  <span class="main">(</span><span class="main">(</span>matrix_mult <span class="free">A1</span>  <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span>matrix_mult <span class="free">B1</span>  <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span>
  <span class="main">=</span>  <span class="free">f</span>
       <span class="main">(</span>scalar_product 
                 <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">(</span>scalar_product 
                 <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> elements_matrix_distribution_1 <span class="keyword1"><span class="command">unfolding</span></span> matrix_match_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> effective_matrix_match_condn_1<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span><span class="main">)</span> "</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span>
             <span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span>
              <span class="main">⟶</span>   <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∘</span>  <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span>
                        <span class="main">=</span>  <span class="free">f</span> 
                            <span class="main">(</span>scalar_product 
                                  <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span>scalar_product 
                                  <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> assms matrix_match_condn_1 <span class="keyword1"><span class="command">unfolding</span></span> matrix_match_def 
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">theorem</span></span> elements_matrix_distribution2<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> <span class="free">i</span> <span class="free">j</span>
<span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A1</span><span class="main">)</span> <span class="free">A1</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span> <span class="free">A2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B1</span><span class="main">)</span> <span class="free">B1</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> wf4<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="free">B2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> matchAA<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">A1</span> <span class="main">=</span> row_length <span class="free">A2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> matchBB<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">B1</span> <span class="main">=</span> row_length <span class="free">B2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> non_Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">A2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>    
         <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span>
  <span class="main">=</span>  scalar_product 
          <span class="main">(</span>vec_vec_Tensor 
                    <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>vec_vec_Tensor 
                    <span class="main">(</span>col <span class="free">A2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"mat 
              <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">(</span><span class="main">(</span>length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
                                   <span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> wf1 wf3 well_defined_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"mat 
                   <span class="main">(</span><span class="main">(</span>row_length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                   <span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                                   <span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> wf2 wf4 well_defined_Tensor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">=</span> <span class="main">(</span><span class="main">(</span>row_length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> matchAA matchBB <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">⊗</span><span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span><span class="main">⊗</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span> 
                        <span class="main">=</span> scalar_product <span class="main">(</span>row <span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span>col <span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span> <span class="free">j</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> i j matrix_mult_index non_Nil mat_mult_index 
                    row_length_mat scalar_product_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>row <span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span> <span class="free">i</span><span class="main">)</span>
                  <span class="main">=</span>  vec_vec_Tensor 
                           <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span>  wf1 wf3 i effective_row_formula <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" col <span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span> <span class="free">j</span> <span class="main">=</span>  vec_vec_Tensor <span class="main">(</span>col <span class="free">A2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> wf2 wf4 j col_formula <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> matrix_match_condn_2<span class="main">:</span>
<span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> 
 <span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span>
 <span class="main">∧</span><span class="main">(</span><span class="free">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span><span class="main">!</span><span class="free">i</span>
          <span class="main">=</span>  scalar_product 
                <span class="main">(</span>vec_vec_Tensor 
                        <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span>vec_vec_Tensor 
                        <span class="main">(</span>col <span class="free">A2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                        <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> elements_matrix_distribution2 <span class="keyword1"><span class="command">unfolding</span></span> matrix_match_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> effective_matrix_match_condn_2<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span><span class="main">)</span> "</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span>
           <span class="main">=</span>  scalar_product 
                  <span class="main">(</span>vec_vec_Tensor 
                           <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                  <span class="main">(</span>vec_vec_Tensor 
                           <span class="main">(</span>col <span class="free">A2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> assms matrix_match_condn_2 <span class="keyword1"><span class="command">unfolding</span></span> matrix_match_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> zip_Nil<span class="main">:</span><span class="quoted"><span class="quoted">"zip <span class="main">[]</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> zip_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> zer_left_mult<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">zer</span> <span class="free">x</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">zer</span> <span class="free">zer</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> plus_left_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">zer</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="free">zer</span> <span class="free">zer</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">zer</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">zer</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="free">f</span> <span class="free">zer</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  plus_right_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="free">zer</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="free">inver</span> <span class="main">(</span><span class="free">f</span> <span class="free">zer</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">zer</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="free">f</span> <span class="free">zer</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="free">inver</span> <span class="main">(</span><span class="free">f</span> <span class="free">zer</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">zer</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="free">zer</span> <span class="free">x</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="free">zer</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> plus_left_inverse  plus_assoc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> plus_right_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zip_Cons<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">v</span> <span class="main">=</span> length <span class="free">w</span><span class="main">)</span> <span class="main">⟹</span> zip <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">#</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>zip <span class="free">v</span> <span class="free">w</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> zip_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> scalar_product_times<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w1</span> <span class="bound">w2</span><span class="main">.</span><span class="main">(</span>length <span class="bound">w1</span> <span class="main">=</span> length <span class="bound">w2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="bound">w1</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟶</span> 
           <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>scalar_product <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span><span class="main">)</span> 
                      <span class="main">=</span> <span class="main">(</span>scalar_product 
                               <span class="main">(</span>times <span class="free">x</span> <span class="bound">w1</span><span class="main">)</span> 
                               <span class="main">(</span>times <span class="free">y</span> <span class="bound">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>  <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">" <span class="skolem">w1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">w2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
                                   <span class="main">⟶</span> scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> 
                                   <span class="main">⟶</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> comm zer_left_mult  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"times <span class="free">x</span> <span class="skolem">w1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"times <span class="free">y</span> <span class="skolem">w2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="main">(</span>times <span class="free">x</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span> times <span class="free">y</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>  <span class="main">⟹</span> <span class="var">?case</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a1</span> <span class="bound">u1</span><span class="main">.</span><span class="main">(</span><span class="skolem">w1</span> <span class="main">=</span> <span class="bound">a1</span><span class="main">#</span><span class="bound">u1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="bound">u1</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Suc_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w1</span> <span class="main">=</span> <span class="skolem">a1</span><span class="main">#</span><span class="skolem">u1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">u1</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w1</span> <span class="main">=</span> <span class="skolem">a1</span><span class="main">#</span><span class="skolem">u1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">u1</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">w2</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a2</span> <span class="bound">u2</span><span class="main">.</span><span class="main">(</span><span class="skolem">w2</span> <span class="main">=</span> <span class="bound">a2</span><span class="main">#</span><span class="bound">u2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="bound">u2</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_Suc_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w2</span> <span class="main">=</span> <span class="skolem">a2</span><span class="main">#</span><span class="skolem">u2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">u2</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w2</span> <span class="main">=</span> <span class="skolem">a2</span><span class="main">#</span><span class="skolem">u2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">u2</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">u1</span> <span class="main">=</span> length <span class="skolem">u2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">u1</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">*</span></span> <span class="free">y</span> <span class="main"><span class="free">*</span></span> scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span> 
                        <span class="main">=</span> scalar_product <span class="main">(</span>times <span class="free">x</span> <span class="skolem">u1</span><span class="main">)</span> <span class="main">(</span>times <span class="free">y</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scalar_product <span class="main">(</span><span class="skolem">a1</span><span class="main">#</span><span class="skolem">u1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a2</span><span class="main">#</span><span class="skolem">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a1</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def zip_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a1</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons_1 Cons_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="free">y</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="free">y</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span><span class="skolem">a1</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="free">y</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> plus_right_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> plus_left_distributivity<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="free">y</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="skolem">a1</span><span class="main"><span class="free">*</span></span><span class="free">y</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span><span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="free">y</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span> comm assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>times <span class="free">x</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="skolem">a1</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>times <span class="free">x</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> times.simps Cons_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>times <span class="free">y</span> <span class="skolem">w2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>times <span class="free">y</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> times.simps Cons_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_5<span class="main">:</span><span class="quoted"><span class="quoted">"scalar_product <span class="main">(</span>times <span class="free">x</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>times <span class="free">y</span> <span class="skolem">w2</span><span class="main">)</span> 
                            <span class="main">=</span> scalar_product 
                                  <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="skolem">a1</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>times <span class="free">x</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">)</span> 
                                  <span class="main">(</span><span class="main">(</span><span class="free">y</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>times <span class="free">y</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="skolem">a1</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span><span class="free">y</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main"><span class="free">+</span></span> scalar_product <span class="main">(</span>times <span class="free">x</span> <span class="skolem">u1</span><span class="main">)</span> <span class="main">(</span>times <span class="free">y</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def zip_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Cons_3 Cons_4 Cons_5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> effective_scalar_product_times<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">w1</span> <span class="main">=</span> length <span class="free">w2</span><span class="main">)</span>"</span></span>  
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="free">*</span></span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>scalar_product <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span> 
                       <span class="main">=</span> <span class="main">(</span>scalar_product <span class="main">(</span>times <span class="free">x</span> <span class="free">w1</span><span class="main">)</span> <span class="main">(</span> times <span class="free">y</span> <span class="free">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> scalar_product_times assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 


<span class="keyword1"><span class="command">lemma</span></span> zip_append<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">zs</span> <span class="main">=</span> length <span class="free">ws</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span><span class="main">)</span> 
                       <span class="main">⟹</span> <span class="main">(</span>zip <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">zs</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span><span class="main">@</span><span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>zip <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>zip <span class="free">zs</span> <span class="free">ws</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> zip_append1 zip_append2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 


<span class="keyword1"><span class="command">lemma</span></span> scalar_product_append<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span> <span class="bound">ys</span> <span class="bound">zs</span> <span class="bound">ws</span><span class="main">.</span><span class="main">(</span>length <span class="bound">zs</span> <span class="main">=</span> length <span class="bound">ws</span><span class="main">)</span>
               <span class="main">∧</span><span class="main">(</span>length <span class="bound">xs</span> <span class="main">=</span> length <span class="bound">ys</span><span class="main">)</span> 
               <span class="main">∧</span><span class="main">(</span>length <span class="bound">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span>  <span class="main">⟶</span> 
                     <span class="main">(</span>scalar_product <span class="main">(</span><span class="bound">xs</span><span class="main">@</span><span class="bound">zs</span><span class="main">)</span> <span class="main">(</span><span class="bound">ys</span><span class="main">@</span><span class="bound">ws</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">=</span> <span class="main">(</span>scalar_product <span class="bound">xs</span> <span class="bound">ys</span><span class="main">)</span>
                                         <span class="main"><span class="free">+</span></span><span class="main">(</span>scalar_product <span class="bound">zs</span> <span class="bound">ws</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">zs</span> <span class="main">=</span> length <span class="skolem">ws</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span>length <span class="skolem">xs</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">⟹</span>
           <span class="main">(</span>scalar_product <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">=</span> <span class="main">(</span>scalar_product <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span>
                                          <span class="main"><span class="free">+</span></span><span class="main">(</span>scalar_product <span class="skolem">zs</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">zs</span> <span class="main">=</span> length <span class="skolem">ws</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span><span class="main">)</span>
                                        <span class="main">∧</span><span class="main">(</span>length <span class="skolem">xs</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scalar_product <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def zip_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span><span class="main"><span class="free">+</span></span><span class="main">(</span>scalar_product <span class="skolem">zs</span> <span class="skolem">ws</span><span class="main">)</span> 
                                       <span class="main">=</span> <span class="main">(</span>scalar_product <span class="skolem">zs</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> plus_left_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>scalar_product <span class="skolem">zs</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">zs</span> <span class="main">=</span> length <span class="skolem">ws</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">xs</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>  <span class="main">⟹</span>
        <span class="main">(</span>scalar_product <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ys</span><span class="main">@</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">=</span> <span class="main">(</span>scalar_product <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span>
                                      <span class="main"><span class="free">+</span></span><span class="main">(</span>scalar_product <span class="skolem">zs</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
   <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="skolem">zs</span> <span class="main">=</span> length <span class="skolem">ws</span><span class="main">)</span>
                   <span class="main">∧</span><span class="main">(</span>length <span class="skolem">xs</span> <span class="main">=</span> length <span class="skolem">ys</span><span class="main">)</span>
                   <span class="main">∧</span><span class="main">(</span>length <span class="skolem">xs</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">xss</span><span class="main">.</span><span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="bound">x</span><span class="main">#</span><span class="bound">xss</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="bound">xss</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_length_conv<span class="main">)</span>         
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">xss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">#</span><span class="skolem">xss</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">xss</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">#</span><span class="skolem">xss</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">xss</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="bound">yss</span><span class="main">.</span><span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="bound">y</span><span class="main">#</span><span class="bound">yss</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="bound">yss</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_length_conv<span class="main">)</span>         
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">yss</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">#</span><span class="skolem">yss</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">yss</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ys</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">#</span><span class="skolem">yss</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">yss</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
   <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">xss</span> <span class="main">=</span> length <span class="skolem">yss</span> <span class="main">∧</span> length <span class="skolem">xss</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="main">(</span><span class="skolem">xss</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">yss</span><span class="main">@</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">=</span> <span class="main">(</span>scalar_product <span class="skolem">xss</span> <span class="skolem">yss</span><span class="main">)</span>
                                    <span class="main"><span class="free">+</span></span><span class="main">(</span>scalar_product <span class="skolem">zs</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span> 
       <span class="keyword1"><span class="command">using</span></span> 1 2 assms Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xss</span><span class="main">)</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">yss</span><span class="main">)</span><span class="main">@</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                        <span class="main">(</span>scalar_product <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="main">(</span><span class="skolem">xss</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="main">(</span><span class="skolem">yss</span><span class="main">@</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="free">*</span></span><span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="main">(</span><span class="skolem">xss</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">yss</span><span class="main">@</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def 
       <span class="keyword1"><span class="command">using</span></span> zip_Cons  scalar_prodI_def scalar_prod_cons 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ys</span><span class="main">)</span><span class="main">@</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">=</span>  <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="free">*</span></span><span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="main">(</span><span class="skolem">xss</span><span class="main">@</span><span class="skolem">zs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">yss</span><span class="main">@</span><span class="skolem">ws</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> 1 2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="free">*</span></span><span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="skolem">xss</span> <span class="skolem">yss</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def 
       <span class="keyword1"><span class="command">using</span></span> zip_Cons
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> <span class="quoted">"2"</span> scalar_prodI_def scalar_prod_cons<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span><span class="main"><span class="free">+</span></span><span class="main">(</span>scalar_product <span class="skolem">zs</span> <span class="skolem">ws</span><span class="main">)</span>
                               <span class="main">=</span>  <span class="main">(</span><span class="skolem">x</span><span class="main"><span class="free">*</span></span><span class="skolem">y</span><span class="main">)</span> 
                                       <span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="skolem">xss</span> <span class="skolem">yss</span><span class="main">)</span> 
                                       <span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="skolem">zs</span> <span class="skolem">ws</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 plus_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> effective_scalar_product_append<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">zs</span> <span class="main">=</span> length <span class="free">ws</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span><span class="main">)</span>"</span></span>   
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">zs</span><span class="main">)</span> <span class="main">(</span><span class="free">ys</span><span class="main">@</span><span class="free">ws</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>scalar_product <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main"><span class="free">+</span></span><span class="main">(</span>scalar_product <span class="free">zs</span> <span class="free">ws</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> scalar_product_append assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> scalar_product_distributivity<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v1</span> <span class="bound">v2</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">.</span><span class="main">(</span><span class="main">(</span>length <span class="bound">v1</span> <span class="main">=</span> length <span class="bound">v2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="bound">v1</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>length <span class="bound">w1</span> <span class="main">=</span> length <span class="bound">w2</span><span class="main">)</span>
           <span class="main">⟶</span>  <span class="main">(</span>scalar_product <span class="bound">v1</span> <span class="bound">v2</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="bound">w1</span> <span class="bound">w2</span><span class="main">)</span>
      <span class="main">=</span> scalar_product <span class="main">(</span>vec_vec_Tensor <span class="bound">v1</span> <span class="bound">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="bound">v2</span> <span class="bound">w2</span><span class="main">)</span><span class="main">)</span> "</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⟶</span>length <span class="skolem">v1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span>
                 <span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                 <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">⟶</span><span class="skolem">v1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span>
                   <span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                   <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⟶</span>length <span class="skolem">v2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span>
                          <span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                          <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">⟶</span><span class="skolem">v2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⟶</span>scalar_product <span class="skolem">v1</span> <span class="skolem">v2</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def <span class="keyword1"><span class="command">using</span></span> zip_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">zer</span> <span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span> <span class="main">=</span> <span class="free">zer</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> zer_left_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⟶</span>vec_vec_Tensor <span class="skolem">v1</span> <span class="skolem">w1</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span>
                   <span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                   <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">⟶</span>vec_vec_Tensor <span class="skolem">v2</span> <span class="skolem">w2</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span>
                      <span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
                      <span class="main">∧</span><span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">⟶</span> scalar_product 
                                 <span class="main">(</span>vec_vec_Tensor <span class="skolem">v1</span> <span class="skolem">w1</span><span class="main">)</span> 
                                 <span class="main">(</span>vec_vec_Tensor <span class="skolem">v2</span> <span class="skolem">w2</span><span class="main">)</span>  <span class="main">=</span> <span class="free">zer</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def <span class="keyword1"><span class="command">using</span></span> zip_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> 3 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> Suc <span class="skolem">k</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⟹</span>  <span class="free">f</span> <span class="main">(</span>scalar_product <span class="skolem">v1</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span>
      <span class="main">=</span> scalar_product <span class="main">(</span>vec_vec_Tensor <span class="skolem">v1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="skolem">v2</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> length <span class="skolem">v2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">v1</span> <span class="main">=</span> Suc <span class="skolem">k</span><span class="main">)</span>
                    <span class="main">∧</span> <span class="main">(</span>length <span class="skolem">w1</span> <span class="main">=</span> length <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">v1</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a1</span> <span class="bound">u1</span><span class="main">.</span><span class="main">(</span><span class="skolem">v1</span> <span class="main">=</span> <span class="bound">a1</span><span class="main">#</span><span class="bound">u1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="bound">u1</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms Suc_length_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span> <span class="main">=</span> <span class="skolem">a1</span><span class="main">#</span><span class="skolem">u1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">u1</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span> <span class="main">=</span> <span class="skolem">a1</span><span class="main">#</span><span class="skolem">u1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">u1</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">v2</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">a2</span> <span class="bound">u2</span><span class="main">.</span><span class="main">(</span><span class="skolem">v2</span> <span class="main">=</span> <span class="bound">a2</span><span class="main">#</span><span class="bound">u2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="bound">u2</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  Suc_length_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v2</span> <span class="main">=</span> <span class="skolem">a2</span><span class="main">#</span><span class="skolem">u2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">u2</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v2</span> <span class="main">=</span> <span class="skolem">a2</span><span class="main">#</span><span class="skolem">u2</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>length <span class="skolem">u2</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">u1</span> <span class="main">=</span> length <span class="skolem">u2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main"><span class="free">*</span></span> scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span> <span class="main">=</span>
         scalar_product <span class="main">(</span>vec_vec_Tensor <span class="skolem">u1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="skolem">u2</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc Cons_1 Cons_2 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zip <span class="skolem">v1</span> <span class="skolem">v2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a1</span><span class="main">,</span><span class="skolem">a2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>zip <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  zip_Cons Cons_1 Cons_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_4<span class="main">:</span><span class="quoted"><span class="quoted">"scalar_product <span class="skolem">v1</span> <span class="skolem">v2</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">a1</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span><span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">unfolding</span></span> scalar_product_def scalar_prodI_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>scalar_product <span class="skolem">v1</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span>
                      <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a1</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span><span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a1</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span> 
                                     <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="main">(</span>scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> plus_right_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a1</span><span class="main"><span class="free">*</span></span><span class="skolem">a2</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
                       <span class="main"><span class="free">+</span></span> scalar_product <span class="main">(</span>vec_vec_Tensor <span class="skolem">u1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="skolem">u2</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>scalar_product <span class="main">(</span>times <span class="skolem">a1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>times <span class="skolem">a2</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
                    <span class="main"><span class="free">+</span></span>  scalar_product <span class="main">(</span>vec_vec_Tensor <span class="skolem">u1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="skolem">u2</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms effective_scalar_product_times <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scalar_product <span class="main">(</span>vec_vec_Tensor <span class="skolem">v1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="skolem">v2</span> <span class="skolem">w2</span><span class="main">)</span>
                        <span class="main">=</span> scalar_product <span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">a1</span><span class="main">#</span><span class="skolem">u1</span><span class="main">)</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">a2</span><span class="main">#</span><span class="skolem">u2</span><span class="main">)</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Cons_1 Cons_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">a1</span><span class="main">#</span><span class="skolem">u1</span><span class="main">)</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>times <span class="skolem">a1</span> <span class="skolem">w1</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">u1</span> <span class="skolem">w1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vec_vec_Tensor <span class="main">(</span><span class="skolem">a2</span><span class="main">#</span><span class="skolem">u2</span><span class="main">)</span> <span class="skolem">w2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>times <span class="skolem">a2</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">u2</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> vec_vec_Tensor.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Cons_7<span class="main">:</span><span class="quoted"><span class="quoted">"scalar_product <span class="main">(</span>vec_vec_Tensor <span class="skolem">v1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="skolem">v2</span> <span class="skolem">w2</span><span class="main">)</span>
                      <span class="main">=</span> scalar_product <span class="main">(</span><span class="main">(</span>times <span class="skolem">a1</span> <span class="skolem">w1</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">u1</span> <span class="skolem">w1</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">(</span><span class="main">(</span>times <span class="skolem">a2</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">u2</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>vec_vec_Tensor <span class="skolem">u2</span> <span class="skolem">w2</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>vec_vec_Tensor <span class="skolem">u1</span> <span class="skolem">w1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_1 Cons_2 vec_vec_Tensor_length<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>times <span class="skolem">a1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>times <span class="skolem">a2</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> preserving_length<span class="main">)</span>  
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scalar_product <span class="main">(</span><span class="main">(</span>times <span class="skolem">a1</span> <span class="skolem">w1</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">u1</span> <span class="skolem">w1</span><span class="main">)</span><span class="main">)</span> 
                                <span class="main">(</span><span class="main">(</span>times <span class="skolem">a2</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>vec_vec_Tensor <span class="skolem">u2</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                    <span class="main">(</span>scalar_product <span class="main">(</span>times <span class="skolem">a1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>times <span class="skolem">a2</span> <span class="skolem">w2</span><span class="main">)</span><span class="main">)</span>
                    <span class="main"><span class="free">+</span></span>  scalar_product <span class="main">(</span>vec_vec_Tensor <span class="skolem">u1</span> <span class="skolem">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="skolem">u2</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> effective_scalar_product_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> Cons_6 Cons_7 <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span> <span class="main"><span class="free">*</span></span> <span class="skolem">a2</span> <span class="main"><span class="free">+</span></span> scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="main"><span class="free">*</span></span> scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span> 
                 <span class="main">=</span> <span class="skolem">a1</span> <span class="main"><span class="free">*</span></span> <span class="skolem">a2</span> <span class="main"><span class="free">*</span></span> scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span> 
                  <span class="main"><span class="free">+</span></span> <span class="main">(</span>scalar_product <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="main"><span class="free">*</span></span> scalar_product <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_3 Cons_4 <span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> effective_scalar_product_distributivity<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v1</span> <span class="main">=</span> length <span class="free">v2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">w1</span> <span class="main">=</span> length <span class="free">w2</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>scalar_product <span class="free">v1</span> <span class="free">v2</span><span class="main">)</span><span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="free">w1</span> <span class="free">w2</span><span class="main">)</span>
      <span class="main">=</span> scalar_product <span class="main">(</span>vec_vec_Tensor <span class="free">v1</span> <span class="free">w1</span><span class="main">)</span> <span class="main">(</span>vec_vec_Tensor <span class="free">v2</span> <span class="free">w2</span><span class="main">)</span> "</span></span>
     <span class="keyword1"><span class="command">using</span></span> assms scalar_product_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> row_length_constant<span class="main">:</span><span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">A</span>"</span></span> 
         <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">A</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>row_length <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">A</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">A</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> Nil row_length_Nil  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
 <span class="keyword1"><span class="command">next</span></span>
 <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> length <span class="bound">x</span> <span class="main">=</span> <span class="free">nr</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mat_def Ball_def vec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">A</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">nr</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">A</span> <span class="main">∈</span> set <span class="free">A</span>"</span></span>     
          <span class="keyword1"><span class="command">using</span></span> hd_def Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"row_length <span class="free">A</span> <span class="main">=</span> <span class="free">nr</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> row_length_def 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">theorem</span></span> row_col_match<span class="main">:</span>
 <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> <span class="free">i</span> <span class="free">j</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A1</span><span class="main">)</span> <span class="free">A1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">A2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span> <span class="free">A2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B1</span><span class="main">)</span> <span class="free">B1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wf4<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="main">(</span>row_length <span class="free">B2</span><span class="main">)</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="free">B2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> matchAA<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">A1</span> <span class="main">=</span> row_length <span class="free">A2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> matchBB<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="free">B1</span> <span class="main">=</span> row_length <span class="free">B2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> non_Nil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">A2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B1</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">B2</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span> <span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> length <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">=</span> length <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">&lt;</span> row_length  <span class="free">A1</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_left_ineq<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">A1</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">&lt;</span> length <span class="free">A2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> div_left_ineq<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> row_length <span class="free">A2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> row_length_constant wf2  <span class="keyword1"><span class="command">unfolding</span></span> col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> 1 matchAA <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>length <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="free">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span> <span class="main">&lt;</span> row_length <span class="free">B1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code mod_less_divisor mult_is_0 neq0_conv<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="free">B1</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> row_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">B2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> j <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_nat_zero_code mod_less_divisor mult_is_0 neq0_conv<span class="main">)</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> row_length <span class="free">B2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> row_length_constant wf4  <span class="keyword1"><span class="command">unfolding</span></span> col_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">with</span></span> 2 matchBB <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="free">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> effective_row_col_match<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
       <span class="main">⟶</span>length <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">⟶</span>length <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms row_col_match <span class="keyword1"><span class="command">unfolding</span></span> matrix_match_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
       

<span class="keyword1"><span class="command">theorem</span></span> prelim_element_match<span class="main">:</span>
 <span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">⟶</span>
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span> <span class="main">∘</span>  <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span>
                  <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
 <span class="keyword3"><span class="command">assume</span></span> assms<span class="main">:</span><span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> "</span></span>
 <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> assms matrix_compose_cond_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
     <span class="main">⟶</span>
      <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span> <span class="main">∘</span>  <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span> 
                <span class="main">=</span> <span class="main">(</span>scalar_product 
                    <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product 
                      <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> effective_matrix_match_condn_1 assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> 
                 scalar_product 
          <span class="main">(</span>vec_vec_Tensor <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>vec_vec_Tensor <span class="main">(</span>col <span class="free">A2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> effective_matrix_match_condn_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
         <span class="main">⟶</span>length <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                           <span class="main">=</span> length <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">⟶</span> length <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                             <span class="main">=</span> length <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> assms effective_row_col_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">&lt;</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">j</span><span class="main">&lt;</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
           <span class="main">⟶</span>
           <span class="main">(</span>scalar_product <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>col <span class="free">A2</span>  <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main"><span class="free">*</span></span><span class="main">(</span>scalar_product <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> <span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> <span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="main">=</span>  scalar_product 
          <span class="main">(</span>vec_vec_Tensor <span class="main">(</span>row <span class="free">A1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">div</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>row <span class="free">B1</span> <span class="main">(</span><span class="bound">i</span> <span class="keyword1">mod</span> row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>vec_vec_Tensor <span class="main">(</span>col <span class="free">A2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">div</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>col <span class="free">B2</span> <span class="main">(</span><span class="bound">j</span> <span class="keyword1">mod</span> length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> effective_scalar_product_distributivity <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> element_match<span class="main">:</span>
 <span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span> <span class="main">⟹</span><span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                              <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> 
<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span> <span class="main">∘</span>  <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span>
                  <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> prelim_element_match <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> application<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m1</span> <span class="free">m2</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m1</span> <span class="bound">m2</span><span class="main">.</span><span class="main">(</span>mat <span class="free">nr</span> <span class="free">nc</span> <span class="bound">m1</span><span class="main">)</span>
              <span class="main">∧</span><span class="main">(</span>mat <span class="free">nr</span> <span class="free">nc</span> <span class="bound">m2</span><span class="main">)</span>
              <span class="main">∧</span><span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">j</span></span> <span class="main">&lt;</span> <span class="free">nc</span><span class="main">.</span> <span class="main">∀</span> <span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> <span class="free">nr</span><span class="main">.</span> <span class="bound">m1</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">m2</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>
                  <span class="main">⟶</span> <span class="main">(</span><span class="bound">m1</span> <span class="main">=</span> <span class="bound">m2</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> mat_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">theorem</span></span> tensor_compose_condn<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> wf1<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> wf2<span class="main">:</span><span class="quoted"><span class="quoted">"mat <span class="free">nr</span> <span class="free">nc</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> wf3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">nc</span><span class="main">.</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">nr</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span> <span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span>  
                              <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span> 
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span> <span class="main">⊗</span> <span class="main">(</span><span class="free">B1</span> <span class="main">∘</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span>  
                              <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> application wf1 wf2 wf3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorem gives us the distributivity relation of tensor
product with matrix multiplication›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> distributivity<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"matrix_match <span class="free">A1</span> <span class="free">A2</span> <span class="free">B1</span> <span class="free">B2</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>row_length <span class="free">A1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>row_length <span class="free">B1</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>length <span class="free">A2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>length <span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="var">?nr</span> <span class="var">?nc</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span><span class="main">∘</span><span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span><span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms effective_tensor_compose_distribution1<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mat <span class="var">?nr</span> <span class="var">?nc</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> effective_tensor_compose_distribution2<span class="main">)</span>
 <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="var">?nc</span><span class="main">.</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="var">?nr</span><span class="main">.</span>
                   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">∘</span> <span class="free">A2</span><span class="main">)</span><span class="main">⊗</span><span class="main">(</span><span class="free">B1</span> <span class="main">∘</span><span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span> 
                                <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">A1</span> <span class="main">⊗</span> <span class="free">B1</span><span class="main">)</span><span class="main">∘</span><span class="main">(</span><span class="free">A2</span> <span class="main">⊗</span> <span class="free">B2</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> element_match assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> application <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>   

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>