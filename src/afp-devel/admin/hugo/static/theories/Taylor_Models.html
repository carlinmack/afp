<div id="Polynomial_Expression">
<div class="head">
<h1>Theory Polynomial_Expression</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Multivariate_Polynomial.thy
    Author:     Amine Chaieb
    Modified by Christoph Traut to work on the most general type possible, for the use in Taylor models.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Implementation and verification of multivariate polynomials›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Polynomial_Expression
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a> 
        <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Rat_Pair.html">HOL-Decision_Procs.Rat_Pair</a>"</span>
        <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Polynomial_List.html">HOL-Decision_Procs.Polynomial_List</a>"</span>
        <span class="quoted">"<a href="../../HOL/HOL-Library/Float.html">HOL-Library.Float</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TODO: generalize in library and remove this theory.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Datatype of polynomial expressions›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> poly <span class="main">=</span> C <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span> Bound <span class="quoted">nat</span> <span class="main">|</span> Add <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="main">|</span> Sub <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>
  <span class="main">|</span> Mul <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span><span class="main">|</span> Neg <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span><span class="main">|</span> Pw <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="quoted">nat</span> <span class="main">|</span> CN <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="quoted">nat</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">poly_0</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>zero poly"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">0<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="main">≡</span> C <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">poly_p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">')<span class="hidden">⇩</span><sub>p</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="keyword1"><span class="free">)<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="main">≡</span> C <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Boundedness, substitution and all that›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">polysize</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polysize</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysize</span> <span class="main">(</span>Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysize</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysize</span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysize</span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysize</span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysize</span> <span class="main">(</span>Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysize</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">+</span> <span class="free">polysize</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">polybound0</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> bool"</span></span> <span class="comment1">― ‹a poly is INDEPENDENT of Bound 0›</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polybound0</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polybound0</span> <span class="main">(</span>Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polybound0</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polybound0</span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polybound0</span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polybound0</span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polybound0</span> <span class="main">(</span>Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polybound0</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free">polybound0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">polysubst0</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="comment1">― ‹substitute a poly into a poly for Bound 0›</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> C <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">else</span> Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> Add <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> Sub <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> Mul <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> Pw <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Add <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span> CN <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">polysubst0</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">decrpoly</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">decrpoly</span> <span class="main">(</span>Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> Bound <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">decrpoly</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">decrpoly</span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> Add <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">decrpoly</span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> Sub <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">decrpoly</span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> Mul <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">decrpoly</span> <span class="main">(</span>Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> Pw <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">decrpoly</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> CN <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">decrpoly</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Degrees and heads and coefficients›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">degree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">degree</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="free">degree</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">degree</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">head</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">head</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">head</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">head</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹More general notions of degree and head.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">degreen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">degreen</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="bound">m</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">+</span> <span class="free">degreen</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">degreen</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">headn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">headn</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="bound">m</span> <span class="keyword1">then</span> <span class="free">headn</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">m</span> <span class="keyword1">else</span> CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">headn</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">coefficients</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">coefficients</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">#</span> <span class="free">coefficients</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">coefficients</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">isconstant</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">isconstant</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isconstant</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">behead</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>zero poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">behead</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p'</span> <span class="main">=</span> <span class="free">behead</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">p'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="keyword1">else</span> CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="bound">p'</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">behead</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">headconst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">headconst</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">headconst</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">headconst</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Operations for normalization›</span></span>

<span class="keyword1"><span class="command">declare</span></span> if_cong<span class="main">[</span><span class="operator">fundef_cong</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> let_cong<span class="main">[</span><span class="operator">fundef_cong</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">polyadd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">}</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span>"</span> 60<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polyadd</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polyadd</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span> <span class="main">=</span> CN <span class="main">(</span><span class="free">polyadd</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polyadd</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="main">=</span> CN <span class="main">(</span><span class="free">polyadd</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polyadd</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="keyword1">then</span> CN <span class="main">(</span><span class="free">polyadd</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> CN <span class="main">(</span><span class="free">polyadd</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span>
     <span class="keyword1">else</span>
      <span class="keyword1">let</span>
        <span class="bound">cc'</span> <span class="main">=</span> <span class="free">polyadd</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">;</span>
        <span class="bound">pp'</span> <span class="main">=</span> <span class="free">polyadd</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span>
      <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">pp'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">then</span> <span class="bound">cc'</span> <span class="keyword1">else</span> CN <span class="bound">cc'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">pp'</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polyadd</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Add <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">polyneg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>uminus poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polyneg</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polyneg</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> CN <span class="main">(</span><span class="free">polyneg</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">polyneg</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polyneg</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">polysub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>uminus<span class="main">}</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">-<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> polyadd <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>polyneg <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">polymul</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>times<span class="main">}</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span>"</span> 60<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polymul</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polymul</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">else</span> CN <span class="main">(</span><span class="free">polymul</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">(</span><span class="free">polymul</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polymul</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">=</span> <span class="main">0</span>  <span class="keyword1">then</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">else</span> CN <span class="main">(</span><span class="free">polymul</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">polymul</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polymul</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="keyword1">then</span> CN <span class="main">(</span><span class="free">polymul</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">polymul</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> CN <span class="main">(</span><span class="free">polymul</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">(</span><span class="free">polymul</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span>
     <span class="keyword1">else</span> polyadd <span class="main">(</span><span class="free">polymul</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">)</span> <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">(</span><span class="free">polymul</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polymul</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Mul <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> if_cong<span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> let_cong<span class="main">[</span><span class="operator">fundef_cong</span><span class="main">]</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">polypow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>times<span class="main">,</span>one<span class="main">}</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polypow</span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="keyword1">)<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polypow</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span>
      <span class="keyword1">let</span>
        <span class="bound">q</span> <span class="main">=</span> <span class="free">polypow</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="bound">p</span><span class="main">;</span>
        <span class="bound">d</span> <span class="main">=</span> polymul <span class="bound">q</span> <span class="bound">q</span>
      <span class="keyword1">in</span> <span class="keyword1">if</span> even <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="bound">d</span> <span class="keyword1">else</span> polymul <span class="bound">p</span> <span class="bound">d</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">poly_pow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>times<span class="main">,</span>one<span class="main">}</span> poly <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1"><span class="free">^<span class="hidden">⇩</span><sub>p</sub></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≡</span> polypow <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">polynate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>uminus<span class="main">,</span>zero<span class="main">,</span>times<span class="main">,</span>one<span class="main">}</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polynate</span> <span class="main">(</span>Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="main">1</span><span class="keyword1">)<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polynate</span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">polynate</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">polynate</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polynate</span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">polynate</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">polynate</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polynate</span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">polynate</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">polynate</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polynate</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="free">polynate</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polynate</span> <span class="main">(</span>Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">polynate</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polynate</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">polynate</span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>Mul <span class="main">(</span>Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">polynate</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> C <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure polysize"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">poly_cmul</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>times<span class="main">,</span>zero<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_cmul</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_cmul</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> CN <span class="main">(</span><span class="free">poly_cmul</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">poly_cmul</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_cmul</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> C <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">monic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>times<span class="main">,</span>one<span class="main">,</span>inverse<span class="main">}</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">×</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">monic</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">h</span> <span class="main">=</span> headconst <span class="free"><span class="bound"><span class="entity">p</span></span></span>
     <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">h</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> False<span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>poly_cmul<span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="bound">h</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> True<span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Pseudo-division›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shift1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>zero poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">shift1</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">funpow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">funpow</span> <span class="main">≡</span> compow"</span></span>

<span class="keyword1"><span class="command">partial_function</span></span> <span class="main">(</span>tailrec<span class="main">)</span> <span class="entity">polydivide_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>uminus<span class="main">,</span>times<span class="main">}</span> poly <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> nat <span class="main">×</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">polydivide_aux</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>
     <span class="keyword1">else</span>
      <span class="keyword1">let</span>
        <span class="bound">b</span> <span class="main">=</span> head <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
        <span class="bound">m</span> <span class="main">=</span> degree <span class="free"><span class="bound"><span class="entity">s</span></span></span>
      <span class="keyword1">in</span>
        <span class="keyword1">if</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>
        <span class="keyword1">else</span>
          <span class="keyword1">let</span> <span class="bound">p'</span> <span class="main">=</span> funpow <span class="main">(</span><span class="bound">m</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> shift1 <span class="free"><span class="bound"><span class="entity">p</span></span></span>
          <span class="keyword1">in</span>
            <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="bound">b</span> <span class="keyword1">then</span> <span class="free">polydivide_aux</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="bound">p'</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="free">polydivide_aux</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="bound">b</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="bound">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">polydivide</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>uminus<span class="main">,</span>times<span class="main">}</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> nat <span class="main">×</span> <span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">polydivide</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> polydivide_aux <span class="main">(</span>head <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">poly_deriv_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>uminus<span class="main">,</span>times<span class="main">,</span>one<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_deriv_aux</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> CN <span class="main">(</span>poly_cmul <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span><span class="free">poly_deriv_aux</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_deriv_aux</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> poly_cmul <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">poly_deriv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>uminus<span class="main">,</span>times<span class="main">,</span>one<span class="main">}</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_deriv</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> poly_deriv_aux <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_deriv</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Semantics of the polynomial representation›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">Ipoly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>minus<span class="main">,</span>uminus<span class="main">,</span>times<span class="main">,</span>one<span class="main">,</span>power<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Pw <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="free">Ipoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="comment1">(*abbreviation Ipoly_syntax :: "'a poly ⇒ 'a list ⇒'a::{plus,zero,minus,uminus,times,one,power}"  ("⦇_⦈<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇗</span><sup>_</sup><span class="hidden">⇖</span>")
  where "⦇p⦈<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇗</span><sup>bs</sup><span class="hidden">⇖</span> ≡ Ipoly bs p"*)</span>

<span class="keyword1"><span class="command">lemmas</span></span> RIpoly_eqs <span class="main">=</span> Ipoly.simps

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Normal form and normalization›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">isnpolyh</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>zero poly <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">(* TODO: Inject normalization via a custom type class here? *)</span>
  <span class="comment1">(*"isnpolyh (C c) = (λk. isnormNum c)"*)</span>
  <span class="quoted"><span class="quoted">"<span class="free">isnpolyh</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> True<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isnpolyh</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="bound">k</span> <span class="main">∧</span> <span class="free">isnpolyh</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">isnpolyh</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isnpolyh</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> False<span class="main">)</span>"</span></span>

<span class="keyword1" id="Polynomial_Expression-isnpolyh_mono"><span class="command">lemma</span></span> isnpolyh_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> isnpolyh <span class="free">p</span> <span class="free">n'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> isnpolyh.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">isnpoly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>zero poly <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">isnpoly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> isnpolyh <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹polyadd preserves normal forms›</span></span>

<span class="keyword1" id="Polynomial_Expression-polyadd_normh"><span class="command">lemma</span></span> polyadd_normh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="free">q</span> <span class="free">n1</span> <span class="main">⟹</span> isnpolyh <span class="main">(</span>polyadd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>min <span class="free">n0</span> <span class="free">n1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">n1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">ab</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span> <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span>  th1<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>C <span class="skolem">ab</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nplen1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">≥</span> <span class="skolem">n1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> isnpolyh_mono <span class="keyword1"><span class="command">have</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> th1 th2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> th3<span class="main">:</span><span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>C <span class="skolem">ab</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> nplen1 <span class="keyword1"><span class="command">have</span></span> n01len1<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 th3
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span> <span class="skolem">ab</span> <span class="skolem">n1</span> <span class="skolem">n0</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span>  th1<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>C <span class="skolem">ab</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> nplen1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">≥</span> <span class="skolem">n1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> isnpolyh_mono <span class="keyword1"><span class="command">have</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> th2 th1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> th3<span class="main">:</span><span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="skolem">c'</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> C <span class="skolem">ab</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> nplen1 <span class="keyword1"><span class="command">have</span></span> n01len1<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 th3
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span> <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> nc'<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> np'<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p'</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> ngen0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">n0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> n'gen1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">≥</span> <span class="skolem">n1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span> <span class="main">|</span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span> <span class="main">|</span> <span class="main">(</span>gt<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> eq
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> nc nc'<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> ncc'<span class="main">:</span><span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ncc'n01<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">(</span>min <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> isnpolyh_mono<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"min <span class="skolem"><span class="skolem">n0</span></span> <span class="skolem"><span class="skolem">n1</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span>  ngen0 n'gen1
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> eq <span class="quoted">"4.hyps"</span><span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> np np'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> npp'<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="skolem">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> minle<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ngen0 n'gen1 eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> minle npp' ncc'n01 4 eq ngen0 n'gen1 ncc' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> lt
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="main">≤</span> <span class="skolem">n0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 4 lt <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span><span class="quoted"><span class="quoted">"min <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> th21<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> th22<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> lt <span class="keyword1"><span class="command">have</span></span> th23<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">n'</span> <span class="main">=</span> Suc <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> th21 th22<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>polyadd <span class="skolem">c</span> <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> th23 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 4 lt th1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> gt
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gt'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="main">≤</span> <span class="skolem">n1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 4 gt <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> th21<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> th22<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> gt <span class="keyword1"><span class="command">have</span></span> th23<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">n</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> th22 th21<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>polyadd <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> th23 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 4 gt th1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polyadd"><span class="command">lemma</span></span> polyadd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>polyadd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">+</span> Ipoly <span class="free">bs</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="dynamic"><span class="dynamic">field_simps</span></span> distrib_left<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> distrib_left_NO_MATCH<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polyadd_norm"><span class="command">lemma</span></span> polyadd_norm<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpoly <span class="free">p</span> <span class="main">⟹</span> isnpoly <span class="free">q</span> <span class="main">⟹</span> isnpoly <span class="main">(</span>polyadd <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polyadd_normh<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isnpoly_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The degree of addition and other general lemmas needed for the normal form of polymul.›</span></span>

<span class="keyword1" id="Polynomial_Expression-polyadd_different_degreen"><span class="command">lemma</span></span> polyadd_different_degreen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degreen <span class="free">p</span> <span class="free">m</span> <span class="main">≠</span> degreen <span class="free">q</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> min <span class="free">n0</span> <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degreen <span class="main">(</span>polyadd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> max <span class="main">(</span>degreen <span class="free">p</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>degreen <span class="free">q</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">n1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span> <span class="skolem">m</span> <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> 4<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> 4<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> 4<span class="main">(</span>5-7<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-headnz"><span class="command">lemma</span></span> headnz<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟹</span> headn <span class="free">p</span> <span class="free">m</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> headn.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-degree_isnpolyh_Suc"><span class="command">lemma</span></span> degree_isnpolyh_Suc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degree.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-degreen_0"><span class="command">lemma</span></span> degreen_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> degreen <span class="free">p</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degreen.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-degree_isnpolyh_Suc'"><span class="command">lemma</span></span> degree_isnpolyh_Suc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degree.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-degree_npolyhCN"><span class="command">lemma</span></span> degree_npolyhCN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="free">c</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="free">n0</span> <span class="main">⟹</span> degree <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> degree_isnpolyh_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-degreen_npolyhCN"><span class="command">lemma</span></span> degreen_npolyhCN<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="free">c</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="free">n0</span> <span class="main">⟹</span> degreen <span class="free">c</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> degreen_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Polynomial_Expression-degreen_polyadd"><span class="command">lemma</span></span> degreen_polyadd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> max <span class="free">n0</span> <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="free">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">m</span> <span class="main">≤</span> max <span class="main">(</span>degreen <span class="free">p</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>degreen <span class="free">q</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> np nq m
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">n1</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">c</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span> <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span> <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> 4<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> 4<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> 4<span class="main">(</span>5-7<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polyadd_eq_const_degreen"><span class="command">lemma</span></span> polyadd_eq_const_degreen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"polyadd <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> C <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degreen <span class="free">p</span> <span class="free">m</span> <span class="main">=</span> degreen <span class="free">q</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">n1</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span> <span class="skolem">m</span> <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">n'</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-polymul_properties"><span class="command">lemma</span></span> polymul_properties<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> min <span class="free">n0</span> <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>min <span class="free">n0</span> <span class="free">n1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> degreen <span class="free">p</span> <span class="free">m</span> <span class="main">+</span> degreen <span class="free">q</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> np nq m
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">n1</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polymul.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">c</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"2.hyps"</span><span class="main">(</span>4-6<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n'</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n'</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n'</span></span></span></span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"2.hyps"</span><span class="main">(</span>1-3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">n'</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">n'</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n'</span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.hyps"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"3.hyps"</span><span class="main">(</span>4-6<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"3.hyps"</span><span class="main">(</span>1-3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3.hyps"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cnp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cnp'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cnp<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?cnp</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> cnp'<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?cnp'</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> np'<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p'</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nc'<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nn0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">n0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nn1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">≥</span> <span class="skolem">n1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>4-5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> np cnp'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> nc cnp'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> nn0 cnp
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>16-17<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> cnp np'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">n'</span></span>"</span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>13<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> cnp nc'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span>"</span></span><span class="main">]</span> nn1 cnp'
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>16-17<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> cnp np'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>13<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> cnp nc'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> cnp cnp' nn1 nn0
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> polyadd_normh<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def isnpolyh_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nn0<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n0</span> <span class="skolem">n1</span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?cnp</span> <span class="skolem">n0</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> np'<span class="main">:</span><span class="quoted"><span class="quoted">"isnpolyh <span class="var">?cnp'</span> <span class="skolem">n1</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> min <span class="skolem">n0</span> <span class="skolem">n1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="var">?cnp'</span><span class="main">)</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degreen <span class="var">?cnp</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degreen <span class="var">?cnp'</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="var">?cnp</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">∨</span> <span class="var">?cnp'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">then</span> <span class="main">0</span>  <span class="keyword1">else</span> <span class="var">?d1</span> <span class="main">+</span> <span class="var">?d2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">∨</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>3<span class="main">,</span>6<span class="main">,</span>18<span class="main">)</span> np np' m <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>16<span class="main">,</span>18<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n'</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main">]</span>
        <span class="quoted">"4.hyps"</span><span class="main">(</span>13<span class="main">,</span>14<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem">n'</span></span>"</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main">]</span>
        np np' nn'
      <span class="keyword1"><span class="command">have</span></span> norm<span class="main">:</span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?cnp</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p'</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="skolem">c'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>17<span class="main">,</span>18<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main">]</span>
          <span class="quoted">"4.hyps"</span><span class="main">(</span>13<span class="main">,</span>15<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main">]</span> norm nn' mn
        <span class="keyword1"><span class="command">have</span></span> degs<span class="main">:</span>
          <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">c'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="var">?d1</span> <span class="main">+</span> degreen <span class="skolem">c'</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="var">?d1</span>  <span class="main">+</span> degreen <span class="skolem">p'</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> degs norm <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">&lt;</span> degreen <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">≠</span> degreen <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> nmin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> min <span class="skolem">n</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> polyadd_different_degreen<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> neq nmin<span class="main">]</span> th1
        <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degreen <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span>
            degreen <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>16-18<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span>4<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span>
          <span class="quoted">"4.hyps"</span><span class="main">(</span>13-15<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span>
          mn norm m nn' deg
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> m np <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> nn' m np <span class="keyword1"><span class="command">have</span></span> max1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> max <span class="skolem">n</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> min <span class="skolem">n</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> min2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> min <span class="skolem">n</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>16-18<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span>4<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span> min1<span class="main">]</span>
          <span class="quoted">"4.hyps"</span><span class="main">(</span>13-15<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span> min2<span class="main">]</span>
          degreen_polyadd<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> max1<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m</span> <span class="main">≤</span>
            max <span class="main">(</span>degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>degreen <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> mn nn' np np' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>16-18<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span>4<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span> min1<span class="main">]</span>
          <span class="quoted">"4.hyps"</span><span class="main">(</span>13-15<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span>2<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span> min2<span class="main">]</span>
          degreen_0<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mn'<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span> <span class="keyword1"><span class="command">using</span></span> nn' mn np np' <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?eq</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?cnp</span> <span class="skolem">n0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> np'<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?cnp'</span> <span class="skolem">n1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> min <span class="skolem">n0</span> <span class="skolem">n1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c0p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="var">?c0p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"4.hyps"</span><span class="main">(</span>16-18<span class="main">)</span> <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span>
        <span class="quoted">"4.hyps"</span><span class="main">(</span>13-15<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span>"</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span></span></span><span class="main">]</span>
        np np' C<span class="main">(</span>2<span class="main">)</span> mn
      <span class="keyword1"><span class="command">have</span></span> norm<span class="main">:</span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?cnp</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p'</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="skolem">c'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
        <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">c'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> degreen <span class="var">?cnp</span> <span class="skolem">n</span> <span class="main">+</span> degreen <span class="skolem">c'</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">=</span> degreen <span class="var">?cnp</span> <span class="skolem">n</span> <span class="main">+</span> degreen <span class="skolem">p'</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> norm <span class="keyword1"><span class="command">have</span></span> cn<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> degneq<span class="main">:</span> <span class="quoted"><span class="quoted">"degreen <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">&lt;</span> degreen <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span><span class="var">?cnp</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> norm <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> polyadd_eq_const_degreen<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> cn C<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">n</span>"</span></span><span class="main">]</span> degneq
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4.hyps"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polymul"><span class="command">lemma</span></span> polymul<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">*</span> Ipoly <span class="free">bs</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polymul.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polymul_normh"><span class="command">lemma</span></span> polymul_normh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="free">q</span> <span class="free">n1</span> <span class="main">⟹</span> isnpolyh <span class="main">(</span><span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>min <span class="free">n0</span> <span class="free">n1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polymul_properties<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Polynomial_Expression-polymul_eq0_iff"><span class="command">lemma</span></span> polymul_eq0_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="free">q</span> <span class="free">n1</span> <span class="main">⟹</span> <span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polymul_properties<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Polynomial_Expression-polymul_degreen"><span class="command">lemma</span></span> polymul_degreen<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="free">q</span> <span class="free">n1</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">≤</span> min <span class="free">n0</span> <span class="free">n1</span> <span class="main">⟹</span>
    degreen <span class="main">(</span><span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> degreen <span class="free">p</span> <span class="free">m</span> <span class="main">+</span> degreen <span class="free">q</span> <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> polymul_properties<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polymul_norm"><span class="command">lemma</span></span> polymul_norm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="free">p</span> <span class="main">⟹</span> isnpoly <span class="free">q</span> <span class="main">⟹</span> isnpoly <span class="main">(</span>polymul <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polymul_normh<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isnpoly_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-headconst_zero"><span class="command">lemma</span></span> headconst_zero<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>zero poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> headconst <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> headconst.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="comment1">(*lemma headconst_isnormNum: "isnpolyh p n0 ⟹ isnormNum (headconst p)"
  by (induct p arbitrary: n0) auto

lemma monic_eqI:
  assumes np: "isnpolyh p n0"
  shows "INum (headconst p) * Ipoly bs (fst (monic p)) =
    (Ipoly bs p ::'a::{field_char_0,field, power})"
  unfolding monic_def Let_def
proof (cases "headconst p = 0<span class="hidden">⇩</span><sub>N</sub>", simp_all add: headconst_zero[OF np])
  let ?h = "headconst p"
  assume pz: "p ≠ 0<span class="hidden">⇩</span><sub>p</sub>"
  {
    assume hz: "INum ?h = (0::'a)"
    from headconst_isnormNum[OF np] have norm: "isnormNum ?h" "isnormNum 0<span class="hidden">⇩</span><sub>N</sub>"
      by simp_all
    from isnormNum_unique[where ?'a = 'a, OF norm] hz have "?h = 0<span class="hidden">⇩</span><sub>N</sub>"
      by simp
    with headconst_zero[OF np] have "p = 0<span class="hidden">⇩</span><sub>p</sub>"
      by blast
    with pz have False
      by blast
  }
  then show "INum (headconst p) = (0::'a) ⟶ ⦇p⦈<span class="hidden">⇩</span><sub>p</sub><span class="hidden">⇗</span><sup>bs</sup><span class="hidden">⇖</span> = 0"
    by blast
qed*)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹polyneg is a negation and preserves normal forms›</span></span>

<span class="keyword1" id="Polynomial_Expression-polyneg"><span class="command">lemma</span></span> polyneg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>polyneg <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Ipoly <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyneg.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polyneg0"><span class="command">lemma</span></span> polyneg0<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyneg.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polyneg_polyneg"><span class="command">lemma</span></span> polyneg_polyneg<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> <span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyneg.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polyneg_normh"><span class="command">lemma</span></span> polyneg_normh<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> isnpolyh <span class="main">(</span>polyneg <span class="free">p</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyneg.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polyneg0<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polyneg_norm"><span class="command">lemma</span></span> polyneg_norm<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="free">p</span> <span class="main">⟹</span> isnpoly <span class="main">(</span>polyneg <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polyneg_normh <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isnpoly_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹polysub is a substraction and preserves normal forms›</span></span>

<span class="keyword1" id="Polynomial_Expression-polysub"><span class="command">lemma</span></span> polysub<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>polysub <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">-</span> Ipoly <span class="free">bs</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polysub_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polysub_normh"><span class="command">lemma</span></span> polysub_normh<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="free">q</span> <span class="free">n1</span> <span class="main">⟹</span> isnpolyh <span class="main">(</span>polysub <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">(</span>min <span class="free">n0</span> <span class="free">n1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polysub_def polyneg_normh polyadd_normh<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polysub_norm"><span class="command">lemma</span></span> polysub_norm<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="free">p</span> <span class="main">⟹</span> isnpoly <span class="free">q</span> <span class="main">⟹</span> isnpoly <span class="main">(</span>polysub <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> polyadd_norm<span class="main">[</span><span class="operator">OF</span> _ polyneg_norm<span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="main">(</span><span class="free">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="main">(</span>polysub <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polysub_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-polysub_same_0"><span class="command">lemma</span></span> polysub_same_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> polysub <span class="free">p</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> polysub_def split_def fst_conv snd_conv
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def Nsub0<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Nsub_def<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polysub_0"><span class="command">lemma</span></span> polysub_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="free">q</span> <span class="free">n1</span> <span class="main">⟹</span> <span class="free">p</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> polysub_def split_def fst_conv snd_conv
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">n1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>polyadd.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Nsub0<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Nsub_def<span class="main"><span class="main">]</span></span> Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹polypow is a power function and preserves normal forms›</span></span>

<span class="keyword1" id="Polynomial_Expression-polypow"><span class="command">lemma</span></span> polypow<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>polypow <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>field<span class="main">)</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polypow.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> Ipoly <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> Suc <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polypow <span class="main">(</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polymul <span class="var">?q</span> <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∨</span> even <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> odd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> th<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">div</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">+</span> Suc <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">from</span></span> odd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="main">(</span>polymul <span class="free">p</span> <span class="var">?d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>Ipoly <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Ipoly <span class="free">bs</span> <span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Ipoly <span class="free">bs</span> <span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>Ipoly <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">+</span> Suc <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_add power_one_right<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>Ipoly <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">div</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> th<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">^</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> numeral_2_eq_2 <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> odd_two_times_div_two_nat <span class="main">[</span><span class="operator">OF</span> odd<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> even<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> even <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="var">?d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>Ipoly <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hyp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_2 power_add<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">^</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> even_two_times_div_two <span class="main">[</span><span class="operator">OF</span> even<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">^</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-polypow_normh"><span class="command">lemma</span></span> polypow_normh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> isnpolyh <span class="main">(</span>polypow <span class="free">k</span> <span class="free">p</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polypow.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> hyps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">n</span><span class="main">.</span> isnpolyh <span class="free">p</span> <span class="bound">n</span> <span class="main">⟹</span> isnpolyh <span class="main">(</span><span class="free">p</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> Suc <span class="skolem">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polypow <span class="main">(</span>Suc <span class="skolem">k</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polymul <span class="var">?q</span> <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> hyps <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?q</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> polymul_normh<span class="main">[</span><span class="operator">OF</span> th1 th1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> dn<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?d</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> polymul_normh<span class="main">[</span><span class="operator">OF</span> th2 dn<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> on<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>polymul <span class="free">p</span> <span class="var">?d</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> dn on <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="free">p</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> Suc <span class="skolem">k</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> Let_def<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-polypow_norm"><span class="command">lemma</span></span> polypow_norm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="free">p</span> <span class="main">⟹</span> isnpoly <span class="main">(</span>polypow <span class="free">k</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polypow_normh isnpoly_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally the whole normalization›</span></span>

<span class="keyword1" id="Polynomial_Expression-polynate"><span class="command">lemma</span></span> polynate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>polynate <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span>field<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polynate.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polynate_norm"><span class="command">lemma</span></span> polynate_norm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="main">(</span>polynate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polynate.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polyadd_norm polymul_norm polysub_norm polyneg_norm polypow_norm<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isnpoly_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹shift1›</span></span>


<span class="keyword1" id="Polynomial_Expression-shift1"><span class="command">lemma</span></span> shift1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>shift1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="main">(</span>Mul <span class="main">(</span>Bound <span class="main">0</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-shift1_isnpoly"><span class="command">lemma</span></span> shift1_isnpoly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="main">(</span>shift1 <span class="free">p</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_def isnpoly_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-shift1_nz"><span class="command">lemma</span></span> shift1_nz<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"shift1 <span class="free">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-funpow_shift1_isnpoly"><span class="command">lemma</span></span> funpow_shift1_isnpoly<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpoly <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟹</span> isnpoly <span class="main">(</span>funpow <span class="free">n</span> shift1 <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_isnpoly funpow_swap1<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-funpow_isnpolyh"><span class="command">lemma</span></span> funpow_isnpolyh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> isnpolyh <span class="bound">p</span> <span class="free">n</span> <span class="main">⟹</span> isnpolyh <span class="main">(</span><span class="free">f</span> <span class="bound">p</span><span class="main">)</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>funpow <span class="free">k</span> <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-funpow_shift1"><span class="command">lemma</span></span> funpow_shift1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Ipoly <span class="free">bs</span> <span class="main">(</span>funpow <span class="free">n</span> shift1 <span class="free">p</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1<span class="main">)</span> <span class="main">=</span>
    Ipoly <span class="free">bs</span> <span class="main">(</span>Mul <span class="main">(</span>Pw <span class="main">(</span>Bound <span class="main">0</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_isnpoly shift1<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-shift1_isnpolyh"><span class="command">lemma</span></span> shift1_isnpolyh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟹</span> isnpolyh <span class="main">(</span>shift1 <span class="free">p</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isnpolyh_mono<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-funpow_shift1_1"><span class="command">lemma</span></span> funpow_shift1_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Ipoly <span class="free">bs</span> <span class="main">(</span>funpow <span class="free">n</span> shift1 <span class="free">p</span><span class="main">)</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> field<span class="main">)</span> <span class="main">=</span>
    Ipoly <span class="free">bs</span> <span class="main">(</span>funpow <span class="free">n</span> shift1 <span class="main">(</span><span class="main">1</span><span class="keyword1">)<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_shift1<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-poly_cmul"><span class="command">lemma</span></span> poly_cmul<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>poly_cmul <span class="free">c</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="main">(</span>Mul <span class="main">(</span>C <span class="free">c</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-behead"><span class="command">lemma</span></span> behead<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>Add <span class="main">(</span>Mul <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">(</span>Pw <span class="main">(</span>Bound <span class="main">0</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>behead <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span>Ipoly <span class="free">bs</span> <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> comm_ring_1<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> behead.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">p</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pn<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> pn<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> th<span class="main">:</span><span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>Add <span class="main">(</span>Mul <span class="main">(</span>head <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>Pw <span class="main">(</span>Bound <span class="main">0</span><span class="main">)</span> <span class="main">(</span>degree <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>behead <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.hyps"</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main"><span class="keyword3">,</span></span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"behead <span class="skolem">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> th<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-behead_isnpolyh"><span class="command">lemma</span></span> behead_isnpolyh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>behead <span class="free">p</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> behead.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def isnpolyh_mono<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous lemmas about indexes, decrementation, substitution  etc ...›</span></span>

<span class="keyword1" id="Polynomial_Expression-isnpolyh_polybound0"><span class="command">lemma</span></span> isnpolyh_polybound0<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> polybound0 <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">n'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p</span> <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹isnpolyh <span class="skolem">p</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-isconstant_polybound0"><span class="command">lemma</span></span> isconstant_polybound0<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isconstant <span class="free">p</span> <span class="main">⟷</span> polybound0 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> isconstant.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isnpolyh_polybound0<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-decrpoly_zero"><span class="command">lemma</span></span> decrpoly_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"decrpoly <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-decrpoly_normh"><span class="command">lemma</span></span> decrpoly_normh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> polybound0 <span class="free">p</span> <span class="main">⟹</span> isnpolyh <span class="main">(</span>decrpoly <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">atomize</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> nat a b<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"Suc <span class="improper">nat</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Polynomial_Expression-head_polybound0"><span class="command">lemma</span></span> head_polybound0<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> polybound0 <span class="main">(</span>head <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span>  <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> head.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> isnpolyh_polybound0<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polybound0_I"><span class="command">lemma</span></span> polybound0_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"polybound0 <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> Ipoly <span class="main">(</span><span class="free">b'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polysubst0_I"><span class="command">lemma</span></span> polysubst0_I<span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>polysubst0 <span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="main">(</span><span class="main">(</span>Ipoly <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-polysubst0_I'"><span class="command">lemma</span></span> polysubst0_I'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"polybound0 <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>polysubst0 <span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="main">(</span><span class="main">(</span>Ipoly <span class="main">(</span><span class="free">b'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polybound0_I<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> b'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">b'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-decrpoly"><span class="command">lemma</span></span> decrpoly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"polybound0 <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">t</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="main">(</span>decrpoly <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> decrpoly.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-polysubst0_polybound0"><span class="command">lemma</span></span> polysubst0_polybound0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"polybound0 <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"polybound0 <span class="main">(</span>polysubst0 <span class="free">t</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> poly.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-degree0_polybound0"><span class="command">lemma</span></span> degree0_polybound0<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> polybound0 <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degree.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isnpolyh_polybound0<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">maxindex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">maxindex</span> <span class="main">(</span>Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxindex</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> max  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>max <span class="main">(</span><span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxindex</span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxindex</span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxindex</span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxindex</span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxindex</span> <span class="main">(</span>Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">maxindex</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxindex</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wf_bs</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟷</span> length <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">≥</span> maxindex <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_coefficients"><span class="command">lemma</span></span> wf_bs_coefficients<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> set <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span><span class="main">.</span> wf_bs <span class="free">bs</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> coefficients.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>coefficients <span class="main">(</span>CN <span class="skolem">c</span> <span class="main">0</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>coefficients <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>coefficients <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.prems"</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted">"1.hyps"</span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-maxindex_coefficients"><span class="command">lemma</span></span> maxindex_coefficients<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> set <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span><span class="main">.</span> maxindex <span class="bound">c</span> <span class="main">≤</span> maxindex <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> coefficients.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_I"><span class="command">lemma</span></span> wf_bs_I<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="free">p</span> <span class="main">⟹</span> Ipoly <span class="main">(</span><span class="free">bs</span> <span class="main">@</span> <span class="free">bs'</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-take_maxindex_wf"><span class="command">lemma</span></span> take_maxindex_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">(</span>take <span class="main">(</span>maxindex <span class="free">p</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ip</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"maxindex <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?tbs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="var">?ip</span> <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?tbs</span> <span class="main">=</span> <span class="var">?ip</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> wf'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="var">?tbs</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span>  <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">=</span> <span class="var">?tbs</span> <span class="main">@</span> drop <span class="var">?ip</span> <span class="free">bs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> wf_bs_I<span class="main">[</span><span class="operator">OF</span> wf'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"drop <span class="var">?ip</span> <span class="free">bs</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-decr_maxindex"><span class="command">lemma</span></span> decr_maxindex<span class="main">:</span> <span class="quoted"><span class="quoted">"polybound0 <span class="free">p</span> <span class="main">⟹</span> maxindex <span class="main">(</span>decrpoly <span class="free">p</span><span class="main">)</span> <span class="main">=</span> maxindex <span class="free">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_insensitive"><span class="command">lemma</span></span> wf_bs_insensitive<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">bs</span> <span class="main">=</span> length <span class="free">bs'</span> <span class="main">⟹</span> wf_bs <span class="free">bs</span> <span class="free">p</span> <span class="main">=</span> wf_bs <span class="free">bs'</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_insensitive'"><span class="command">lemma</span></span> wf_bs_insensitive'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> wf_bs <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_coefficients'"><span class="command">lemma</span></span> wf_bs_coefficients'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> set <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span><span class="main">.</span> wf_bs <span class="free">bs</span> <span class="bound">c</span> <span class="main">⟹</span> wf_bs <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> coefficients.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_bs_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-coefficients_Nil"><span class="command">lemma</span></span> coefficients_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"coefficients <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> coefficients.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-coefficients_head"><span class="command">lemma</span></span> coefficients_head<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span> <span class="main">=</span> head <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> coefficients.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_decrpoly"><span class="command">lemma</span></span> wf_bs_decrpoly<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="main">(</span>decrpoly <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> wf_bs <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> decrpoly.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-length_le_list_ex"><span class="command">lemma</span></span> length_le_list_ex<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ys</span><span class="main">.</span> length <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"replicate <span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span> <span class="main"><span class="main">-</span></span> length <span class="free"><span class="free">xs</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">z</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem"><span class="skolem">z</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Polynomial_Expression-isnpolyh_Suc_const"><span class="command">lemma</span></span> isnpolyh_Suc_const<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> isconstant <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> nat a<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nat</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_polyadd"><span class="command">lemma</span></span> wf_bs_polyadd<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="free">p</span> <span class="main">∧</span> wf_bs <span class="free">bs</span> <span class="free">q</span> <span class="main">⟶</span> wf_bs <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_polyul"><span class="command">lemma</span></span> wf_bs_polyul<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="free">p</span> <span class="main">⟹</span> wf_bs <span class="free">bs</span> <span class="free">q</span> <span class="main">⟹</span> wf_bs <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polymul.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_bs_polyadd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_bs_polyadd<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> wf_bs_def<span class="main"><span class="main">,</span></span> <span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_polyneg"><span class="command">lemma</span></span> wf_bs_polyneg<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="free">p</span> <span class="main">⟹</span> wf_bs <span class="free">bs</span> <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyneg.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-wf_bs_polysub"><span class="command">lemma</span></span> wf_bs_polysub<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="free">bs</span> <span class="free">p</span> <span class="main">⟹</span> wf_bs <span class="free">bs</span> <span class="free">q</span> <span class="main">⟹</span> wf_bs <span class="free">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> polysub_def split_def fst_conv snd_conv
  <span class="keyword1"><span class="command">using</span></span> wf_bs_polyadd wf_bs_polyneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Canonicity of polynomial representation, see lemma isnpolyh_unique›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">polypoly</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> map <span class="main">(</span>Ipoly <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">(</span>coefficients <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">polypoly'</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> map <span class="main">(</span>Ipoly <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">∘</span> decrpoly<span class="main">)</span> <span class="main">(</span>coefficients <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_nate</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> map <span class="main">(</span>Ipoly <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">∘</span> decrpoly<span class="main">)</span> <span class="main">(</span>coefficients <span class="main">(</span>polynate <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Polynomial_Expression-coefficients_normh"><span class="command">lemma</span></span> coefficients_normh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span><span class="main">.</span> isnpolyh <span class="bound">q</span> <span class="free">n0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> coefficients.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">p</span> <span class="skolem">n0</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="skolem">c</span> <span class="main">0</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">n0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> norm<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isnpolyh_mono<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"1.hyps"</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> norm<span class="main">(</span>1<span class="main">)</span> norm<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-coefficients_isconst"><span class="command">lemma</span></span> coefficients_isconst<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span><span class="main">.</span> isconstant <span class="bound">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> coefficients.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isnpolyh_Suc_const<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polypoly_polypoly'"><span class="command">lemma</span></span> polypoly_polypoly'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"polypoly <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> polypoly' <span class="free">bs</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> coefficients_normh<span class="main">[</span><span class="operator">OF</span> np<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> cn_norm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span><span class="main">∈</span> <span class="var">?cf</span><span class="main">.</span> isnpolyh <span class="bound">q</span> <span class="free">n0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?cf</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> q cn_norm <span class="keyword1"><span class="command">have</span></span> th<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">q</span> <span class="free">n0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> coefficients_isconst<span class="main">[</span><span class="operator">OF</span> np<span class="main">]</span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isconstant <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> isconstant_polybound0<span class="main">[</span><span class="operator">OF</span> th<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"polybound0 <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="var">?cf</span><span class="main">.</span> polybound0 <span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="main">∈</span> <span class="var">?cf</span><span class="main">.</span> Ipoly <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="bound">q</span> <span class="main">=</span> Ipoly <span class="free">bs</span> <span class="main">(</span>decrpoly <span class="bound">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> polybound0_I<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> bs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">bs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">y</span></span><span class="main">]</span> decrpoly<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> bs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">bs</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> polypoly_def polypoly'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-polypoly_poly"><span class="command">lemma</span></span> polypoly_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> poly <span class="main">(</span>polypoly <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> coefficients.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polypoly_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polypoly'_poly"><span class="command">lemma</span></span> polypoly'_poly<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> poly <span class="main">(</span>polypoly' <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polypoly_poly<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">simplified</span> polypoly_polypoly'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Polynomial_Expression-polypoly_poly_polybound0"><span class="command">lemma</span></span> polypoly_poly_polybound0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"polybound0 <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"polypoly <span class="free">bs</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[</span>Ipoly <span class="free">bs</span> <span class="free">p</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> polypoly_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> nat a<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">nat</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Polynomial_Expression-head_isnpolyh"><span class="command">lemma</span></span> head_isnpolyh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="free">n0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> head.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-headn_nz"><span class="command">lemma</span></span> headn_nz<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> headn <span class="free">p</span> <span class="free">m</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-head_eq_headn0"><span class="command">lemma</span></span> head_eq_headn0<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="free">p</span> <span class="main">=</span> headn <span class="free">p</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> head.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-head_nz"><span class="command">lemma</span></span> head_nz<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> head <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> head_eq_headn0<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-isnpolyh_zero_iff"><span class="command">lemma</span></span> isnpolyh_zero_iff<span class="main">:</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq <span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">bs</span><span class="main">.</span> wf_bs <span class="bound">bs</span> <span class="free">p</span> <span class="main">⟶</span> Ipoly <span class="bound">bs</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nq eq
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"maxindex <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">note</span></span> np <span class="main">=</span> <span class="quoted"><span class="quoted">‹isnpolyh <span class="skolem">p</span> <span class="skolem">n0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> zp <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">bs</span><span class="main">.</span> wf_bs <span class="bound">bs</span> <span class="skolem">p</span> <span class="main">⟶</span> Ipoly <span class="bound">bs</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"maxindex <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> C <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> np <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> zp np <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"maxindex <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"head <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?hd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"decrpoly <span class="var">?h</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ihd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"maxindex <span class="var">?hd</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> head_isnpolyh<span class="main">[</span><span class="operator">OF</span> np<span class="main">]</span> head_polybound0<span class="main">[</span><span class="operator">OF</span> np<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?h</span> <span class="skolem">n0</span>"</span></span> <span class="quoted"><span class="quoted">"polybound0 <span class="var">?h</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nhd<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="var">?hd</span> <span class="main">(</span><span class="skolem">n0</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> decrpoly_normh <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> maxindex_coefficients<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> coefficients_head<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> mihn<span class="main">:</span> <span class="quoted"><span class="quoted">"maxindex <span class="var">?h</span> <span class="main">≤</span> maxindex <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> decr_maxindex<span class="main">[</span><span class="operator">OF</span> h<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> nz <span class="keyword1"><span class="command">have</span></span> ihd_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ihd</span> <span class="main">&lt;</span> maxindex <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> bs<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="skolem">bs</span> <span class="var">?hd</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ts</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="var">?ihd</span> <span class="skolem">bs</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"drop <span class="var">?ihd</span> <span class="skolem">bs</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> ts<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="var">?ts</span> <span class="var">?hd</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bs <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> bs_ts_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ts</span> <span class="main">@</span> <span class="var">?rs</span> <span class="main">=</span> <span class="skolem">bs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> wf_bs_decrpoly<span class="main">[</span><span class="operator">OF</span> ts<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> tsh<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> wf_bs <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="var">?ts</span><span class="main">)</span> <span class="var">?h</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> ihd_lt_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> length <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="var">?ts</span><span class="main">)</span> <span class="main">≤</span> maxindex <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> length_le_list_ex <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="var">?ts</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> maxindex <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> wf_bs <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="var">?ts</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> zp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> Ipoly <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="var">?ts</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> Ipoly <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="main">(</span><span class="var">?ts</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> polypoly_poly<span class="main">[</span><span class="operator">OF</span> np<span class="main">]</span> polypoly_polypoly'<span class="main">[</span><span class="operator">OF</span> np<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>polypoly' <span class="main">(</span><span class="var">?ts</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> poly <span class="main">[]</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>polypoly' <span class="main">(</span><span class="var">?ts</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> poly <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> set <span class="main">(</span>coefficients <span class="skolem">p</span><span class="main">)</span><span class="main">.</span> Ipoly <span class="main">(</span><span class="var">?ts</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">(</span>decrpoly <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_zero polypoly'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> coefficients_head<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> th0<span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">(</span><span class="var">?ts</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="var">?hd</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> bs <span class="keyword1"><span class="command">have</span></span> wf''<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_bs <span class="var">?ts</span> <span class="var">?hd</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> wf_bs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> th0 wf_bs_I<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?ts</span></span></span> <span class="var"><span class="quoted"><span class="var">?hd</span></span></span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="var">?ts</span> <span class="var">?hd</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> wf'' wf_bs_I<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?ts</span></span></span> <span class="var"><span class="quoted"><span class="var">?hd</span></span></span> <span class="var"><span class="quoted"><span class="var">?rs</span></span></span><span class="main">]</span> bs_ts_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="skolem">bs</span> <span class="var">?hd</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hdz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">bs</span><span class="main">.</span> wf_bs <span class="bound">bs</span> <span class="var">?hd</span> <span class="main">⟶</span> Ipoly <span class="bound">bs</span> <span class="var">?hd</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ihd_lt_n nhd<span class="main">]</span> hdz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?hd</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> head_nz<span class="main">[</span><span class="operator">OF</span> np<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-isnpolyh_unique"><span class="command">lemma</span></span> isnpolyh_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">bs</span><span class="main">.</span> Ipoly <span class="bound">bs</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>Ipoly <span class="bound">bs</span> <span class="free">q</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>idom_char_0<span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">bs</span><span class="main">.</span> <span class="main">(</span>Ipoly <span class="bound">bs</span> <span class="free">p</span> <span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="bound">bs</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">bs</span><span class="main">.</span> Ipoly <span class="bound">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">bs</span><span class="main">.</span> wf_bs <span class="bound">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">⟶</span> Ipoly <span class="bound">bs</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> wf_bs_polysub<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">p</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> isnpolyh_zero_iff<span class="main">[</span><span class="operator">OF</span> polysub_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> np nq<span class="main"><span class="main">]</span></span><span class="main">]</span> polysub_0<span class="main">[</span><span class="operator">OF</span> np nq<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹consequences of unicity on the algorithms for polynomial normalization›</span></span>

<span class="keyword1" id="Polynomial_Expression-polyadd_commute"><span class="command">lemma</span></span> polyadd_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isnpolyh_unique<span class="main">[</span><span class="operator">OF</span> polyadd_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> np nq<span class="main"><span class="main">]</span></span> polyadd_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nq np<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Polynomial_Expression-zero_normh"><span class="command">lemma</span></span> zero_normh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Polynomial_Expression-one_normh"><span class="command">lemma</span></span> one_normh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="main">1</span><span class="keyword1">)<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Polynomial_Expression-polyadd_0"><span class="command">lemma</span></span> polyadd_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>idom_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isnpolyh_unique<span class="main">[</span><span class="operator">OF</span> polyadd_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> np zero_normh<span class="main"><span class="main">]</span></span> np<span class="main">]</span>
    isnpolyh_unique<span class="main">[</span><span class="operator">OF</span> polyadd_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_normh np<span class="main"><span class="main">]</span></span> np<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-polymul_1"><span class="command">lemma</span></span> polymul_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span><span class="main">1</span><span class="keyword1">)<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="keyword1">)<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isnpolyh_unique<span class="main">[</span><span class="operator">OF</span> polymul_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> np one_normh<span class="main"><span class="main">]</span></span> np<span class="main">]</span>
    isnpolyh_unique<span class="main">[</span><span class="operator">OF</span> polymul_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> one_normh np<span class="main"><span class="main">]</span></span> np<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-polymul_0"><span class="command">lemma</span></span> polymul_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isnpolyh_unique<span class="main">[</span><span class="operator">OF</span> polymul_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> np zero_normh<span class="main"><span class="main">]</span></span> zero_normh<span class="main">]</span>
    isnpolyh_unique<span class="main">[</span><span class="operator">OF</span> polymul_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> zero_normh np<span class="main"><span class="main">]</span></span> zero_normh<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-polymul_commute"><span class="command">lemma</span></span> polymul_commute<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isnpolyh_unique<span class="main">[</span><span class="operator">OF</span> polymul_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> np nq<span class="main"><span class="main">]</span></span> polymul_normh<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nq np<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">declare</span></span> polyneg_polyneg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1" id="Polynomial_Expression-isnpolyh_polynate_id"><span class="command">lemma</span></span> isnpolyh_polynate_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"polynate <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isnpolyh_unique<span class="main">[</span><span class="operator">OF</span> polynate_norm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> isnpoly_def<span class="main"><span class="main">]</span></span> np<span class="main">]</span>
    polynate
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Polynomial_Expression-polynate_idempotent"><span class="command">lemma</span></span> polynate_idempotent<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field_char_0 poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"polynate <span class="main">(</span>polynate <span class="free">p</span><span class="main">)</span> <span class="main">=</span> polynate <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isnpolyh_polynate_id<span class="main">[</span><span class="operator">OF</span> polynate_norm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> isnpoly_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Polynomial_Expression-poly_nate_polypoly'"><span class="command">lemma</span></span> poly_nate_polypoly'<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_nate <span class="free">bs</span> <span class="free">p</span> <span class="main">=</span> polypoly' <span class="free">bs</span> <span class="main">(</span>polynate <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_nate_def polypoly'_def <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Polynomial_Expression-poly_nate_poly"><span class="command">lemma</span></span> poly_nate_poly<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="main">(</span>poly_nate <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span>field<span class="main">.</span> Ipoly <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polypoly'_poly<span class="main">[</span><span class="operator">OF</span> polynate_norm<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> isnpoly_def<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poly_nate_polypoly' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹heads, degrees and all that›</span></span>

<span class="keyword1" id="Polynomial_Expression-degree_eq_degreen0"><span class="command">lemma</span></span> degree_eq_degreen0<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degreen <span class="free">p</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degree.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-degree_polyneg"><span class="command">lemma</span></span> degree_polyneg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>polyneg <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyneg.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">na</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Polynomial_Expression-degree_polyadd"><span class="command">lemma</span></span> degree_polyadd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">}</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> degreen_polyadd<span class="main">[</span><span class="operator">OF</span> np nq<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_eq_degreen0<span class="main">)</span>


<span class="keyword1" id="Polynomial_Expression-degree_polysub"><span class="command">lemma</span></span> degree_polysub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> polyneg_normh<span class="main">[</span><span class="operator">OF</span> nq<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> nq'<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="free">n1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> degree_polyadd<span class="main">[</span><span class="operator">OF</span> np nq'<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polysub_def degree_polyneg<span class="main"><span class="main">[</span></span><span class="operator">OF</span> nq<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-degree_polysub_samehead"><span class="command">lemma</span></span> degree_polysub_samehead<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="free">p</span> <span class="main">=</span> head <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">p</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> polysub_def split_def fst_conv snd_conv
  <span class="keyword1"><span class="command">using</span></span> np nq h d
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span> <span class="skolem">c'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nsub_def Nsub0<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> Nsub_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">c</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>C <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>C <span class="skolem">c'</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span>
    <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">n0</span>"</span></span>
    <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span> <span class="free">n1</span>"</span></span>
    <span class="quoted"><span class="quoted">"head <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> head <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"degree <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> degc<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degc'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">c'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> degnc<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> degnc'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>1-2<span class="main">)</span> degc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> degree_polyneg<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> cnh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'nh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> degree_polysub<span class="main">[</span><span class="operator">OF</span> cnh c'nh<span class="main">,</span> <span class="operator">simplified</span> polysub_def<span class="main">]</span> degc degc'
  <span class="keyword1"><span class="command">have</span></span> degcmc'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span>  <span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span><span class="skolem">c'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> pnh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p'nh<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p'</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4 nn'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def degcmc'<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> nn' H<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>  cc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pp'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> polysub_same_0<span class="main">[</span><span class="operator">OF</span> p'nh<span class="main">,</span> <span class="operator">simplified</span> polysub_def split_def fst_conv snd_conv<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> polysub_same_0<span class="main">[</span><span class="operator">OF</span> c'nh<span class="main">,</span> <span class="operator">simplified</span> polysub_def<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> nn' 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n'p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> headcnp'<span class="main">:</span><span class="quoted"><span class="quoted">"head <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">have</span></span> degcnp'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> degcnpeq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 4 nn' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> headcnp<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> H<span class="main">(</span>3<span class="main">)</span> headcnp headcnp' nn' <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> headcnp<span class="main">:</span><span class="quoted"><span class="quoted">"head <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> degcnpeq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> degree <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> np <span class="keyword1"><span class="command">have</span></span> degcnp<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> degcnpeq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> headcnp'<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> H<span class="main">(</span>3<span class="main">)</span> headcnp headcnp' nn' <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-shift1_head"><span class="command">lemma</span></span> shift1_head <span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> head <span class="main">(</span>shift1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> head <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> head.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-funpow_shift1_head"><span class="command">lemma</span></span> funpow_shift1_head<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟹</span> head <span class="main">(</span>funpow <span class="free">k</span> shift1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> head <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="skolem">n0</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>shift1 <span class="skolem">p</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_isnpolyh<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>funpow <span class="skolem">k</span> shift1 <span class="main">(</span>shift1 <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> head <span class="main">(</span>shift1 <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>shift1 <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> head <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_head<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_swap1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-shift1_degree"><span class="command">lemma</span></span> shift1_degree<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>shift1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-funpow_shift1_degree"><span class="command">lemma</span></span> funpow_shift1_degree<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>funpow <span class="free">k</span> shift1 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">+</span> degree <span class="free">p</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shift1_degree<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-funpow_shift1_nz"><span class="command">lemma</span></span> funpow_shift1_nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟹</span> funpow <span class="free">n</span> shift1 <span class="free">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-head_isnpolyh_Suc"><span class="command">lemma</span></span> head_isnpolyh_Suc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> head <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degree.induct<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1" id="Polynomial_Expression-headn_0"><span class="command">lemma</span></span> headn_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> headn <span class="free">p</span> <span class="free">m</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degreen.induct<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1" id="Polynomial_Expression-head_isnpolyh_Suc'"><span class="command">lemma</span></span> head_isnpolyh_Suc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> head <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degree.induct<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1" id="Polynomial_Expression-head_head"><span class="command">lemma</span></span> head_head<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> head <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">=</span> head <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> head.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polyadd_eq_const_degree"><span class="command">lemma</span></span> polyadd_eq_const_degree<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="free">q</span> <span class="free">n1</span> <span class="main">⟹</span> polyadd <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> C <span class="free">c</span> <span class="main">⟹</span> degree <span class="free">p</span> <span class="main">=</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polyadd_eq_const_degreen <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_eq_degreen0<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polyadd_head"><span class="command">lemma</span></span> polyadd_head<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≠</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"head <span class="main">(</span><span class="free">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> degree <span class="free">p</span> <span class="main">&lt;</span> degree <span class="free">q</span> <span class="keyword1">then</span> head <span class="free">q</span> <span class="keyword1">else</span> head <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> np nq deg
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">n1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">n'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polyadd_eq_const_degree<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> head_nz<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> head_nz<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> degree.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> gr0_conv_Suc head.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_Suc0 not_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Polynomial_Expression-polymul_head_polyeq"><span class="command">lemma</span></span> polymul_head_polyeq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="free">q</span> <span class="free">n1</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟹</span> <span class="free">q</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟹</span> head <span class="main">(</span><span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> head <span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> head <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quoted"><span class="free">n1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polymul.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">c</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span> <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>head <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> head_isnpolyh<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>head <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> head_isnpolyh<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span> <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> norm<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">p'</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="skolem">c'</span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span> <span class="main">∨</span> <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> norm <span class="quoted">"4.hyps"</span><span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted">"4.hyps"</span><span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span><span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> norm <span class="quoted">"4.hyps"</span><span class="main">(</span>6<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted">"4.hyps"</span><span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> nn'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> nn' polymul_normh<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> ncnpc'<span class="main">:</span><span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> nn' polymul_normh<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> norm
    <span class="keyword1"><span class="command">have</span></span> ncnpp'<span class="main">:</span><span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> nn' ncnpp' polymul_eq0_iff<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> norm<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ncnpp0'<span class="main">:</span><span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> polyadd_normh<span class="main">[</span><span class="operator">OF</span> ncnpc' ncnpp0'<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> nth<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="main">(</span><span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">n</span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> nn' head_isnpolyh_Suc'<span class="main">[</span><span class="operator">OF</span> np nth<span class="main">]</span>
        head_isnpolyh_Suc'<span class="main">[</span><span class="operator">OF</span> np norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> head_isnpolyh_Suc'<span class="main">[</span><span class="operator">OF</span> np norm<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span> nn'<span class="main"><span class="main">]</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> polymul_degreen<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span>
        polymul_degreen<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span> nn' nz degree_eq_degreen0
      norm<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> degree_npolyhCN<span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> dth<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>CN <span class="skolem">c</span> <span class="main">0</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">0</span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="main">0</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted">"4.prems"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> One_nat_def add_Suc add_less_imp_less_left comm_monoid_add_class.add_0 degree.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eq_imp_le gr_implies_not0 head.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> head_nz min_0L norm<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_less_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dth'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>CN <span class="skolem">c</span> <span class="main">0</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">c'</span><span class="main">)</span> <span class="main">≠</span> degree <span class="main">(</span>CN <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">0</span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="main">0</span> <span class="skolem">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> polyadd_head<span class="main">[</span><span class="operator">OF</span> ncnpc'<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> nz<span class="main"><span class="main">]</span></span> ncnpp0'<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> nz<span class="main"><span class="main">]</span></span> dth'<span class="main">]</span> dth
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> norm <span class="quoted">"4.hyps"</span><span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="quoted">"4.hyps"</span><span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> nn' nz
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-degree_coefficients"><span class="command">lemma</span></span> degree_coefficients<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> length <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degree.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-degree_head"><span class="command">lemma</span></span> degree_head<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> head.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-degree_CN"><span class="command">lemma</span></span> degree_CN<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> degree <span class="main">(</span>CN <span class="free">c</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-degree_CN'"><span class="command">lemma</span></span> degree_CN'<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> degree <span class="main">(</span>CN <span class="free">c</span> <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">≥</span>  degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-polyadd_different_degree"><span class="command">lemma</span></span> polyadd_different_degree<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isnpolyh <span class="free">q</span> <span class="free">n1</span> <span class="main">⟹</span> degree <span class="free">p</span> <span class="main">≠</span> degree <span class="free">q</span> <span class="main">⟹</span>
    degree <span class="main">(</span>polyadd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">(</span>degree <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_eq_degreen0 polyadd_different_degreen<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-degreen_polyneg"><span class="command">lemma</span></span> degreen_polyneg<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> degreen <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span><span class="main">)</span> <span class="free">m</span> <span class="main">=</span> degreen <span class="free">p</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyneg.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-degree_polymul"><span class="command">lemma</span></span> degree_polymul<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">q</span> <span class="free">n1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">p</span> <span class="main">+</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> polymul_degreen<span class="main">[</span><span class="operator">OF</span> np nq<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> degree_eq_degreen0<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-polyneg_degree"><span class="command">lemma</span></span> polyneg_degree<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> degree <span class="main">(</span>polyneg <span class="free">p</span><span class="main">)</span> <span class="main">=</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degree.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-polyneg_head"><span class="command">lemma</span></span> polyneg_head<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> head <span class="main">(</span>polyneg <span class="free">p</span><span class="main">)</span> <span class="main">=</span> polyneg <span class="main">(</span>head <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> degree.induct<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Correctness of polynomial pseudo division›</span></span>

<span class="comment1">(*lemma polydivide_aux_properties:
  fixes p :: "'a::field poly"
  assumes np: "isnpolyh p n0"
    and ns: "isnpolyh s n1"
    and ap: "head p = a"
    and ndp: "degree p = n"
    and pnz: "p ≠ 0<span class="hidden">⇩</span><sub>p</sub>"
  shows "polydivide_aux a n p k s = (k', r) ⟶ k' ≥ k ∧ (degree r = 0 ∨ degree r &lt; degree p) ∧
    (∃nr. isnpolyh r nr) ∧ (∃q n1. isnpolyh q n1 ∧ (polypow (k' - k) a) *<span class="hidden">⇩</span><sub>p</sub> s = p *<span class="hidden">⇩</span><sub>p</sub> q +<span class="hidden">⇩</span><sub>p</sub> r)"
  using ns
proof (induct "degree s" arbitrary: s k k' r n1 rule: less_induct)
  case less
  let ?qths = "∃q n1. isnpolyh q n1 ∧ (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> s = p *<span class="hidden">⇩</span><sub>p</sub> q +<span class="hidden">⇩</span><sub>p</sub> r)"
  let ?ths = "polydivide_aux a n p k s = (k', r) ⟶  k ≤ k' ∧
    (degree r = 0 ∨ degree r &lt; degree p) ∧ (∃nr. isnpolyh r nr) ∧ ?qths"
  let ?b = "head s"
  let ?p' = "funpow (degree s - n) shift1 p"
  let ?xdn = "funpow (degree s - n) shift1 (1)<span class="hidden">⇩</span><sub>p</sub>"
  let ?akk' = "a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k)"
  note ns = ‹isnpolyh s n1›
  from np have np0: "isnpolyh p 0"
    using isnpolyh_mono[where n="n0" and n'="0" and p="p"] by simp
  have np': "isnpolyh ?p' 0"
    using funpow_shift1_isnpoly[OF np0[simplified isnpoly_def[symmetric]] pnz, where n="degree s - n"]
    by (simp add: isnpoly_def)
  have headp': "head ?p' = head p"
    using funpow_shift1_head[OF np pnz] by simp
  from funpow_shift1_isnpoly[where p="(1)<span class="hidden">⇩</span><sub>p</sub>"] have nxdn: "isnpolyh ?xdn 0"
    (*by (simp add: isnpoly_def)*)
    sorry
  from polypow_normh [OF head_isnpolyh[OF np0], where k="k' - k"] ap
  have nakk':"isnpolyh ?akk' 0" by blast
  {
    assume sz: "s = 0<span class="hidden">⇩</span><sub>p</sub>"
    then have ?ths
      using np polydivide_aux.simps
      apply clarsimp
      apply (rule exI[where x="0<span class="hidden">⇩</span><sub>p</sub>"])
      apply simp
      done
  }
  moreover
  {
    assume sz: "s ≠ 0<span class="hidden">⇩</span><sub>p</sub>"
    {
      assume dn: "degree s &lt; n"
      then have "?ths"
        using ns ndp np polydivide_aux.simps
        apply auto
        apply (rule exI[where x="0<span class="hidden">⇩</span><sub>p</sub>"])
        apply simp
        done
    }
    moreover
    {
      assume dn': "¬ degree s &lt; n"
      then have dn: "degree s ≥ n"
        by arith
      have degsp': "degree s = degree ?p'"
        using dn ndp funpow_shift1_degree[where k = "degree s - n" and p="p"]
        by simp
      {
        assume ba: "?b = a"
        then have headsp': "head s = head ?p'"
          using ap headp' by simp
        have nr: "isnpolyh (s -<span class="hidden">⇩</span><sub>p</sub> ?p') 0"
          using polysub_normh[OF ns np'] by simp
        from degree_polysub_samehead[OF ns np' headsp' degsp']
        have "degree (s -<span class="hidden">⇩</span><sub>p</sub> ?p') &lt; degree s ∨ s -<span class="hidden">⇩</span><sub>p</sub> ?p' = 0<span class="hidden">⇩</span><sub>p</sub>"
          by simp
        moreover
        {
          assume deglt:"degree (s -<span class="hidden">⇩</span><sub>p</sub> ?p') &lt; degree s"
          from polydivide_aux.simps sz dn' ba
          have eq: "polydivide_aux a n p k s = polydivide_aux a n p k (s -<span class="hidden">⇩</span><sub>p</sub> ?p')"
            by (simp add: Let_def)
          {
            assume h1: "polydivide_aux a n p k s = (k', r)"
            from less(1)[OF deglt nr, of k k' r] trans[OF eq[symmetric] h1]
            have kk': "k ≤ k'"
              and nr: "∃nr. isnpolyh r nr"
              and dr: "degree r = 0 ∨ degree r &lt; degree p"
              and q1: "∃q nq. isnpolyh q nq ∧ a ^<span class="hidden">⇩</span><sub>p</sub> k' - k *<span class="hidden">⇩</span><sub>p</sub> (s -<span class="hidden">⇩</span><sub>p</sub> ?p') = p *<span class="hidden">⇩</span><sub>p</sub> q +<span class="hidden">⇩</span><sub>p</sub> r"
              by auto
            from q1 obtain q n1 where nq: "isnpolyh q n1"
              and asp: "a^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> (s -<span class="hidden">⇩</span><sub>p</sub> ?p') = p *<span class="hidden">⇩</span><sub>p</sub> q +<span class="hidden">⇩</span><sub>p</sub> r"
              by blast
            from nr obtain nr where nr': "isnpolyh r nr"
              by blast
            from polymul_normh[OF nakk' ns] have nakks': "isnpolyh (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> s) 0"
              by simp
            from polyadd_normh[OF polymul_normh[OF nakk' nxdn] nq]
            have nq': "isnpolyh (?akk' *<span class="hidden">⇩</span><sub>p</sub> ?xdn +<span class="hidden">⇩</span><sub>p</sub> q) 0" by simp
            from polyadd_normh[OF polymul_normh[OF np
              polyadd_normh[OF polymul_normh[OF nakk' nxdn] nq]] nr']
            have nqr': "isnpolyh (p *<span class="hidden">⇩</span><sub>p</sub> (?akk' *<span class="hidden">⇩</span><sub>p</sub> ?xdn +<span class="hidden">⇩</span><sub>p</sub> q) +<span class="hidden">⇩</span><sub>p</sub> r) 0"
              by simp
            from asp have "∀bs :: 'a::{field_char_0,field} list.
              Ipoly bs (a^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> (s -<span class="hidden">⇩</span><sub>p</sub> ?p')) = Ipoly bs (p *<span class="hidden">⇩</span><sub>p</sub> q +<span class="hidden">⇩</span><sub>p</sub> r)"
              by simp
            then have "∀bs :: 'a::{field_char_0,field} list.
              Ipoly bs (a^<span class="hidden">⇩</span><sub>p</sub> (k' - k)*<span class="hidden">⇩</span><sub>p</sub> s) =
              Ipoly bs (a^<span class="hidden">⇩</span><sub>p</sub> (k' - k)) * Ipoly bs ?p' + Ipoly bs p * Ipoly bs q + Ipoly bs r"
              by (simp add: field_simps)
            then have "∀bs :: 'a::{field_char_0,field} list.
              Ipoly bs (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> s) =
              Ipoly bs (a^<span class="hidden">⇩</span><sub>p</sub> (k' - k)) * Ipoly bs (funpow (degree s - n) shift1 (1)<span class="hidden">⇩</span><sub>p</sub> *<span class="hidden">⇩</span><sub>p</sub> p) +
              Ipoly bs p * Ipoly bs q + Ipoly bs r"
              by (auto simp only: funpow_shift1_1)
            then have "∀bs:: 'a::{field_char_0,field} list.
              Ipoly bs (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> s) =
              Ipoly bs p * (Ipoly bs (a^<span class="hidden">⇩</span><sub>p</sub> (k' - k)) * Ipoly bs (funpow (degree s - n) shift1 (1)<span class="hidden">⇩</span><sub>p</sub>) +
              Ipoly bs q) + Ipoly bs r"
              by (simp add: field_simps)
            then have "∀bs:: 'a::{field_char_0,field} list.
              Ipoly bs (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> s) =
              Ipoly bs (p *<span class="hidden">⇩</span><sub>p</sub> ((a^<span class="hidden">⇩</span><sub>p</sub> (k' - k)) *<span class="hidden">⇩</span><sub>p</sub> (funpow (degree s - n) shift1 (1)<span class="hidden">⇩</span><sub>p</sub>) +<span class="hidden">⇩</span><sub>p</sub> q) +<span class="hidden">⇩</span><sub>p</sub> r)"
              by simp
            with isnpolyh_unique[OF nakks' nqr']
            have "a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> s =
              p *<span class="hidden">⇩</span><sub>p</sub> ((a^<span class="hidden">⇩</span><sub>p</sub> (k' - k)) *<span class="hidden">⇩</span><sub>p</sub> (funpow (degree s - n) shift1 (1)<span class="hidden">⇩</span><sub>p</sub>) +<span class="hidden">⇩</span><sub>p</sub> q) +<span class="hidden">⇩</span><sub>p</sub> r"
              by blast
            then have ?qths using nq'
              apply (rule_tac x="(a^<span class="hidden">⇩</span><sub>p</sub> (k' - k)) *<span class="hidden">⇩</span><sub>p</sub> (funpow (degree s - n) shift1 (1)<span class="hidden">⇩</span><sub>p</sub>) +<span class="hidden">⇩</span><sub>p</sub> q" in exI)
              apply (rule_tac x="0" in exI)
              apply simp
              done
            with kk' nr dr have "k ≤ k' ∧ (degree r = 0 ∨ degree r &lt; degree p) ∧
              (∃nr. isnpolyh r nr) ∧ ?qths"
              by blast
          }
          then have ?ths by blast
        }
        moreover
        {
          assume spz:"s -<span class="hidden">⇩</span><sub>p</sub> ?p' = 0<span class="hidden">⇩</span><sub>p</sub>"
          from spz isnpolyh_unique[OF polysub_normh[OF ns np'], where q="0<span class="hidden">⇩</span><sub>p</sub>", symmetric, where ?'a = "'a::{field_char_0,field}"]
          have "∀bs:: 'a::{field_char_0,field} list. Ipoly bs s = Ipoly bs ?p'"
            by simp
          then have "∀bs:: 'a::{field_char_0,field} list. Ipoly bs s = Ipoly bs (?xdn *<span class="hidden">⇩</span><sub>p</sub> p)"
            using np nxdn
            apply simp
            apply (simp only: funpow_shift1_1)
            apply simp
            done
          then have sp': "s = ?xdn *<span class="hidden">⇩</span><sub>p</sub> p"
            using isnpolyh_unique[OF ns polymul_normh[OF nxdn np]]
            by blast
          {
            assume h1: "polydivide_aux a n p k s = (k', r)"
            from polydivide_aux.simps sz dn' ba
            have eq: "polydivide_aux a n p k s = polydivide_aux a n p k (s -<span class="hidden">⇩</span><sub>p</sub> ?p')"
              by (simp add: Let_def)
            also have "… = (k,0<span class="hidden">⇩</span><sub>p</sub>)"
              using polydivide_aux.simps spz by simp
            finally have "(k', r) = (k, 0<span class="hidden">⇩</span><sub>p</sub>)"
              using h1 by simp
            with sp'[symmetric] ns np nxdn polyadd_0(1)[OF polymul_normh[OF np nxdn]]
              polyadd_0(2)[OF polymul_normh[OF np nxdn]] have ?ths
              apply auto
              apply (rule exI[where x="?xdn"])
              apply (auto simp add: polymul_commute[of p])
              done
          }
        }
        ultimately have ?ths by blast
      }
      moreover
      {
        assume ba: "?b ≠ a"
        from polysub_normh[OF polymul_normh[OF head_isnpolyh[OF np0, simplified ap] ns]
          polymul_normh[OF head_isnpolyh[OF ns] np']]
        have nth: "isnpolyh ((a *<span class="hidden">⇩</span><sub>p</sub> s) -<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?p')) 0"
          by (simp add: min_def)
        have nzths: "a *<span class="hidden">⇩</span><sub>p</sub> s ≠ 0<span class="hidden">⇩</span><sub>p</sub>" "?b *<span class="hidden">⇩</span><sub>p</sub> ?p' ≠ 0<span class="hidden">⇩</span><sub>p</sub>"
          using polymul_eq0_iff[OF head_isnpolyh[OF np0, simplified ap] ns]
            polymul_eq0_iff[OF head_isnpolyh[OF ns] np']head_nz[OF np0] ap pnz sz head_nz[OF ns]
            funpow_shift1_nz[OF pnz]
          by simp_all
        from polymul_head_polyeq[OF head_isnpolyh[OF np] ns] head_nz[OF np] sz ap head_head[OF np] pnz
          polymul_head_polyeq[OF head_isnpolyh[OF ns] np'] head_nz [OF ns] sz funpow_shift1_nz[OF pnz, where n="degree s - n"]
        have hdth: "head (a *<span class="hidden">⇩</span><sub>p</sub> s) = head (?b *<span class="hidden">⇩</span><sub>p</sub> ?p')"
          using head_head[OF ns] funpow_shift1_head[OF np pnz]
            polymul_commute[OF head_isnpolyh[OF np] head_isnpolyh[OF ns]]
          by (simp add: ap)
        from polymul_degreen[OF head_isnpolyh[OF np] ns, where m="0"]
          head_nz[OF np] pnz sz ap[symmetric]
          funpow_shift1_nz[OF pnz, where n="degree s - n"]
          polymul_degreen[OF head_isnpolyh[OF ns] np', where m="0"] head_nz[OF ns]
          ndp dn
        have degth: "degree (a *<span class="hidden">⇩</span><sub>p</sub> s) = degree (?b *<span class="hidden">⇩</span><sub>p</sub> ?p')"
          by (simp add: degree_eq_degreen0[symmetric] funpow_shift1_degree)
        {
          assume dth: "degree ((a *<span class="hidden">⇩</span><sub>p</sub> s) -<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?p')) &lt; degree s"
          from polysub_normh[OF polymul_normh[OF head_isnpolyh[OF np] ns]
            polymul_normh[OF head_isnpolyh[OF ns]np']] ap
          have nasbp': "isnpolyh ((a *<span class="hidden">⇩</span><sub>p</sub> s) -<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?p')) 0"
            by simp
          {
            assume h1:"polydivide_aux a n p k s = (k', r)"
            from h1 polydivide_aux.simps sz dn' ba
            have eq:"polydivide_aux a n p (Suc k) ((a *<span class="hidden">⇩</span><sub>p</sub> s) -<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?p')) = (k',r)"
              by (simp add: Let_def)
            with less(1)[OF dth nasbp', of "Suc k" k' r]
            obtain q nq nr where kk': "Suc k ≤ k'"
              and nr: "isnpolyh r nr"
              and nq: "isnpolyh q nq"
              and dr: "degree r = 0 ∨ degree r &lt; degree p"
              and qr: "a ^<span class="hidden">⇩</span><sub>p</sub> (k' - Suc k) *<span class="hidden">⇩</span><sub>p</sub> ((a *<span class="hidden">⇩</span><sub>p</sub> s) -<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?p')) = p *<span class="hidden">⇩</span><sub>p</sub> q +<span class="hidden">⇩</span><sub>p</sub> r"
              by auto
            from kk' have kk'': "Suc (k' - Suc k) = k' - k"
              by arith
            {
              fix bs :: "'a::{field_char_0,field} list"
              from qr isnpolyh_unique[OF polypow_normh[OF head_isnpolyh[OF np], where k="k' - Suc k", simplified ap] nasbp', symmetric]
              have "Ipoly bs (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - Suc k) *<span class="hidden">⇩</span><sub>p</sub> ((a *<span class="hidden">⇩</span><sub>p</sub> s) -<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?p'))) = Ipoly bs (p *<span class="hidden">⇩</span><sub>p</sub> q +<span class="hidden">⇩</span><sub>p</sub> r)"
                by simp
              then have "Ipoly bs a ^ (Suc (k' - Suc k)) * Ipoly bs s =
                Ipoly bs p * Ipoly bs q + Ipoly bs a ^ (k' - Suc k) * Ipoly bs ?b * Ipoly bs ?p' + Ipoly bs r"
                by (simp add: field_simps)
              then have "Ipoly bs a ^ (k' - k)  * Ipoly bs s =
                Ipoly bs p * Ipoly bs q + Ipoly bs a ^ (k' - Suc k) * Ipoly bs ?b * Ipoly bs ?xdn * Ipoly bs p + Ipoly bs r"
                by (simp add: kk'' funpow_shift1_1[where n="degree s - n" and p="p"])
              then have "Ipoly bs (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> s) =
                Ipoly bs p * (Ipoly bs q + Ipoly bs a ^ (k' - Suc k) * Ipoly bs ?b * Ipoly bs ?xdn) + Ipoly bs r"
                by (simp add: field_simps)
            }
            then have ieq:"∀bs :: 'a::{field_char_0,field} list.
                Ipoly bs (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> s) =
                Ipoly bs (p *<span class="hidden">⇩</span><sub>p</sub> (q +<span class="hidden">⇩</span><sub>p</sub> (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - Suc k) *<span class="hidden">⇩</span><sub>p</sub> ?b *<span class="hidden">⇩</span><sub>p</sub> ?xdn)) +<span class="hidden">⇩</span><sub>p</sub> r)"
              by auto
            let ?q = "q +<span class="hidden">⇩</span><sub>p</sub> (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - Suc k) *<span class="hidden">⇩</span><sub>p</sub> ?b *<span class="hidden">⇩</span><sub>p</sub> ?xdn)"
            from polyadd_normh[OF nq polymul_normh[OF polymul_normh[OF polypow_normh[OF head_isnpolyh[OF np], where k="k' - Suc k"] head_isnpolyh[OF ns], simplified ap] nxdn]]
            have nqw: "isnpolyh ?q 0"
              by simp
            from ieq isnpolyh_unique[OF polymul_normh[OF polypow_normh[OF head_isnpolyh[OF np], where k="k' - k"] ns, simplified ap] polyadd_normh[OF polymul_normh[OF np nqw] nr]]
            have asth: "(a ^<span class="hidden">⇩</span><sub>p</sub> (k' - k) *<span class="hidden">⇩</span><sub>p</sub> s) = p *<span class="hidden">⇩</span><sub>p</sub> (q +<span class="hidden">⇩</span><sub>p</sub> (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - Suc k) *<span class="hidden">⇩</span><sub>p</sub> ?b *<span class="hidden">⇩</span><sub>p</sub> ?xdn)) +<span class="hidden">⇩</span><sub>p</sub> r"
              by blast
            from dr kk' nr h1 asth nqw have ?ths
              apply simp
              apply (rule conjI)
              apply (rule exI[where x="nr"], simp)
              apply (rule exI[where x="(q +<span class="hidden">⇩</span><sub>p</sub> (a ^<span class="hidden">⇩</span><sub>p</sub> (k' - Suc k) *<span class="hidden">⇩</span><sub>p</sub> ?b *<span class="hidden">⇩</span><sub>p</sub> ?xdn))"], simp)
              apply (rule exI[where x="0"], simp)
              done
          }
          then have ?ths by blast
        }
        moreover
        {
          assume spz: "a *<span class="hidden">⇩</span><sub>p</sub> s -<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?p') = 0<span class="hidden">⇩</span><sub>p</sub>"
          {
            fix bs :: "'a::{field_char_0,field} list"
            from isnpolyh_unique[OF nth, where ?'a="'a" and q="0<span class="hidden">⇩</span><sub>p</sub>",simplified,symmetric] spz
            have "Ipoly bs (a*<span class="hidden">⇩</span><sub>p</sub> s) = Ipoly bs ?b * Ipoly bs ?p'"
              by simp
            then have "Ipoly bs (a*<span class="hidden">⇩</span><sub>p</sub> s) = Ipoly bs (?b *<span class="hidden">⇩</span><sub>p</sub> ?xdn) * Ipoly bs p"
              by (simp add: funpow_shift1_1[where n="degree s - n" and p="p"])
            then have "Ipoly bs (a*<span class="hidden">⇩</span><sub>p</sub> s) = Ipoly bs (p *<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?xdn))"
              by simp
          }
          then have hth: "∀bs :: 'a::{field_char_0,field} list.
            Ipoly bs (a *<span class="hidden">⇩</span><sub>p</sub> s) = Ipoly bs (p *<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?xdn))" ..
          from hth have asq: "a *<span class="hidden">⇩</span><sub>p</sub> s = p *<span class="hidden">⇩</span><sub>p</sub> (?b *<span class="hidden">⇩</span><sub>p</sub> ?xdn)"
            using isnpolyh_unique[where ?'a = "'a::{field_char_0,field}", OF polymul_normh[OF head_isnpolyh[OF np] ns]
                    polymul_normh[OF np polymul_normh[OF head_isnpolyh[OF ns] nxdn]],
              simplified ap]
            by simp
          {
            assume h1: "polydivide_aux a n p k s = (k', r)"
            from h1 sz ba dn' spz polydivide_aux.simps polydivide_aux.simps
            have "(k', r) = (Suc k, 0<span class="hidden">⇩</span><sub>p</sub>)"
              by (simp add: Let_def)
            with h1 np head_isnpolyh[OF np, simplified ap] ns polymul_normh[OF head_isnpolyh[OF ns] nxdn]
              polymul_normh[OF np polymul_normh[OF head_isnpolyh[OF ns] nxdn]] asq
            have ?ths
              apply (clarsimp simp add: Let_def)
              apply (rule exI[where x="?b *<span class="hidden">⇩</span><sub>p</sub> ?xdn"])
              apply simp
              apply (rule exI[where x="0"], simp)
              done
          }
          then have ?ths by blast
        }
        ultimately have ?ths
          using degree_polysub_samehead[OF polymul_normh[OF head_isnpolyh[OF np0, simplified ap] ns] polymul_normh[OF head_isnpolyh[OF ns] np'] hdth degth] polymul_degreen[OF head_isnpolyh[OF np] ns, where m="0"]
            head_nz[OF np] pnz sz ap[symmetric]
          by (auto simp add: degree_eq_degreen0[symmetric])
      }
      ultimately have ?ths by blast
    }
    ultimately have ?ths by blast
  }
  ultimately show ?ths by blast
qed

lemma polydivide_properties:
  assumes "SORT_CONSTRAINT('a::{field_char_0,field})"
    and np: "isnpolyh p n0"
    and ns: "isnpolyh s n1"
    and pnz: "p ≠ 0<span class="hidden">⇩</span><sub>p</sub>"
  shows "∃k r. polydivide s p = (k, r) ∧
    (∃nr. isnpolyh r nr) ∧ (degree r = 0 ∨ degree r &lt; degree p) ∧
    (∃q n1. isnpolyh q n1 ∧ polypow k (head p) *<span class="hidden">⇩</span><sub>p</sub> s = p *<span class="hidden">⇩</span><sub>p</sub> q +<span class="hidden">⇩</span><sub>p</sub> r)"
proof -
  have trv: "head p = head p" "degree p = degree p"
    by simp_all
  from polydivide_def[where s="s" and p="p"] have ex: "∃ k r. polydivide s p = (k,r)"
    by auto
  then obtain k r where kr: "polydivide s p = (k,r)"
    by blast
  from trans[OF polydivide_def[where s="s"and p="p", symmetric] kr]
    polydivide_aux_properties[OF np ns trv pnz, where k="0" and k'="k" and r="r"]
  have "(degree r = 0 ∨ degree r &lt; degree p) ∧
    (∃nr. isnpolyh r nr) ∧ (∃q n1. isnpolyh q n1 ∧ head p ^<span class="hidden">⇩</span><sub>p</sub> k - 0 *<span class="hidden">⇩</span><sub>p</sub> s = p *<span class="hidden">⇩</span><sub>p</sub> q +<span class="hidden">⇩</span><sub>p</sub> r)"
    by blast
  with kr show ?thesis
    apply -
    apply (rule exI[where x="k"])
    apply (rule exI[where x="r"])
    apply simp
    done
qed*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More about polypoly and pnormal etc›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">isnonconstant</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟷</span> <span class="main">¬</span> isconstant <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1" id="Polynomial_Expression-isnonconstant_pnormal_iff"><span class="command">lemma</span></span> isnonconstant_pnormal_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnonconstant <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pnormal <span class="main">(</span>polypoly <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> Ipoly <span class="free">bs</span> <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polypoly <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"pnormal <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> csz<span class="main">:</span> <span class="quoted"><span class="quoted">"coefficients <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> coefficients_head<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> last_map<span class="main">[</span><span class="operator">OF</span> csz<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span>"</span></span><span class="main">]</span> pnormal_last_nonzero<span class="main">[</span><span class="operator">OF</span> H<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polypoly_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polypoly <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> csz<span class="main">:</span> <span class="quoted"><span class="quoted">"coefficients <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polypoly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lg<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> h coefficients_head<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> last_map<span class="main">[</span><span class="operator">OF</span> csz<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> lz<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polypoly_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> pnormal_last_length<span class="main">[</span><span class="operator">OF</span> lg lz<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pnormal <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-isnonconstant_coefficients_length"><span class="command">lemma</span></span> isnonconstant_coefficients_length<span class="main">:</span> <span class="quoted"><span class="quoted">"isnonconstant <span class="free">p</span> <span class="main">⟹</span> length <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> isnonconstant_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> nat a<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">nat</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Polynomial_Expression-isnonconstant_nonconstant"><span class="command">lemma</span></span> isnonconstant_nonconstant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnonconstant <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nonconstant <span class="main">(</span>polypoly <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> Ipoly <span class="free">bs</span> <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polypoly <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> nc<span class="main">:</span> <span class="quoted"><span class="quoted">"nonconstant <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> isnonconstant_pnormal_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">bs</span></span><span class="main">]</span> nc
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> nonconstant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polypoly <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> isnonconstant_pnormal_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">bs</span></span><span class="main">]</span> h
  <span class="keyword1"><span class="command">have</span></span> pn<span class="main">:</span> <span class="quoted"><span class="quoted">"pnormal <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>coefficients <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> polypoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> isnonconstant_coefficients_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nonconstant <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pn <span class="keyword1"><span class="command">unfolding</span></span> nonconstant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression-pnormal_length"><span class="command">lemma</span></span> pnormal_length<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> pnormal <span class="free">p</span> <span class="main">⟷</span> length <span class="main">(</span>pnormalize <span class="free">p</span><span class="main">)</span> <span class="main">=</span> length <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pnormal_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Polynomial_Expression-degree_degree"><span class="command">lemma</span></span> degree_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isnonconstant <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> Polynomial_List.degree <span class="main">(</span>polypoly <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> Ipoly <span class="free">bs</span> <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polypoly <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> Polynomial_List.degree <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> isnonconstant_coefficients_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> pz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> polypoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> H degree_coefficients<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> isnonconstant_coefficients_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> lg<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>pnormalize <span class="var">?p</span><span class="main">)</span> <span class="main">=</span> length <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Polynomial_List.degree_def polypoly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pnormal <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pnormal_length<span class="main">[</span><span class="operator">OF</span> pz<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> isnonconstant_pnormal_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"polypoly <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>head <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> isnonconstant_pnormal_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pnormal <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> degree_coefficients<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> isnonconstant_coefficients_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> Polynomial_List.degree <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> polypoly_def pnormal_def Polynomial_List.degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Swaps ; Division by a certain variable›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">swap</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> C <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Bound <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> Bound <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Neg <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Add <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Add <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Sub <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="main">=</span> Mul <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>Pw <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> Pw <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> CN <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">swap</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Polynomial_Expression-swap"><span class="command">lemma</span></span> swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">bs</span> <span class="main">(</span>swap <span class="free">n</span> <span class="free">m</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">[</span><span class="free">n</span><span class="main">:=</span> <span class="free">bs</span><span class="main">!</span><span class="free">m</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">m</span><span class="main">:=</span> <span class="free">bs</span><span class="main">!</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bound <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">k</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-swap_swap_id"><span class="command">lemma</span></span> swap_swap_id <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"swap <span class="free">n</span> <span class="free">m</span> <span class="main">(</span>swap <span class="free">m</span> <span class="free">n</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-swap_commute"><span class="command">lemma</span></span> swap_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"swap <span class="free">n</span> <span class="free">m</span> <span class="free">p</span> <span class="main">=</span> swap <span class="free">m</span> <span class="free">n</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression-swap_same_id"><span class="command">lemma</span></span> swap_same_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"swap <span class="free">n</span> <span class="free">n</span> <span class="free">t</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">swapnorm</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> polynate <span class="main">(</span>swap <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Polynomial_Expression-swapnorm"><span class="command">lemma</span></span> swapnorm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nbs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mbs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Ipoly <span class="free">bs</span> <span class="main">(</span>swapnorm <span class="free">n</span> <span class="free">m</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    Ipoly <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">[</span><span class="free">n</span><span class="main">:=</span> <span class="free">bs</span><span class="main">!</span><span class="free">m</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">m</span><span class="main">:=</span> <span class="free">bs</span><span class="main">!</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> swap<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> swapnorm_def<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression-swapnorm_isnpoly"><span class="command">lemma</span></span> swapnorm_isnpoly <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>field poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isnpoly <span class="main">(</span>swapnorm <span class="free">n</span> <span class="free">m</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> swapnorm_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">polydivideby</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span>
    <span class="bound">ss</span> <span class="main">=</span> swapnorm <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
    <span class="bound">sp</span> <span class="main">=</span> swapnorm <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span>
    <span class="bound">h</span> <span class="main">=</span> head <span class="bound">sp</span><span class="main">;</span>
    <span class="main">(</span><span class="bound">k</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> polydivide <span class="bound">ss</span> <span class="bound">sp</span>
   <span class="keyword1">in</span> <span class="main">(</span><span class="bound">k</span><span class="main">,</span> swapnorm <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">h</span><span class="main">,</span> swapnorm <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Polynomial_Expression-swap_nz"><span class="command">lemma</span></span> swap_nz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"swap <span class="free">n</span> <span class="free">m</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">isweaknpoly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">isweaknpoly</span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isweaknpoly</span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">isweaknpoly</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free">isweaknpoly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">isweaknpoly</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> False"</span></span>

<span class="keyword1" id="Polynomial_Expression-isnpolyh_isweaknpoly"><span class="command">lemma</span></span> isnpolyh_isweaknpoly<span class="main">:</span> <span class="quoted"><span class="quoted">"isnpolyh <span class="free">p</span> <span class="free">n0</span> <span class="main">⟹</span> isweaknpoly <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n0</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression-swap_isweanpoly"><span class="command">lemma</span></span> swap_isweanpoly<span class="main">:</span> <span class="quoted"><span class="quoted">"isweaknpoly <span class="free">p</span> <span class="main">⟹</span> isweaknpoly <span class="main">(</span>swap <span class="free">n</span> <span class="free">m</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Float_Topology">
<div class="head">
<h1>Theory Float_Topology</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Topology for Floating Point Numbers›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Float_Topology
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Float.html">HOL-Library.Float</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This topology is totally disconnected and not complete, in which sense is it useful?
Perhaps for convergence of intervals?›</span></span>

<span class="keyword1"><span class="command">unbundle</span></span> float.lifting

<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="quoted">dist</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">dist_float</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float <span class="main">⇒</span> float <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">dist</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Float_Topology-dist_float_eq_0_iff"><span class="command">lemma</span></span> dist_float_eq_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dist <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted">float</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>

<span class="keyword1" id="Float_Topology-dist_float_triangle2"><span class="command">lemma</span></span> dist_float_triangle2<span class="main">:</span> <span class="quoted"><span class="quoted">"dist <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> dist <span class="free">x</span> <span class="free">z</span> <span class="main">+</span> dist <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">::</span><span class="quoted">float</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">rule</span> dist_triangle2<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="quoted">uniformity</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">uniformity_float</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>float <span class="main">×</span> float<span class="main">)</span> filter"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">uniformity_float</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> principal <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Float_Topology-float_dense_in_real"><span class="command">lemma</span></span> float_dense_in_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">∈</span>float<span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> reals_Archimedean <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>real <span class="skolem">q'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≡</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">¦</span>bitlen <span class="skolem">q'</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> bitlen_bounds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">q'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">&lt;</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">q</span> <span class="main">&lt;</span> inverse <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q'</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> q' <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span>real <span class="skolem">q</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">⌈</span><span class="free">y</span> <span class="main">*</span> real <span class="skolem">q</span><span class="main">⌉</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> of_int <span class="skolem">p</span> <span class="main">/</span> real <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">-</span> inverse <span class="main">(</span>real <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">-</span> inverse <span class="main">(</span>real <span class="skolem">q</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def p_def le_divide_eq left_diff_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def p_def divide_less_eq diff_less_eq less_ceiling_iff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> float"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Float_Topology-real_of_float_dense"><span class="command">lemma</span></span> real_of_float_dense<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span> <span class="main">::</span> float<span class="main">.</span> <span class="free">x</span> <span class="main">&lt;</span> real_of_float <span class="bound">q</span> <span class="main">∧</span> real_of_float <span class="bound">q</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> float_dense_in_real <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> real_of_float_cases<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="quoted">linorder_topology</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">open_float</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"float set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">open_float</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="bound">y</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ext iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span><span class="main">::</span><span class="quoted"><span class="quoted">"float set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"generate_topology <span class="main">(</span>range lessThan <span class="main">∪</span> range greaterThan<span class="main">)</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> open_float_def uniformity_float_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">U</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> UNIV
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> zero_less_one<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Int <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Int<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e1</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e2</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e2</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bspec<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="bound">y</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">a</span> <span class="main">∩</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"min <span class="skolem">e1</span> <span class="skolem">e2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>UN <span class="skolem">K</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">X</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> <span class="skolem">K</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> UN<span class="main">[</span><span class="operator">OF</span> X<span class="main">]</span> x <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="main">(</span>real_of_float <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>real_of_float <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">⋃</span><span class="skolem">K</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x X
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">e</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Basis <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">u</span><span class="main">::</span><span class="quoted">float</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="main">(</span>real_of_float <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>real_of_float <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{..&lt;</span><span class="skolem">u</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_principal dist_float_def
            dist_real_def abs_real_def
            <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">l</span><span class="main">::</span><span class="quoted">float</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="main">(</span>real_of_float <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>real_of_float <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">l</span><span class="main">&lt;..}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_principal dist_float_def
            dist_real_def abs_real_def
            <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">l</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span><span class="main">::</span><span class="quoted"><span class="quoted">"float set"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">⟹</span> <span class="skolem">e</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">⟹</span> dist <span class="main">(</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">unfolding</span></span> open_float_def uniformity_float_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> e'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"real_of_float <span class="skolem">e'</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> real_of_float_dense<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="skolem">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> e<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> x<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e'</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> e<span class="main"><span class="main">[</span></span><span class="operator">OF</span> x<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e'</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="main">(</span><span class="bound">y</span><span class="main">)</span> <span class="main">(</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> real_of_float <span class="bound">e'</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e'
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> e'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e'</span> <span class="skolem">x</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">⟹</span> dist <span class="skolem">y</span> <span class="skolem">x</span> <span class="main">&lt;</span> real_of_float <span class="main">(</span><span class="skolem">e'</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> greaterThan <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">e'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∩</span> lessThan <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_float_def dist_commute dist_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"generate_topology <span class="main">(</span>range lessThan <span class="main">∪</span> range greaterThan<span class="main">)</span> <span class="main">…</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> generate_topology_Union generate_topology.Int generate_topology.Basis<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"generate_topology <span class="main">(</span>range lessThan <span class="main">∪</span> range greaterThan<span class="main">)</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> float <span class="main">::</span> <span class="quoted">metric_space</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">standard</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span><span class="main">::</span><span class="quoted"><span class="quoted">"float set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open <span class="skolem">U</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">in</span> uniformity<span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> open_float_def open_dist uniformity_float_def uniformity_real_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="main">(</span>real_of_float <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>real_of_float <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">in</span> <span class="keyword1">INF</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> principal <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_INF1<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">e</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_principal dist_commute dist_float_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="keyword1">in</span> <span class="keyword1">INF</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> principal <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">E</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">⋂</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">E</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">y'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dist <span class="bound">y'</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">x</span><span class="main">}</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> eventually_INF<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> INF_principal_finite eventually_principal<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> dist <span class="main">(</span>real_of_float <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>real_of_float <span class="skolem">u</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">E</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="main"><span class="main"><span class="main">{}</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span> Min <span class="skolem"><span class="skolem"><span class="skolem">E</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_commute dist_float_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> dist_float_eq_0_iff dist_float_triangle2 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>
    <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main">:</span> uniformity_float_def dist_float_def›</span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> float<span class="main">::</span><span class="quoted">topological_ab_group_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">::</span><span class="quoted">float</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">+</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>F</sub></span> nhds <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendstoI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">⤏</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>F</sub></span> nhds <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="main">⤏</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>F</sub></span> nhds <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_eq_intros</span></span> filterlim_ident <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nhds_prod<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> nhds <span class="skolem">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>F</sub></span> nhds <span class="skolem">b</span><span class="main">.</span> dist <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendstoD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> nhds <span class="skolem">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>F</sub></span> nhds <span class="skolem">b</span><span class="main">.</span> dist <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendstoD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> nhds <span class="skolem">a</span> <span class="keyword1">×<span class="hidden">⇩</span><sub>F</sub></span> nhds <span class="skolem">b</span><span class="main">.</span> dist <span class="main">(</span>fst <span class="bound">x</span> <span class="main">+</span> snd <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">eventually_elim</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>elim <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_float_def<span class="main">)</span> <span class="operator">norm</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uminus <span class="main">⤏</span> <span class="main">-</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>nhds <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filterlim_ident<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nhds <span class="skolem">a</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tendstoI <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tendstoD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dist_float_def dist_minus<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lifting_update</span></span> float.lifting
<span class="keyword1"><span class="command">lifting_forget</span></span> float.lifting

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Horner_Eval">
<div class="head">
<h1>Theory Horner_Eval</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Horner Evaluation›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Horner_Eval
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/Interval.html">HOL-Library.Interval</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Function and lemmas for evaluating polynomials via the horner scheme.
   Because interval multiplication is not distributive, interval polynomials
   expressed as a sum of monomials are not equivalent to their respective horner form.
   The functions and lemmas in this theory can be used to express interval
   polynomials in horner form and prove facts about them.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">horner_eval'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">horner_eval'</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">horner_eval'</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">horner_eval'</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">horner_eval</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">horner_eval</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> horner_eval' <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1" id="Horner_Eval-horner_eval_cong"><span class="command">lemma</span></span> horner_eval_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"horner_eval <span class="free">f</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> horner_eval <span class="free">g</span> <span class="free">y</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"horner_eval' <span class="free">f</span> <span class="free">x</span> <span class="skolem">v</span> <span class="free">n</span> <span class="main">=</span> horner_eval' <span class="free">g</span> <span class="free">x</span> <span class="skolem">v</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> horner_eval_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Horner_Eval-horner_eval_eq_setsum"><span class="command">lemma</span></span> horner_eval_eq_setsum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"horner_eval <span class="free">f</span> <span class="free">x</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"horner_eval' <span class="free">f</span> <span class="free">x</span> <span class="skolem">v</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> horner_eval_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Horner_Eval-horner_eval_Suc"><span class="command">lemma</span></span> horner_eval_Suc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"horner_eval <span class="free">f</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> horner_eval <span class="free">f</span> <span class="free">x</span> <span class="free">n</span> <span class="main">+</span> <span class="main">(</span><span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> horner_eval_eq_setsum
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Horner_Eval-horner_eval_Suc'"><span class="command">lemma</span></span> horner_eval_Suc'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>comm_monoid_add<span class="main">,</span> times<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"horner_eval <span class="free">f</span> <span class="free">x</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span>horner_eval <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"horner_eval' <span class="free">f</span> <span class="free">x</span> <span class="skolem">v</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">+</span> <span class="free">x</span> <span class="main">*</span> horner_eval' <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="skolem">v</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> horner_eval_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Horner_Eval-horner_eval_0"><span class="command">lemma</span></span> horner_eval_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"horner_eval <span class="free">f</span> <span class="free">x</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> horner_eval_def<span class="main">)</span>

<span class="keyword1" id="Horner_Eval-horner_eval'_interval"><span class="command">lemma</span></span> horner_eval'_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_ring"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">∈</span> set_of <span class="main">(</span><span class="free">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"horner_eval' <span class="free">f</span> <span class="free">x</span> <span class="free">v</span> <span class="free">n</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> horner_eval' <span class="free">g</span> <span class="free">I</span> <span class="free">V</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_in_intervalI times_in_intervalI<span class="main">)</span>

<span class="keyword1" id="Horner_Eval-horner_eval_interval"><span class="command">lemma</span></span> horner_eval_interval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">∈</span> set_of <span class="main">(</span><span class="free">g</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set_of <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"horner_eval <span class="free">f</span> <span class="free">x</span> <span class="free">n</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> horner_eval <span class="free">g</span> <span class="free">I</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> horner_eval_def
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> horner_eval'_interval<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Polynomial_Expression_Additional">
<div class="head">
<h1>Theory Polynomial_Expression_Additional</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Polynomial_Expression_Additional
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="Polynomial_Expression.html">Polynomial_Expression</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Approximation.html">HOL-Decision_Procs.Approximation</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Polynomial_Expression_Additional-real_of_float_eq_zero_iff"><span class="command">lemma</span></span> real_of_float_eq_zero_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_float <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_of_float_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theory <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="Polynomial_Expression.html"></a><a href="Polynomial_Expression.html">Taylor_Models.Polynomial_Expression</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> contains a, more or less, 1:1 generalization
   of theory <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Multivariate_Polynomial›</span></span></span></span>. Any additions belong here.›</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion_map</span> <span class="quoted">map_poly</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted"><span class="quoted">"interval_of<span class="main">::</span>float<span class="main">⇒</span>float interval"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Apply float interval arguments to a float poly.›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">[</span>Ivl <span class="main">(</span>Float <span class="numeral">4</span> <span class="main">(</span><span class="main">-</span><span class="numeral">6</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Float <span class="numeral">10</span> <span class="numeral">6</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>poly.Add <span class="main">(</span>poly.C <span class="main">(</span>Float <span class="numeral">3</span> <span class="numeral">5</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>poly.Bound <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">map_poly</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for homomorphisms›</span></span>

<span class="keyword1" id="Polynomial_Expression_Additional-map_poly_homo_polyadd_eq_zero_iff"><span class="command">lemma</span></span> map_poly_homo_polyadd_eq_zero_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">⟷</span> <span class="free">p</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">q</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression_Additional-zero_iffD"><span class="command">lemma</span></span> zero_iffD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression_Additional-map_poly_homo_polyadd"><span class="command">lemma</span></span> map_poly_homo_polyadd<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span><span class="free">p1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p2</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">f</span> <span class="free">p1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> map_poly <span class="free">f</span> <span class="free">p2</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_iffD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def map_poly_homo_polyadd_eq_zero_iff<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression_Additional-map_poly_homo_polyneg"><span class="command">lemma</span></span> map_poly_homo_polyneg<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p1</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def map_poly_homo_polyadd_eq_zero_iff<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression_Additional-map_poly_homo_polysub"><span class="command">lemma</span></span> map_poly_homo_polysub<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span><span class="free">p1</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p2</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">f</span> <span class="free">p1</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> map_poly <span class="free">f</span> <span class="free">p2</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="main">-</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> polysub_def map_poly_homo_polyadd map_poly_homo_polyneg<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression_Additional-map_poly_homo_polymul"><span class="command">lemma</span></span> map_poly_homo_polymul<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span><span class="free">p1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p2</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">f</span> <span class="free">p1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> map_poly <span class="free">f</span> <span class="free">p2</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polymul.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_iffD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> map_poly_homo_polyadd<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression_Additional-map_poly_homo_polypow"><span class="command">lemma</span></span> map_poly_homo_polypow<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map_poly <span class="free">f</span> <span class="main">(</span><span class="free">p1</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> map_poly <span class="free">f</span> <span class="free">p1</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">f</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_poly_homo_polyadd map_poly_homo_polymul<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Suc_less_eq div2_less_self even_Suc odd_Suc_div_two map_poly_homo_polymul that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> map_poly_homo_polyarith <span class="main">=</span> map_poly_homo_polyadd map_poly_homo_polyneg map_poly_homo_polysub map_poly_homo_polymul map_poly_homo_polypow

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Count the number of parameters of a polynomial.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">num_params</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">num_params</span> <span class="main">(</span>poly.C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">num_params</span> <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>  <span class="main">=</span> Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">num_params</span> <span class="main">(</span>poly.Add <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>  <span class="main">=</span> max <span class="main">(</span><span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">num_params</span> <span class="main">(</span>poly.Sub <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>  <span class="main">=</span> max <span class="main">(</span><span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">num_params</span> <span class="main">(</span>poly.Mul <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>  <span class="main">=</span> max <span class="main">(</span><span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">num_params</span> <span class="main">(</span>poly.Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>    <span class="main">=</span> <span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">num_params</span> <span class="main">(</span>poly.Pw <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>   <span class="main">=</span> <span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">num_params</span> <span class="main">(</span>poly.CN <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>max <span class="main">(</span><span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">num_params</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Polynomial_Expression_Additional-num_params_map_poly"><span class="command">lemma</span></span> num_params_map_poly<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>map_poly <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> num_params <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression_Additional-num_params_polyadd"><span class="command">lemma</span></span> num_params_polyadd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span><span class="free">p1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p2</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>num_params <span class="free">p1</span><span class="main">)</span> <span class="main">(</span>num_params <span class="free">p2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression_Additional-num_params_polyneg"><span class="command">lemma</span></span> num_params_polyneg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> num_params <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyneg.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression_Additional-num_params_polymul"><span class="command">lemma</span></span> num_params_polymul<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span><span class="free">p1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">p2</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">(</span>num_params <span class="free">p1</span><span class="main">)</span> <span class="main">(</span>num_params <span class="free">p2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p1</span></span> <span class="quoted"><span class="free">p2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polymul.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p</span> <span class="skolem">c'</span> <span class="skolem">n'</span> <span class="skolem">p'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_polyadd<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Polynomial_Expression_Additional-num_params_polypow"><span class="command">lemma</span></span> num_params_polypow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span><span class="free">p</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polypow.induct<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> polypow.simps
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> num_params_polymul<span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> polypow.simps<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression_Additional-num_params_polynate"><span class="command">lemma</span></span> num_params_polynate<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>polynate <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polynate.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> num_params_polyadd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"polynate <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"polynate <span class="skolem">r</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> num_params_polyadd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"polynate <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">(</span>polynate <span class="skolem">r</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polysub_def num_params_polyneg<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> num_params_polymul<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"polynate <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"polynate <span class="skolem">r</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> num_params_polyneg<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">p</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> num_params_polypow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="quoted">"polynate <span class="skolem">p</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Polynomial_Expression_Additional-polynate_map_poly_real"><span class="command">lemma</span></span> polynate_map_poly_real<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map_poly real_of_float <span class="main">(</span>polynate <span class="free">p</span><span class="main">)</span> <span class="main">=</span> polynate <span class="main">(</span>map_poly real_of_float <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_poly_homo_polyarith<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Evaluating a float poly is equivalent to evaluating the corresponding
   real poly with the float parameters converted to reals.›</span></span>
<span class="keyword1" id="Polynomial_Expression_Additional-Ipoly_real_float_eqiv"><span class="command">lemma</span></span> Ipoly_real_float_eqiv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"float poly"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"float list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">xs</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span>real poly<span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">xs</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Evaluating an <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a poly›</span></span></span></span> with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'a interval›</span></span></span></span> arguments is monotone.›</span></span>
<span class="keyword1" id="Polynomial_Expression_Additional-Ipoly_interval_args_mono"><span class="command">lemma</span></span> Ipoly_interval_args_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_idom poly"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interval list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">x</span> <span class="free">p</span> <span class="main">∈</span> set_of <span class="main">(</span>Ipoly <span class="free">xs</span> <span class="main">(</span>map_poly interval_of <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> all_in_i_def plus_in_intervalI minus_in_intervalI times_in_intervalI
      uminus_in_intervalI set_of_power_mono<span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression_Additional-Ipoly_interval_args_inc_mono"><span class="command">lemma</span></span> Ipoly_interval_args_inc_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>real_normed_algebra<span class="main">,</span> linear_continuum_topology<span class="main">,</span> linordered_idom<span class="main">}</span> poly"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">I</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interval list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">J</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interval list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="keyword1">all_subset</span> <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>Ipoly <span class="free">I</span> <span class="main">(</span>map_poly interval_of <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span>Ipoly <span class="free">J</span> <span class="main">(</span>map_poly interval_of <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_of_add_inc set_of_sub_inc set_of_mul_inc set_of_neg_inc set_of_pow_inc<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Splitting polynomials to reduce floating point precision›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TODO: Move this!
  Definitions regarding floating point numbers should not be in a theory about polynomials.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">float_prec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float <span class="main">⇒</span> int"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">float_prec</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p</span><span class="main">=</span>exponent <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">p</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">-</span><span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">float_round</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float <span class="main">⇒</span> float"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">float_round</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">let</span> <span class="bound">d</span> <span class="main">=</span> float_down <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span> <span class="bound">u</span> <span class="main">=</span> float_up <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>
         <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">-</span> <span class="bound">d</span> <span class="main">&lt;</span> <span class="bound">u</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">then</span> <span class="bound">d</span> <span class="keyword1">else</span> <span class="bound">u</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Splits any polynomial <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> into two polynomials <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>l›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>r›</span></span></span></span>, such that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∀x::real. p(x) = l(x) + r(x)›</span></span></span></span>
   and all floating point coefficients in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>p›</span></span></span></span> are rounded to precision <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prec›</span></span></span></span>.
   Not all cases need to give good results. Polynomials normalized with polynate
   only contain <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>poly.C›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>poly.CN›</span></span></span></span> constructors.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">split_by_prec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float poly <span class="main">⇒</span> float poly <span class="main">*</span> float poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.C <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">r</span> <span class="main">=</span> float_round <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>poly.C <span class="bound">r</span><span class="main">,</span> poly.C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">-</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> poly.C <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Add <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">ll</span><span class="main">,</span> <span class="bound">lr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">;</span>
                                                <span class="main">(</span><span class="bound">rl</span><span class="main">,</span> <span class="bound">rr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>
                                            <span class="keyword1">in</span> <span class="main">(</span>poly.Add <span class="bound">ll</span> <span class="bound">rl</span><span class="main">,</span> poly.Add <span class="bound">lr</span> <span class="bound">rr</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Sub <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">ll</span><span class="main">,</span> <span class="bound">lr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">;</span>
                                             <span class="main">(</span><span class="bound">rl</span><span class="main">,</span> <span class="bound">rr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>
                                         <span class="keyword1">in</span> <span class="main">(</span>poly.Sub <span class="bound">ll</span> <span class="bound">rl</span><span class="main">,</span> poly.Sub <span class="bound">lr</span> <span class="bound">rr</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Mul <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">ll</span><span class="main">,</span> <span class="bound">lr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">;</span>
                                                <span class="main">(</span><span class="bound">rl</span><span class="main">,</span> <span class="bound">rr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>
                                            <span class="keyword1">in</span> <span class="main">(</span>poly.Mul <span class="bound">ll</span> <span class="bound">rl</span><span class="main">,</span> poly.Add <span class="main">(</span>poly.Add <span class="main">(</span>poly.Mul <span class="bound">lr</span> <span class="bound">rl</span><span class="main">)</span> <span class="main">(</span>poly.Mul <span class="bound">ll</span> <span class="bound">rr</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>poly.Mul <span class="bound">lr</span> <span class="bound">rr</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>poly.Neg <span class="bound">l</span><span class="main">,</span> poly.Neg <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly.C <span class="main">1</span><span class="main">,</span> poly.C <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span> <span class="main">(</span>poly.Pw <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> poly.Sub <span class="main">(</span>poly.Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>poly.Pw <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">cr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span>
                                                 <span class="main">(</span><span class="bound">pl</span><span class="main">,</span> <span class="bound">pr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_prec</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
                                             <span class="keyword1">in</span> <span class="main">(</span>poly.CN <span class="bound">cl</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">pl</span><span class="main">,</span> poly.CN <span class="bound">cr</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">pr</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TODO: Prove precision constraint on <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>l›</span></span></span></span>.›</span></span>
<span class="keyword1" id="Polynomial_Expression_Additional-split_by_prec_correct"><span class="command">lemma</span></span> split_by_prec_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">args</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> split_by_prec <span class="free">prec</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">args</span> <span class="free">p</span> <span class="main">=</span> Ipoly <span class="free">args</span> <span class="free">l</span> <span class="main">+</span> Ipoly <span class="free">args</span> <span class="free">r</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"num_params <span class="free">l</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"num_params <span class="free">r</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P3</span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> atomize_conj
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Add <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Add<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> prod.collapse<span class="main"><span class="main">]</span></span> split_beta<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> max.coboundedI1 max.coboundedI2 prod.collapse
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sub <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sub<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> prod.collapse<span class="main"><span class="main">]</span></span> split_beta<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> max.coboundedI1 max.coboundedI2 prod.collapse
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Mul <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Mul<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> prod.collapse<span class="main"><span class="main">]</span></span> split_beta <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> max.coboundedI1 max.coboundedI2 prod.collapse
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Neg<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> prod.collapse<span class="main"><span class="main">]</span></span> split_beta<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pw <span class="skolem">p</span> <span class="skolem">n</span> <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pw<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> prod.collapse<span class="main"><span class="main">]</span></span> split_beta<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CN<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> prod.collapse<span class="main"><span class="main">]</span></span> split_beta <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_max_iff_disj prod.collapse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Splitting polynomials by degree›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">maxdegree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>zero<span class="main">)</span> poly <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">maxdegree</span> <span class="main">(</span>poly.C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxdegree</span> <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxdegree</span> <span class="main">(</span>poly.Add <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxdegree</span> <span class="main">(</span>poly.Sub <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxdegree</span> <span class="main">(</span>poly.Mul <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">+</span> <span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxdegree</span> <span class="main">(</span>poly.Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxdegree</span> <span class="main">(</span>poly.Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">*</span> <span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">maxdegree</span> <span class="main">(</span>poly.CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span><span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">maxdegree</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">split_by_degree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span>zero poly <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">*</span> <span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">split_by_degree</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>poly.C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>poly.C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> poly.C <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_degree</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>poly.C <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_degree</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>poly.CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">let</span> <span class="main">(</span><span class="bound">cl</span><span class="main">,</span> <span class="bound">cr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_degree</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span>
             <span class="main">(</span><span class="bound">pl</span><span class="main">,</span> <span class="bound">pr</span><span class="main">)</span> <span class="main">=</span> <span class="free">split_by_degree</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
         <span class="keyword1">in</span> <span class="main">(</span>poly.CN <span class="bound">cl</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">pl</span><span class="main">,</span> poly.CN <span class="bound">cr</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">pr</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="comment1">― ‹This function is only intended for use on polynomials in normal form.
       Hence most cases never get executed.›</span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">split_by_degree</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span>poly.C <span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Polynomial_Expression_Additional-split_by_degree_correct"><span class="command">lemma</span></span> split_by_degree_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> split_by_degree <span class="free">ord</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maxdegree <span class="free">l</span> <span class="main">≤</span> <span class="free">ord</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"Ipoly <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Ipoly <span class="free">x</span> <span class="free">l</span> <span class="main">+</span> Ipoly <span class="free">x</span> <span class="free">r</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"num_params <span class="free">l</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P3</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"num_params <span class="free">r</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P4</span></span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> atomize_conj
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">ord</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>C <span class="skolem">c</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">ord</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bound <span class="skolem">v</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">ord</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ord</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Add <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">ord</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ord</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sub <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">ord</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ord</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Mul <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">ord</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ord</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">ord</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ord</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pw <span class="skolem">p</span> <span class="skolem">k</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">ord</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ord</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CN <span class="skolem">c</span> <span class="skolem">v</span> <span class="skolem">p</span> <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">ord</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ord</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cl</span></span> <span class="skolem"><span class="skolem">cr</span></span> <span class="keyword2"><span class="keyword">where</span></span> cl_cr_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">cl</span><span class="main">,</span> <span class="skolem">cr</span><span class="main">)</span> <span class="main">=</span> split_by_degree <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"split_by_degree <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="skolem">c</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pl</span></span> <span class="skolem"><span class="skolem">pr</span></span> <span class="keyword2"><span class="keyword">where</span></span> pl_pr_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pl</span><span class="main">,</span> <span class="skolem">pr</span><span class="main">)</span> <span class="main">=</span> split_by_degree <span class="skolem">m</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"split_by_degree <span class="skolem">m</span> <span class="skolem">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">x</span> <span class="skolem">p</span> <span class="main">=</span> Ipoly <span class="free">x</span> <span class="skolem">pl</span> <span class="main">+</span> Ipoly <span class="free">x</span> <span class="skolem">pr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> CN<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> pl_pr_def<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ord</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> CN<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> l_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> CN <span class="skolem">cl</span> <span class="skolem">v</span> <span class="skolem">pl</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> r_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> CN <span class="skolem">cr</span> <span class="skolem">v</span> <span class="skolem">pr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc cl_cr_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> pl_pr_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> CN<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> cl_cr_def<span class="main">]</span>  CN<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> pl_pr_def<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> l_decomp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_decomp r_decomp <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Operations on lists.›</span></span>

<span class="keyword1" id="Polynomial_Expression_Additional-length_map2"><span class="command">lemma</span></span> length_map2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>map2 <span class="free">f</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>length <span class="free">a</span><span class="main">)</span> <span class="main">(</span>length <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"map2 <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Nil <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">|</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">c</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">a</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xa</span></span> <span class="skolem"><span class="skolem">ar</span></span> <span class="skolem"><span class="skolem">xb</span></span> <span class="skolem"><span class="skolem">br</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> a_decomp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">xa</span> <span class="main">#</span> <span class="skolem">ar</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>   b_decomp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">xb</span> <span class="main">#</span> <span class="skolem">br</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Polynomial_Expression_Additional-map2_nth"><span class="command">lemma</span></span> map2_nth<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> length <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map2 <span class="free">f</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">!</span><span class="free">n</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">!</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 0
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 0
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="main">(</span>tl <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="main">(</span>tl <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map2 <span class="free">f</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> map2 <span class="free">f</span> <span class="main">(</span>hd <span class="skolem">a</span> <span class="main">#</span> tl <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>hd <span class="skolem">b</span> <span class="main">#</span> tl <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">b</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">!</span> Suc <span class="skolem">n</span> <span class="main">=</span> map2 <span class="free">f</span> <span class="main">(</span>tl <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">b</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>tl <span class="skolem">a</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>tl <span class="skolem">b</span> <span class="main">!</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="main">(</span>tl <span class="skolem">a</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> length <span class="main">(</span>tl <span class="skolem">b</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc.IH<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tl <span class="skolem">a</span> <span class="main">!</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span>hd <span class="skolem">a</span> <span class="main">#</span> tl <span class="skolem">a</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span> <span class="main">#</span> tl <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tl <span class="skolem">b</span> <span class="main">!</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span>hd <span class="skolem">b</span> <span class="main">#</span> tl <span class="skolem">b</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">b</span> <span class="main">#</span> tl <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Translating a polynomial by a vector.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">poly_translate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">(</span>poly.C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">=</span> poly.C <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> poly.Add <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>poly.C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">(</span>poly.Add <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> poly.Add <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">(</span>poly.Sub <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> poly.Sub <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">(</span>poly.Mul <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> poly.Mul <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">(</span>poly.Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> poly.Neg <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">(</span>poly.Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> poly.Pw <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">(</span>poly.CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> poly.Add <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">(</span>poly.Mul <span class="main">(</span>poly.Add <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>poly.C <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">poly_translate</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Translating a polynomial is equivalent to translating its argument.›</span></span>
<span class="keyword1" id="Polynomial_Expression_Additional-poly_translate_correct"><span class="command">lemma</span></span> poly_translate_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> length <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">x</span> <span class="main">=</span> length <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">x</span> <span class="main">(</span>poly_translate <span class="free">v</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="main">(</span>map2 <span class="main">(+)</span> <span class="free">x</span> <span class="free">v</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression_Additional-real_poly_translate"><span class="command">lemma</span></span> real_poly_translate<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> length <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">x</span> <span class="main">(</span>map_poly real_of_float <span class="main">(</span>poly_translate <span class="free">v</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="free">x</span> <span class="main">(</span>poly_translate <span class="free">v</span> <span class="main">(</span>map_poly real_of_float <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Polynomial_Expression_Additional-num_params_poly_translate"><span class="command">lemma</span></span> num_params_poly_translate<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>poly_translate <span class="free">v</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> num_params <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Taylor_Models_Misc">
<div class="head">
<h1>Theory Taylor_Models_Misc</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Taylor_Models_Misc
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Float.html">HOL-Library.Float</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Function_Algebras.html">HOL-Library.Function_Algebras</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Approximation.html">HOL-Decision_Procs.Approximation</a>"</span>
    <span class="quoted">"<a href="../Affine_Arithmetic/Floatarith_Expression.html">Affine_Arithmetic.Floatarith_Expression</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory contains anything that doesn't belong anywhere else.›</span></span>

<span class="keyword1" id="Taylor_Models_Misc-of_nat_real_float_equiv"><span class="command">lemma</span></span> of_nat_real_float_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>of_nat <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>of_nat <span class="free">n</span> <span class="main">::</span> float<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models_Misc-fact_real_float_equiv"><span class="command">lemma</span></span> fact_real_float_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fact <span class="free">n</span> <span class="main">::</span> float<span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fact <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Taylor_Models_Misc-Some_those_length"><span class="command">lemma</span></span> Some_those_length<span class="main">:</span>
  <span class="quoted"><span class="quoted">"those <span class="free">ys</span> <span class="main">=</span> Some <span class="free">xs</span> <span class="main">⟹</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1" id="Taylor_Models_Misc-those_eq_None_iff"><span class="command">lemma</span></span> those_eq_None_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"those <span class="free">ys</span> <span class="main">=</span> None <span class="main">⟷</span> None <span class="main">∈</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1" id="Taylor_Models_Misc-those_eq_Some_iff"><span class="command">lemma</span></span> those_eq_Some_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"those <span class="free">ys</span> <span class="main">=</span> <span class="main">(</span>Some <span class="free">xs</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">ys</span> <span class="main">=</span> map Some <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1" id="Taylor_Models_Misc-Some_those_nth"><span class="command">lemma</span></span> Some_those_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"those <span class="free">ys</span> <span class="main">=</span> Some <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Some <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">ys</span><span class="main">!</span><span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Some_those_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits nat.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons<span class="main">)</span>

<span class="keyword1" id="Taylor_Models_Misc-fun_pow"><span class="command">lemma</span></span> fun_pow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> floatarith_notation <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Translate floatarith expressions by a vector of floats.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fa_translate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float list <span class="main">⇒</span> floatarith <span class="main">⇒</span> floatarith"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Add</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Add</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Minus</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Mult</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Inverse</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Cos</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Cos</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Arctan</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Arctan</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Min</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Min</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Max</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Max</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Abs</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Abs</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Sqrt</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Sqrt</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Exp</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Exp</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Ln</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Ln</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Var</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Add</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Num</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Power</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Power</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Powr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Powr</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Floor</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Floor</span> <span class="main">(</span><span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="keyword1">Num</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Num</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
    <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">fa_translate</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">Pi</span> <span class="main">=</span> <span class="keyword1">Pi</span>"</span></span>

<span class="keyword1" id="Taylor_Models_Misc-fa_translate_correct"><span class="command">lemma</span></span> fa_translate_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"max_Var_floatarith <span class="free">f</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">v</span> <span class="main">=</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span>fa_translate <span class="free">v</span> <span class="free">f</span><span class="main">)</span> <span class="free">I</span> <span class="main">=</span> interpret_floatarith <span class="free">f</span> <span class="main">(</span>map2 <span class="main">(+)</span> <span class="free">I</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">vars_floatarith</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Add</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Num</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Cos</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Arctan</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Abs</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Max</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Min</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Pi</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Sqrt</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Exp</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Powr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Ln</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Power</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vars_floatarith</span> <span class="main">(</span><span class="keyword1">Floor</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">vars_floatarith</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>       

<span class="keyword1" id="Taylor_Models_Misc-finite_vars_floatarith"><span class="command">lemma</span></span> finite_vars_floatarith<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>vars_floatarith <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Taylor_Models_Misc-max_Var_floatarith_eq_Max_vars_floatarith"><span class="command">lemma</span></span> max_Var_floatarith_eq_Max_vars_floatarith<span class="main">:</span>
  <span class="quoted"><span class="quoted">"max_Var_floatarith <span class="free">fa</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> vars_floatarith <span class="free">fa</span> <span class="main">=</span> <span class="main">{}</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> Suc <span class="main">(</span>Max <span class="main">(</span>vars_floatarith <span class="free">fa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">fa</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Max_Un Max_eq_iff max_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Taylor_Models">
<div class="head">
<h1>Theory Taylor_Models</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Taylor_Models
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="Horner_Eval.html">Horner_Eval</a>"</span>
    <span class="quoted">"<a href="Polynomial_Expression_Additional.html">Polynomial_Expression_Additional</a>"</span>
    <span class="quoted">"<a href="Taylor_Models_Misc.html">Taylor_Models_Misc</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Decision_Procs/Approximation.html">HOL-Decision_Procs.Approximation</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Function_Algebras.html">HOL-Library.Function_Algebras</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Set_Algebras.html">HOL-Library.Set_Algebras</a>"</span>
    <span class="quoted">"<a href="../Affine_Arithmetic/Straight_Line_Program.html">Affine_Arithmetic.Straight_Line_Program</a>"</span>
    <span class="quoted">"<a href="../Affine_Arithmetic/Affine_Approximation.html">Affine_Arithmetic.Affine_Approximation</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TODO: get rid of float poly/float inteval and use real poly/real interval
  and data refinement?›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Multivariate Taylor Models›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Computing interval bounds on arithmetic expressions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is a wrapper around the "approx" function.
  It computes range bounds on floatarith expressions.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">compute_bound_fa</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> floatarith <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">compute_bound_fa</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">=</span> approx <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>map Some <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Taylor_Models-compute_bound_fa_correct"><span class="command">lemma</span></span> compute_bound_fa_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"interpret_floatarith <span class="free">f</span> <span class="free">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">ivl</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"compute_bound_fa <span class="free">prec</span> <span class="free">f</span> <span class="free">I</span> <span class="main">=</span> Some <span class="free">ivl</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">all_in</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">i</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> bounded<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_by <span class="free">i</span> <span class="main">(</span>map Some <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> bounded_by_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bounds_of_interval_eq_lower_upper set_of_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> Some<span class="main">:</span> <span class="quoted"><span class="quoted">"approx <span class="free">prec</span> <span class="free">f</span> <span class="main">(</span>map Some <span class="free">I</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">ivl</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lower_Interval upper_Interval min_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> approx<span class="main">[</span><span class="operator">OF</span> bounded Some<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Taylor models and notion of rangeity›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Taylor models are a pair of a polynomial and an absolute error bound.›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> taylor_model <span class="main">=</span> TaylorModel <span class="main">(</span><span class="free"><span class="entity">tm_poly</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"float poly"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">tm_bound</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"float interval"</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Taylor model for a real valuation of variables›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">insertion</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>plus<span class="main">,</span>zero<span class="main">,</span>minus<span class="main">,</span>uminus<span class="main">,</span>times<span class="main">,</span>one<span class="main">,</span>power<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Neg <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>poly.Add <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Sub <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Mul <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Pw <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">+</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="free">insertion</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">range_tm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> taylor_model <span class="main">⇒</span> real interval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">range_tm</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span> <span class="main">=</span> interval_of <span class="main">(</span>insertion <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>tm_poly <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> real_interval <span class="main">(</span>tm_bound <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Taylor_Models-Ipoly_num_params_cong"><span class="command">lemma</span></span> Ipoly_num_params_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">xs</span> <span class="free">p</span> <span class="main">=</span> Ipoly <span class="free">ys</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> num_params <span class="free">p</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Taylor_Models-insertion_num_params_cong"><span class="command">lemma</span></span> insertion_num_params_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="free">p</span> <span class="main">=</span> insertion <span class="free">f</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> num_params <span class="free">p</span> <span class="main">⟹</span> <span class="free">e</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Taylor_Models-insertion_eq_IpolyI"><span class="command">lemma</span></span> insertion_eq_IpolyI<span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">xs</span> <span class="free">p</span> <span class="main">=</span> Ipoly <span class="free">ys</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> num_params <span class="free">p</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Taylor_Models-Ipoly_eq_insertionI"><span class="command">lemma</span></span> Ipoly_eq_insertionI<span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="free">ys</span> <span class="free">p</span> <span class="main">=</span> insertion <span class="free">xs</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> num_params <span class="free">p</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ys</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Taylor_Models-range_tmI"><span class="command">lemma</span></span> range_tmI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">tm</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> interval_of <span class="main">(</span>insertion <span class="free">e</span> <span class="main">(</span><span class="main">(</span>tm_poly <span class="free">tm</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> real_interval <span class="main">(</span>tm_bound <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">e</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> range_tm_def x<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-range_tmD"><span class="command">lemma</span></span> range_tmD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> interval_of <span class="main">(</span>insertion <span class="free">e</span> <span class="main">(</span>tm_poly <span class="free">tm</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> real_interval <span class="main">(</span>tm_bound <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">tm</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">e</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat<span class="main">⇒</span>real"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> range_tm_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Interval bounds for Taylor models›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Bound a polynomial by simply approximating it with interval arguments.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">compute_bound_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval poly <span class="main">⇒</span> <span class="main">(</span>float interval list<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>float interval list<span class="main">)</span> <span class="main">⇒</span> float interval"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.C <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> round_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Add <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
    round_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span><span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Sub <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
    round_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span><span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Mul <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
    mult_float_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span><span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">-</span><span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> power_float_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span><span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>poly.CN <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
    round_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span><span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span>
      mult_float_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>round_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">compute_bound_poly</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Bounds on Taylor models are simply a bound on its polynomial, widened by the approximation error.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">compute_bound_tm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> float interval"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">compute_bound_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> compute_bound_poly <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>

<span class="keyword1" id="Taylor_Models-compute_bound_tm_def"><span class="command">lemma</span></span> compute_bound_tm_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">tm</span> <span class="main">=</span> compute_bound_poly <span class="free">prec</span> <span class="main">(</span>tm_poly <span class="free">tm</span><span class="main">)</span> <span class="free">I</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span>tm_bound <span class="free">tm</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">tm</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Taylor_Models-real_of_float_in_real_interval_of"><span class="command">lemma</span></span> real_of_float_in_real_interval_of<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real_of_float <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-in_set_of_round_interval"><span class="command">lemma</span></span> in_set_of_round_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> round_interval <span class="free">prec</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> round_ivl_correct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">prec</span></span><span class="main">]</span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-in_set_real_minus_interval"><span class="command">lemma</span></span> in_set_real_minus_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span> <span class="main">-</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-real_interval_plus"><span class="command">lemma</span></span> real_interval_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"real_interval <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> real_interval <span class="free">a</span> <span class="main">+</span> real_interval <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-real_interval_uminus"><span class="command">lemma</span></span> real_interval_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"real_interval <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> real_interval <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-real_interval_of"><span class="command">lemma</span></span> real_interval_of<span class="main">:</span> <span class="quoted"><span class="quoted">"real_interval <span class="main">(</span>interval_of <span class="free">b</span><span class="main">)</span> <span class="main">=</span> interval_of <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-real_interval_minus"><span class="command">lemma</span></span> real_interval_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"real_interval <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> real_interval <span class="free">a</span> <span class="main">-</span> real_interval <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> real_interval_plus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">b</span>"</span></span><span class="main">]</span> real_interval_uminus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_eq_iff<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-in_set_real_plus_interval"><span class="command">lemma</span></span> in_set_real_plus_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span> <span class="main">+</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-in_set_neg_plus_interval"><span class="command">lemma</span></span> in_set_neg_plus_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">-</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-in_set_real_times_interval"><span class="command">lemma</span></span> in_set_real_times_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span> <span class="main">*</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_interval_times <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> times_in_intervalI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-real_interval_one"><span class="command">lemma</span></span> real_interval_one<span class="main">:</span> <span class="quoted"><span class="quoted">"real_interval <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-real_interval_zero"><span class="command">lemma</span></span> real_interval_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"real_interval <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-real_interval_power"><span class="command">lemma</span></span> real_interval_power<span class="main">:</span> <span class="quoted"><span class="quoted">"real_interval <span class="main">(</span><span class="free">a</span> <span class="main">^</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> real_interval <span class="free">a</span> <span class="main">^</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_interval_times real_interval_one<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-in_set_real_power_interval"><span class="command">lemma</span></span> in_set_real_power_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_interval_power <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> set_of_power_mono<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-power_float_interval_real_interval"><span class="command">lemma</span></span> power_float_interval_real_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> power_float_interval <span class="free">prec</span> <span class="free">n</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_interval_power that <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> power_float_intervalI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-in_set_mult_float_interval"><span class="command">lemma</span></span> in_set_mult_float_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> mult_float_interval <span class="free">prec</span> <span class="free">X</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_float_interval<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">Y</span></span><span class="main">]</span> in_set_real_times_interval<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> that<span class="main">(</span>1<span class="main">)</span> that<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Taylor_Models-in_set_real_minus_swapI"><span class="command">lemma</span></span> in_set_real_minus_swapI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="free">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">I</span> <span class="main">!</span> <span class="free">i</span> <span class="main">-</span> <span class="free">a</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">e</span> <span class="free">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">a</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">I</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">develops_at_within</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">develops_at_within</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">all_subset</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">!</span> <span class="bound">i</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Taylor_Models-develops_at_withinI"><span class="command">lemma</span></span> develops_at_withinI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> all_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">all_subset</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">I</span> <span class="main">⟹</span> <span class="free">e</span> <span class="bound">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">I</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> develops_at_within_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-develops_at_withinD"><span class="command">lemma</span></span> develops_at_withinD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">all_subset</span> <span class="free">I</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">I</span> <span class="main">⟹</span> <span class="free">e</span> <span class="bound">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">I</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">-</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> develops_at_within_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-compute_bound_poly_correct"><span class="command">lemma</span></span> compute_bound_poly_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"float poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span><span class="free">p</span><span class="main">::</span>real poly<span class="main">)</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> compute_bound_poly <span class="free">prec</span> <span class="main">(</span>map_poly interval_of <span class="free">p</span><span class="main">)</span> <span class="free">I</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>C <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bound <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dev
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> develops_at_within_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Add <span class="skolem">p1</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sub <span class="skolem">p1</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Mul <span class="skolem">p1</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pw <span class="skolem">p</span> <span class="skolem">x2a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CN <span class="skolem">p1</span> <span class="skolem">i</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dev
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> develops_at_within_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-compute_bound_tm_correct"><span class="command">lemma</span></span> compute_bound_tm_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float interval list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x0</span> <span class="main">=</span> <span class="var">?I</span> <span class="main">+</span> <span class="main">(</span><span class="free">x0</span> <span class="main">-</span> <span class="var">?I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> compute_bound_tm_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> in_set_real_plus_interval<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> compute_bound_poly_correct<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dev<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> range_tmD<span class="main">[</span><span class="operator">OF</span> x0<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-compute_bound_tm_correct_subset"><span class="command">lemma</span></span> compute_bound_tm_correct_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float interval list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>range_tm <span class="free">e</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span>real_interval <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> compute_bound_tm_correct<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-compute_bound_poly_mono"><span class="command">lemma</span></span> compute_bound_poly_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="keyword1">all_subset</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">all_subset</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>compute_bound_poly <span class="free">prec</span> <span class="free">p</span> <span class="free">I</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span>compute_bound_poly <span class="free">prec</span> <span class="free">p</span> <span class="free">J</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>C <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bound <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> round_interval_mono set_of_sub_inc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Add <span class="skolem">p1</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> round_interval_mono set_of_add_inc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sub <span class="skolem">p1</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> round_interval_mono set_of_sub_inc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Mul <span class="skolem">p1</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> round_interval_mono mult_float_interval_mono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> round_interval_mono set_of_neg_inc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pw <span class="skolem">p</span> <span class="skolem">x2a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_float_interval_mono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CN <span class="skolem">p1</span> <span class="skolem">x2a</span> <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> mem
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> round_interval_mono mult_float_interval_mono
        set_of_add_inc set_of_sub_inc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-compute_bound_tm_mono"><span class="command">lemma</span></span> compute_bound_tm_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float interval list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="keyword1">all_subset</span> <span class="free">J</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">all_subset</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">J</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compute_bound_tm_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_add_inc_left<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> compute_bound_poly_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Computing taylor models for basic, univariate functions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tm_const</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_const</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> TaylorModel <span class="main">(</span>poly.C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> floatarith_notation <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tm_pi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_pi</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">pi_ivl</span> <span class="main">=</span> the <span class="main">(</span>compute_bound_fa <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="keyword1">Pi</span> <span class="main">[]</span><span class="main">)</span>
  <span class="keyword1">in</span> TaylorModel <span class="main">(</span>poly.C <span class="main">(</span>mid <span class="bound">pi_ivl</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>centered <span class="bound">pi_ivl</span><span class="main">)</span>
<span class="main">)</span>"</span></span>

<span class="keyword1" id="Taylor_Models-zero_real_interval"><span class="command">lemma</span></span> zero_real_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-range_TM_tm_const"><span class="command">lemma</span></span> range_TM_tm_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"range_tm <span class="free">e</span> <span class="main">(</span>tm_const <span class="free">c</span><span class="main">)</span> <span class="main">=</span> interval_of <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> range_tm_def real_interval_zero tm_const_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_const"><span class="command">lemma</span></span> num_params_tm_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_const <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_const_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_pi"><span class="command">lemma</span></span> num_params_tm_pi<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_pi <span class="free">prec</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_pi_def Let_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-range_tm_tm_pi"><span class="command">lemma</span></span> range_tm_tm_pi<span class="main">:</span> <span class="quoted"><span class="quoted">"pi <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_pi <span class="free">prec</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">prec</span><span class="main">.</span> real_of_float <span class="main">(</span>lb_pi <span class="bound">prec</span><span class="main">)</span> <span class="main">≤</span> real_of_float <span class="main">(</span>ub_pi <span class="bound">prec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iffD1<span class="main">[</span><span class="operator">OF</span> atLeastAtMost_iff<span class="main">,</span> <span class="operator">OF</span> pi_boundaries<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ivl_pi</span></span> <span class="keyword2"><span class="keyword">where</span></span> ivl_pi_def<span class="main">:</span> <span class="quoted"><span class="quoted">"compute_bound_fa <span class="free">prec</span> <span class="keyword1">Pi</span> <span class="main">[]</span> <span class="main">=</span> Some <span class="skolem">ivl_pi</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> approx.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> range_tm_def Let_def
    <span class="keyword1"><span class="command">using</span></span> compute_bound_fa_correct<span class="main">[</span><span class="operator">OF</span> ivl_pi_def<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq Let_def centered_def ivl_pi_def tm_pi_def
        <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> compute_bound_fa.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Derivations of floatarith expressions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Compute the nth derivative of a floatarith expression›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">deriv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> floatarith <span class="main">⇒</span> nat <span class="main">⇒</span> floatarith"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deriv</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">deriv</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> DERIV_floatarith <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="free">deriv</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Taylor_Models-isDERIV_DERIV_floatarith"><span class="command">lemma</span></span> isDERIV_DERIV_floatarith<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isDERIV <span class="free">v</span> <span class="free">f</span> <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isDERIV <span class="free">v</span> <span class="main">(</span>DERIV_floatarith <span class="free">v</span> <span class="free">f</span><span class="main">)</span> <span class="free">vs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Power <span class="skolem">f</span> <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> isDERIV_Power<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_eq_Suc add_nonneg_eq_0_iff <span class="main">)</span>

<span class="keyword1" id="Taylor_Models-isDERIV_is_analytic"><span class="command">lemma</span></span> isDERIV_is_analytic<span class="main">:</span>
  <span class="quoted"><span class="quoted">"isDERIV <span class="free">i</span> <span class="main">(</span>Taylor_Models.deriv <span class="free">i</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"isDERIV <span class="free">i</span> <span class="free">f</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> isDERIV_DERIV_floatarith that
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Taylor_Models-deriv_correct"><span class="command">lemma</span></span> deriv_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isDERIV <span class="free">i</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="free">i</span><span class="main">:=</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> interpret_floatarith <span class="main">(</span>deriv <span class="free">i</span> <span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="free">i</span><span class="main">:=</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> interpret_floatarith <span class="main">(</span>deriv <span class="free">i</span> <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="free">i</span><span class="main">:=</span><span class="free">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_field_derivative_at_within<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> DERIV_floatarith<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> isDERIV_is_analytic<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Faster derivation for univariate functions, producing smaller terms and thus less over-approximation.›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TODO: Extend to Arctan, Log!›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">deriv_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"floatarith <span class="main">⇒</span> nat <span class="main">⇒</span> floatarith"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">deriv_rec</span> <span class="main">(</span><span class="keyword1">Exp</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="keyword1">Exp</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">deriv_rec</span> <span class="main">(</span><span class="keyword1">Cos</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="numeral">4</span>
         <span class="keyword1">of</span> <span class="main">0</span> <span class="main">⇒</span> <span class="keyword1">Cos</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span>
         <span class="main">|</span> Suc <span class="main">0</span> <span class="main">⇒</span> <span class="keyword1">Minus</span> <span class="main">(</span>Sin <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
         <span class="main">|</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">⇒</span> <span class="keyword1">Minus</span> <span class="main">(</span><span class="keyword1">Cos</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
         <span class="main">|</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> Sin <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">deriv_rec</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="keyword1">Mult</span> <span class="main">(</span><span class="keyword1">Num</span> <span class="main">(</span>fact <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Power</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">deriv_rec</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> deriv <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>

<span class="keyword1" id="Taylor_Models-deriv_rec_correct"><span class="command">lemma</span></span> deriv_rec_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"isDERIV <span class="main">0</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> interpret_floatarith <span class="main">(</span>deriv_rec <span class="free">f</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> interpret_floatarith <span class="main">(</span>deriv_rec <span class="free">f</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="free">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> deriv_rec.cases<span class="main">)</span>
                      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms deriv_correct<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="keyword1">Cos</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> n_mod_4_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">0</span> <span class="main">|</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="main">1</span> <span class="main">|</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">|</span> <span class="free">n</span> <span class="keyword1">mod</span> <span class="numeral">4</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> Sin_sin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> interpret_floatarith <span class="main">(</span>Sin <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> sin <span class="main">(</span><span class="bound">xs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> interpret_floatarith <span class="main">(</span>deriv_rec <span class="main">(</span><span class="keyword1">Cos</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span>
         interpret_floatarith <span class="main">(</span>deriv_rec <span class="main">(</span><span class="keyword1">Cos</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="free">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
         <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n_mod_4_cases assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_Suc Sin_sin field_differentiable_minus
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"isDERIV <span class="main">0</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="free">t</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> Suc <span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> Suc <span class="skolem">n</span> <span class="keyword1">mod</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> parity_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span>deriv_rec <span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> fact <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="skolem">n</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">x</span><span class="main">^</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def <span class="dynamic"><span class="dynamic">field_simps</span></span> fact_real_float_equiv<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> closed_formula <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="bound">x</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> <span class="main">-</span>real <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> inverse <span class="main">(</span><span class="free">t</span> <span class="main">^</span> Suc <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> DERIV_inverse_fun<span class="main">[</span><span class="operator">OF</span> DERIV_pow<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="free">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted">UNIV</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DERIV_cong_ev<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fact <span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> inverse <span class="main">(</span><span class="bound">x</span> <span class="main">^</span> Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> fact <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="free">n</span> <span class="main">/</span> <span class="free">t</span> <span class="main">^</span> Suc <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DERIV_cong_ev<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> refl _ _ DERIV_cmult<span class="main"><span class="main"><span class="main">[</span></span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main"><span class="main">=</span></span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"fact <span class="free"><span class="free">n</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>real<span class="main"><span class="main">)</span></span><span class="main"><span class="main">^</span></span><span class="free"><span class="free">n</span></span>"</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> interpret_floatarith <span class="main">(</span>deriv_rec <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span>
         interpret_floatarith <span class="main">(</span>deriv_rec <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="free">t</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
         <span class="main">(</span><span class="keyword1">at</span> <span class="free">t</span> <span class="keyword1">within</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> has_field_derivative_at_within<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DERIV_cong_ev<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> refl _ closed_formula<span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main"><span class="main"><span class="main">,</span></span></span></span> <span class="operator">symmetric</span><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> f_def<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span> 1<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fact_real_float_equiv inverse_eq_divide even_iff_mod_2_eq_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main">:</span> has_field_derivative_subset<span class="main">[</span><span class="operator">OF</span> DERIV_exp subset_UNIV<span class="main">]</span>›</span><span class="main">)</span>

<span class="keyword1" id="Taylor_Models-deriv_rec_0_idem"><span class="command">lemma</span></span> deriv_rec_0_idem<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"deriv_rec <span class="free">f</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> deriv_rec.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Computing Taylor models for arbitrary univariate expressions›</span></span> 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tmf_c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> floatarith <span class="main">⇒</span> nat <span class="main">⇒</span> float interval option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tmf_c</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> compute_bound_fa <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="main">(</span>deriv_rec <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Num</span> <span class="main">(</span>fact <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span>
    <span class="comment1">― ‹The interval coefficients of the Taylor polynomial,
   i.e. the real coefficients approximated by a float interval.›</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tmf_ivl_cs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float list <span class="main">⇒</span> floatarith <span class="main">⇒</span> float interval list option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tmf_ivl_cs</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> those <span class="main">(</span>map <span class="main">(</span>tmf_c <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">ord</span></span></span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>tmf_c <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="comment1">― ‹Make a list of bounds on the n+1 coefficients, with the n+1-th coefficient bounding
   the remainder term of the Taylor-Lagrange formula.›</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tmf_polys</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float interval list <span class="main">⇒</span> float poly <span class="main">×</span> float interval poly"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tmf_polys</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span>poly.C <span class="main">0</span><span class="main">,</span> poly.C <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">tmf_polys</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">let</span> <span class="main">(</span><span class="bound">pf</span><span class="main">,</span> <span class="bound">pi</span><span class="main">)</span> <span class="main">=</span> <span class="free">tmf_polys</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span>
         <span class="keyword1">in</span> <span class="main">(</span>poly.CN <span class="main">(</span>poly.C <span class="main">(</span>mid <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="bound">pf</span><span class="main">,</span> poly.CN <span class="main">(</span>poly.C <span class="main">(</span>centered <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="bound">pi</span><span class="main">)</span>
       <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_floatarith</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float list <span class="main">⇒</span> floatarith <span class="main">⇒</span> taylor_model option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_floatarith</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span>
  map_option <span class="main">(</span><span class="main">λ</span><span class="bound">cs</span><span class="main">.</span> 
    <span class="keyword1">let</span> <span class="main">(</span><span class="bound">pf</span><span class="main">,</span> <span class="bound">pi</span><span class="main">)</span> <span class="main">=</span> tmf_polys <span class="bound">cs</span><span class="main">;</span>
        <span class="main"><span class="bound">_</span></span> <span class="main">=</span> compute_bound_tm <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>List.map2 <span class="main">(-)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">;</span>
        <span class="bound">e</span> <span class="main">=</span> round_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span>Ipoly <span class="main">(</span>List.map2 <span class="main">(-)</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="bound">pi</span><span class="main">)</span> <span class="comment1">― ‹TODO: use <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>compute_bound_tm›</span></span> here?!›</span>
    <span class="keyword1">in</span> TaylorModel <span class="bound">pf</span> <span class="bound">e</span>
  <span class="main">)</span> <span class="main">(</span>tmf_ivl_cs <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>
<span class="main">)</span>"</span></span> <span class="comment1">― ‹Compute a Taylor model from an arbitrary, univariate floatarith expression, if possible.
   This is used to compute Taylor models for elemental functions like sin, cos, exp, etc.›</span>

<span class="keyword1"><span class="command">term</span></span> <span class="quoted">compute_bound_poly</span>
<span class="keyword1" id="Taylor_Models-tmf_c_correct"><span class="command">lemma</span></span> tmf_c_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"float interval list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">I</span><span class="main">::</span><span class="quoted"><span class="quoted">"float interval"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted">floatarith</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">all_in</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tmf_c <span class="free">prec</span> <span class="free">A</span> <span class="free">f</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span>deriv_rec <span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="free">a</span> <span class="main">/</span> fact <span class="free">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> compute_bound_fa_correct<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> tmf_c.simps<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_real_def fact_real_float_equiv<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tmf_ivl_cs_length"><span class="command">lemma</span></span> tmf_ivl_cs_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tmf_ivl_cs <span class="free">prec</span> <span class="free">n</span> <span class="free">A</span> <span class="free">a</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">=</span> <span class="free">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Some_those_length<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">unfolded</span> tmf_ivl_cs.simps<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tmf_ivl_cs_correct"><span class="command">lemma</span></span> tmf_ivl_cs_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted"><span class="quoted">"float interval list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted">floatarith</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">all_in</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tmf_ivl_cs <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">cs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">ord</span> <span class="main">⟹</span> tmf_c <span class="free">prec</span> <span class="main">(</span>map interval_of <span class="free">a</span><span class="main">)</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">cs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tmf_c <span class="free">prec</span> <span class="free">I</span> <span class="free">f</span> <span class="free">ord</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">cs</span><span class="main">!</span><span class="free">ord</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">=</span> Suc <span class="free">ord</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tmf_ivl_cs_length<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tmf_c <span class="free">prec</span> <span class="free">I</span> <span class="free">f</span> <span class="free">ord</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">cs</span><span class="main">!</span><span class="free">ord</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Some_those_nth assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> diff_zero length_map length_upt less_add_one
        nth_append_length tmf_ivl_cs.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">ord</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Some <span class="main">(</span><span class="free">cs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map <span class="main">(</span>tmf_c <span class="free">prec</span> <span class="free">a</span> <span class="free">f</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">ord</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span>tmf_c <span class="free">prec</span> <span class="free">I</span> <span class="free">f</span> <span class="free">ord</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Some_those_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> tmf_ivl_cs_length <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">ord</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tmf_c <span class="free">prec</span> <span class="free">a</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">cs</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">ord</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="free">cs</span> <span class="main">=</span> Suc <span class="free">ord</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta' those_eq_Some_iff list_eq_iff_nth_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Taylor_Models-Ipoly_fst_tmf_polys"><span class="command">lemma</span></span> Ipoly_fst_tmf_polys<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Ipoly <span class="free">xs</span> <span class="main">(</span>fst <span class="main">(</span>tmf_polys <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>length <span class="free">z</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">0</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>mid <span class="main">(</span><span class="free">z</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">xs</span><span class="main">::</span><span class="quoted"><span class="quoted">"real list"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list.size add_Suc_right sum.lessThan_Suc_shift
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta' Let_def nth_Cons Cons sum_distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Taylor_Models-insertion_fst_tmf_polys"><span class="command">lemma</span></span> insertion_fst_tmf_polys<span class="main">:</span>
  <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span>fst <span class="main">(</span>tmf_polys <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>length <span class="free">z</span><span class="main">.</span> <span class="free">e</span> <span class="main">0</span> <span class="main">^</span> <span class="bound">i</span> <span class="main">*</span> <span class="main">(</span>mid <span class="main">(</span><span class="free">z</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">e</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> list.size add_Suc_right sum.lessThan_Suc_shift
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta' Let_def nth_Cons Cons sum_distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Taylor_Models-Ipoly_snd_tmf_polys"><span class="command">lemma</span></span> Ipoly_snd_tmf_polys<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>horner_eval <span class="main">(</span>real_interval <span class="keyword1">o</span> centered <span class="keyword1">o</span> nth <span class="free">z</span><span class="main">)</span> <span class="free">x</span> <span class="main">(</span>length <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span>Ipoly <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span>map_poly real_interval <span class="main">(</span>snd <span class="main">(</span>tmf_polys <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">z</span> <span class="skolem">zs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">[</span><span class="operator">THEN</span> set_of_mul_inc_right<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> list.size add_Suc_right sum.lessThan_Suc_shift
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta' Let_def nth_Cons sum_distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span>
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_in_intervalE <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_in_intervalI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_interval_zero<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-zero_interval"><span class="command">lemma</span></span> zero_interval<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-sum_in_intervalI"><span class="command">lemma</span></span> sum_in_intervalI<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">f</span> <span class="free">X</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> sum <span class="free">g</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">::</span> ordered_comm_monoid_add"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_in_intervalI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Taylor_Models-set_of_sum_subset"><span class="command">lemma</span></span> set_of_sum_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>sum <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span>sum <span class="free">g</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> set_of <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span><span class="main">⇒</span><span class="tfree">'a</span><span class="main">::</span>linordered_ab_group_add interval"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_of_add_inc<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-interval_of_plus"><span class="command">lemma</span></span> interval_of_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_of <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> interval_of <span class="free">a</span> <span class="main">+</span> interval_of <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-interval_of_uminus"><span class="command">lemma</span></span> interval_of_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_of <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> interval_of <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-interval_of_zero"><span class="command">lemma</span></span> interval_of_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_of <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-interval_of_sum"><span class="command">lemma</span></span> interval_of_sum<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_of <span class="main">(</span>sum <span class="free">f</span> <span class="free">X</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> interval_of <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">X</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_of_plus interval_of_zero<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-interval_of_prod"><span class="command">lemma</span></span> interval_of_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_of <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> interval_of <span class="free">a</span> <span class="main">*</span> interval_of <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lower_times upper_times interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-in_set_of_interval_of"><span class="command">lemma</span></span> in_set_of_interval_of<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="main">(</span>interval_of <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>order"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-real_interval_Ipoly"><span class="command">lemma</span></span> real_interval_Ipoly<span class="main">:</span> <span class="quoted"><span class="quoted">"real_interval <span class="main">(</span>Ipoly <span class="free">xs</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="main">(</span>map real_interval <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>map_poly real_interval <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_interval_plus real_interval_minus real_interval_times
      real_interval_uminus real_interval_power<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tmf_polys1"><span class="command">lemma</span></span> num_params_tmf_polys1<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>fst <span class="main">(</span>tmf_polys <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta' Let_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tmf_polys2"><span class="command">lemma</span></span> num_params_tmf_polys2<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>snd <span class="main">(</span>tmf_polys <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta' Let_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-set_of_real_interval_subset"><span class="command">lemma</span></span> set_of_real_interval_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>real_interval <span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span>real_interval <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"set_of <span class="free">x</span> <span class="main">⊆</span> set_of <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> tm_floatarith<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"tm_floatarith <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">xs</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">all_in</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">I</span> <span class="main">!</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xs_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">I</span> <span class="main">!</span> <span class="main">0</span> <span class="main">⟹</span> isDERIV <span class="main">0</span> <span class="free">f</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span> <span class="main">:=</span> <span class="bound">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">i</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">xs</span> <span class="main">⟹</span> <span class="free">e</span> <span class="bound">i</span> <span class="main">=</span> real_of_float <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> diff_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">-</span> real_of_float <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">e</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="free">f</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> xs_ne a <span class="keyword1"><span class="command">have</span></span> I_ne<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> xs'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">[</span><span class="main">0</span> <span class="main">:=</span> <span class="free">x</span><span class="main">]</span> <span class="keyword1">all_in</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_list_update x<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> t <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"tmf_ivl_cs <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">xs</span> <span class="free">f</span> <span class="main">=</span> Some <span class="skolem">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> tz<span class="main">:</span> <span class="quoted"><span class="quoted">"tm_poly <span class="free">t</span> <span class="main">=</span> fst <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> tb<span class="main">:</span> <span class="quoted"><span class="quoted">"tm_bound <span class="free">t</span> <span class="main">=</span> round_interval <span class="free">prec</span> <span class="main">(</span>Ipoly <span class="main">(</span>List.map2 <span class="main">(-)</span> <span class="free">I</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> those_eq_Some_iff split_beta' Let_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> tmf_ivl_cs.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tmf_ivl_cs_correct<span class="main">[</span><span class="operator">OF</span> a z<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> z_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">ord</span> <span class="main">⟹</span> tmf_c <span class="free">prec</span> <span class="main">(</span>map interval_of <span class="free">xs</span><span class="main">)</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">z</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lz<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">z</span> <span class="main">=</span> Suc <span class="free">ord</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">z</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="free">ord</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> z_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"tmf_c <span class="free">prec</span> <span class="free">I</span> <span class="free">f</span> <span class="free">ord</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">z</span> <span class="main">!</span> <span class="free">ord</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> rewr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{..</span><span class="free">ord</span><span class="main">}</span> <span class="main">=</span> insert <span class="free">ord</span> <span class="main">{..&lt;</span><span class="free">ord</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?diff</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> interpret_floatarith <span class="main">(</span>deriv_rec <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span><span class="main">:=</span><span class="bound">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_float <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_float <span class="main">(</span>lower <span class="main">(</span><span class="free">I</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_float <span class="main">(</span>upper <span class="main">(</span><span class="free">I</span><span class="main">!</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">::</span>real"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> interpret_floatarith <span class="free">f</span> <span class="main">(</span><span class="free">xs</span><span class="main">[</span><span class="main">0</span> <span class="main">:=</span> <span class="bound">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?diff</span> <span class="main">0</span> <span class="main">=</span> <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_update<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="var">?n</span> <span class="main">∧</span> <span class="var">?a</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="var">?b</span> <span class="main">⟶</span> <span class="main">(</span><span class="var">?diff</span> <span class="bound">m</span> <span class="keyword1">has_real_derivative</span> <span class="var">?diff</span> <span class="main">(</span>Suc <span class="bound">m</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> deriv_rec_correct deriv <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq xs_ne<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≤</span> <span class="var">?c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">≤</span> <span class="var">?b</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≤</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a xs_ne x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cr</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">s</span> <span class="bound">m</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="free">ord</span> <span class="keyword1">then</span> <span class="var">?diff</span> <span class="bound">m</span> <span class="var">?c</span> <span class="main">/</span> fact <span class="bound">m</span> <span class="main">-</span> mid <span class="main">(</span><span class="skolem">z</span> <span class="main">!</span> <span class="bound">m</span><span class="main">)</span>
                           <span class="keyword1">else</span> <span class="var">?diff</span> <span class="bound">m</span> <span class="bound">s</span> <span class="main">/</span> fact <span class="free">ord</span> <span class="main">-</span> mid <span class="main">(</span><span class="skolem">z</span> <span class="main">!</span> <span class="free">ord</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ci</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ci</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> real_interval <span class="main">(</span><span class="skolem">z</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> interval_of <span class="main">(</span>real_of_float <span class="main">(</span>mid <span class="main">(</span><span class="skolem">z</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> cr_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cr</span> <span class="free">x</span> <span class="free">ord</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="skolem">ci</span> <span class="free">ord</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tmf_c_correct<span class="main">[</span><span class="operator">OF</span> xs'_in z_ord<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ci_def set_of_eq cr_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> enclosure<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="free">ord</span><span class="main">.</span> <span class="skolem">cr</span> <span class="skolem">s</span> <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">cr</span> <span class="skolem">s</span> <span class="free">ord</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">^</span> <span class="free">ord</span>
      <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> round_interval <span class="free">prec</span> <span class="main">(</span>Ipoly <span class="main">(</span>List.map2 <span class="main">(-)</span> <span class="free">I</span> <span class="main">(</span>map interval_of <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> cr_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cr</span> <span class="skolem">s</span> <span class="free">ord</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="skolem">ci</span> <span class="free">ord</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="free">ord</span><span class="main">.</span> <span class="skolem">cr</span> <span class="skolem">s</span> <span class="bound">m</span>  <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">xs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">cr</span> <span class="skolem">s</span> <span class="free">ord</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">xs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="free">ord</span> <span class="main">=</span>
        horner_eval <span class="main">(</span><span class="skolem">cr</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">xs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">ord</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> horner_eval_eq_setsum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> horner_eval <span class="skolem">ci</span> <span class="main">(</span>real_interval <span class="main">(</span><span class="free">I</span> <span class="main">!</span> <span class="main">0</span> <span class="main">-</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">ord</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> horner_eval_interval<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="free">ord</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">ord</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">ord</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cr</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="skolem">ci</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cr_def ci_def not_less less_Suc_eq_le
              <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> minus_in_intervalI tmf_c_correct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ z_less<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="main">(</span><span class="operator">metis</span> in_set_of_interval_of list_update_id map_update nth_map real_interval_of<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cr_ord<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> minus_in_intervalI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_interval_minus x<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set_of <span class="main">(</span>horner_eval <span class="main">(</span>real_interval <span class="keyword1">o</span> centered <span class="main">∘</span> <span class="main">(!)</span> <span class="skolem">z</span><span class="main">)</span>
      <span class="main">(</span>real_interval <span class="main">(</span><span class="free">I</span> <span class="main">!</span> <span class="main">0</span> <span class="main">-</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ci_def centered_def real_interval_minus real_interval_of lz<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> set_of <span class="main">(</span>Ipoly <span class="main">[</span>real_interval <span class="main">(</span><span class="free">I</span> <span class="main">!</span> <span class="main">0</span> <span class="main">-</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span>
        <span class="main">(</span>map_poly real_interval <span class="main">(</span>snd <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> set_of <span class="var">?x</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Ipoly_snd_tmf_polys<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set_of <span class="main">(</span>real_interval <span class="main">(</span>Ipoly <span class="main">[</span><span class="main">(</span><span class="free">I</span> <span class="main">!</span> <span class="main">0</span> <span class="main">-</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>snd <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> real_interval_Ipoly num_params_tmf_polys2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> set_of <span class="main">(</span>real_interval <span class="main">(</span>round_interval <span class="free">prec</span> <span class="main">(</span>Ipoly <span class="main">[</span><span class="main">(</span><span class="free">I</span> <span class="main">!</span> <span class="main">0</span> <span class="main">-</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>snd <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_of_real_interval_subset<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> round_ivl_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">[</span><span class="free">I</span> <span class="main">!</span> <span class="main">0</span> <span class="main">-</span> interval_of <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>snd <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Ipoly <span class="main">(</span>List.map2 <span class="main">(-)</span> <span class="free">I</span> <span class="main">(</span>map interval_of <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  a
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ipoly_num_params_cong nth_equalityI
          <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons  <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>length_greater_0_conv <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ num_params_tmf_polys2<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> map2_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">ord</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">ord</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">ord</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> Taylor<span class="main">[</span><span class="operator">OF</span> 1 2 3 4 5<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="var">?x</span> <span class="main">&lt;</span> <span class="var">?c</span> <span class="keyword1">then</span> <span class="var">?x</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="var">?c</span> <span class="keyword1">else</span> <span class="var">?c</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="var">?x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="var">?x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="var">?n</span><span class="main">.</span> <span class="var">?diff</span> <span class="bound">m</span> <span class="var">?c</span> <span class="main">/</span> fact <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> <span class="var">?c</span><span class="main">)</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">+</span> <span class="var">?diff</span> <span class="var">?n</span> <span class="skolem">s</span> <span class="main">/</span> fact <span class="var">?n</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> <span class="var">?c</span><span class="main">)</span> <span class="main">^</span> <span class="var">?n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="free">f</span> <span class="main">(</span><span class="main">(</span>map real_of_float <span class="free">xs</span><span class="main">)</span><span class="main">[</span><span class="main">0</span> <span class="main">:=</span> <span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span>
    Ipoly <span class="main">(</span>List.map2 <span class="main">(-)</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[</span><span class="free">xs</span><span class="main">!</span><span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="var">?n</span><span class="main">.</span> <span class="var">?diff</span> <span class="bound">m</span> <span class="var">?c</span> <span class="main">/</span> fact <span class="bound">m</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> <span class="var">?c</span><span class="main">)</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">+</span> <span class="var">?diff</span> <span class="var">?n</span> <span class="skolem">s</span> <span class="main">/</span> fact <span class="var">?n</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x</span> <span class="main">-</span> <span class="var">?c</span><span class="main">)</span> <span class="main">^</span> <span class="var">?n</span> <span class="main">-</span>
    <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">≤</span><span class="var">?n</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">xs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="bound">m</span> <span class="main">*</span> mid <span class="main">(</span><span class="skolem">z</span> <span class="main">!</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> tse
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ipoly_fst_tmf_polys rewr lz<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">m</span><span class="main">&lt;</span><span class="free">ord</span><span class="main">.</span> <span class="skolem">cr</span> <span class="skolem">s</span> <span class="bound">m</span>  <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">xs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="bound">m</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">cr</span> <span class="skolem">s</span> <span class="free">ord</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">xs</span><span class="main">!</span><span class="main">0</span><span class="main">)</span> <span class="main">^</span> <span class="free">ord</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rewr
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> cr_def sum.distrib sum_subtractf<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cr</span> <span class="skolem">s</span> <span class="free">ord</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="skolem">ci</span> <span class="free">ord</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cr_def ci_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> minus_in_intervalI
          tmf_c_correct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ z_ord<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> a all_in_def in_real_intervalI length_greater_0_conv nth_list_update s xs_ne<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> enclosure<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="main">(</span>List.map2 <span class="main">(-)</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">(</span>map real_of_float <span class="main">[</span><span class="free">xs</span> <span class="main">!</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map_poly real_of_float <span class="main">(</span>fst <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="main">(</span>fst <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> diff_e
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ipoly_eq_insertionI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ num_params_tmf_polys1<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tz tb range_tm_def set_of_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">z</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lz<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>tmf_polys <span class="main">[</span><span class="skolem">z</span> <span class="main">!</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> CN <span class="main">(</span>mid <span class="main">(</span><span class="skolem">z</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="keyword1">)<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">0</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>tmf_polys <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> CN <span class="main">(</span>mid <span class="main">(</span><span class="skolem">z</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="keyword1">)<span class="hidden">⇩</span><sub>p</sub></span> <span class="main">0</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>p</sub></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> enclosure<span class="main">[</span><span class="operator">OF</span> cr_ord<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cr_def 3 range_tm_def tz tb set_of_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">have</span></span> rewr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{..&lt;</span>length <span class="skolem">z</span><span class="main">}</span> <span class="main">=</span> insert <span class="main">0</span> <span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span>length <span class="skolem">z</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lz<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2 enclosure<span class="main">[</span><span class="operator">OF</span> cr_ord<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_power 2 cr_def range_tm_def tz tb insertion_fst_tmf_polys
          diff_e<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> rewr set_of_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Operations on Taylor models›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_norm_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_norm_poly</span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> TaylorModel <span class="main">(</span>polynate <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>
<span class="comment1">― ‹Normalizes the Taylor model by transforming its polynomial into horner form.›</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_lower_order</span> <span class="entity">tm_lower_order_of_normed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_lower_order</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free">tm_lower_order_of_normed</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>tm_norm_poly <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span>  <span class="quoted"><span class="quoted">"<span class="free">tm_lower_order_of_normed</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">let</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> split_by_degree <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
         <span class="keyword1">in</span> TaylorModel <span class="bound">l</span> <span class="main">(</span>round_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">+</span> compute_bound_poly <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="bound">r</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="main">)</span>"</span></span>
<span class="comment1">― ‹Reduces the degree of a Taylor model's polynomial to n and keeps it range by increasing the error bound.›</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_round_floats</span> <span class="entity">tm_round_floats_of_normed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_round_floats</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free">tm_round_floats_of_normed</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>tm_norm_poly <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">tm_round_floats_of_normed</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">let</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">=</span> split_by_prec <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
         <span class="keyword1">in</span> TaylorModel <span class="bound">l</span> <span class="main">(</span>round_interval <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">+</span> compute_bound_poly <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="bound">r</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span>
       <span class="main">)</span>"</span></span>
<span class="comment1">― ‹Rounding of Taylor models. Rounds both the coefficients of the polynomial and the floats in the error bound.›</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_norm</span> <span class="entity">tm_norm'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_norm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free">tm_norm'</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>tm_norm_poly <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">tm_norm'</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> tm_round_floats_of_normed <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>tm_lower_order_of_normed <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span> 
<span class="comment1">― ‹Normalization of taylor models. Performs order lowering and rounding on tayor models,
   also converts the polynomial into horner form.›</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_neg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_neg</span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> TaylorModel <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_add</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"taylor_model <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_add</span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> TaylorModel <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_sub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"taylor_model <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_sub</span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> tm_add <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="main">(</span>tm_neg <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_mul</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_mul</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">let</span> <span class="bound">d1</span> <span class="main">=</span> compute_bound_poly <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
             <span class="bound">d2</span> <span class="main">=</span> compute_bound_poly <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
             <span class="bound">p</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">;</span>
             <span class="bound">e</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">*</span><span class="bound">d2</span> <span class="main">+</span> <span class="bound">d1</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">e2</span></span></span>
         <span class="keyword1">in</span> tm_norm' <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>TaylorModel <span class="bound">p</span> <span class="bound">e</span><span class="main">)</span>
       <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> tm_norm'.simps

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_pow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> nat <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_pow</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">0</span> <span class="main">=</span> tm_const <span class="main">1</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">tm_pow</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">if</span> odd <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>
         <span class="keyword1">then</span> tm_mul <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span><span class="free">tm_pow</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>
         <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">t'</span> <span class="main">=</span> <span class="free">tm_pow</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span><span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>
              <span class="keyword1">in</span> tm_mul <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">t'</span> <span class="bound">t'</span>
       <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Evaluates a float polynomial, using a Taylor model as the parameter. This is used to compose Taylor models.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval_poly_at_tm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> float poly <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>poly.C <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> tm_const <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>poly.Bound <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>poly.Add <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
         <span class="main">=</span> tm_add <span class="main">(</span><span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>
                  <span class="main">(</span><span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>poly.Sub <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
         <span class="main">=</span> tm_sub <span class="main">(</span><span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>
                  <span class="main">(</span><span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>poly.Mul <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
         <span class="main">=</span> tm_mul <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>  <span class="free"><span class="bound"><span class="entity">p1</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>
                               <span class="main">(</span><span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p2</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>poly.Neg <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
         <span class="main">=</span> tm_neg <span class="main">(</span><span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>poly.Pw <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>
         <span class="main">=</span> tm_pow <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>poly.CN <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">let</span> <span class="bound">pt</span> <span class="main">=</span> <span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span>
             <span class="bound">t_mul_pt</span> <span class="main">=</span> tm_mul <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="bound">pt</span> 
         <span class="keyword1">in</span> tm_add <span class="main">(</span><span class="free">eval_poly_at_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span> <span class="bound">t_mul_pt</span>
       <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_inc_err</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float interval <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_inc_err</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> TaylorModel <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_comp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> float <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_comp</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ta</span></span></span> <span class="main">(</span>TaylorModel <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">let</span> <span class="bound">t_sub_ta</span> <span class="main">=</span> tm_sub <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>tm_const <span class="free"><span class="bound"><span class="entity">ta</span></span></span><span class="main">)</span><span class="main">;</span>
             <span class="bound">pt</span> <span class="main">=</span> eval_poly_at_tm <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">t_sub_ta</span>
         <span class="keyword1">in</span> tm_inc_err <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">pt</span>
       <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tm_max›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tm_min›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tm_abs›</span></span></span></span> are implemented extremely naively, because I don't expect them to be very useful.
   But the implementation is fairly modular, i.e. <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tm_{abs,min,max}›</span></span></span></span> all can easily be swapped out,
   as long as the corresponding correctness lemmas <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>tm_{abs,min,max}_range›</span></span></span></span> are updated as well.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_abs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_abs</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">bound</span> <span class="main">=</span> compute_bound_tm <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> <span class="bound">abs_bound</span><span class="main">=</span>Ivl <span class="main">(</span><span class="main">0</span><span class="main">::</span>float<span class="main">)</span> <span class="main">(</span>max <span class="main">(</span>abs <span class="main">(</span>lower <span class="bound">bound</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>abs <span class="main">(</span>upper <span class="bound">bound</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1">in</span> TaylorModel <span class="main">(</span>poly.C <span class="main">(</span>mid <span class="bound">abs_bound</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>centered <span class="bound">abs_bound</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_union</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_union</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> <span class="main">(</span>
  <span class="keyword1">let</span> <span class="bound">b1</span> <span class="main">=</span> compute_bound_tm <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span><span class="main">;</span> <span class="bound">b2</span> <span class="main">=</span> compute_bound_tm <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span><span class="main">;</span>
      <span class="bound">b_combined</span> <span class="main">=</span> sup <span class="bound">b1</span> <span class="bound">b2</span>
  <span class="keyword1">in</span> TaylorModel <span class="main">(</span>poly.C <span class="main">(</span>mid <span class="bound">b_combined</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>centered <span class="bound">b_combined</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_min</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_min</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> tm_union <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tm_max</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model <span class="main">⇒</span> taylor_model"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_max</span>  <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span> <span class="main">=</span> tm_union <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">t1</span></span></span> <span class="free"><span class="bound"><span class="entity">t2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rangeity of is preserved by our operations on Taylor models.›</span></span>

<span class="keyword1" id="Taylor_Models-insertion_polyadd"><span class="command">lemma</span></span> insertion_polyadd<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> insertion <span class="free">e</span> <span class="free">a</span> <span class="main">+</span> insertion <span class="free">e</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyadd.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> mult_zero_right ring_class.ring_distribs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="keyword1" id="Taylor_Models-insertion_polyneg"><span class="command">lemma</span></span> insertion_polyneg<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span><span class="keyword1">~<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>  <span class="main">-</span> insertion <span class="free">e</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polyneg.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Let_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-insertion_polysub"><span class="command">lemma</span></span> insertion_polysub<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">-<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> insertion <span class="free">e</span> <span class="free">a</span> <span class="main">-</span> insertion <span class="free">e</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>ring_1 poly"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> polysub_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-insertion_polymul"><span class="command">lemma</span></span> insertion_polymul<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> insertion <span class="free">e</span> <span class="free">a</span> <span class="main">*</span> insertion <span class="free">e</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_ring_1 poly"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polymul.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> Let_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-insertion_polypow"><span class="command">lemma</span></span> insertion_polypow<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> insertion <span class="free">e</span> <span class="free">a</span> <span class="main">^</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_ring_1 poly"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def div2_less_self 1 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> polypow.simps<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> even_Suc even_two_times_div_two odd_Suc_div_two semiring_normalization_rules<span class="main"><span class="main">(</span></span>27<span class="main"><span class="main">)</span></span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>36<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> even_two_times_div_two semiring_normalization_rules<span class="main"><span class="main">(</span></span>36<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-insertion_polynate"><span class="command">lemma</span></span> insertion_polynate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"insertion <span class="free">bs</span> <span class="main">(</span>polynate <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>insertion <span class="free">bs</span> <span class="free">p</span> <span class="main">::</span> <span class="tfree">'a</span><span class="main">::</span>comm_ring_1<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> polynate.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tm_norm_poly_range"><span class="command">lemma</span></span> tm_norm_poly_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_norm_poly <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> range_tm_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-split_by_degree_correct_insertion"><span class="command">lemma</span></span> split_by_degree_correct_insertion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_by_degree <span class="free">ord</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maxdegree <span class="free">l</span> <span class="main">≤</span> <span class="free">ord</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"insertion <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> insertion <span class="free">x</span> <span class="free">l</span> <span class="main">+</span> insertion <span class="free">x</span> <span class="free">r</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"num_params <span class="free">l</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P3</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"num_params <span class="free">r</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P4</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> map <span class="free">x</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>num_params <span class="free">p</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> num_params <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Ipoly <span class="skolem">xs</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> insertion_eq_IpolyI xs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">from</span></span> split_by_degree_correct<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span></span><span class="operator"><span class="operator"><span class="operator"><span class="operator">symmetric</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"maxdegree <span class="free">l</span> <span class="main">≤</span> <span class="free">ord</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
    Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">l</span><span class="main">)</span> <span class="main">+</span> Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">r</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="free">l</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="free">r</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span> <span class="var"><span class="quoted"><span class="var">?P3</span></span></span> <span class="var"><span class="quoted"><span class="var">?P4</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> p
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">l</span><span class="main">)</span> <span class="main">=</span> insertion <span class="free">x</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> xs Ipoly_eq_insertionI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">r</span><span class="main">)</span> <span class="main">=</span> insertion <span class="free">x</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> xs Ipoly_eq_insertionI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-split_by_prec_correct_insertion"><span class="command">lemma</span></span> split_by_prec_correct_insertion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"split_by_prec <span class="free">ord</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">l</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> insertion <span class="free">x</span> <span class="free">l</span> <span class="main">+</span> insertion <span class="free">x</span> <span class="free">r</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">l</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">r</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P3</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> map <span class="free">x</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>num_params <span class="free">p</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> num_params <span class="free">p</span> <span class="main">⟹</span> <span class="free">x</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> xs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">x</span> <span class="free">p</span> <span class="main">=</span> Ipoly <span class="skolem">xs</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> insertion_eq_IpolyI xs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">from</span></span> split_by_prec_correct<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>1<span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator"><span class="operator"><span class="operator">symmetric</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
    Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">l</span><span class="main">)</span> <span class="main">+</span> Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">r</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="free">l</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="free">r</span> <span class="main">≤</span> num_params <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span> <span class="var"><span class="quoted"><span class="var">?P3</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> p
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">l</span><span class="main">)</span> <span class="main">=</span> insertion <span class="free">x</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> xs Ipoly_eq_insertionI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ipoly <span class="skolem">xs</span> <span class="main">(</span>map_poly real_of_float <span class="free">r</span><span class="main">)</span> <span class="main">=</span> insertion <span class="free">x</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> r
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> xs Ipoly_eq_insertionI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-tm_lower_order_of_normed_range"><span class="command">lemma</span></span> tm_lower_order_of_normed_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_lower_order_of_normed <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">err</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> TaylorModel <span class="skolem">p</span> <span class="skolem">err</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pl</span></span> <span class="skolem"><span class="skolem">pr</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_split<span class="main">:</span> <span class="quoted"><span class="quoted">"split_by_degree <span class="free">ord</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pl</span><span class="main">,</span> <span class="skolem">pr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"split_by_degree <span class="free">ord</span> <span class="skolem">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> split_by_degree_correct_insertion<span class="main">[</span><span class="operator">OF</span> p_split<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> params<span class="main">:</span> <span class="quoted"><span class="quoted">"maxdegree <span class="skolem">pl</span> <span class="main">≤</span> <span class="free">ord</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">pl</span> <span class="main">≤</span> num_params <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">pr</span> <span class="main">≤</span> num_params <span class="skolem">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ins<span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span>
      insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">pl</span><span class="main">)</span> <span class="main">+</span> insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">pr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms params <span class="keyword1"><span class="command">have</span></span> params_pr<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">pr</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_decomp<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range_tm <span class="free">e</span> <span class="free">t</span> <span class="main">=</span>
    interval_of <span class="main">(</span>insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">pl</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="main">(</span>interval_of <span class="main">(</span>insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">pr</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> real_interval <span class="skolem">err</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_decomp range_tm_def ins <span class="dynamic"><span class="dynamic">ac_simps</span></span> interval_of_plus<span class="main">)</span> <span class="keyword1"><span class="command">term</span></span> <span class="quoted">round_interval</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_of <span class="main">…</span> <span class="main">⊆</span> set_of <span class="main">(</span>interval_of <span class="main">(</span>insertion <span class="free">e</span> <span class="skolem">pl</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    set_of <span class="main">(</span>real_interval <span class="main">(</span>round_interval <span class="free">prec</span> <span class="main">(</span><span class="skolem">err</span> <span class="main">+</span> compute_bound_poly <span class="free">prec</span> <span class="skolem">pr</span> <span class="free">I</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_of_plus real_interval_plus add.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">err</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_plus_mono2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_real_interval_subset<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> round_ivl_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_of_plus real_interval_plus
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_plus_mono2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ order_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> compute_bound_poly_correct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> params_pr<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set_of <span class="main">(</span>range_tm <span class="free">e</span> <span class="main">(</span>tm_lower_order_of_normed <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_decomp split_beta' Let_def p_split range_tm_def set_of_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-num_params_tm_norm_poly_le"><span class="command">lemma</span></span> num_params_tm_norm_poly_le<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_norm_poly <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_polynate<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tm_lower_order_range"><span class="command">lemma</span></span> tm_lower_order_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_lower_order <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_lower_order_of_normed_range tm_norm_poly_range assms
      num_params_tm_norm_poly_le<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tm_round_floats_of_normed_range"><span class="command">lemma</span></span> tm_round_floats_of_normed_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_round_floats_of_normed <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span>"</span></span>
    <span class="comment1">― ‹TODO: this is a clone of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> tm_lower_order_of_normed_range<span class="antiquote">}</span></span> -&gt; general sweeping method!›</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">err</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> TaylorModel <span class="skolem">p</span> <span class="skolem">err</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pl</span></span> <span class="skolem"><span class="skolem">pr</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_prec<span class="main">:</span> <span class="quoted"><span class="quoted">"split_by_prec <span class="free">prec</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pl</span><span class="main">,</span> <span class="skolem">pr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"split_by_prec <span class="free">prec</span> <span class="skolem">p</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> split_by_prec_correct_insertion<span class="main">[</span><span class="operator">OF</span> p_prec<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> params<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">pl</span> <span class="main">≤</span> num_params <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">pr</span> <span class="main">≤</span> num_params <span class="skolem">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ins<span class="main">:</span> <span class="quoted"><span class="quoted">"insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span>
      insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">pl</span><span class="main">)</span> <span class="main">+</span> insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">pr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms params <span class="keyword1"><span class="command">have</span></span> params_pr<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">pr</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_decomp<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range_tm <span class="free">e</span> <span class="free">t</span> <span class="main">=</span>
    interval_of <span class="main">(</span>insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">pl</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="main">(</span>interval_of <span class="main">(</span>insertion <span class="free">e</span> <span class="main">(</span>map_poly real_of_float <span class="skolem">pr</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> real_interval <span class="skolem">err</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_decomp range_tm_def ins <span class="dynamic"><span class="dynamic">ac_simps</span></span> interval_of_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_of <span class="main">…</span> <span class="main">⊆</span> set_of <span class="main">(</span>interval_of <span class="main">(</span>insertion <span class="free">e</span> <span class="skolem">pl</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    set_of <span class="main">(</span>real_interval <span class="main">(</span>round_interval <span class="free">prec</span> <span class="main">(</span><span class="skolem">err</span> <span class="main">+</span> compute_bound_poly <span class="free">prec</span> <span class="skolem">pr</span> <span class="free">I</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_of_plus real_interval_plus add.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">err</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_plus_mono2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> order_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_real_interval_subset<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> round_ivl_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_of_plus real_interval_plus
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_plus_mono2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ order_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> compute_bound_poly_correct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> params_pr<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set_of <span class="main">(</span>range_tm <span class="free">e</span> <span class="main">(</span>tm_round_floats_of_normed <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_decomp split_beta' Let_def p_prec range_tm_def set_of_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-num_params_split_by_degree_le"><span class="command">lemma</span></span> num_params_split_by_degree_le<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>fst <span class="main">(</span>split_by_degree <span class="free">ord</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">K</span>"</span></span>
  <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>snd <span class="main">(</span>split_by_degree <span class="free">ord</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">K</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">x</span> <span class="main">≤</span> <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"float poly"</span></span>
  <span class="keyword1"><span class="command">using</span></span> split_by_degree_correct_insertion<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ord</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">,</span> <span class="operator">OF</span> surjective_pairing<span class="main">]</span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Taylor_Models-num_params_split_by_prec_le"><span class="command">lemma</span></span> num_params_split_by_prec_le<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>fst <span class="main">(</span>split_by_prec <span class="free">ord</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">K</span>"</span></span>
  <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>snd <span class="main">(</span>split_by_prec <span class="free">ord</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">K</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">x</span> <span class="main">≤</span> <span class="free">K</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"float poly"</span></span>
  <span class="keyword1"><span class="command">using</span></span> split_by_prec_correct_insertion<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ord</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">,</span> <span class="operator">OF</span> surjective_pairing<span class="main">]</span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_norm'_le"><span class="command">lemma</span></span> num_params_tm_norm'_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_round_floats_of_normed <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_norm'.simps split_beta' Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_split_by_prec_le<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tm_round_floats_range"><span class="command">lemma</span></span> tm_round_floats_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_round_floats <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_round_floats_of_normed_range assms tm_norm_poly_range num_params_tm_norm_poly_le<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_lower_order_of_normed_le"><span class="command">lemma</span></span> num_params_tm_lower_order_of_normed_le<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_lower_order_of_normed <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta' Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_polynate<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> split_by_degree_correct<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prod_eq_iff<span class="main">)</span>


<span class="keyword1" id="Taylor_Models-tm_norm'_range"><span class="command">lemma</span></span> tm_norm'_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_norm' <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_round_floats_of_normed_range tm_lower_order_of_normed_range assms
      num_params_tm_norm_poly_le num_params_tm_lower_order_of_normed_le
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_norm'.simps<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_norm'"><span class="command">lemma</span></span> num_params_tm_norm'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_norm' <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_norm'.simps split_beta' Let_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_norm'_le num_params_split_by_prec_le num_params_split_by_degree_le<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tm_norm_range"><span class="command">lemma</span></span> tm_norm_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_norm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> assms tm_norm'_range tm_norm_poly_range num_params_tm_norm_poly_le<span class="main">)</span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> tm_norm.simps

<span class="keyword1" id="Taylor_Models-tm_neg_range"><span class="command">lemma</span></span> tm_neg_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_neg <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq range_tm_def interval_of_plus interval_of_uminus map_poly_homo_polyneg<span class="main">)</span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> tm_neg.simps


<span class="keyword1" id="Taylor_Models-tm_bound_tm_add"><span class="command">lemma</span></span> tm_bound_tm_add<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tm_bound <span class="main">(</span>tm_add <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span> <span class="main">=</span> tm_bound <span class="free">t1</span> <span class="main">+</span> tm_bound <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>

<span class="keyword1" id="Taylor_Models-interval_of_add"><span class="command">lemma</span></span> interval_of_add<span class="main">:</span> <span class="quoted"><span class="quoted">"interval_of <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> interval_of <span class="free">a</span> <span class="main">+</span> interval_of <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> interval_eqI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tm_add_range"><span class="command">lemma</span></span> tm_add_range<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_add <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t1</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> range_tmD<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> range_tmD<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> range_tmI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_poly_homo_polyadd real_interval_plus <span class="dynamic"><span class="dynamic">ac_simps</span></span> interval_of_add
        num_params_polyadd insertion_polyadd set_of_eq
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ num_params_polyadd<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> tm_add.simps

<span class="keyword1" id="Taylor_Models-tm_sub_range"><span class="command">lemma</span></span> tm_sub_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_sub <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tm_add_range<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tm_neg_range<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> tm_sub.simps

<span class="keyword1" id="Taylor_Models-set_of_intervalI"><span class="command">lemma</span></span> set_of_intervalI<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>interval_of <span class="free">y</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>order"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-set_of_real_intervalI"><span class="command">lemma</span></span> set_of_real_intervalI<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>interval_of <span class="free">y</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span>real_interval <span class="free">Y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tm_mul_range"><span class="command">lemma</span></span> tm_mul_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> params<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t1</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t2</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_mul <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> tm_poly <span class="free">t1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">=</span> tm_poly <span class="free">t2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">=</span> tm_bound <span class="free">t1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">=</span> tm_bound <span class="free">t2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> t1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">=</span> TaylorModel <span class="skolem">p1</span> <span class="skolem">e1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">=</span> TaylorModel <span class="skolem">p2</span> <span class="skolem">e2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p1_def e1_def p2_def e2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> params <span class="keyword1"><span class="command">have</span></span> params<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">p1</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">p2</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p1_def p2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> range_tmD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xe</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> insertion <span class="free">e</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">xe</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?x'</span> <span class="main">+</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> xe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xe</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">e1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p1_def e1_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_in_intervalE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> range_tmD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ye</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> insertion <span class="free">e</span> <span class="skolem">p2</span> <span class="main">+</span> <span class="skolem">ye</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?y'</span> <span class="main">+</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> ye<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ye</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">e2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2_def e2_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_in_intervalE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> insertion <span class="free">e</span> <span class="main">(</span><span class="skolem">p1</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>p</sub></span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">xe</span> <span class="main">*</span> <span class="var">?y'</span> <span class="main">+</span> <span class="var">?x'</span> <span class="main">*</span> <span class="skolem">ye</span> <span class="main">+</span> <span class="skolem">xe</span> <span class="main">*</span> <span class="skolem">ye</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> x y map_poly_homo_polymul<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_mul <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_round_floats_of_normed_range assms tm_norm'_range
        <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta' Let_def t1_def t2_def<span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> range_tm_def real_interval_plus real_interval_times <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_in_intervalI
        times_in_intervalI xe ye params compute_bound_poly_correct dev
        num_params_polymul<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-num_params_tm_mul_le"><span class="command">lemma</span></span> num_params_tm_mul_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_mul <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
    <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_norm' num_params_polymul<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span> <span class="main">=</span> tm_pow.simps<span class="comment1">― ‹TODO: make a systematic decision›</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> tm_pow_range<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span> <span class="main">⟹</span>
      develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span> <span class="main">⟹</span>
      <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span> <span class="main">⟹</span>
      <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_pow <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> num_params_tm_pow_le<span class="main">[</span><span class="operator">THEN</span> order_trans<span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_pow <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> atomize_conj atomize_imp
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> IH1 <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">THEN</span> conjunct1<span class="main">,</span> <span class="operator">rule_format</span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> IH2 <span class="main">=</span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">,</span> <span class="operator">THEN</span> order_trans<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_const_def range_tm_def set_of_eq tm_pow.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="skolem">nat</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="skolem">nat</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="main">(</span>Suc <span class="skolem">nat</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> div2_plus_div2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> tm_pow.simps Suc
      <span class="keyword1"><span class="command">using</span></span> Suc
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tm_mul_range<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> IH1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> IH2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_tm_mul_le<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> IH2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> eq odd_Suc_div_two
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tm_mul_range<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH1<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_mul_range num_params_tm_mul_le IH1 IH2 1
              <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def div2_less_self<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH1<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_mul_range num_params_tm_mul_le IH1 IH2 1
              <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def div2_less_self<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div2_less_self 1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> div2_less_self 1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def div2_less_self 1 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> IH2 num_params_tm_mul_le<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-num_params_tm_add_le"><span class="command">lemma</span></span> num_params_tm_add_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_add <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
    <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_add.simps
       <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_norm' num_params_polymul<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span>
       num_params_polyadd<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> order_trans<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_neg_eq"><span class="command">lemma</span></span> num_params_tm_neg_eq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_neg <span class="free">t1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> num_params <span class="main">(</span>tm_poly <span class="free">t1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_neg.simps num_params_polyneg<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_sub_le"><span class="command">lemma</span></span> num_params_tm_sub_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_sub <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
    <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t1</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">t2</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_sub.simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_add_le<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_eval_poly_le"><span class="command">lemma</span></span> num_params_eval_poly_le<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>eval_poly_at_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">p</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> max <span class="main">1</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">prec</span></span> <span class="quoted"><span class="free">ord</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> eval_poly_at_tm.induct<span class="main">)</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_add_le num_params_tm_sub_le num_params_tm_mul_le
      num_params_tm_pow_le<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-eval_poly_at_tm_range"><span class="command">lemma</span></span> eval_poly_at_tm_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"num_params <span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tg_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e'</span> <span class="main">0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">tg</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> params<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">tg</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"insertion <span class="free">e'</span> <span class="free">p</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>eval_poly_at_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">p</span> <span class="free">tg</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> params
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>C <span class="skolem">c</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> tg_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">tg</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_const_def range_tm_def real_interval_zero<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Bound <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> tg_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Add <span class="skolem">p1l</span> <span class="skolem">p1r</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> tm_add_range <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> func_plus<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sub <span class="skolem">p1l</span> <span class="skolem">p1r</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> tm_sub_range <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_diff_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Mul <span class="skolem">p1l</span> <span class="skolem">p1r</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_mul_range Mul dev num_params_eval_poly_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Neg <span class="skolem">p1'</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> tm_neg_range <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_Compl_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pw <span class="skolem">p1'</span> <span class="skolem">n</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_pow_range Pw dev num_params_eval_poly_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>CN <span class="skolem">p1l</span> <span class="skolem">n</span> <span class="skolem">p1r</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_mul_range tm_pow_range CN dev num_params_eval_poly_le tm_add_range tg_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-tm_inc_err_range"><span class="command">lemma</span></span> tm_inc_err_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_inc_err <span class="free">i</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span> <span class="main">+</span> real_interval <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> range_tm_def real_interval_plus <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_inc_err"><span class="command">lemma</span></span> num_params_tm_inc_err<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_inc_err <span class="free">i</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_comp_le"><span class="command">lemma</span></span> num_params_tm_comp_le<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_comp <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">ga</span> <span class="free">tf</span> <span class="free">tg</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">tf</span><span class="main">)</span> <span class="main">≤</span> max <span class="main">1</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">tg</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">tf</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_inc_err num_params_eval_poly_le num_params_tm_sub_le<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tm_comp_range"><span class="command">lemma</span></span> tm_comp_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e'</span> <span class="free">tf</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tg_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e'</span> <span class="main">0</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_sub <span class="free">tg</span> <span class="main">(</span>tm_const <span class="free">ga</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> params<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">tf</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">tg</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_comp <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">ga</span> <span class="free">tf</span> <span class="free">tg</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pf</span></span> <span class="skolem"><span class="skolem">ef</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tf</span> <span class="main">=</span> TaylorModel <span class="skolem">pf</span> <span class="skolem">ef</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> taylor_model.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pg</span></span> <span class="skolem"><span class="skolem">eg</span></span> <span class="keyword2"><span class="keyword">where</span></span> tg_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tg</span> <span class="main">=</span> TaylorModel <span class="skolem">pg</span> <span class="skolem">eg</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> taylor_model.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> params <span class="keyword1"><span class="command">have</span></span> params<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">pf</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="skolem">pg</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tf_decomp tg_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> tf_def <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xe</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> insertion <span class="free">e'</span> <span class="skolem">pf</span> <span class="main">+</span> <span class="skolem">xe</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xe</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">ef</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tf_decomp range_tm_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_in_intervalE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> tg_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tf_decomp tg_decomp x_def params dev
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_inc_err_range eval_poly_at_tm_range plus_in_intervalI num_params_tm_sub_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-mid_centered_collapse"><span class="command">lemma</span></span> mid_centered_collapse<span class="main">:</span>
  <span class="quoted"><span class="quoted">"interval_of <span class="main">(</span>real_of_float <span class="main">(</span>mid <span class="free">abs_bound</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> real_interval <span class="main">(</span>centered <span class="free">abs_bound</span><span class="main">)</span> <span class="main">=</span>
    real_interval <span class="free">abs_bound</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> centered_def interval_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> tm_abs.simps
<span class="keyword1" id="Taylor_Models-tm_abs_range"><span class="command">lemma</span></span> tm_abs_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_abs <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> TaylorModel <span class="skolem">p</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> taylor_model.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">bound</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bound</span> <span class="main">=</span> compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">bound</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bound_def
    <span class="keyword1"><span class="command">using</span></span> n d x
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compute_bound_tm_correct<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">abs_bound</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">abs_bound</span> <span class="main">≡</span> Ivl <span class="main">0</span> <span class="main">(</span>max <span class="main">¦</span>lower <span class="skolem">bound</span><span class="main">¦</span> <span class="main">¦</span>upper <span class="skolem">bound</span><span class="main">¦</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> abs_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">abs_bound</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bound
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> abs_bound_def set_of_eq abs_real_def max_def min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> tm_abs_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"tm_abs <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span> <span class="main">=</span> TaylorModel <span class="main">(</span>poly.C <span class="main">(</span>mid <span class="skolem">abs_bound</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>centered <span class="skolem">abs_bound</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bound_def abs_bound_def Let_def tm_abs.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tm_abs_decomp
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> range_tmI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mid_centered_collapse abs_bound<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-num_params_tm_abs_le"><span class="command">lemma</span></span> num_params_tm_abs_le<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_abs <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_abs.simps Let_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-real_interval_sup"><span class="command">lemma</span></span> real_interval_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"real_interval <span class="main">(</span>sup <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span>real_interval <span class="free">a</span><span class="main">)</span> <span class="main">(</span>real_interval <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> interval_eq_iff inf_real_def inf_float_def sup_float_def sup_real_def min_def max_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-in_interval_supI1"><span class="command">lemma</span></span> in_interval_supI1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> sup <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> in_interval_supI2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> sup <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>lattice"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq le_infI1 le_infI2 le_supI1 le_supI2<span class="main">)</span>
  
<span class="keyword1" id="Taylor_Models-tm_union_range_left"><span class="command">lemma</span></span> tm_union_range_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t1</span>"</span></span>
    <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t1</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_union <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">≡</span> compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">≡</span> compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t2</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b_combined</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b_combined</span> <span class="main">≡</span> sup <span class="skolem">b1</span> <span class="skolem">b2</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> tm_union_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"tm_union <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span> <span class="main">=</span> TaylorModel <span class="skolem">p</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> taylor_model.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span>mid <span class="skolem">b_combined</span><span class="keyword1">)<span class="hidden">⇩</span><sub>p</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> e_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> centered <span class="skolem">b_combined</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def b1_def b2_def b_combined_def interval_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">b1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="main"><span class="main">:</span></span> b1_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> compute_bound_tm_correct assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="skolem">b_combined</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b_combined_def real_interval_sup in_interval_supI1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tm_union_decomp
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> range_tm_def p_def e_def mid_centered_collapse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-tm_union_range_right"><span class="command">lemma</span></span> tm_union_range_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t2</span>"</span></span>
    <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t2</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_union <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tm_union_range_left<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interval_union_commute<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_tm_union_le"><span class="command">lemma</span></span> num_params_tm_union_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="main">(</span>tm_union <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span> <span class="main">=</span> tm_union.simps tm_min.simps tm_max.simps

<span class="keyword1" id="Taylor_Models-tm_min_range"><span class="command">lemma</span></span> tm_min_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t2</span>"</span></span>
    <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t1</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t2</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"min <span class="free">x</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_min <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def tm_min.simps min_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tm_union_range_left tm_union_range_right<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-tm_max_range"><span class="command">lemma</span></span> tm_max_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t2</span>"</span></span>
    <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t1</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t2</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max <span class="free">x</span> <span class="free">y</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="main">(</span>tm_max <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">t1</span> <span class="free">t2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def tm_max.simps max_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tm_union_range_left tm_union_range_right<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Computing Taylor models for multivariate expressions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Compute Taylor models for expressions of the form "f (g x)", where f is an elementary function like exp or cos,
   by composing Taylor models for f and g. For our correctness proof, we need to make it explicit that the range
   of g on I is inside the domain of f, by introducing the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f_exists_on›</span></span></span></span> predicate.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">compute_tm_by_comp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> floatarith <span class="main">⇒</span> taylor_model option <span class="main">⇒</span> <span class="main">(</span>float interval <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> taylor_model option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">compute_tm_by_comp</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">f_exists_on</span></span></span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span>
         <span class="keyword1">of</span> Some <span class="bound">tg</span> <span class="main">⇒</span> <span class="main">(</span>
           <span class="keyword1">let</span> <span class="bound">gI</span> <span class="main">=</span> compute_bound_tm <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">tg</span><span class="main">;</span>
               <span class="bound">ga</span> <span class="main">=</span> mid <span class="main">(</span>compute_bound_tm <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">tg</span><span class="main">)</span>
           <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">f_exists_on</span></span></span> <span class="bound">gI</span>
              <span class="keyword1">then</span> map_option <span class="main">(</span><span class="main">λ</span><span class="bound">tf</span><span class="main">.</span> tm_comp <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">ga</span> <span class="bound">tf</span> <span class="bound">tg</span> <span class="main">)</span> <span class="main">(</span>tm_floatarith <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="main">[</span><span class="bound">gI</span><span class="main">]</span> <span class="main">[</span><span class="bound">ga</span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>
              <span class="keyword1">else</span> None<span class="main">)</span>
         <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None
       <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Compute Taylor models with numerical precision <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prec›</span></span></span></span> of degree <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ord›</span></span></span></span>,
  with Taylor models in the environment <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>env›</span></span></span></span> whose variables are jointly interpreted with domain
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>I›</span></span></span></span> and expanded around point <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span>.
  from floatarith expressions on a rectangular domain.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">approx_tm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> floatarith <span class="main">⇒</span> taylor_model list <span class="main">⇒</span>
    taylor_model option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span><span class="keyword1">Num</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> Some <span class="main">(</span>tm_const <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Var</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Add</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">case</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">,</span> <span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> 
         <span class="keyword1">of</span> <span class="main">(</span>Some <span class="bound">t1</span><span class="main">,</span> Some <span class="bound">t2</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>tm_add <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>
          <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Minus</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>
         <span class="main">=</span> map_option tm_neg <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Mult</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">case</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">,</span> <span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> 
         <span class="keyword1">of</span> <span class="main">(</span>Some <span class="bound">t1</span><span class="main">,</span> Some <span class="bound">t2</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>tm_mul <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>
          <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span>     
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Power</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>
         <span class="main">=</span> map_option <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> tm_pow <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>
                      <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>
         <span class="main">=</span> compute_tm_by_comp <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> lower <span class="bound">x</span> <span class="main">∨</span> upper <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Cos</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>
         <span class="main">=</span> compute_tm_by_comp <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Cos</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Arctan</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>
         <span class="main">=</span> compute_tm_by_comp <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Arctan</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Exp</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>
         <span class="main">=</span> compute_tm_by_comp <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Exp</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Ln</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>
         <span class="main">=</span> compute_tm_by_comp <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Ln</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> lower <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Sqrt</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>
         <span class="main">=</span> compute_tm_by_comp <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Sqrt</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> lower <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">Pi</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> Some <span class="main">(</span>tm_pi <span class="free"><span class="bound"><span class="entity">prec</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Abs</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span>
         <span class="main">=</span> map_option <span class="main">(</span>tm_abs <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Min</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">case</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">,</span> <span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span> 
         <span class="keyword1">of</span> <span class="main">(</span>Some <span class="bound">t1</span><span class="main">,</span> Some <span class="bound">t2</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>tm_min <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>
          <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Max</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> <span class="main">(</span>
         <span class="keyword1">case</span> <span class="main">(</span><span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">,</span> <span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">env</span></span></span><span class="main">)</span>
         <span class="keyword1">of</span> <span class="main">(</span>Some <span class="bound">t1</span><span class="main">,</span> Some <span class="bound">t2</span><span class="main">)</span> <span class="main">⇒</span> Some <span class="main">(</span>tm_max <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">)</span>
          <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Powr</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> None"</span></span> <span class="comment1">― ‹TODO›</span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_tm</span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="keyword1">Floor</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">env</span></span></span> <span class="main">=</span> None"</span></span> <span class="comment1">― ‹TODO›</span>

<span class="keyword1" id="Taylor_Models-mid_in_real_interval"><span class="command">lemma</span></span> mid_in_real_interval<span class="main">:</span> <span class="quoted"><span class="quoted">"mid <span class="free">i</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lower_le_upper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mid_def set_of_eq powr_minus<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-set_of_real_interval_mono"><span class="command">lemma</span></span> set_of_real_interval_mono<span class="main">:</span><span class="quoted"><span class="quoted">"set_of <span class="main">(</span>real_interval <span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> set_of <span class="main">(</span>real_interval <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"set_of <span class="free">x</span> <span class="main">⊆</span> set_of <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span></span></span></span></span></span><span class="main">]</span> <span class="main">=</span> compute_bound_poly.simps tm_floatarith.simps

<span class="comment1">(*
  assumes tx_valid: "valid_tm I a (interpret_floatarith g) tg"
  assumes t_def: "compute_tm_on_ivl_by_comp prec ord I a f (Some tg) c = Some t"
  assumes f_deriv: "⋀x. x ∈<span class="hidden">⇩</span><sub>r</sub> (compute_bound_tm prec I a tg) ⟹ c (compute_bound_tm prec I a tg) ⟹ isDERIV 0 f [x]"
  shows "valid_tm I a ((λx. interpret_floatarith f [x]) o interpret_floatarith g) t"
*)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span><span class="main">]</span> <span class="main">=</span> tmf_ivl_cs.simps compute_bound_tm.simps tmf_polys.simps

<span class="keyword1" id="Taylor_Models-tm_floatarith_eq_Some_num_params"><span class="command">lemma</span></span> tm_floatarith_eq_Some_num_params<span class="main">:</span>
  <span class="quoted"><span class="quoted">"tm_floatarith <span class="free">prec</span> <span class="free">ord</span> <span class="free">a</span> <span class="free">b</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">tf</span> <span class="main">⟹</span> num_params <span class="main">(</span>tm_poly <span class="free">tf</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_floatarith.simps split_beta' Let_def those_eq_Some_iff num_params_tmf_polys1<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-compute_tm_by_comp_range"><span class="command">lemma</span></span> compute_tm_by_comp_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"max_Var_floatarith <span class="free">f</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">all_subset</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tx_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">tg</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t_def<span class="main">:</span> <span class="quoted"><span class="quoted">"compute_tm_by_comp <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">f</span> <span class="main">(</span>Some <span class="free">tg</span><span class="main">)</span> <span class="free">c</span> <span class="main">=</span> Some <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_deriv<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">tg</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">tg</span><span class="main">)</span> <span class="main">⟹</span> isDERIV <span class="main">0</span> <span class="free">f</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> params<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">tg</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="free">f</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> t_def<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">simplified</span> Let_def<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tf</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> t1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"tm_floatarith <span class="free">prec</span> <span class="free">ord</span> <span class="main">[</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="free">tg</span><span class="main">]</span>
          <span class="main">[</span>mid <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">a</span> <span class="free">a</span> <span class="free">tg</span><span class="main">)</span><span class="main">]</span> <span class="free">f</span> <span class="main">=</span>
         Some <span class="skolem">tf</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> t_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> tm_comp <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="main">(</span>mid <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">a</span> <span class="free">a</span> <span class="free">tg</span><span class="main">)</span><span class="main">)</span> <span class="skolem">tf</span> <span class="free">tg</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> c_true<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">tg</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> split_beta' Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"mid <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">a</span> <span class="free">a</span> <span class="free">tg</span><span class="main">)</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="free">tg</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mid_in_real_interval<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_real_interval_mono<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> compute_bound_tm_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> params a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_of_eq <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> range_tmD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹max_Var_floatarith <span class="free">f</span> <span class="main">≤</span> <span class="main">1</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> length <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> interpret_floatarith <span class="free">f</span> <span class="main">[</span><span class="bound">x</span> <span class="main">!</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> interpret_floatarith <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mid</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"real_of_float <span class="main">(</span>mid <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">a</span> <span class="free">a</span> <span class="free">tg</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="free">f</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">x</span> <span class="main">-</span> <span class="var">?mid</span><span class="main">)</span> <span class="skolem">tf</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tm_floatarith<span class="main"><span class="main">[</span></span><span class="operator">OF</span> t1_def<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mid_in_real_interval<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_of_real_interval_mono<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> compute_bound_tm_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> compute_bound_tm_correct assms<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> assms c_true<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> t_decomp
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tm_comp_range<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> tm_floatarith_eq_Some_num_params<span class="main">[</span><span class="operator">OF</span> t1_def<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_sub_range assms <span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> compute_tm_by_comp.simps

<span class="keyword1" id="Taylor_Models-compute_tm_by_comp_num_params_le"><span class="command">lemma</span></span> compute_tm_by_comp_num_params_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compute_tm_by_comp <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">f</span> <span class="main">(</span>Some <span class="free">t0</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compute_tm_by_comp.simps Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_comp_le
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-compute_tm_by_comp_eq_Some_iff"><span class="command">lemma</span></span> compute_tm_by_comp_eq_Some_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"compute_tm_by_comp <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">f</span> <span class="free">t0</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">t</span> <span class="main">⟷</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="bound">x2</span><span class="main">.</span> <span class="free">t0</span> <span class="main">=</span> Some <span class="bound">x2</span> <span class="main">∧</span>
    tm_floatarith <span class="free">prec</span> <span class="free">ord</span> <span class="main">[</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="bound">x2</span><span class="main">]</span>
      <span class="main">[</span>mid <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">a</span> <span class="free">a</span> <span class="bound">x2</span><span class="main">)</span><span class="main">]</span> <span class="free">f</span> <span class="main">=</span>
      Some <span class="bound">z</span>
   <span class="main">∧</span> tm_comp <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span>
      <span class="main">(</span>mid <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">a</span> <span class="free">a</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span> <span class="bound">z</span> <span class="bound">x2</span> <span class="main">=</span> <span class="free">t</span>
   <span class="main">∧</span> <span class="free">i</span> <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="bound">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compute_tm_by_comp.simps Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-num_params_approx_tm"><span class="command">lemma</span></span> num_params_approx_tm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tm</span><span class="main">.</span> <span class="bound">tm</span> <span class="main">∈</span> set <span class="free">env</span> <span class="main">⟹</span> num_params <span class="main">(</span>tm_poly <span class="bound">tm</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="free">t</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Add <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_add_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Minus <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Mult <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_mul_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Inverse <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def compute_tm_by_comp_eq_Some_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_comp_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cos <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def compute_tm_by_comp_eq_Some_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_comp_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Arctan <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def compute_tm_by_comp_eq_Some_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_comp_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Abs <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_abs.simps Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_union_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Max <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_max.simps Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_union_le <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Min <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tm_min.simps Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_union_le <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Pi
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Sqrt <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def compute_tm_by_comp_eq_Some_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_comp_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Exp <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def compute_tm_by_comp_eq_Some_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_comp_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Powr <span class="skolem">f1</span> <span class="skolem">f2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def compute_tm_by_comp_eq_Some_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_comp_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Ln <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def compute_tm_by_comp_eq_Some_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_comp_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Power <span class="skolem">f</span> <span class="skolem">x2a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def compute_tm_by_comp_eq_Some_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_pow_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Floor <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def compute_tm_by_comp_eq_Some_iff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> num_params_tm_comp_le <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_floatarith_eq_Some_num_params<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Num <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Taylor_Models-in_interval_realI"><span class="command">lemma</span></span> in_interval_realI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-all_subset_all_inI"><span class="command">lemma</span></span> all_subset_all_inI<span class="main">:</span> <span class="quoted"><span class="quoted">"map interval_of <span class="free">a</span> <span class="keyword1">all_subset</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">all_in</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_interval_realI<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-compute_tm_by_comp_None"><span class="command">lemma</span></span> compute_tm_by_comp_None<span class="main">:</span> <span class="quoted"><span class="quoted">"compute_tm_by_comp <span class="free">p</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">x</span> None <span class="free">k</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compute_tm_by_comp_eq_Some_iff<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-approx_tm_num_Vars_None"><span class="command">lemma</span></span> approx_tm_num_Vars_None<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"max_Var_floatarith <span class="free">f</span> <span class="main">&gt;</span> length <span class="free">env</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">p</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">f</span> <span class="free">env</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.splits if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def compute_tm_by_comp_None<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-approx_tm_num_Vars"><span class="command">lemma</span></span> approx_tm_num_Vars<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_Var_floatarith <span class="free">f</span> <span class="main">≤</span> length <span class="free">env</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> approx_tm_num_Vars_None<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">env</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">prec</span></span> <span class="quoted"><span class="free">ord</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">range_tms</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> map <span class="main">(</span>range_tm <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1" id="Taylor_Models-approx_tm_range"><span class="command">lemma</span></span> approx_tm_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">all_subset</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="free">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> allin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="free">env</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> devs<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">a</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> env<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tm</span><span class="main">.</span> <span class="bound">tm</span> <span class="main">∈</span> set <span class="free">env</span> <span class="main">⟹</span> num_params <span class="main">(</span>tm_poly <span class="bound">tm</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="free">f</span> <span class="free">xs</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> t_def
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Var <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> allin approx_tm_num_Vars<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">prec</span></span> <span class="quoted"><span class="free">ord</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Var</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="free">env</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> all_in_i_def range_tms_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Num <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Add <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> t1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">l</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">t1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Add<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> approx_tm.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> option.case_eq_if option.collapse prod.case<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> t2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">r</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Add<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> approx_tm.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> option.case_eq_if option.collapse prod.case<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> t_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> tm_add <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Add<span class="main">(</span>3<span class="main">)</span> t1_def t2_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> approx_tm.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> option.case<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.inject prod.case<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span>floatarith.Add <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> interpret_floatarith <span class="skolem">l</span> <span class="main">+</span> interpret_floatarith <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Add
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_add_range Add t1_def t2_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Minus <span class="skolem">f</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span><span class="keyword1">Minus</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>interpret_floatarith <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> t1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">t1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Minus.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> approx_tm.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> map_option_eq_Some<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> t_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> tm_neg <span class="skolem">t1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Minus.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> approx_tm.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> option.inject option.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> t1_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_neg_range t1_def Minus<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Mult <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> t1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">l</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">t1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Mult<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> approx_tm.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> option.case_eq_if option.collapse prod.case<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> t2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">r</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Mult<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> approx_tm.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> option.case_eq_if option.collapse prod.case<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> t_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> tm_mul <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Mult<span class="main">(</span>3<span class="main">)</span> t1_def t2_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> approx_tm.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> option.case<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.inject prod.case<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span>floatarith.Mult <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> interpret_floatarith <span class="skolem">l</span> <span class="main">*</span> interpret_floatarith <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> env Mult
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_mul_range Mult t1_def t2_def devs
        num_params_approx_tm<span class="main"><span class="main">[</span></span><span class="operator">OF</span> t1_def<span class="main"><span class="main">]</span></span> num_params_approx_tm<span class="main"><span class="main">[</span></span><span class="operator">OF</span> t2_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Power <span class="skolem">f</span> <span class="skolem">k</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Power<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tm_f</span></span> <span class="keyword2"><span class="keyword">where</span></span> tm_f_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">tm_f</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> t_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> tm_pow <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">tm_f</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Power<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tm_f_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> env Power
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_def tm_f_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_pow_range Power  devs
        num_params_approx_tm<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tm_f_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Inverse <span class="skolem">f</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Inverse <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tf</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">tf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compute_tm_by_comp_eq_Some_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> safe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">tf</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="main">0</span> <span class="main">&lt;</span> lower <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">tf</span><span class="main">)</span> <span class="main">∨</span> upper <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">tf</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span>
          isDERIV <span class="main">0</span> <span class="main">(</span><span class="keyword1">Inverse</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_of_eq <span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">tf</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> compute_tm_by_comp_range<span class="main">[</span><span class="operator">OF</span> _ a
      Inverse<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> tf_def<span class="main"><span class="main">]</span></span>
      Inverse<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> approx_tm.simps tf_def<span class="main"><span class="main">]</span></span>
      safe np devs<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> <span class="main">(</span>Cos <span class="skolem">f</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hyps <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tf</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">tf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compute_tm_by_comp_eq_Some_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">tf</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> compute_tm_by_comp_range<span class="main">[</span><span class="operator">OF</span> _ a
      hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> tf_def<span class="main"><span class="main">]</span></span>
      hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> approx_tm.simps tf_def<span class="main"><span class="main">]</span></span>
      _ np devs<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> <span class="main">(</span>Arctan <span class="skolem">f</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hyps <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tf</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">tf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compute_tm_by_comp_eq_Some_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">tf</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> compute_tm_by_comp_range<span class="main">[</span><span class="operator">OF</span> _ a
      hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> tf_def<span class="main"><span class="main">]</span></span>
      hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> approx_tm.simps tf_def<span class="main"><span class="main">]</span></span>
      _ np devs<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> <span class="main">(</span>Exp <span class="skolem">f</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hyps <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tf</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">tf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compute_tm_by_comp_eq_Some_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">tf</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> compute_tm_by_comp_range<span class="main">[</span><span class="operator">OF</span> _ a
      hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> tf_def<span class="main"><span class="main">]</span></span>
      hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> approx_tm.simps tf_def<span class="main"><span class="main">]</span></span>
      _ np devs<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> <span class="main">(</span>Ln <span class="skolem">f</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hyps <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tf</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">tf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compute_tm_by_comp_eq_Some_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> safe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">tf</span> <span class="main">⟹</span>
        <span class="main">0</span> <span class="main">&lt;</span> lower <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">tf</span><span class="main">)</span> <span class="main">⟹</span> isDERIV <span class="main">0</span> <span class="main">(</span><span class="keyword1">Ln</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">tf</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> compute_tm_by_comp_range<span class="main">[</span><span class="operator">OF</span> _ a
      hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> tf_def<span class="main"><span class="main">]</span></span>
      hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> approx_tm.simps tf_def<span class="main"><span class="main">]</span></span>
      safe np devs<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> <span class="main">(</span>Sqrt <span class="skolem">f</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hyps <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tf</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">tf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compute_tm_by_comp_eq_Some_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> safe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>r</sub></span> compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">tf</span> <span class="main">⟹</span>
        <span class="main">0</span> <span class="main">&lt;</span> lower <span class="main">(</span>compute_bound_tm <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">tf</span><span class="main">)</span> <span class="main">⟹</span> isDERIV <span class="main">0</span> <span class="main">(</span><span class="keyword1">Sqrt</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">tf</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> compute_tm_by_comp_range<span class="main">[</span><span class="operator">OF</span> _ a
      hyps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> tf_def<span class="main"><span class="main">]</span></span>
      hyps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> approx_tm.simps tf_def<span class="main"><span class="main">]</span></span>
      safe np devs<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Pi <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> tm_pi <span class="free">prec</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> range_tm_tm_pi<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Abs <span class="skolem">f</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Abs<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tf</span></span> <span class="keyword2"><span class="keyword">where</span></span> tf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">f</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">tf</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  t_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> tm_abs <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">tf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> approx_tm.simps<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> map_option_eq_Some<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> np<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">tf</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tf_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> tm_abs_range<span class="main">[</span><span class="operator">OF</span> Abs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> tf_def<span class="main"><span class="main">]</span></span> np devs<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> t_def interpret_floatarith.simps<span class="main">(</span>9<span class="main">)</span> comp_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> <span class="main">(</span>Min <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hyps<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> tm_min <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> t1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"Some <span class="skolem">t1</span> <span class="main">=</span> approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">l</span> <span class="free">env</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> t2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">r</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> approx_tm.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span> option.case_eq_if option.collapse option.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.inject split_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> t1_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interpret_floatarith <span class="skolem">l</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="skolem">t1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  t2_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interpret_floatarith <span class="skolem">r</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span>floatarith.Min <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span><span class="main">.</span> min <span class="main">(</span>interpret_floatarith <span class="skolem">l</span> <span class="bound">vs</span><span class="main">)</span> <span class="main">(</span>interpret_floatarith <span class="skolem">r</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> np1<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">t1</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t1_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> np2<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">t2</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t2_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> t_decomp<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> tm_min.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> t1_range t2_range np1 np2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_min_range devs<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> <span class="main">(</span>Max <span class="skolem">l</span> <span class="skolem">r</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hyps<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> t_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> tm_max <span class="free">prec</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> t1_def<span class="main">:</span> <span class="quoted"><span class="quoted">"Some <span class="skolem">t1</span> <span class="main">=</span> approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">l</span> <span class="free">env</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> t2_def<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">prec</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">a</span> <span class="skolem">r</span> <span class="free">env</span> <span class="main">=</span> Some <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> approx_tm.simps<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span> option.case_eq_if option.collapse option.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> option.inject split_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> hyps<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> t1_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interpret_floatarith <span class="skolem">l</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="skolem">t1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  t2_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>interpret_floatarith <span class="skolem">r</span> <span class="free">xs</span><span class="main">)</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="skolem">t2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="main">(</span>floatarith.Min <span class="skolem">l</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">vs</span><span class="main">.</span> min <span class="main">(</span>interpret_floatarith <span class="skolem">l</span> <span class="bound">vs</span><span class="main">)</span> <span class="main">(</span>interpret_floatarith <span class="skolem">r</span> <span class="bound">vs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> np1<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">t1</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t1_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> np2<span class="main">:</span> <span class="quoted"><span class="quoted">"num_params <span class="main">(</span>tm_poly <span class="skolem">t2</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> t2_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> t_decomp<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> tm_min.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> t1_range t2_range np1 np2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tm_max_range devs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Evaluate expression with Taylor models in environment.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Computing bounds for floatarith expressions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TODO: compare parametrization of input vs. uncertainty for input...›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tm_of_ivl_par</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ivl</span></span></span> <span class="main">=</span> TaylorModel <span class="main">(</span>CN <span class="main">(</span>C <span class="main">(</span><span class="main">(</span>upper <span class="free"><span class="bound"><span class="entity">ivl</span></span></span> <span class="main">+</span> lower <span class="free"><span class="bound"><span class="entity">ivl</span></span></span><span class="main">)</span><span class="main">*</span>Float <span class="main">1</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>
  <span class="main">(</span>C <span class="main">(</span><span class="main">(</span>upper <span class="free"><span class="bound"><span class="entity">ivl</span></span></span> <span class="main">-</span> lower <span class="free"><span class="bound"><span class="entity">ivl</span></span></span><span class="main">)</span><span class="main">*</span>Float <span class="main">1</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span>
  <span class="comment1">― ‹track uncertainty in parameter <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>n›</span></span>, which is to be interpreted over standardized domain <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>[-1, 1]›</span></span>.›</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"tm_of_ivl_par <span class="numeral">3</span> <span class="main">(</span>Ivl <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tms_of_ivls</span> <span class="free"><span class="bound"><span class="entity">ivls</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="bound">ivl</span><span class="main">)</span><span class="main">.</span> tm_of_ivl_par <span class="bound">i</span> <span class="bound">ivl</span><span class="main">)</span> <span class="main">(</span>zip <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free"><span class="bound"><span class="entity">ivls</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">ivls</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"tms_of_ivls <span class="main">[</span>Ivl <span class="main">1</span> <span class="numeral">2</span><span class="main">,</span> Ivl <span class="numeral">4</span> <span class="numeral">5</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">approx_slp'</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> float interval list <span class="main">⇒</span> float interval list <span class="main">⇒</span> slp <span class="main">⇒</span>
  taylor_model list <span class="main">⇒</span> taylor_model list option"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">approx_slp'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">approx_slp'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ea</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">eas</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span>
    <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">r</span> <span class="main">←</span> approx_tm <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ea</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">;</span>
      <span class="free">approx_slp'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">eas</span></span></span> <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
    <span class="main">}</span>"</span></span>

<span class="keyword1" id="Taylor_Models-mem_range_tms_Cons_iff"><span class="command">lemma</span></span> mem_range_tms_Cons_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="free">xs</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="main">(</span><span class="free">X</span><span class="main">#</span><span class="free">XS</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">xs</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="free">XS</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> range_tms_def all_in_i_def nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.splits<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-approx_slp'_range"><span class="command">lemma</span></span> approx_slp'_range<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">all_subset</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="free">i</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="free">VS</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">tm</span><span class="main">.</span> <span class="bound">tm</span> <span class="main">∈</span> set <span class="free">VS</span> <span class="main">⟹</span> num_params <span class="main">(</span>tm_poly <span class="bound">tm</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">I</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> appr<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_slp' <span class="free">p</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">i</span> <span class="free">ra</span> <span class="free">VS</span> <span class="main">=</span> Some <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interpret_slp <span class="free">ra</span> <span class="free">vs</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> appr vs
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ra</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">vs</span></span> <span class="quoted"><span class="free">VS</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">ra</span> <span class="skolem">ras</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_tm <span class="free">p</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">i</span> <span class="skolem">ra</span> <span class="skolem">VS</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_slp' <span class="free">p</span> <span class="free">ord</span> <span class="free">I</span> <span class="free">i</span> <span class="skolem">ras</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">VS</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bind_eq_Some_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> approx_tm_range<span class="main">[</span><span class="operator">OF</span> i a Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dev Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="skolem">ra</span> <span class="skolem">vs</span> <span class="keyword1">∈<span class="hidden">⇩</span><sub>i</sub></span> range_tm <span class="free">e</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"interpret_floatarith <span class="skolem">ra</span> <span class="skolem">vs</span><span class="main">#</span><span class="skolem">vs</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">VS</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Cons.IH<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> r<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> num_params_approx_tm<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> a<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Cons.prems<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">approx_slp</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> slp <span class="main">⇒</span> taylor_model list <span class="main">⇒</span> taylor_model list option"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">approx_slp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">slp</span></span></span> <span class="free"><span class="bound"><span class="entity">tms</span></span></span> <span class="main">=</span>
      map_option <span class="main">(</span>take <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span>
        <span class="main">(</span>approx_slp' <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">tms</span></span></span><span class="main">)</span> <span class="main">(</span>Ivl <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="free"><span class="bound"><span class="entity">tms</span></span></span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">slp</span></span></span> <span class="free"><span class="bound"><span class="entity">tms</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Taylor_Models-length_range_tms"><span class="command">lemma</span></span> length_range_tms<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>range_tms <span class="free">e</span> <span class="free">VS</span><span class="main">)</span> <span class="main">=</span> length <span class="free">VS</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> range_tms_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-set_of_Ivl"><span class="command">lemma</span></span> set_of_Ivl<span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="main">(</span>Ivl <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span> <span class="main">..</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq that min_def<span class="main">)</span>

<span class="keyword1" id="Taylor_Models-set_of_zero"><span class="command">lemma</span></span> set_of_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set_of <span class="main">0</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>ordered_comm_monoid_add<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_of_eq<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> approx_slp_range_tms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"approx_slp <span class="free">p</span> <span class="free">ord</span> <span class="free">d</span> <span class="free">slp</span> <span class="free">VS</span> <span class="main">=</span> Some <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> slp_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">slp</span> <span class="main">=</span> slp_of_fas <span class="free">fas</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> d_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> length <span class="free">fas</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> UNIV <span class="main">→</span> <span class="main">{</span><span class="main">-</span><span class="main">1</span> <span class="main">..</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> vs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="free">VS</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lens<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">tm</span><span class="main">.</span> <span class="bound">tm</span> <span class="main">∈</span> set <span class="free">VS</span> <span class="main">⟹</span> num_params <span class="main">(</span>tm_poly <span class="bound">tm</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">vs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"interpret_floatariths <span class="free">fas</span> <span class="free">vs</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interpret_floatariths <span class="free">fas</span> <span class="free">vs</span> <span class="main">=</span> take <span class="free">d</span> <span class="main">(</span>interpret_slp <span class="free">slp</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> slp_of_fas slp_def d_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> lvs<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">vs</span> <span class="main">=</span> length <span class="free">VS</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> all_in_i_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>float interval<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> replicate <span class="main">(</span>length <span class="free">vs</span><span class="main">)</span> <span class="main">(</span>Ivl <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">1</span><span class="main">::</span>float interval<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">XS</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    XS<span class="main">:</span> <span class="quoted"><span class="quoted">"approx_slp' <span class="free">p</span> <span class="free">ord</span> <span class="skolem">I</span> <span class="skolem">i</span> <span class="free">slp</span> <span class="free">VS</span> <span class="main">=</span> Some <span class="skolem">XS</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="free">d</span> <span class="skolem">XS</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> approx_slp_def lvs i_def I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> iI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">all_subset</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> i_def I_def set_of_Ivl<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> dev<span class="main">:</span> <span class="quoted"><span class="quoted">"develops_at_within <span class="free">e</span> <span class="skolem">i</span> <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> develops_at_within_def i_def I_def set_of_Ivl real_interval_Ivl
        real_interval_minus real_interval_zero set_of_eq Pi_iff min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> approx_slp'_range<span class="main">[</span><span class="operator">OF</span> iI dev vs _ XS<span class="main">]</span> lens
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"interpret_slp <span class="free">slp</span> <span class="free">vs</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="skolem">XS</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="free">d</span> <span class="main">(</span>interpret_slp <span class="free">slp</span> <span class="free">vs</span><span class="main">)</span> <span class="keyword1">all_in<span class="hidden">⇩</span><sub>i</sub></span> range_tms <span class="free">e</span> <span class="main">(</span>take <span class="free">d</span> <span class="skolem">XS</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> all_in_i_def range_tms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹take <span class="free">d</span> <span class="skolem">XS</span> <span class="main">=</span> <span class="free">X</span>›</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Experiments">
<div class="head">
<h1>Theory Experiments</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Experiments
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Taylor_Models.html">Taylor_Models</a>
    <a href="../Affine_Arithmetic/Affine_Arithmetic.html">Affine_Arithmetic.Affine_Arithmetic</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> interval<span class="main">::</span><span class="main">(</span><span class="quoted"><span class="quoted">"<span class="main">{</span>show<span class="main">,</span> preorder<span class="main">}</span>"</span></span><span class="main">)</span> <span class="quoted"><span class="quoted">"show"</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> interval.lifting <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">shows_prec_interval</span><span class="main">::</span>
  <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> interval <span class="main">⇒</span> char list <span class="main">⇒</span> char list"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">ivl</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>shows_string <span class="inner_quoted">''Interval''</span> <span class="keyword1">o</span> shows <span class="bound">ivl</span><span class="main">)</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>


<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">shows_list_interval</span><span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> interval list <span class="main">⇒</span> char list <span class="main">⇒</span> char list"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">ivls</span> <span class="bound">s</span><span class="main">.</span> shows_list <span class="bound">ivls</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">show_law_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">split_largest_interval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"float interval list <span class="main">⇒</span> float interval list <span class="main">×</span> float interval list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">split_largest_interval</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> sort_key <span class="main">(</span>uminus <span class="keyword1">o</span> snd<span class="main">)</span> <span class="main">(</span>zip <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">]</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> upper <span class="bound">x</span> <span class="main">-</span> lower <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">of</span> Nil <span class="main">⇒</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>
  <span class="main">|</span> <span class="main">(</span><span class="bound">i</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">#</span><span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">!</span> <span class="bound">i</span> <span class="keyword1">in</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">[</span><span class="bound">i</span><span class="main">:=</span>Ivl <span class="main">(</span>lower <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>upper <span class="bound">x</span> <span class="main">+</span> lower <span class="bound">x</span><span class="main">)</span><span class="main">*</span>Float <span class="main">1</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
                 <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">[</span><span class="bound">i</span><span class="main">:=</span>Ivl <span class="main">(</span><span class="main">(</span>upper <span class="bound">x</span> <span class="main">+</span> lower <span class="bound">x</span><span class="main">)</span><span class="main">*</span>Float <span class="main">1</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>upper <span class="bound">x</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Inf_tm</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">params</span></span></span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span> <span class="main">=</span>
  lower <span class="main">(</span>compute_bound_tm <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>replicate <span class="free"><span class="bound"><span class="entity">params</span></span></span> <span class="main">(</span>Ivl <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>replicate <span class="free"><span class="bound"><span class="entity">params</span></span></span> <span class="main">(</span>Ivl <span class="main">0</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">tm</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">prove_pos</span><span class="main">::</span><span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span>
    <span class="main">(</span>nat <span class="main">⇒</span> nat <span class="main">⇒</span> taylor_model list <span class="main">⇒</span> taylor_model option<span class="main">)</span> <span class="main">⇒</span> float interval list list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prove_pos</span> <span class="free"><span class="bound"><span class="entity">prnt</span></span></span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main"><span class="bound">_</span></span> <span class="main">=</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">prnt</span></span></span> <span class="keyword1">then</span> print <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''# depth limit exceeded⏎''</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">()</span> <span class="keyword1">in</span> False<span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">prove_pos</span> <span class="free"><span class="bound"><span class="entity">prnt</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">XXS</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">XXS</span></span></span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> True <span class="main">|</span> <span class="main">(</span><span class="bound">X</span><span class="main">#</span><span class="bound">XS</span><span class="main">)</span> <span class="main">⇒</span>
    <span class="keyword1">let</span>
       <span class="bound">params</span> <span class="main">=</span> length <span class="bound">X</span><span class="main">;</span>
       <span class="bound">R</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="main">(</span>tms_of_ivls <span class="bound">X</span><span class="main">)</span><span class="main">;</span>
       <span class="main"><span class="bound">_</span></span> <span class="main">=</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">prnt</span></span></span>  <span class="keyword1">then</span> print <span class="main">(</span>String.implode <span class="main">(</span><span class="main">(</span>shows <span class="inner_quoted">''# ''</span> <span class="keyword1">o</span> shows <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">ivl</span><span class="main">.</span> <span class="main">(</span>lower <span class="bound">ivl</span><span class="main">,</span> upper <span class="bound">ivl</span><span class="main">)</span><span class="main">)</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span> <span class="inner_quoted">''⏎''</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">()</span>
    <span class="keyword1">in</span>
    <span class="keyword1">if</span> <span class="bound">R</span> <span class="main">≠</span> None <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> Inf_tm <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">params</span> <span class="main">(</span>the <span class="bound">R</span><span class="main">)</span>
    <span class="keyword1">then</span> <span class="keyword1">let</span> <span class="main"><span class="bound">_</span></span> <span class="main">=</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">prnt</span></span></span> <span class="keyword1">then</span> print <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''# Success⏎''</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">()</span> <span class="keyword1">in</span> <span class="free">prove_pos</span> <span class="free"><span class="bound"><span class="entity">prnt</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">XS</span>
    <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="main"><span class="bound">_</span></span> <span class="main">=</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">prnt</span></span></span> <span class="keyword1">then</span> print <span class="main">(</span>String.implode <span class="main">(</span><span class="main">(</span>shows <span class="inner_quoted">''# Split (''</span> <span class="keyword1">o</span> shows <span class="main">(</span><span class="main">(</span>map_option <span class="main">(</span>Inf_tm <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">params</span><span class="main">)</span><span class="main">)</span> <span class="bound">R</span><span class="main">)</span> <span class="keyword1">o</span> shows <span class="inner_quoted">'')''</span><span class="main">)</span> <span class="inner_quoted">''⏎''</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">()</span> <span class="keyword1">in</span> <span class="keyword1">case</span> split_largest_interval <span class="bound">X</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⇒</span>
      <span class="free">prove_pos</span> <span class="free"><span class="bound"><span class="entity">prnt</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="bound">a</span><span class="main">#</span><span class="bound">b</span><span class="main">#</span><span class="bound">XS</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> prove_pos_slp

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">prove_pos_slp</span> <span class="free"><span class="bound"><span class="entity">prnt</span></span></span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="free"><span class="bound"><span class="entity">fa</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">slp</span> <span class="main">=</span> slp_of_fas <span class="main">[</span><span class="free"><span class="bound"><span class="entity">fa</span></span></span><span class="main">]</span> <span class="keyword1">in</span> prove_pos <span class="free"><span class="bound"><span class="entity">prnt</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="free"><span class="bound"><span class="entity">ord</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">ord</span> <span class="bound">xs</span><span class="main">.</span>
  <span class="keyword1">case</span> approx_slp <span class="free"><span class="bound"><span class="entity">prec</span></span></span> <span class="bound">ord</span> <span class="main">1</span> <span class="bound">slp</span> <span class="bound">xs</span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">⇒</span> Some <span class="bound">x</span> <span class="main">|</span> Some <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">experiment</span></span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">unbundle</span></span> floatarith_notation

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">schwefel</span> <span class="main">≡</span>
  <span class="main">(</span><span class="numeral">5.8806</span> <span class="main">/</span> <span class="numeral">10</span> <span class="main">^</span> <span class="numeral">10</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">1</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">2</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"prove_pos_slp True <span class="numeral">30</span> <span class="main">0</span> schwefel <span class="numeral">100000</span> <span class="main">[</span>replicate <span class="numeral">3</span> <span class="main">(</span>Ivl <span class="main">(</span><span class="main">-</span><span class="numeral">10</span><span class="main">)</span> <span class="numeral">10</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">delta6</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">Var</span> <span class="main">0</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="numeral">2</span> <span class="main">-</span> <span class="keyword1">Var</span> <span class="numeral">3</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="numeral">4</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="numeral">5</span><span class="main">)</span> <span class="main">+</span>
    <span class="keyword1">Var</span> <span class="main">1</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span> <span class="keyword1">Var</span> <span class="main">0</span> <span class="main">-</span> <span class="keyword1">Var</span> <span class="main">1</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="numeral">3</span> <span class="main">-</span> <span class="keyword1">Var</span> <span class="numeral">4</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="numeral">5</span><span class="main">)</span> <span class="main">+</span>
    <span class="keyword1">Var</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span> <span class="keyword1">Var</span> <span class="main">0</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="main">1</span> <span class="main">-</span> <span class="keyword1">Var</span> <span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="numeral">3</span> <span class="main">+</span> <span class="keyword1">Var</span> <span class="numeral">4</span> <span class="main">-</span> <span class="keyword1">Var</span> <span class="numeral">5</span><span class="main">)</span>
   <span class="main">-</span> <span class="keyword1">Var</span> <span class="main">1</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">3</span>
   <span class="main">-</span> <span class="keyword1">Var</span> <span class="main">0</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">4</span>
   <span class="main">-</span> <span class="keyword1">Var</span> <span class="main">0</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="main">1</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">5</span>
   <span class="main">-</span> <span class="keyword1">Var</span> <span class="numeral">3</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">4</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">5</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"prove_pos_slp True <span class="numeral">30</span> <span class="numeral">3</span> delta6 <span class="numeral">10000</span> <span class="main">[</span>replicate <span class="numeral">6</span> <span class="main">(</span>Ivl <span class="numeral">4</span> <span class="main">(</span>Float <span class="numeral">104045</span> <span class="main">(</span><span class="main">-</span><span class="numeral">14</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">caprasse</span> <span class="main">≡</span> <span class="main">(</span><span class="numeral">3.1801</span> <span class="main">+</span> <span class="main">-</span> <span class="keyword1">Var</span> <span class="main">0</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span> <span class="numeral">3</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">2</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">3</span> <span class="main">+</span>
    <span class="numeral">4</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="main">0</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">3</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">3</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">3</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="main">0</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">2</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">2</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">10</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="main">1</span> <span class="main">*</span> <span class="keyword1">Var</span> <span class="numeral">3</span> <span class="main">+</span>
    <span class="main">-</span><span class="numeral">10</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">3</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"prove_pos_slp True <span class="numeral">30</span> <span class="numeral">2</span> caprasse <span class="numeral">10000</span> <span class="main">[</span>replicate <span class="numeral">4</span> <span class="main">(</span>Ivl <span class="main">(</span><span class="main">-</span>Float <span class="main">1</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Float <span class="main">1</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">magnetism</span> <span class="main">≡</span>
  <span class="numeral">0.25001</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">0</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="main">1</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">2</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">3</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">4</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">5</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">+</span>
    <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">Var</span> <span class="numeral">6</span><span class="main">)</span><span class="keyword1">^<span class="hidden">⇩</span><sub>e</sub></span><span class="numeral">2</span> <span class="main">-</span> <span class="keyword1">Var</span> <span class="main">0</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>