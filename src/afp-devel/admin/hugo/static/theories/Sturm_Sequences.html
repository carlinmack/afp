<div id="Sturm_Library_Document">
<div class="head">
<h1>Theory Sturm_Library_Document</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>
<span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">theory</span></span> Sturm_Library_Document <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Misc_Polynomial">
<div class="head">
<h1>Theory Misc_Polynomial</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Manuel Eberl &lt;eberlm@in.tum.de&gt; *)</span>
<span class="keyword1"><span class="command">theory</span></span> Misc_Polynomial
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial_Factorial.html">HOL-Computational_Algebra.Polynomial_Factorial</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Analysis›</span></span>

<span class="keyword1" id="Misc_Polynomial-fun_eq_in_ivl"><span class="command">lemma</span></span> fun_eq_in_ivl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">ξ</span><span class="main">.</span> <span class="free">f</span> <span class="bound">ξ</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">f</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> connected_local_const<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> connected_Icc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">aa</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">f</span> <span class="bound">aa</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">aa</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x</span> <span class="keyword1">within</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_filter <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polynomials›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹General simplification lemmas›</span></span>

<span class="keyword1" id="Misc_Polynomial-pderiv_div"><span class="command">lemma</span></span> pderiv_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> pderiv <span class="free">p</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> pderiv <span class="free">q</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">*</span><span class="free">q</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> pderiv <span class="free">p</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> pderiv <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> pderiv <span class="free">p</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> pderiv <span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">*</span> pderiv <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> pderiv_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">*</span><span class="free">q</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> pderiv <span class="free">p</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> pderiv <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> 0 <span class="main">=</span> pderiv_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dvd_def nonzero_mult_div_cancel_left<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> pderiv <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> pderiv <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span> <span class="main">*</span> pderiv <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 0 1<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> pderiv <span class="free">q</span> <span class="main">=</span> pderiv <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 mult.commute<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> pderiv <span class="free">q</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span> <span class="main">*</span> pderiv <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> pderiv <span class="free">p</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> pderiv <span class="free">q</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> pderiv <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_right' distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> pderiv <span class="free">p</span> <span class="main">-</span> <span class="free">p</span> <span class="main">*</span> pderiv <span class="free">q</span><span class="main">)</span> <span class="keyword1">div</span> <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute mult.left_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Divisibility of polynomials›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Two polynomials that are coprime have no common roots.
›</span></span>
<span class="keyword1" id="Misc_Polynomial-coprime_imp_no_common_roots"><span class="command">lemma</span></span> coprime_imp_no_common_roots<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">q</span>"</span></span>
     <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_common_divisor<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_unit_pCons_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_div"><span class="command">lemma</span></span> poly_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">::</span> field poly<span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="free">x</span> <span class="main">/</span> poly <span class="free">q</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span> <span class="main">*</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="main">(</span><span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_swap<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">q</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="free">x</span> <span class="main">/</span> poly <span class="free">q</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* TODO: make this less ugly *)</span>
<span class="keyword1" id="Misc_Polynomial-poly_div_gcd_squarefree_aux"><span class="command">lemma</span></span> poly_div_gcd_squarefree_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span><span class="main">)</span> poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="main">(</span>pderiv <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bezout_coefficients <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">s</span> <span class="main">*</span> pderiv <span class="free">p</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bezout_coefficients<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">s</span> <span class="main">*</span> pderiv <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> pderiv <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> pderiv <span class="free">d</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="keyword1">div</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">*</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">*</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t_def u_def d_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> poly_squarefree_decomp<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> A B<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> p'_def<span class="main"><span class="main">]</span></span> rs<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> t_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> rs <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">*</span><span class="skolem">t</span><span class="main">*</span><span class="skolem">d'</span> <span class="main">=</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">*</span><span class="skolem">t</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">*</span>pderiv <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A B <span class="dynamic"><span class="dynamic">algebra_simps</span></span> pderiv_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="keyword1">dvd</span> <span class="skolem">t</span><span class="main">;</span> <span class="bound">x</span> <span class="keyword1">dvd</span> <span class="main">(</span>pderiv <span class="skolem">t</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="main">(</span>pderiv <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> vw<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> pderiv <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span> pderiv <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> vw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">*</span><span class="skolem">v'</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">*</span><span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pderiv_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">*</span><span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="skolem">w</span> <span class="main">-</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="skolem">v</span><span class="main">*</span>pderiv <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">*</span><span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> vw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> x_pow_n_dvd_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">x</span><span class="main">^</span><span class="bound">n</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">^</span> <span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">n</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> vw <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="free">d</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">v</span> <span class="main">+</span> <span class="free">d</span><span class="main">*</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">w</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">d'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span>Suc <span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvdI<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">n'</span> <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">[:</span>of_nat <span class="skolem">n</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> pderiv_power_Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">n'</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="skolem">n'</span> <span class="main">*</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dvd_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> pderiv <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> d <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">from</span></span> C d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">z</span> <span class="main">=</span> <span class="skolem">z</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">*</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">c</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span><span class="main">*</span><span class="main">(</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">x'</span><span class="main">)</span> <span class="main">+</span>
                          <span class="skolem">s</span><span class="main">*</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">z'</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span>Suc <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="skolem">z</span><span class="main">*</span><span class="main">(</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">x'</span><span class="main">)</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">v'</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span>Suc <span class="skolem">n</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> vw pderiv_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">v</span> <span class="main">+</span> <span class="skolem">z</span><span class="main">*</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">c</span><span class="main">*</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">z'</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">*</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">v'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> y<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">v</span><span class="main">+</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">c</span><span class="main">*</span><span class="skolem">y</span><span class="main">+</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">z'</span><span class="main">+</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">y</span><span class="main">+</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">z</span><span class="main">*</span><span class="skolem">v'</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">^</span><span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_triv_left<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> d <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span>Suc <span class="skolem">n</span> <span class="keyword1">dvd</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>

   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="main">(</span>degree <span class="free">d</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> degree <span class="free">d</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_power_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x_pow_n_dvd_d<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>degree <span class="free">d</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
           <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span><span class="skolem">x</span><span class="main">^</span>Suc <span class="main">(</span>degree <span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> degree <span class="free">d</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_imp_degree_le<span class="main">)</span>
       <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dvdI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span>inverse <span class="skolem">c</span><span class="main">:]</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">t</span> <span class="main">(</span>pderiv <span class="skolem">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprimeI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-normalize_field"><span class="command">lemma</span></span> normalize_field<span class="main">:</span>
  <span class="quoted"><span class="quoted">"normalize <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>normalization_semidom<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_unit_normalize dvd_field_iff<span class="main">)</span>

<span class="keyword1" id="Misc_Polynomial-normalize_field_eq_1"><span class="command">lemma</span></span> normalize_field_eq_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> normalize <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>normalization_semidom<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_field<span class="main">)</span>

<span class="keyword1" id="Misc_Polynomial-unit_factor_field"><span class="command">lemma</span></span> unit_factor_field <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"unit_factor <span class="main">(</span><span class="free">x</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field<span class="main">,</span>normalization_semidom<span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_unit_unit_factor dvd_field_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Dividing a polynomial by its gcd with its derivative yields
  a squarefree polynomial with the same roots.
›</span></span>
<span class="keyword1" id="Misc_Polynomial-poly_div_gcd_squarefree"><span class="command">lemma</span></span> poly_div_gcd_squarefree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>field_char_0<span class="main">,</span>field_gcd<span class="main">}</span><span class="main">)</span> poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="main">(</span>pderiv <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="var">?B</span> <span class="bound">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="var">?B</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree_aux<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pderiv_iszero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> smult <span class="main">(</span>inverse <span class="skolem">c</span><span class="main">)</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def normalize_poly_def map_poly_pCons <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pCons_one<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> normalize_const_poly is_unit_triv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="var">?B</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sign changes of a polynomial›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If a polynomial has different signs at two points, it has a root inbetween.
›</span></span>
<span class="keyword1" id="Misc_Polynomial-poly_different_sign_imp_root"><span class="command">lemma</span></span> poly_different_sign_imp_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
                        <span class="operator">rule_tac</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> assms True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> poly_IVT_pos<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> True this<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> x <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_less less_eq_real_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> assms False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def not_less
                           less_eq_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> poly_IVT_neg<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> this<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> x <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_different_sign_imp_root'"><span class="command">lemma</span></span> poly_different_sign_imp_root'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> poly_different_sign_imp_root
                                    <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def not_less<span class="main">)</span>


<span class="keyword1" id="Misc_Polynomial-no_roots_inbetween_imp_same_sign"><span class="command">lemma</span></span> no_roots_inbetween_imp_same_sign<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> poly_different_sign_imp_root assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Limits of polynomials›</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_neighbourhood_without_roots"><span class="command">lemma</span></span> poly_neighbourhood_without_roots<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ε</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">δ</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="bound">δ</span><span class="main">≤</span><span class="skolem">ε</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="bound">δ</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
           <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ε</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">ε</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"card <span class="var">?A</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ε</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc _<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ε'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε'</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ε'</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ε'_def <span class="keyword1"><span class="command">using</span></span> x_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">from</span></span> x_props<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">x'</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x'</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε'</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x'</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∉</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ε'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x_props
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊂</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?B</span> <span class="main">&lt;</span> card <span class="var">?A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> psubset_card_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> less<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
                <span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ less<span class="main"><span class="main"><span class="main">(</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε'</span> <span class="main">&lt;</span> <span class="skolem">ε</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at dist_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Misc_Polynomial-poly_neighbourhood_same_sign"><span class="command">lemma</span></span> poly_neighbourhood_same_sign<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> cont<span class="main">:</span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> isCont_sgn<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_isCont<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">-</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> isCont_def tendsto_iff dist_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_lhopital"><span class="command">lemma</span></span> poly_lhopital<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="main">(</span>pderiv <span class="free">q</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">─</span><span class="free">x</span><span class="main">→</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">/</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">─</span><span class="free">x</span><span class="main">→</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> lhopital<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>poly <span class="free">p</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"isCont <span class="main">(</span>poly <span class="free">q</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">─</span><span class="free">x</span><span class="main">→</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="main">─</span><span class="free">x</span><span class="main">→</span> <span class="main">0</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isCont_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> pderiv_iszero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> poly_neighbourhood_without_roots<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>pderiv <span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_DERIV poly_neighbourhood_without_roots<span class="main">)</span>


<span class="keyword1" id="Misc_Polynomial-poly_roots_bounds"><span class="command">lemma</span></span> poly_roots_bounds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">l</span> <span class="free">u</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="main">(</span><span class="free">u</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">l</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">l</span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">l</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">u</span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?roots</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> poly_roots_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?roots'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="main">0</span> <span class="var">?roots</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> Min <span class="var">?roots'</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> Max <span class="var">?roots'</span> <span class="main">+</span> <span class="main">1</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?roots</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?roots'</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Min_le<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span>  <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_def u_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Min_le<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> l_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≤</span><span class="skolem">l</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> l_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Max_ge<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> u_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≥</span><span class="skolem">u</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> l_props u_props <span class="keyword3"><span class="command">show</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">l</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> l_props <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_le<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> u_props <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linear<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">l</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="var">?roots</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> poly_IVT_pos<span class="main">[</span><span class="operator">OF</span> A<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> poly_IVT_neg<span class="main">[</span><span class="operator">OF</span> A<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> A<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm
                         <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def l_props not_less less_eq_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">l</span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> u_props poly_IVT_neg<span class="main">[</span><span class="operator">OF</span> A<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> poly_IVT_pos<span class="main">[</span><span class="operator">OF</span> A<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> A<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm
                         <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def l_props not_less less_eq_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">u</span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_normed_vector<span class="main">)</span> poly <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_inf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> sgn <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poly_neg_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_normed_vector<span class="main">)</span> poly <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poly_neg_inf</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="keyword1">then</span> sgn <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>
                                       <span class="keyword1">else</span> <span class="main">-</span>sgn <span class="main">(</span>coeff <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>degree <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1" id="Misc_Polynomial-poly_inf_0_iff"><span class="command">lemma</span></span> poly_inf_0_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> poly_inf_def poly_neg_inf_def sgn_zero_iff<span class="main">)</span>

<span class="keyword1" id="Misc_Polynomial-poly_inf_mult"><span class="command">lemma</span></span> poly_inf_mult<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_normed_field<span class="main">)</span> poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly_inf <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="free">p</span> <span class="main">*</span> poly_inf <span class="free">q</span>"</span></span>
        <span class="quoted"><span class="quoted">"poly_neg_inf <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> poly_neg_inf <span class="free">p</span> <span class="main">*</span> poly_neg_inf <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> poly_inf_def poly_neg_inf_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_zero_iff
         degree_mult_eq<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span><span class="main"><span class="main">]</span></span> coeff_mult_degree_sum Real_Vector_Spaces.sgn_mult<span class="main">)</span><span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1" id="Misc_Polynomial-poly_neq_0_at_infinity"><span class="command">lemma</span></span> poly_neq_0_at_infinity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_infinity"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> poly_roots_bounds<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> l u <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> lu_props <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> max <span class="main">(</span><span class="main">-</span><span class="skolem">l</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> eventually_at_infinity<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">≥</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> lu_props<span class="main">(</span>3<span class="main">,</span> 6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sgn_zero_iff B<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> lu_props<span class="main">(</span>2<span class="main">,</span> 5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sgn_zero_iff B<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1" id="Misc_Polynomial-poly_limit_aux"><span class="command">lemma</span></span> poly_limit_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≡</span> degree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">⤏</span> coeff <span class="free">p</span> <span class="free">n</span><span class="main">)</span> at_infinity"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            at_infinity"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_infinity"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_infinity<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def sum_divide_distrib power_diff poly_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">n</span> <span class="keyword1">then</span> coeff <span class="free">p</span> <span class="free">n</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="var">?a</span> <span class="bound">i</span><span class="main">)</span> at_infinity"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{..</span><span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> coeff <span class="free">p</span> <span class="skolem">i</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="var">?a</span> <span class="skolem">i</span><span class="main">)</span> at_infinity"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendstoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> eventually_at_infinity<span class="main"><span class="keyword3">,</span></span>
                         <span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≤</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> tendsto_inverse_0 <span class="keyword2"><span class="keyword">and</span></span> divide_real_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> tendsto_power<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_infinity"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_0_left power_one_over<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> tendsto_mult_right_zero<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="skolem">i</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> coeff <span class="free">p</span> <span class="skolem">i</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_infinity"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> at_infinity"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tendsto_sum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> <span class="var">?a</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> coeff <span class="free">p</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sum.delta<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">i</span><span class="main">≤</span><span class="free">n</span><span class="main">.</span> coeff <span class="free">p</span> <span class="bound">i</span> <span class="main">/</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> coeff <span class="free">p</span> <span class="free">n</span><span class="main">)</span> at_infinity"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Misc_Polynomial-poly_at_top_at_top"><span class="command">lemma</span></span> poly_at_top_at_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span><span class="main">^</span><span class="var">?n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="var">?n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>

  <span class="keyword1"><span class="command">from</span></span> poly_limit_aux <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tendsto_mono at_top_le_at_infinity <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_pow_at_top filterlim_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filterlim_tendsto_pos_mult_at_top assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eventually_at_top_linorder<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_altdef <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_distrib_left power_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> filterlim_cong<span class="main">[</span><span class="operator">OF</span> refl refl this<span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_at_bot_at_top"><span class="command">lemma</span></span> poly_at_bot_at_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> poly_at_top_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> <span class="main">-</span>poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_uminus_at_bot<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_lim_inf"><span class="command">lemma</span></span> poly_lim_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="free">p</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder poly_inf_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> deg <span class="main">=</span> this
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?lc</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> poly_at_top_at_top<span class="main">[</span><span class="operator">OF</span> deg this<span class="main">]</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top
                      eventually_at_top_linorder less_eq_real_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder poly_inf_def<span class="main"><span class="keyword3">,</span></span>
                             <span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lc</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">from</span></span> poly_at_bot_at_top<span class="main">[</span><span class="operator">OF</span> deg this<span class="main">]</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_bot
                      eventually_at_top_linorder less_eq_real_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder poly_inf_def<span class="main"><span class="keyword3">,</span></span>
                             <span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lc</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_at_top_or_bot_at_bot"><span class="command">lemma</span></span> poly_at_top_or_bot_at_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="keyword1">then</span> at_top <span class="keyword1">else</span> at_bot<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">/</span> <span class="skolem">x</span> <span class="main">^</span> <span class="var">?n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">^</span> <span class="var">?n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span>

  <span class="keyword1"><span class="command">from</span></span> poly_limit_aux <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="main">⤏</span> coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tendsto_mono at_bot_le_at_infinity <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def <span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="keyword1">then</span> at_top <span class="keyword1">else</span> at_bot<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> filterlim_pow_at_bot_even filterlim_pow_at_bot_odd filterlim_ident<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">:&gt;</span>
                      <span class="main">(</span><span class="keyword1">if</span> even <span class="var">?n</span> <span class="keyword1">then</span> at_top <span class="keyword1">else</span> at_bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> filterlim_tendsto_pos_mult_at_top
                                  filterlim_tendsto_pos_mult_at_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">=</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> at_bot"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> f_def g_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eventually_at_bot_linorder<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">-</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_altdef <span class="dynamic"><span class="dynamic">field_simps</span></span> sum_distrib_left power_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> filterlim_cong<span class="main">[</span><span class="operator">OF</span> refl refl this<span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Misc_Polynomial-poly_at_bot_or_top_at_bot"><span class="command">lemma</span></span> poly_at_bot_or_top_at_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span> <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="keyword1">then</span> at_bot <span class="keyword1">else</span> at_top<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> poly_at_top_or_bot_at_bot<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> assms
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_bot<span class="main">.</span> <span class="main">-</span>poly <span class="free">p</span> <span class="bound">x</span> <span class="main">:&gt;</span>
                <span class="main">(</span><span class="keyword1">if</span> even <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span> <span class="keyword1">then</span> at_top <span class="keyword1">else</span> at_bot<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_uminus_at_bot<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_lim_neg_inf"><span class="command">lemma</span></span> poly_lim_neg_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_neg_inf <span class="free">p</span><span class="main">)</span> at_bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_bot_linorder poly_neg_inf_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> deg <span class="main">=</span> this
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"coeff <span class="free">p</span> <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?lc</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">note</span></span> lc_pos <span class="main">=</span> this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">from</span></span> poly_at_top_or_bot_at_bot<span class="main">[</span><span class="operator">OF</span> deg lc_pos<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> True
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top filterlim_at_bot
                        eventually_at_bot_linorder less_eq_real_def<span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True eventually_at_bot_linorder poly_neg_inf_def<span class="main"><span class="keyword3">,</span></span>
                    <span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_pos<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">from</span></span> poly_at_top_or_bot_at_bot<span class="main">[</span><span class="operator">OF</span> deg lc_pos<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> False
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_bot
                        eventually_at_bot_linorder less_eq_real_def<span class="main">)</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False eventually_at_bot_linorder poly_neg_inf_def<span class="main"><span class="keyword3">,</span></span>
                              <span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> lc_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lc</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>degree <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> poly_at_bot_or_top_at_bot<span class="main">[</span><span class="operator">OF</span> deg lc_neg<span class="main">]</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_bot
                          eventually_at_bot_linorder less_eq_real_def<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> True eventually_at_bot_linorder poly_neg_inf_def<span class="main"><span class="keyword3">,</span></span>
                               <span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_neg<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> poly_at_bot_or_top_at_bot<span class="main">[</span><span class="operator">OF</span> deg lc_neg<span class="main">]</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top
                          eventually_at_bot_linorder less_eq_real_def<span class="main">)</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> False eventually_at_bot_linorder poly_neg_inf_def<span class="main"><span class="keyword3">,</span></span>
                               <span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_neg<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Signs of polynomials for sufficiently large values›</span></span>

<span class="keyword1" id="Misc_Polynomial-polys_inf_sign_thresholds"><span class="command">lemma</span></span> polys_inf_sign_thresholds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">ps</span> <span class="main">::</span> real poly set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">l</span> <span class="free">u</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">ps</span><span class="main">;</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span>
              <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">l</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">∧</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">ps</span><span class="main">;</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">u</span><span class="main">⟧</span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="bound">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">ps</span><span class="main">;</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">l</span><span class="main">⟧</span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_neg_inf <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">l</span> <span class="main">≤</span> <span class="bound">u</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">ps</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≥</span> <span class="bound">u</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">ps</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">l</span> <span class="main">⟶</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_neg_inf <span class="bound">p</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l</span> <span class="bound">u</span><span class="main">.</span> <span class="var">?P</span> <span class="free">ps</span> <span class="bound">l</span> <span class="bound">u</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_subset_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">42</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>3 <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> lu_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">ps</span> <span class="skolem">l</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> poly_lim_inf <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> u'_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">u'</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> poly_lim_neg_inf <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> l'_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">l'</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_neg_inf <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at_bot_linorder<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"min <span class="skolem"><span class="skolem"><span class="skolem">l</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">l'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"max <span class="skolem"><span class="skolem"><span class="skolem">u</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">u'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
              <span class="operator">insert</span> lu_props l'_props u'_props<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> lu_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">ps</span> <span class="main">⟹</span> <span class="skolem">u</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="bound">p</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">l</span> <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_neg_inf <span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">ps</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_le<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lu_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> A <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">ps</span> <span class="main">⟹</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
                 <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">l</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> prems<span class="main">[</span><span class="operator">OF</span> lu_props<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> this lu_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Positivity of polynomials›</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_pos"><span class="command">lemma</span></span> poly_pos<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> poly_lim_inf <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> poly_lim_inf <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x'</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> poly_different_sign_imp_root'<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> B
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_pos_greater"><span class="command">lemma</span></span> poly_pos_greater<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
    poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> poly_lim_inf <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>max <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> poly_lim_inf <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_top_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>max <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> poly_inf <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>max <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">&gt;</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x'</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>max <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x'</span></span> <span class="quoted"><span class="quoted">"max <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> B E <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">&gt;</span> <span class="free">a</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> poly_different_sign_imp_root<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_pos_geq"><span class="command">lemma</span></span> poly_pos_geq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
    poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> poly_pos_greater
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        B<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> poly_pos_greater <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> B C poly_IVT_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≥</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_pos_less"><span class="command">lemma</span></span> poly_pos_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
    poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> poly_lim_neg_inf <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_neg_inf <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_bot_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="free">p</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>min <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> poly_lim_neg_inf <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span>
      C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> poly_neg_inf <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at_bot_linorder<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>min <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> poly_neg_inf <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>min <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">&lt;</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x'</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span>min <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x'</span></span> <span class="quoted"><span class="quoted">"min <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> B E <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">&lt;</span> <span class="free">a</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> poly_different_sign_imp_root<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_pos_leq"><span class="command">lemma</span></span> poly_pos_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
    poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> poly_pos_less
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        B<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword2"><span class="keyword">and</span></span> poly_pos_less <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> B C poly_IVT_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">≤</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_pos_between_less_less"><span class="command">lemma</span></span> poly_pos_between_less_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> ccontr<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> not_le not_less<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> B
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> poly_different_sign_imp_root<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span>
              <span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> poly_different_sign_imp_root<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
              <span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_pos_between_less_leq"><span class="command">lemma</span></span> poly_pos_between_less_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">&lt;</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> ccontr<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> not_le not_less<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> poly_different_sign_imp_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">a</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_pos_between_leq_less"><span class="command">lemma</span></span> poly_pos_between_leq_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> ccontr<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> not_le not_less<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> poly_different_sign_imp_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">a</span>›</span></span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">b</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Misc_Polynomial-poly_pos_between_leq_leq"><span class="command">lemma</span></span> poly_pos_between_leq_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> iffI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">∨</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> poly <span class="free">p</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">≤</span><span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≤</span><span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> ccontr<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> not_le not_less<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≥</span> <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> poly_different_sign_imp_root<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">a</span>›</span></span> this<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sturm_Library">
<div class="head">
<h1>Theory Sturm_Library</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Sturm_Library
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Misc_Polynomial.html">Misc_Polynomial</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sturm_Theorem">
<div class="head">
<h1>Theory Sturm_Theorem</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proof of Sturm's Theorem›</span></span>
<span class="comment1">(* Author: Manuel Eberl &lt;eberlm@in.tum.de&gt; *)</span>
<span class="keyword1"><span class="command">theory</span></span> Sturm_Theorem
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Polynomial.html">HOL-Computational_Algebra.Polynomial</a>"</span>
    <span class="quoted">"<a href="Sturm_Library.html">Lib/Sturm_Library</a>"</span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Field_as_Ring.html">HOL-Computational_Algebra.Field_as_Ring</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sign changes of polynomial sequences›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For a given sequence of polynomials, this function computes the number of sign changes
  of the sequence of polynomials evaluated at a given position $x$. A sign change is a
  change from a negative value to a positive one or vice versa; zeros in the sequence are
  ignored.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sign_changes</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sign_changes</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span>
    length <span class="main">(</span>remdups_adj <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The number of sign changes of a sequence distributes over a list in the sense that
  the number of sign changes of a sequence $p_1, \ldots, p_i, \ldots, p_n$ at $x$ is the same
  as the sum of the sign changes of the sequence $p_1, \ldots, p_i$ and $p_i, \ldots, p_n$
  as long as $p_i(x)\neq 0$.
›</span></span>

<span class="keyword1" id="Sturm_Theorem-sign_changes_distrib"><span class="command">lemma</span></span> sign_changes_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
      sign_changes <span class="main">(</span><span class="free">ps<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">[</span><span class="free">p</span><span class="main">]</span> <span class="main">@</span> <span class="free">ps<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span>
      sign_changes <span class="main">(</span><span class="free">ps<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">@</span> <span class="main">[</span><span class="free">p</span><span class="main">]</span><span class="main">)</span> <span class="free">x</span> <span class="main">+</span> sign_changes <span class="main">(</span><span class="main">[</span><span class="free">p</span><span class="main">]</span> <span class="main">@</span> <span class="free">ps<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sign_changes_def sgn_zero_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> remdups_adj_append<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following two congruences state that the number of sign changes is the same
  if all the involved signs are the same.
›</span></span>

<span class="keyword1" id="Sturm_Theorem-sign_changes_cong"><span class="command">lemma</span></span> sign_changes_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ps</span> <span class="main">=</span> length <span class="free">ps'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span> <span class="main">&lt;</span> length <span class="free">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">ps</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">ps'</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="free">x</span> <span class="main">=</span> sign_changes <span class="free">ps'</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">ps'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span> <span class="skolem">ps</span> <span class="skolem">p'</span> <span class="skolem">ps'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="skolem">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span>
                         sgn <span class="main">(</span>poly <span class="main">(</span><span class="skolem">ps'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_changes_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-sign_changes_cong'"><span class="command">lemma</span></span> sign_changes_cong'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="free">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sign_changes_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For a sequence of polynomials of length 3, if the first and the third
  polynomial have opposite and nonzero sign at some $x$, the number of
  sign changes is always 1, irrespective of the sign of the second
  polynomial.
›</span></span>

<span class="keyword1" id="Sturm_Theorem-sign_changes_sturm_triple"><span class="command">lemma</span></span> sign_changes_sturm_triple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">[</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">]</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> sign_changes_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, we define two additional functions that count the sign changes ``at infinity''.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sign_changes_inf</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sign_changes_inf</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span>
    length <span class="main">(</span>remdups_adj <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map poly_inf <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sign_changes_neg_inf</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sign_changes_neg_inf</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span>
    length <span class="main">(</span>remdups_adj <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map poly_neg_inf <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Sturm sequences locale›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We first define the notion of a ``Quasi-Sturm sequence'', which is a weakening of
  a Sturm sequence that captures the properties that are fulfilled by a nonempty
  suffix of a Sturm sequence:
  \begin{itemize}
    \item The sequence is nonempty.
    \item The last polynomial does not change its sign.
    \item If the middle one of three adjacent polynomials has a root at $x$, the other
          two have opposite and nonzero signs at $x$.
  \end{itemize}
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> quasi_sturm_seq <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real poly<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> last_ps_sgn_const<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="free">ps</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="free">ps</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ps_not_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> signs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ps</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">;</span> poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span>
                     <span class="main">⟹</span> <span class="main">(</span>poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now we define a Sturm sequence $p_1,\ldots,p_n$ of a polynomial $p$ in the following way:
  \begin{itemize}
    \item The sequence contains at least two elements.
    \item $p$ is the first polynomial, i.\,e. $p_1 = p$.
    \item At any root $x$ of $p$, $p_2$ and $p$ have opposite sign left of $x$ and
          the same sign right of $x$ in some neighbourhood around $x$.
    \item The first two polynomials in the sequence have no common roots.
    \item If the middle one of three adjacent polynomials has a root at $x$, the other
          two have opposite and nonzero signs at $x$.
  \end{itemize}
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> sturm_seq <span class="main">=</span> quasi_sturm_seq <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hd_ps_p<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">ps</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> length_ps_ge_2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ps</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deriv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
      eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">ps</span><span class="main">!</span><span class="main">1</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                      <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_squarefree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="main">(</span><span class="free">ps</span><span class="main">!</span><span class="main">1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    Any Sturm sequence is obviously a Quasi-Sturm sequence.
›</span></span>
  <span class="keyword1" id="Sturm_Theorem-quasi_sturm_seq"><span class="command">lemma</span></span> quasi_sturm_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"quasi_sturm_seq <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="comment1">(*&lt;*)</span>
  <span class="keyword1" id="Sturm_Theorem-ps_first_two"><span class="command">lemma</span></span> ps_first_two<span class="main">:</span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="free">ps'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">=</span> <span class="free">p</span> <span class="main">#</span> <span class="free">q</span> <span class="main">#</span> <span class="free">ps'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hd_ps_p length_ps_ge_2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">ps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> ps'<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">ps'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="Sturm_Theorem-ps_first"><span class="command">lemma</span></span> ps_first<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ps_first_two<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_in_set<span class="main">[</span><span class="operator">OF</span> ps_not_Nil<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="comment1">(*&gt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>quasi_sturm_seq <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quasi_sturm_seq_def<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Any suffix of a Quasi-Sturm sequence is again a Quasi-Sturm sequence.
›</span></span>

<span class="keyword1" id="Sturm_Theorem-quasi_sturm_seq_Cons"><span class="command">lemma</span></span> quasi_sturm_seq_Cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"quasi_sturm_seq <span class="main">(</span><span class="free">p</span><span class="main">#</span><span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quasi_sturm_seq <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">interpret</span></span> quasi_sturm_seq <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">#</span><span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">from</span></span> last_ps_sgn_const <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ps</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="free">ps</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="free">ps</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">interpret</span></span> quasi_sturm_seq <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">#</span><span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ps</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> signs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">*</span> poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary lemmas about roots and sign changes›</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_adjacent_root_aux"><span class="command">lemma</span></span> sturm_adjacent_root_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">ps</span> <span class="main">::</span> real poly list<span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">ps</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">;</span> poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span>
                   <span class="main">⟹</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> j<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">j</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc.prems<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Suc.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> poly <span class="main">(</span><span class="free">ps</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Suc.IH<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Suc.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> j<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">j</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This function splits the sign list of a Sturm sequence at a
  position <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that is not a root of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> into a
  list of sublists such that the number of sign changes within
  every sublist is constant in the neighbourhood of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  thus proving that the total number is also constant.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">split_sign_changes</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">split_sign_changes</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">split_sign_changes</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">]</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">split_sign_changes</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> poly <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
       <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">]</span> <span class="main">#</span> <span class="free">split_sign_changes</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>
     <span class="keyword1">else</span>
       <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">]</span> <span class="main">#</span> <span class="free">split_sign_changes</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> quasi_sturm_seq<span class="main">)</span> split_sign_changes_subset<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">ps'</span> <span class="main">∈</span> set <span class="main">(</span>split_sign_changes <span class="free">ps</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> set <span class="free">ps'</span> <span class="main">⊆</span> set <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ps_not_Nil<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ps</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_sign_changes.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> p q r ps x<span class="main"><span class="keyword3">,</span></span>
       <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"poly <span class="improper">p</span> <span class="improper">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="improper">q</span> <span class="improper">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  A custom induction rule for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">split_sign_changes</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that
  uses the fact that all the intermediate parameters in calls
  of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">split_sign_changes</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are quasi-Sturm sequences.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> quasi_sturm_seq<span class="main">)</span> split_sign_changes_induct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span><span class="bound">p</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">[</span><span class="bound">p</span><span class="main">]</span> <span class="bound">x</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">x</span><span class="main">.</span> quasi_sturm_seq <span class="main">[</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">]</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">[</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">]</span> <span class="bound">x</span><span class="main">;</span>
    <span class="main">⋀</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span> <span class="bound">ps</span> <span class="bound">x</span><span class="main">.</span> quasi_sturm_seq <span class="main">(</span><span class="bound">p</span><span class="main">#</span><span class="bound">q</span><span class="main">#</span><span class="bound">r</span><span class="main">#</span><span class="bound">ps</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">⟦</span>poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> poly <span class="bound">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">r</span><span class="main">#</span><span class="bound">ps</span><span class="main">)</span> <span class="bound">x</span><span class="main">;</span>
        poly <span class="bound">q</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">q</span><span class="main">#</span><span class="bound">r</span><span class="main">#</span><span class="bound">ps</span><span class="main">)</span> <span class="bound">x</span><span class="main">;</span>
        poly <span class="bound">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">q</span><span class="main">#</span><span class="bound">r</span><span class="main">#</span><span class="bound">ps</span><span class="main">)</span> <span class="bound">x</span><span class="main">⟧</span>
           <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">p</span><span class="main">#</span><span class="bound">q</span><span class="main">#</span><span class="bound">r</span><span class="main">#</span><span class="bound">ps</span><span class="main">)</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">ps</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">goal_cases</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quasi_sturm_seq <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ps</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_sign_changes.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">ps</span> <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 3<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quasi_sturm_seq <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> quasi_sturm_seq_Cons<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 3 A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quasi_sturm_seq <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> quasi_sturm_seq_Cons<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 3 A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">#</span> <span class="skolem">r</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quasi_sturm_seq <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> quasi_sturm_seq_Cons<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 3 A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">#</span> <span class="skolem">r</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The total number of sign changes in the split list is the same
  as the number of sign changes in the original list.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> quasi_sturm_seq<span class="main">)</span> split_sign_changes_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>hd <span class="free">ps</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">sign_changes'</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">ps</span> <span class="bound">x</span><span class="main">.</span>
               <span class="main">∑</span><span class="bound">ps'</span><span class="main">←</span>split_sign_changes <span class="bound">ps</span> <span class="bound">x</span><span class="main">.</span> sign_changes <span class="bound">ps'</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">sign_changes'</span> <span class="free">ps</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_sign_changes_induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 3<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">interpret</span></span> quasi_sturm_seq <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> signs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">have</span></span>
           sgn_r_x0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">*</span> poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> sign_changes_distrib<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span>
                  sign_changes <span class="main">(</span><span class="main">[</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">r</span><span class="main">]</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">+</span> sign_changes <span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">sign_changes'</span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 3<span class="main">(</span>5<span class="main">)</span><span class="quoted"><span class="quoted">‹poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_changes'_def
          <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> sign_changes_distrib<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span>
                  sign_changes <span class="main">(</span><span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">+</span> sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="free">sign_changes'</span> <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 3<span class="main">(</span>5<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_changes'_def
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sign_changes_def sign_changes'_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We now prove that if $p(x)\neq 0$, the number of sign changes of a Sturm sequence of $p$
  at $x$ is constant in a neighbourhood of $x$.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> quasi_sturm_seq<span class="main">)</span> split_sign_changes_correct_nbh<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>hd <span class="free">ps</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">sign_changes'</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">ps</span> <span class="bound">x</span><span class="main">.</span>
               <span class="main">∑</span><span class="bound">ps'</span><span class="main">←</span>split_sign_changes <span class="bound">ps</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> sign_changes <span class="bound">ps'</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">sign_changes'</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">ps</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_ball_finite<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_neighbourhood_same_sign<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="free">sign_changes'</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">ps</span> <span class="skolem">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> nbh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">p</span></span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> poly <span class="bound">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">sign_changes'</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="free">ps</span> <span class="skolem">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_sign_changes_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 3<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">interpret</span></span> quasi_sturm_seq <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> signs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">have</span></span>
               sgn_r_x0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">*</span> poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">with</span></span> nbh 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_zero_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> sign_changes_distrib<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
                      sign_changes <span class="main">(</span><span class="main">[</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">,</span> <span class="skolem">r</span><span class="main">]</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span> sign_changes <span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">sign_changes'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span> nbh <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 3<span class="main">(</span>5<span class="main">)</span><span class="quoted"><span class="quoted">‹poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_changes'_def
              <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> nbh 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_zero_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> sign_changes_distrib<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span><span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
                      sign_changes <span class="main">(</span><span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">+</span> sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">sign_changes'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> nbh <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 3<span class="main">(</span>5<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sign_changes'_def
              <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sign_changes_def sign_changes'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> quasi_sturm_seq<span class="main">)</span> hd_nonzero_imp_sign_changes_const_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>hd <span class="free">ps</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps'</span> <span class="main">∈</span> set <span class="main">(</span>split_sign_changes <span class="free">ps</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sign_changes <span class="free">ps'</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="free">ps'</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> split_sign_changes_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sign_changes_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">interpret</span></span> quasi_sturm_seq <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> poly_neighbourhood_same_sign<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> last_ps_sgn_const
        <span class="keyword1"><span class="command">have</span></span> sgn_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="skolem">q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">q</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span>  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set<span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                           sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span>
                                sign_changes_cong'<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">ps''</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> p_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> sturm <span class="main">=</span> 3<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> IH <span class="main">=</span> 3<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> ps''_props <span class="main">=</span> 3<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">note</span></span> q_0 <span class="main">=</span> this
        <span class="keyword1"><span class="command">from</span></span> sturm <span class="keyword1"><span class="command">interpret</span></span> quasi_sturm_seq <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">r</span><span class="main">#</span><span class="skolem">ps''</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> signs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> q_0
            <span class="keyword1"><span class="command">have</span></span> signs'<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">*</span> poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> p_not_0 <span class="keyword1"><span class="command">have</span></span> r_not_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ps'</span> <span class="main">∈</span> set <span class="main">(</span>split_sign_changes <span class="main">(</span><span class="skolem">r</span> <span class="main">#</span> <span class="skolem">ps''</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_not_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> ps''_props p_not_0 q_0 <span class="keyword1"><span class="command">have</span></span> ps'_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> signs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> q_0
                <span class="keyword1"><span class="command">have</span></span> sgn_r<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">*</span> poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> p_not_0 sgn_r
              <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">∧</span>
                                     sgn <span class="main">(</span>poly <span class="skolem">r</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_conj poly_neighbourhood_same_sign<span class="main"><span class="keyword3">,</span></span>
                      <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_not_0<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span>
                   <span class="operator">subst</span> ps'_props<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sign_changes_sturm_triple<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="skolem">r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">r</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> prod_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="main">(</span><span class="bound">b</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span><span class="main">&gt;</span><span class="main">0</span><span class="main">;</span> <span class="bound">b</span><span class="main">&gt;</span><span class="main">0</span><span class="main">;</span> <span class="bound">a</span><span class="main">*</span><span class="bound">b</span><span class="main">&lt;</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
                             <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="main">(</span><span class="bound">b</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span><span class="main">&lt;</span><span class="main">0</span><span class="main">;</span> <span class="bound">b</span><span class="main">&lt;</span><span class="main">0</span><span class="main">;</span> <span class="bound">a</span><span class="main">*</span><span class="bound">b</span><span class="main">&lt;</span><span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> mult_pos_pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span>
                      <span class="operator">drule</span> mult_neg_neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> A <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_zero_iff<span class="main">)</span>

              <span class="keyword1"><span class="command">with</span></span> sgn_r p_not_0 r_not_0 A B
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x</span> <span class="main">*</span> poly <span class="skolem">p</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sgn_less sgn_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> sgn_0_0<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> sgn_r <span class="keyword3"><span class="command">show</span></span> sgn_r'<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="skolem">r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sgn <span class="main">(</span>poly <span class="skolem">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_def not_le not_less
                             <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
                  <span class="keyword1"><span class="command">using</span></span> prod_neg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">x</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"poly <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">x</span></span>"</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> sign_changes <span class="free">ps'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ps'_props<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sign_changes_sturm_triple<span class="main"><span class="keyword3">,</span></span>
                      <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> A B sgn_r'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> q_not_0 <span class="main">=</span> this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">ps'</span> <span class="main">∈</span> set <span class="main">(</span>split_sign_changes <span class="main">(</span><span class="skolem">q</span> <span class="main">#</span> <span class="skolem">r</span> <span class="main">#</span> <span class="skolem">ps''</span><span class="main">)</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_not_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> ps''_props <span class="keyword2"><span class="keyword">and</span></span> q_not_0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps'</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps'</span><span class="main">.</span> poly <span class="bound">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> q_not_0 p_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps'</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps'</span> <span class="skolem">x</span> <span class="main">=</span> sign_changes <span class="free">ps'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sign_changes_cong'<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">ps'</span><span class="main">.</span>
                        sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_ball_finite
                                   poly_neighbourhood_same_sign<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> quasi_sturm_seq<span class="main">)</span> hd_nonzero_imp_sign_changes_const<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>hd <span class="free">ps</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sign_changes <span class="free">ps</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pss</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"split_sign_changes <span class="free">ps</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">pss</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">ps'</span><span class="main">←</span><span class="bound">pss</span><span class="main">.</span> sign_changes <span class="bound">ps'</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pss</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps'</span><span class="main">.</span> <span class="bound">ps'</span><span class="main">∈</span>set <span class="skolem">pss</span> <span class="main">⟹</span>
        eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sign_changes <span class="bound">ps'</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="bound">ps'</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="skolem">pss</span> <span class="bound">x</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">pss</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">pss</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">ps'</span> <span class="skolem">pss</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_conj<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons.prems<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> A <span class="main">=</span> this<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?pss</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="var">?f</span> <span class="var">?pss</span> <span class="bound">x</span> <span class="main">=</span> <span class="var">?f</span> <span class="var">?pss</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> hd_nonzero_imp_sign_changes_const_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> C <span class="main">=</span> split_sign_changes_correct_nbh<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> D <span class="main">=</span> split_sign_changes_correct<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> E <span class="main">=</span> eventually_conj<span class="main">[</span><span class="operator">OF</span> B C<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">hide_fact</span></span> quasi_sturm_seq.split_sign_changes_correct_nbh
<span class="keyword1"><span class="command">hide_fact</span></span> quasi_sturm_seq.hd_nonzero_imp_sign_changes_const_aux
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sturm_seq<span class="main">)</span> p_nonzero_imp_sign_changes_const<span class="main">:</span>
  <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
       eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sign_changes <span class="free">ps</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hd_nonzero_imp_sign_changes_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If $x$ is a root of $p$ and $p$ is not the zero polynomial, the
  number of sign changes of a Sturm chain of $p$ decreases by 1 at $x$.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sturm_seq<span class="main">)</span> p_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sign_changes <span class="free">ps</span> <span class="bound">x</span> <span class="main">=</span>
      sign_changes <span class="free">ps</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span><span class="main">&lt;</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ps_first_two <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">=</span> <span class="free">p</span><span class="main">#</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_at<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p_squarefree <span class="keyword2"><span class="keyword">and</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"quasi_sturm_seq <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> quasi_sturm_seq_Cons<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">#</span><span class="skolem">ps'</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">interpret</span></span> quasi_sturm_seq <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">#</span><span class="skolem">ps'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps'</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span>
                                     sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps'</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hd_nonzero_imp_sign_changes_const<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="hidden">⇩</span><sub>0</sub><span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> poly_neighbourhood_without_roots<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> deriv<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
                   sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">ps</span><span class="main">!</span><span class="main">1</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
                   sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps'</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps'</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ps</span><span class="main">!</span><span class="main">1</span> <span class="main">=</span> <span class="skolem">q</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> eventually_conj<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> zero_less_mult_pos <span class="keyword1"><span class="command">have</span></span> zero_less_mult_pos'<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="bound">a</span><span class="main">*</span><span class="bound">b</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">*</span><span class="improper">b</span> <span class="main">=</span> <span class="improper">b</span><span class="main">*</span><span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q_sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="skolem">q</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">-</span>sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_real_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> linorder_neqE_linordered_idom
                 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> mult_neg_neg zero_less_mult_pos
                 zero_less_mult_pos' <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> sign_changes_distrib<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="skolem">q</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">ps'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="skolem">x</span> <span class="main">=</span> sign_changes <span class="main">[</span><span class="free">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span> <span class="skolem">x</span> <span class="main">+</span> sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps'</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> q_sgn <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">[</span><span class="free">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">]</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span><span class="main">&lt;</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sign_changes_def sgn_zero_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> prems<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">ps'</span><span class="main">)</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sign_changes_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  With these two results, we can now show that if $p$ is nonzero, the number
  of roots in an interval of the form $(a;b]$ is the difference of the sign changes
  of a Sturm sequence of $p$ at $a$ and $b$.\\
  First, however, we prove the following auxiliary lemma that shows that
  if a function $f: \RR\to\NN$ is locally constant at any $x\in(a;b]$, it is constant
  across the entire interval $(a;b]$:
›</span></span>

<span class="keyword1" id="Sturm_Theorem-count_roots_between_aux"><span class="command">lemma</span></span> count_roots_between_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">ξ</span><span class="main">.</span> <span class="free">f</span> <span class="bound">ξ</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x'</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="bound">x'</span> <span class="main">∧</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span>
                       eventually <span class="main">(</span><span class="main">λ</span><span class="bound">ξ</span><span class="main">.</span> <span class="free">f</span> <span class="bound">ξ</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> fun_eq_in_ivl<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="free">b</span>›</span></span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Now we can prove the actual root-counting theorem:
›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sturm_seq<span class="main">)</span> count_roots_between<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="free">a</span> <span class="main">-</span> sign_changes <span class="free">ps</span> <span class="free">b</span> <span class="main">=</span>
             card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="free">a</span> <span class="main">-</span> int <span class="main">(</span>sign_changes <span class="free">ps</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
             card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span>
             <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> no_roots<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?roots</span><span class="main">=</span><span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> card_roots<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="var">?roots</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> no_roots<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> card_roots eq_iff_diff_eq_0<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_nat_eq_iff<span class="main"><span class="keyword3">,</span></span>
                 <span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">with</span></span> no_roots <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="skolem">a</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">b</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> fun_eq_in_ivl <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>›</span></span>
                                   p_nonzero_imp_sign_changes_const<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">⟶</span> sign_changes <span class="free">ps</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">b</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> count_roots_between_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> p_nonzero_imp_sign_changes_const<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> False<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">a</span> <span class="main">⟶</span>
                        sign_changes <span class="free">ps</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> p_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">δ</span></span> <span class="keyword2"><span class="keyword">where</span></span> δ_props<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">a</span><span class="main">+</span><span class="skolem">δ</span> <span class="main">⟶</span>
                                   sign_changes <span class="free">ps</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">a</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at dist_real_def<span class="main">)</span>

              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="skolem">a</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">b</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span><span class="main">)</span>
                <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> min <span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">δ</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
                  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">a</span><span class="main">+</span><span class="skolem">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span>
                     <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">δ</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≤</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
                  <span class="keyword1"><span class="command">from</span></span> δ_props <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">a</span><span class="main">+</span><span class="skolem">δ</span>›</span></span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="skolem">a</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">b</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">from</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword1"><span class="command">have</span></span> card_greater_0<span class="main">:</span>
              <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> Min <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> Min_in<span class="main">[</span><span class="operator">OF</span> fin<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> True
              <span class="keyword1"><span class="command">have</span></span> x<span class="hidden">⇩</span><sub>2</sub>_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">&gt;</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>2</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">from</span></span> Min_le<span class="main">[</span><span class="operator">OF</span> fin<span class="main">]</span> x<span class="hidden">⇩</span><sub>2</sub>_props
              <span class="keyword1"><span class="command">have</span></span> x<span class="hidden">⇩</span><sub>2</sub>_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x'</span> <span class="main">&gt;</span> <span class="skolem">a</span><span class="main">;</span> <span class="bound">x'</span> <span class="main">≤</span> <span class="skolem">b</span><span class="main">;</span> poly <span class="free">p</span> <span class="bound">x'</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≤</span> <span class="bound">x'</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>2</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">have</span></span> left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> x<span class="hidden">⇩</span><sub>2</sub>_props x<span class="hidden">⇩</span><sub>2</sub>_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">from</span></span> p_zero<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">,</span>
              <span class="operator">unfolded</span> eventually_at dist_real_def<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> ε <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">hence</span></span> ε_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">⟶</span>
                   sign_changes <span class="free">ps</span> <span class="bound">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span>
                       <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> max <span class="main">(</span><span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> <span class="skolem">ε</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> x<span class="hidden">⇩</span><sub>2</sub>_props <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x<span class="hidden">⇩</span><sub>1</sub>_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">&lt;</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">then</span> sign_changes <span class="free">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> sign_changes <span class="free">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ε_props<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> sign_changes <span class="free">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>1</sub>_def <span class="keyword1"><span class="command">using</span></span> x<span class="hidden">⇩</span><sub>2</sub>_props <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∉</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>1</sub>_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">with</span></span> left <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">a</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> x<span class="hidden">⇩</span><sub>1</sub>_def <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_greater_0<span class="main">)</span>

          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> signs_left<span class="main">:</span>
              <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="skolem">a</span> <span class="main">-</span> int <span class="main">(</span>sign_changes <span class="free">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
                <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span>
                <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x<span class="hidden">⇩</span><sub>2</sub>_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> left
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span>
              card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">&lt;</span>
                 card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this x<span class="hidden">⇩</span><sub>2</sub>_props<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> A
              <span class="keyword1"><span class="command">have</span></span> signs_right<span class="main">:</span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="skolem">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">-</span> int <span class="main">(</span>sign_changes <span class="free">ps</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span>
                  card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">from</span></span> signs_left <span class="keyword2"><span class="keyword">and</span></span> signs_right <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  By applying this result to a sufficiently large upper bound, we can effectively count
  the number of roots ``between $a$ and infinity'', i.\,e. the roots greater than $a$:
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sturm_seq<span class="main">)</span> count_roots_above<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="free">a</span> <span class="main">-</span> sign_changes_inf <span class="free">ps</span> <span class="main">=</span>
             card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_in_set<span class="main">[</span><span class="operator">OF</span> ps_not_Nil<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> polys_inf_sign_thresholds<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> l u <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> lu_props <span class="main">=</span> this
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="free">a</span> <span class="skolem">u</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="var">?u</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> lu_props<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> this

  <span class="keyword1"><span class="command">from</span></span> lu_props
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="var">?u</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span> <span class="main">=</span> map poly_inf <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps</span> <span class="free">a</span> <span class="main">-</span> sign_changes_inf <span class="free">ps</span> <span class="main">=</span>
             sign_changes <span class="free">ps</span> <span class="free">a</span> <span class="main">-</span> sign_changes <span class="free">ps</span> <span class="var">?u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sign_changes_def sign_changes_inf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> count_roots_between<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> lu_props
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="var">?u</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="var">?u</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lu_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The same works analogously for the number of roots below $a$ and the
  total number of roots.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sturm_seq<span class="main">)</span> count_roots_below<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_changes_neg_inf <span class="free">ps</span> <span class="main">-</span> sign_changes <span class="free">ps</span> <span class="free">a</span> <span class="main">=</span>
             card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_in_set<span class="main">[</span><span class="operator">OF</span> ps_not_Nil<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> polys_inf_sign_thresholds<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> l u <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> lu_props <span class="main">=</span> this
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"min <span class="free">a</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="var">?l</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> lu_props<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> this

  <span class="keyword1"><span class="command">from</span></span> lu_props
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="var">?l</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span> <span class="main">=</span> map poly_neg_inf <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_changes_neg_inf <span class="free">ps</span> <span class="main">-</span> sign_changes <span class="free">ps</span> <span class="free">a</span> <span class="main">=</span>
             sign_changes <span class="free">ps</span> <span class="var">?l</span> <span class="main">-</span> sign_changes <span class="free">ps</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sign_changes_def sign_changes_neg_inf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> count_roots_between<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> lu_props
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="var">?l</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="var">?l</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≥</span> <span class="bound">x</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lu_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sturm_seq<span class="main">)</span> count_roots<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sign_changes_neg_inf <span class="free">ps</span> <span class="main">-</span> sign_changes_inf <span class="free">ps</span> <span class="main">=</span>
             card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> polys_inf_sign_thresholds<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> l u <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> lu_props <span class="main">=</span> this

  <span class="keyword1"><span class="command">from</span></span> lu_props
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span> <span class="main">=</span> map poly_neg_inf <span class="free">ps</span>"</span></span>
         <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="bound">p</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span> <span class="main">=</span> map poly_inf <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sign_changes_neg_inf <span class="free">ps</span> <span class="main">-</span> sign_changes_inf <span class="free">ps</span> <span class="main">=</span>
             sign_changes <span class="free">ps</span> <span class="skolem">l</span> <span class="main">-</span> sign_changes <span class="free">ps</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sign_changes_def sign_changes_inf_def
                         sign_changes_neg_inf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> count_roots_between<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> lu_props
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">l</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">l</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lu_props assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Constructing Sturm sequences›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The canonical Sturm sequence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this subsection, we will present the canonical Sturm sequence construction for
  a polynomial $p$ without multiple roots that is very similar to the Euclidean
  algorithm:
  $$p_i = \begin{cases}
    p &amp; \text{for}\ i = 1\\
    p' &amp; \text{for}\ i = 2\\
    -p_{i-2}\ \text{mod}\ p_{i-1} &amp; \text{otherwise}
  \end{cases}$$
  We break off the sequence at the first constant polynomial.
›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1" id="Sturm_Theorem-degree_mod_less'"><span class="command">lemma</span></span> degree_mod_less'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> degree <span class="main">(</span><span class="free">p</span> <span class="keyword1">mod</span> <span class="free">q</span><span class="main">)</span> <span class="main">&lt;</span> degree <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_0 degree_mod_less not_gr0<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">sturm_aux</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sturm_aux</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">::</span> real poly<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> degree <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">]</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free">sturm_aux</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">mod</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">pat_completeness</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span>degree <span class="main">∘</span> snd<span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
                <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def degree_mod_less'<span class="main">)</span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">declare</span></span> sturm_aux.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sturm</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sturm</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> sturm_aux <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>pderiv <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next, we show some simple facts about this construction:›</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_0"><span class="command">lemma</span></span> sturm_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm <span class="main">0</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> sturm_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm_aux <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sturm_aux.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Sturm_Theorem-sturm_neq_Nil"><span class="command">lemma</span></span> sturm_neq_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sturm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sturm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hd_in_set<span class="main">[</span><span class="operator">OF</span> sturm_neq_Nil<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sturm_aux <span class="free">p</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sturm_aux.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sturm_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>last <span class="main">(</span>sturm_aux <span class="free">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sturm_aux.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sturm_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm_aux <span class="free">p</span> <span class="free">q</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm_aux <span class="free">p</span> <span class="free">q</span> <span class="main">!</span> Suc <span class="main">0</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sturm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span> <span class="main">!</span> Suc <span class="main">0</span> <span class="main">=</span> pderiv <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sturm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Sturm_Theorem-sturm_indices"><span class="command">lemma</span></span> sturm_indices<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span><span class="main">!</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span>sturm <span class="free">p</span><span class="main">!</span><span class="free">i</span> <span class="keyword1">mod</span> sturm <span class="free">p</span><span class="main">!</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">q</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">ps</span> <span class="main">=</span> sturm_aux <span class="free">p</span> <span class="skolem">q</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="skolem">ps</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">⟧</span>
            <span class="main">⟹</span> <span class="skolem">ps</span><span class="main">!</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">ps</span><span class="main">!</span><span class="free">i</span> <span class="keyword1">mod</span> <span class="skolem">ps</span><span class="main">!</span><span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sturm_aux.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">i'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">≥</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> deg <span class="keyword1"><span class="command">have</span></span> ps'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">=</span> sturm_aux <span class="skolem">q</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹length <span class="skolem">ps</span> <span class="main">≥</span> <span class="numeral">4</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps'</span>›</span></span> 1<span class="main">(</span>3<span class="main">)</span> False
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> length <span class="skolem">ps'</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> deg ps' this<span class="main">]</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">ps</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm_aux <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">!</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">!</span><span class="main">(</span><span class="skolem">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> sturm_def assms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If the Sturm sequence construction is applied to polynomials $p$ and $q$,
  the greatest common divisor of $p$ and $q$ a divisor of every element in the
  sequence. This is obvious from the similarity to Euclid's algorithm for
  computing the GCD.
›</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_aux_gcd"><span class="command">lemma</span></span> sturm_aux_gcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> set <span class="main">(</span>sturm_aux <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> gcd <span class="free">p</span> <span class="free">q</span> <span class="keyword1">dvd</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sturm_aux.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> set <span class="main">(</span>sturm_aux <span class="skolem">q</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">p</span> <span class="keyword1">mod</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main"><span class="keyword3">,</span></span>
              <span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="main">[</span><span class="operator">OF</span> False r<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd_mod_right <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">≠</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_gcd"><span class="command">lemma</span></span> sturm_gcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> set <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sturm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sturm_aux_gcd<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If two adjacent polynomials in the result of the canonical Sturm chain construction
  both have a root at some $x$, this $x$ is a root of all polynomials in the sequence.
›</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_adjacent_root_propagate_left"><span class="command">lemma</span></span> sturm_adjacent_root_propagate_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm <span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sturm_adjacent_root_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>3<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> sturm_indices<span class="main">[</span><span class="operator">OF</span> prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="var">?p</span> <span class="keyword1">div</span> <span class="var">?q</span> <span class="main">*</span> <span class="var">?q</span> <span class="main">-</span> <span class="var">?r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_mod_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="main">(</span><span class="var">?p</span> <span class="keyword1">div</span> <span class="var">?q</span> <span class="main">*</span> <span class="var">?q</span> <span class="main">-</span> <span class="var">?r</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span>poly <span class="var">?r</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_minus<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Consequently, if this is the case in the canonical Sturm chain of $p$,
  $p$ must have multiple roots.
›</span></span>
<span class="keyword1" id="Sturm_Theorem-sturm_adjacent_root_not_squarefree"><span class="command">lemma</span></span> sturm_adjacent_root_not_squarefree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm <span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>rsquarefree <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sturm_adjacent_root_propagate_left<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rsquarefree_roots<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since the second element of the sequence is chosen to be the derivative of $p$,
  $p_1$ and $p_2$ fulfil the property demanded by the definition of a Sturm sequence
  that they locally have opposite sign left of a root $x$ of $p$ and the same sign
  to the right of $x$.
›</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_firsttwo_signs_aux"><span class="command">lemma</span></span> sturm_firsttwo_signs_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_pderiv<span class="main">:</span>
      <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
               sgn <span class="main">(</span>poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> poly_neighbourhood_same_sign q_pderiv
                poly_neighbourhood_without_roots eventually_conj<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ε</span></span> <span class="keyword2"><span class="keyword">where</span></span> ε_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span> <span class="main">⟶</span>
      poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> sgn <span class="main">(</span>poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_at dist_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sqr_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> sgn <span class="bound">x</span> <span class="main">*</span> sgn <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eventually_at dist_real_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">ε</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ε</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ε_props <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">q</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> poly_MVT<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> ξ <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">note</span></span> ξ_props <span class="main">=</span> this
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> ε_props
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">*</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="skolem">ξ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_pderiv sgn_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ξ_props ε_props <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">ξ</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟶</span> poly <span class="free">q</span> <span class="bound">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">q</span> <span class="skolem">ξ</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ξ_props ε_props
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> no_roots_inbetween_imp_same_sign<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> ε_props ξ_props
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_mult sqr_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> sgn<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> poly_MVT<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> ξ <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">note</span></span> ξ_props <span class="main">=</span> this
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> ε_props
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">ξ</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">*</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="skolem">ξ</span>"</span></span>
                 <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">ξ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> <span class="main">*</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="skolem">ξ</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ε_props ξ_props <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_pderiv sgn_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ξ_props ε_props <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="skolem">x</span> <span class="main">-</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">ε</span>›</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≤</span> <span class="skolem">ξ</span> <span class="main">⟶</span> poly <span class="free">q</span> <span class="bound">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="free">q</span> <span class="skolem">ξ</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="free">q</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ξ_props ε_props
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> no_roots_inbetween_imp_same_sign<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_mult sqr_pos<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_firsttwo_signs"><span class="command">lemma</span></span> sturm_firsttwo_signs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> squarefree<span class="main">:</span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> sturm <span class="free">p</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
             <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="free">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rsquarefree_roots<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> squarefree p_0 <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span>  <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rsquarefree_roots<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sturm_firsttwo_signs_aux<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rsquarefree_roots<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The construction also obviously fulfils the property about three
  adjacent polynomials in the sequence.
›</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_signs"><span class="command">lemma</span></span> sturm_signs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> squarefree<span class="main">:</span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_in_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm <span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">*</span> poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="free">x</span> <span class="main">*</span> poly <span class="var">?r</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sturm_indices<span class="main">[</span><span class="operator">OF</span> i_in_range<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="free">i</span> <span class="keyword1">mod</span> sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="var">?p</span> <span class="keyword1">mod</span> <span class="var">?q</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?r</span> <span class="main">=</span> <span class="var">?p</span> <span class="keyword1">mod</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> div_mult_mod_eq<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">div</span> <span class="var">?q</span> <span class="main">*</span> <span class="var">?q</span> <span class="main">-</span> <span class="var">?r</span> <span class="main">=</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?p</span> <span class="keyword1">div</span> <span class="var">?q</span><span class="main">)</span> <span class="free">x</span> <span class="main">*</span> poly <span class="var">?q</span> <span class="free">x</span> <span class="main">-</span> poly <span class="var">?r</span> <span class="free">x</span> <span class="main">=</span> poly <span class="var">?p</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poly_diff poly_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> q_0 <span class="keyword1"><span class="command">have</span></span> r_x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?r</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span>poly <span class="var">?p</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> sqr_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_neg_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sturm_adjacent_root_not_squarefree<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms r_x
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="free">x</span> <span class="main">*</span> poly <span class="var">?p</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sqr_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?r</span> <span class="free">x</span> <span class="main">*</span> poly <span class="var">?p</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Finally, if $p$ contains no multiple roots, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"sturm <span class="free"><span class="free">p</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, i.e.
  the canonical Sturm sequence for $p$, is a Sturm sequence
  and can be used to determine the number of roots of $p$.
›</span></span>
<span class="keyword1" id="Sturm_Theorem-sturm_seq_sturm"><span class="command">lemma</span></span> sturm_seq_sturm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sturm_seq <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rsquarefree_roots<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
            sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> sturm_firsttwo_signs<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
         eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span><span class="main">*</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                         <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> sturm_signs<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">;</span> poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span>
          <span class="main">⟹</span> poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> poly <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Canonical squarefree Sturm sequence›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The previous construction does not work for polynomials with multiple roots,
  but we can simply ``divide away'' multiple roots by dividing $p$ by the
  GCD of $p$ and $p'$. The resulting polynomial has the same roots as $p$,
  but with multiplicity 1, allowing us to again use the canonical construction.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sturm_squarefree</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sturm_squarefree</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> sturm <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>pderiv <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_squarefree_not_Nil"><span class="command">lemma</span></span> sturm_squarefree_not_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm_squarefree <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sturm_squarefree_def<span class="main">)</span>


<span class="keyword1" id="Sturm_Theorem-sturm_seq_sturm_squarefree"><span class="command">lemma</span></span> sturm_seq_sturm_squarefree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">≡</span> <span class="free">p</span> <span class="keyword1">div</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sturm_seq <span class="main">(</span>sturm_squarefree <span class="free">p</span><span class="main">)</span> <span class="free">p'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rsquarefree <span class="free">p'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> rsquarefree_roots<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="free">p'</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> gcd <span class="free">p'</span> <span class="main">(</span>pderiv <span class="free">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">p'</span> <span class="main">(</span>pderiv <span class="free">p'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poly_eq_0_iff_dvd<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> sturm_seq_sturm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹rsquarefree <span class="free">p'</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">interpret</span></span> sturm_seq<span class="main">:</span> sturm_seq <span class="quoted"><span class="quoted">"sturm_squarefree <span class="free">p</span>"</span></span> <span class="quoted"><span class="free">p'</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sturm_squarefree_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="main">(</span>sturm_squarefree <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
      sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="main">(</span>sturm_squarefree <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sturm_squarefree <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>sturm_squarefree <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sturm_squarefree_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>sturm_squarefree <span class="free">p</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm_squarefree <span class="free">p</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="free">p'</span>"</span></span>
               <span class="quoted"><span class="quoted">"sturm_squarefree <span class="free">p</span> <span class="main">!</span> Suc <span class="main">0</span> <span class="main">=</span> pderiv <span class="free">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sturm_squarefree_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rsquarefree <span class="free">p'</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>poly <span class="free">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="main">(</span>sturm_squarefree <span class="free">p</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rsquarefree_roots<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> sturm_seq.signs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm_squarefree <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">;</span>
                                 poly <span class="main">(</span>sturm_squarefree <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span>
                                 <span class="main">⟹</span> poly <span class="main">(</span>sturm_squarefree <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span>
                                         poly <span class="main">(</span>sturm_squarefree <span class="free">p</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">from</span></span> sturm_seq.deriv <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> poly <span class="free">p'</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
         eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">p'</span> <span class="main">*</span> sturm_squarefree <span class="free">p</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                         <span class="main">(</span><span class="keyword1">if</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Optimisation for multiple roots›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We can also define the following non-canonical Sturm sequence that
  is obtained by taking the canonical Sturm sequence of $p$
  (possibly with multiple roots) and then dividing the entire
  sequence by the GCD of $p$ and its derivative.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sturm_squarefree'</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sturm_squarefree'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">d</span> <span class="main">=</span> gcd <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span>pderiv <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>
                         <span class="keyword1">in</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">p'</span><span class="main">.</span> <span class="bound">p'</span> <span class="keyword1">div</span> <span class="bound">d</span><span class="main">)</span> <span class="main">(</span>sturm <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This construction also has all the desired properties:
›</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_squarefree'_adjacent_root_propagate_left"><span class="command">lemma</span></span> sturm_squarefree'_adjacent_root_propagate_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm_squarefree' <span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≤</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">.</span> poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sturm_adjacent_root_aux<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">,</span></span></span>3<span class="main"><span class="main"><span class="main">,</span></span></span>4<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> sturm <span class="free">p</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span> <span class="main">=</span> <span class="skolem">r</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i_in_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sturm_squarefree'_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def r_def s_def d_def
        <span class="keyword1"><span class="command">using</span></span> i_in_range <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sturm_gcd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> qrs_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">r'</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> q'_def r'_def s'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prems<span class="main">(</span>2<span class="main">)</span> i_in_range <span class="keyword1"><span class="command">have</span></span> r'_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> r'_def r_def d_def sturm_squarefree'_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> r_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">r'</span> <span class="main">*</span> <span class="skolem">d</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sturm_indices<span class="main">[</span><span class="operator">OF</span> i_in_range<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> q_def r_def s_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_mod_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">-</span> <span class="skolem">s'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s'_def poly_div_diff_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">s'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dvd_div_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">r</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">r</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> r'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">q'</span> <span class="keyword1">div</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qrs_simps <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q'</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="main">(</span><span class="skolem">q'</span> <span class="keyword1">div</span> <span class="skolem">r'</span> <span class="main">*</span> <span class="skolem">r'</span> <span class="main">-</span> <span class="skolem">s'</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> r'_0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span>poly <span class="skolem">s'</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">s'</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span>poly <span class="skolem">q'</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> i_in_range
        <span class="keyword1"><span class="command">unfolding</span></span> q'_def s'_def q_def s_def sturm_squarefree'_def Let_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def sgn_minus<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_squarefree'_adjacent_roots"><span class="command">lemma</span></span> sturm_squarefree'_adjacent_roots<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm_squarefree' <span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> sturm_squarefree'_adjacent_root_propagate_left<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
           <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>pderiv <span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> sturm_squarefree'_def Let_def d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> div_gcd_coprime assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> coprime_imp_no_common_roots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_squarefree'_signs"><span class="command">lemma</span></span> sturm_squarefree'_signs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i_in_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm_squarefree' <span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?q</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">*</span>
         poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?r</span> <span class="free">x</span> <span class="main">*</span> poly <span class="var">?p</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
       coprime_imp_no_common_roots
      <span class="keyword1"><span class="command">have</span></span> rsquarefree<span class="main">:</span> <span class="quoted"><span class="quoted">"rsquarefree <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rsquarefree_roots d_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> i_in_range <span class="keyword1"><span class="command">have</span></span> i_in_range'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sturm_squarefree'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?p'</span>"</span></span><span class="main">)</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?q'</span>"</span></span><span class="main">)</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="var">?r'</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sturm_gcd<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> pqr_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q'</span> <span class="main">=</span> <span class="var">?q</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r'</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sturm_squarefree'_def Let_def d_def <span class="keyword1"><span class="command">using</span></span> i_in_range'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dvd_div_mult_self<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> q_0 <span class="keyword1"><span class="command">have</span></span> q'_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?q'</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> sturm_indices<span class="main">[</span><span class="operator">OF</span> i_in_range'<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>sturm <span class="free">p</span> <span class="main">!</span> <span class="free">i</span> <span class="keyword1">mod</span> sturm <span class="free">p</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?r'</span> <span class="main">=</span> <span class="var">?p'</span> <span class="keyword1">mod</span> <span class="var">?q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> div_mult_mod_eq<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p'</span></span></span> <span class="var"><span class="quoted"><span class="var">?q'</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="keyword1">div</span> <span class="var">?q'</span> <span class="main">*</span> <span class="var">?q'</span> <span class="main">-</span> <span class="var">?r'</span> <span class="main">=</span> <span class="var">?p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span><span class="main">*</span><span class="main">(</span><span class="var">?p</span> <span class="keyword1">div</span> <span class="var">?q</span> <span class="main">*</span> <span class="var">?q</span> <span class="main">-</span> <span class="var">?r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">*</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pqr_simps <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">div</span> <span class="var">?q</span> <span class="main">*</span> <span class="var">?q</span> <span class="main">-</span> <span class="var">?r</span> <span class="main">=</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="var">?p</span> <span class="keyword1">div</span> <span class="var">?q</span><span class="main">)</span> <span class="free">x</span> <span class="main">*</span> poly <span class="var">?q</span> <span class="free">x</span> <span class="main">-</span> poly <span class="var">?r</span> <span class="free">x</span> <span class="main">=</span> poly <span class="var">?p</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poly_diff poly_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> q_0 <span class="keyword1"><span class="command">have</span></span> r_x<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?r</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span>poly <span class="var">?p</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> sturm_squarefree'_adjacent_roots<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> i_in_range q_0
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> sqr_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_neg_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> r_x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This approach indeed also yields a valid squarefree Sturm sequence
  for the polynomial $p/\text{gcd}(p,p')$.
›</span></span>
<span class="keyword1" id="Sturm_Theorem-sturm_seq_sturm_squarefree'"><span class="command">lemma</span></span> sturm_seq_sturm_squarefree'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">::</span> real poly<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≡</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sturm_seq <span class="main">(</span>sturm_squarefree' <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sturm_seq <span class="var">?ps'</span> <span class="var">?p'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ps'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="var">?ps'</span> <span class="main">=</span> <span class="var">?p'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> length <span class="var">?ps'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sturm_squarefree'_def d_def hd_map<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">dvd</span> last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sturm_gcd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span> <span class="main">=</span> last <span class="var">?ps'</span> <span class="main">*</span> <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sturm_squarefree'_def last_map d_def dvd_div_mult_self<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="var">?ps'</span> <span class="keyword1">dvd</span> last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> * dvd_imp_degree_le<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>last <span class="var">?ps'</span><span class="main">)</span> <span class="main">≤</span> degree <span class="main">(</span>last <span class="main">(</span>sturm <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"last <span class="var">?ps'</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"degree <span class="main">(</span>last <span class="var">?ps'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"last <span class="var">?ps'</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">c</span><span class="main">:]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"last <span class="var">?ps'</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="var">?ps'</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="main">(</span>last <span class="var">?ps'</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">have</span></span> squarefree<span class="main">:</span> <span class="quoted"><span class="quoted">"rsquarefree <span class="var">?p'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rsquarefree_roots<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> d_def<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">intro</span> allI coprime_imp_no_common_roots poly_div_gcd_squarefree<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sturm_squarefree' <span class="free">p</span> <span class="main">!</span> Suc <span class="main">0</span> <span class="main">=</span> pderiv <span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sturm_squarefree'_def Let_def sturm_def d_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> coprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="var">?p'</span> <span class="main">(</span>pderiv <span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> div_gcd_coprime <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> squarefree'<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="main">(</span>sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> coprime_imp_no_common_roots <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> sturm_squarefree'_signs<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">&lt;</span> length <span class="var">?ps'</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">;</span> poly <span class="main">(</span><span class="var">?ps'</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span>
                <span class="main">⟹</span> poly <span class="main">(</span><span class="var">?ps'</span> <span class="main">!</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> poly <span class="main">(</span><span class="var">?ps'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> squarefree <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rsquarefree_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p'</span> <span class="main">=</span> <span class="var">?ps'</span> <span class="main">!</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">=</span> <span class="var">?ps'</span> <span class="main">!</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sturm_squarefree'_def Let_def d_def sturm_def<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">subst</span> sturm_aux.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ps'</span> <span class="main">!</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> squarefree
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A rsquarefree_def<span class="main">)</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p'</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_div_gcd_squarefree<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pderiv <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> pderiv_iszero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹poly <span class="free">p</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span> <span class="main">*</span> pderiv <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                              <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sturm_firsttwo_signs_aux<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> ev <span class="main">=</span> eventually_conj<span class="main">[</span><span class="operator">OF</span> A poly_neighbourhood_without_roots<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span> <span class="main">*</span> sturm_squarefree' <span class="free">p</span> <span class="main">!</span> <span class="main">1</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span>
                        <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="skolem">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ev<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="main">(</span><span class="bound">b</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">/</span> <span class="main">(</span><span class="bound">b</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="main">(</span><span class="bound">b</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">/</span> <span class="main">(</span><span class="bound">b</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper">b</span></span> <span class="main"><span class="main">&gt;</span></span> <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="keyword3">,</span></span>
              <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_neg_neg <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span>  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">d</span> <span class="skolem">x</span> <span class="main">*</span> poly <span class="free">d</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">d</span> <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_neg_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree_aux<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹pderiv <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="free">d</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">dvd</span> pderiv <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sgn_real_def poly_div not_less<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
                         zero_less_divide_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This construction is obviously more expensive to compute than the one that \emph{first}
  divides $p$ by $\text{gcd}(p,p')$ and \emph{then} applies the canonical construction.
  In this construction, we \emph{first} compute the canonical Sturm sequence of $p$ as if
  it had no multiple roots and \emph{then} divide by the GCD.
  However, it can be seen quite easily that unless $x$ is a multiple root of $p$,
  i.\,e. as long as $\text{gcd}(P,P')\neq 0$, the number of sign changes in a sequence of
  polynomials does not actually change when we divide the polynomials by $\text{gcd}(p,p')$.\\
  There\-fore we can use the ca\-no\-ni\-cal Sturm se\-quence even in the non-square\-free
  case as long as the borders of the interval we are interested in are not multiple roots
  of the polynomial.
›</span></span>

<span class="keyword1" id="Sturm_Theorem-sign_changes_mult_aux"><span class="command">lemma</span></span> sign_changes_mult_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>remdups_adj <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(*)</span> <span class="free">d</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         length <span class="main">(</span>remdups_adj <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">(*)</span> <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> injI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">d</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
                          <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">(*)</span> <span class="free">d</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span>
        map <span class="main">(</span><span class="main">(*)</span> <span class="free">d</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(*)</span> <span class="free">d</span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_map o_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> remdups_adj_map_injective<span class="main">[</span><span class="operator">OF</span> inj<span class="main">]</span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_map map_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> map_map<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-sturm_sturm_squarefree'_same_sign_changes"><span class="command">lemma</span></span> sturm_sturm_squarefree'_same_sign_changes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≡</span> sturm <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps'</span> <span class="main">≡</span> sturm_squarefree' <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
             sign_changes <span class="free">ps'</span> <span class="free">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="free">x</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> sign_changes_inf <span class="free">ps'</span> <span class="main">=</span> sign_changes_inf <span class="free">ps</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> sign_changes_neg_inf <span class="free">ps'</span> <span class="main">=</span> sign_changes_neg_inf <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> poly_inf <span class="skolem">d</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> poly_neg_inf <span class="skolem">d</span>"</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def ps_def <span class="keyword1"><span class="command">using</span></span> sturm_gcd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> q_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def d_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> dvd_mult_div_cancel<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x</span> <span class="main">=</span> poly <span class="skolem">d</span> <span class="skolem">x</span> <span class="main">*</span> poly <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> q_prod<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="skolem">q</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>poly <span class="skolem">d</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> sgn <span class="main">(</span>poly <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> q_prod<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> poly_inf_mult <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_inf <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="main">*</span> poly_inf <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> s'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> q_prod<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> poly_inf_mult <span class="keyword1"><span class="command">have</span></span> s3<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_neg_inf <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">s''</span> <span class="main">*</span> poly_neg_inf <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> s''_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> q_prod<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> s1 s2 s3
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> signs <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="bound">q</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inverse <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
     <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span><span class="skolem">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">=</span> inverse <span class="skolem">s</span> <span class="main">*</span> <span class="skolem">f</span> <span class="skolem">q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> f' <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>remdups_adj <span class="main">[</span><span class="bound">x</span><span class="main">←</span>map <span class="skolem">f</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span>
           length <span class="main">(</span>remdups_adj <span class="main">[</span><span class="bound">x</span><span class="main">←</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sign_changes_def o_def map_map<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="free">ps</span> <span class="main">=</span> <span class="free">ps'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ps_def ps'_def sturm_squarefree'_def Let_def d_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> f' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span><span class="bound">q</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span> <span class="main">=</span>
                      map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(*)</span><span class="main">(</span>inverse <span class="skolem">s</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sign_changes_mult_aux<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹inverse <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="free">ps</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"length <span class="main">(</span>remdups_adj <span class="main">[</span><span class="bound">x</span><span class="main">←</span>map <span class="skolem">f</span> <span class="free">ps'</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span>
         length <span class="main">(</span>remdups_adj <span class="main">[</span><span class="bound">x</span><span class="main">←</span>map <span class="skolem">f</span> <span class="free">ps</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">]</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> length_remdups_adj <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="keyword1">dvd</span> pderiv <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>poly <span class="skolem">d</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_zero_iff <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> dvdE<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sign_changes <span class="free">ps'</span> <span class="skolem">x</span> <span class="main">=</span> sign_changes <span class="free">ps</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> signs<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> sign_changes_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> length_remdups_adj<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">q</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> sgn <span class="main"><span class="main"><span class="main">(</span></span></span>poly <span class="bound"><span class="bound"><span class="bound">q</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> s'_def s''_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> length_remdups_adj<span class="main">[</span><span class="operator">of</span> <span class="quoted">poly_inf</span> <span class="quoted"><span class="skolem">s'</span></span><span class="main">,</span> <span class="operator">OF</span> signs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sign_changes_inf <span class="free">ps'</span> <span class="main">=</span> sign_changes_inf <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sign_changes_inf_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> length_remdups_adj<span class="main">[</span><span class="operator">of</span> <span class="quoted">poly_neg_inf</span> <span class="quoted"><span class="skolem">s''</span></span><span class="main">,</span> <span class="operator">OF</span> signs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sign_changes_neg_inf <span class="free">ps'</span> <span class="main">=</span> sign_changes_neg_inf <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sign_changes_neg_inf_def <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Root-counting functions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  With all these results, we can now define functions that count roots
  in bounded and unbounded intervals:
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">count_roots_between</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">count_roots_between</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm_squarefree <span class="free"><span class="bound"><span class="entity">p</span></span></span>
    <span class="keyword1">in</span> sign_changes <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">count_roots</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">count_roots</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">::</span>real poly<span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm_squarefree <span class="free"><span class="bound"><span class="entity">p</span></span></span>
    <span class="keyword1">in</span> sign_changes_neg_inf <span class="bound">ps</span> <span class="main">-</span> sign_changes_inf <span class="bound">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">count_roots_above</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">count_roots_above</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">::</span>real poly<span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm_squarefree <span class="free"><span class="bound"><span class="entity">p</span></span></span>
    <span class="keyword1">in</span> sign_changes <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> sign_changes_inf <span class="bound">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">count_roots_below</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">count_roots_below</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">::</span>real poly<span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm_squarefree <span class="free"><span class="bound"><span class="entity">p</span></span></span>
    <span class="keyword1">in</span> sign_changes_neg_inf <span class="bound">ps</span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Sturm_Theorem-count_roots_between_correct"><span class="command">lemma</span></span> count_roots_between_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> False' <span class="main">=</span> this
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> infinite_Ioo<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> subset<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> False' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less card_eq_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> count_roots_between_def Let_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

  <span class="keyword1"><span class="command">from</span></span> sturm_seq_sturm_squarefree<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">interpret</span></span> sturm_seq <span class="quoted"><span class="quoted">"sturm_squarefree <span class="free">p</span>"</span></span> <span class="quoted"><span class="skolem">p'</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> count_roots_between_def Let_def
      <span class="keyword1"><span class="command">using</span></span> True count_roots_between<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-count_roots_correct"><span class="command">lemma</span></span> count_roots_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"count_roots <span class="free">p</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> card <span class="var">?S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..&lt;</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> infinite_Ioo<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_def True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

  <span class="keyword1"><span class="command">from</span></span> sturm_seq_sturm_squarefree<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">interpret</span></span> sturm_seq <span class="quoted"><span class="quoted">"sturm_squarefree <span class="free">p</span>"</span></span> <span class="quoted"><span class="skolem">p'</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> count_roots<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count_roots <span class="free">p</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> count_roots_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-count_roots_above_correct"><span class="command">lemma</span></span> count_roots_above_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"count_roots_above <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
         <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> card <span class="var">?S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> infinite_Ioo subset_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_above_def True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

  <span class="keyword1"><span class="command">from</span></span> sturm_seq_sturm_squarefree<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">interpret</span></span> sturm_seq <span class="quoted"><span class="quoted">"sturm_squarefree <span class="free">p</span>"</span></span> <span class="quoted"><span class="skolem">p'</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> count_roots_above<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count_roots_above <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> count_roots_above_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-count_roots_below_correct"><span class="command">lemma</span></span> count_roots_below_correct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"count_roots_below <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
         <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> card <span class="var">?S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> finite_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> infinite_Ioo subset_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_below_def True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="free">p</span> <span class="keyword1">div</span> <span class="main">(</span>gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span>

  <span class="keyword1"><span class="command">from</span></span> sturm_seq_sturm_squarefree<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">interpret</span></span> sturm_seq <span class="quoted"><span class="quoted">"sturm_squarefree <span class="free">p</span>"</span></span> <span class="quoted"><span class="skolem">p'</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> count_roots_below<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count_roots_below <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> count_roots_below_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> poly_div_gcd_squarefree<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="skolem">p'</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The optimisation explained above can be used to prove more efficient code equations that
  use the more efficient construction in the case that the interval borders are not
  multiple roots:
›</span></span>

<span class="keyword1" id="Sturm_Theorem-count_roots_between"><span class="command">lemma</span></span> count_roots_between<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">q</span> <span class="main">=</span> pderiv <span class="free">p</span>
       <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span>
       <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="bound">q</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>poly <span class="free">p</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="bound">q</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>
            <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm <span class="free">p</span>
                   <span class="keyword1">in</span> sign_changes <span class="bound">ps</span> <span class="free">a</span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="free">b</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm_squarefree <span class="free">p</span>
                   <span class="keyword1">in</span> sign_changes <span class="bound">ps</span> <span class="free">a</span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_between_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> False1 <span class="main">=</span> this
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span>poly <span class="free">p</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def count_roots_between_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            B<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sturm_seq_sturm_squarefree'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">interpret</span></span> sturm_seq <span class="quoted"><span class="quoted">"sturm_squarefree' <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sturm_squarefree'_def Let_def d_def <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">note</span></span> count_roots_between_correct
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
                 <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> poly_div_gcd_squarefree<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> count_roots_between<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>›</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sturm_sturm_squarefree'_same_sign_changes<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sturm_sturm_squarefree'_same_sign_changes<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> B<span class="main">]</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Sturm_Theorem-count_roots_code"><span class="command">lemma</span></span> count_roots_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"count_roots <span class="main">(</span><span class="free">p</span><span class="main">::</span>real poly<span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span>
     <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm <span class="free">p</span>
           <span class="keyword1">in</span> sign_changes_neg_inf <span class="bound">ps</span> <span class="main">-</span> sign_changes_inf <span class="bound">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_def<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sturm_seq_sturm_squarefree'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">interpret</span></span> sturm_seq <span class="quoted"><span class="quoted">"sturm_squarefree' <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sturm_squarefree'_def Let_def d_def <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">note</span></span> count_roots_correct
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> poly_div_gcd_squarefree<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> count_roots<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sturm_sturm_squarefree'_same_sign_changes<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sturm_sturm_squarefree'_same_sign_changes<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Sturm_Theorem-count_roots_above_code"><span class="command">lemma</span></span> count_roots_above_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"count_roots_above <span class="free">p</span> <span class="free">a</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">q</span> <span class="main">=</span> pderiv <span class="free">p</span>
       <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span>
       <span class="keyword1">else</span> <span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="bound">q</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>
            <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm <span class="free">p</span>
                   <span class="keyword1">in</span> sign_changes <span class="bound">ps</span> <span class="free">a</span> <span class="main">-</span> sign_changes_inf <span class="bound">ps</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm_squarefree <span class="free">p</span>
                   <span class="keyword1">in</span> sign_changes <span class="bound">ps</span> <span class="free">a</span> <span class="main">-</span> sign_changes_inf <span class="bound">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_above_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> False1 <span class="main">=</span> this
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def count_roots_above_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sturm_seq_sturm_squarefree'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">interpret</span></span> sturm_seq <span class="quoted"><span class="quoted">"sturm_squarefree' <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sturm_squarefree'_def Let_def d_def <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">note</span></span> count_roots_above_correct
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
                 <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> poly_div_gcd_squarefree<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> count_roots_above<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sturm_sturm_squarefree'_same_sign_changes<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sturm_sturm_squarefree'_same_sign_changes<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Theorem-count_roots_below_code"><span class="command">lemma</span></span> count_roots_below_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"count_roots_below <span class="free">p</span> <span class="free">a</span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">q</span> <span class="main">=</span> pderiv <span class="free">p</span>
       <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span>
       <span class="keyword1">else</span> <span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="bound">q</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>
            <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm <span class="free">p</span>
                   <span class="keyword1">in</span> sign_changes_neg_inf <span class="bound">ps</span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="free">a</span><span class="main">)</span>
            <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ps</span> <span class="main">=</span> sturm_squarefree <span class="free">p</span>
                   <span class="keyword1">in</span> sign_changes_neg_inf <span class="bound">ps</span> <span class="main">-</span> sign_changes <span class="bound">ps</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_below_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> False1 <span class="main">=</span> this
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def count_roots_below_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> gcd <span class="free">p</span> <span class="main">(</span>pderiv <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> poly_div_gcd_squarefree<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sturm_seq_sturm_squarefree'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">interpret</span></span> sturm_seq <span class="quoted"><span class="quoted">"sturm_squarefree' <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sturm_squarefree'_def Let_def d_def <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">note</span></span> count_roots_below_correct
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
                 <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="main">(</span><span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> d_def <span class="keyword1"><span class="command">using</span></span> poly_div_gcd_squarefree<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> count_roots_below<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="keyword1">div</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sturm_sturm_squarefree'_same_sign_changes<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> sturm_sturm_squarefree'_same_sign_changes<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sturm_Method">
<div class="head">
<h1>Theory Sturm_Method</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The ``sturm'' proof method›</span></span>

<span class="comment1">(* Author: Manuel Eberl &lt;eberlm@in.tum.de&gt; *)</span>
<span class="keyword1"><span class="command">theory</span></span> Sturm_Method
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Sturm_Theorem.html">Sturm_Theorem</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminary lemmas›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this subsection, we prove lemmas that reduce root counting and
  related statements to simple, computable expressions using the 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"count_roots"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function family.
›</span></span>

<span class="keyword1" id="Sturm_Method-poly_card_roots_less_leq"><span class="command">lemma</span></span> poly_card_roots_less_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_between_correct<span class="main">)</span>

<span class="keyword1" id="Sturm_Method-poly_card_roots_leq_leq"><span class="command">lemma</span></span> poly_card_roots_leq_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> 
       <span class="main">(</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">+</span> 
      <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> False' <span class="main">=</span> this
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> False' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> 
               <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_card_roots_less_leq False' 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..</span><span class="free">b</span><span class="main">}</span>"</span></span>
             <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> True False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_eq_0_iff infinite_Ioc infinite_Icc<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> True False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> count_roots_between_correct <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> True' <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> True' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> poly_roots_finite<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
        insert <span class="free">a</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
           Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True count_roots_between_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Method-poly_card_roots_less_less"><span class="command">lemma</span></span> poly_card_roots_less_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> 
      <span class="main">(</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">-</span>
              <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> False' <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span>
                     <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> True False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_eq_0_iff infinite_Ioo infinite_Ioc<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> True False' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> count_roots_between_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> False' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> 
                          <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_card_roots_less_leq False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> poly_roots_finite
        <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
        insert <span class="free">b</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
           card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> count_roots_between_correct<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Method-poly_card_roots_leq_less"><span class="command">lemma</span></span> poly_card_roots_leq_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
      <span class="main">(</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">+</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">-</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">≥</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> True' <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">b</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">&lt;..</span><span class="free">b</span><span class="main">}</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> True False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_eq_0_iff infinite_Ico infinite_Ioc<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False True' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_between_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> True' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> 
                          <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> poly_card_roots_less_leq True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> CD_if<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> False poly_roots_finite 
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?D</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="var">?B</span> <span class="main">∪</span> <span class="var">?D</span><span class="main">)</span> <span class="main">-</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?A</span> <span class="main">=</span> card <span class="var">?B</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">-</span>
                       <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> CD_if<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> count_roots_between_correct<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Method-poly_card_roots"><span class="command">lemma</span></span> poly_card_roots<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> count_roots <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> count_roots_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Sturm_Method-poly_no_roots"><span class="command">lemma</span></span> poly_no_roots<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots <span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> count_roots_correct <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span>

<span class="keyword1" id="Sturm_Method-poly_pos"><span class="command">lemma</span></span> poly_pos<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span> 
        <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> count_roots <span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Let_def poly_pos poly_no_roots<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1" id="Sturm_Method-poly_card_roots_greater"><span class="command">lemma</span></span> poly_card_roots_greater<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> count_roots_above <span class="free">p</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> count_roots_above_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Sturm_Method-poly_card_roots_leq"><span class="command">lemma</span></span> poly_card_roots_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> count_roots_below <span class="free">p</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> count_roots_below_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Sturm_Method-poly_card_roots_geq"><span class="command">lemma</span></span> poly_card_roots_geq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span>
      count_roots_above <span class="free">p</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> infinite_Ioo less_add_one<span class="main">)</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
                      <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">+</span><span class="main">1</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> infinite_Ioo<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_card_roots_greater<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_roots_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> 
                       insert <span class="free">a</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> 
                         Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> card_insert_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_card_roots_greater<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Method-poly_card_roots_less"><span class="command">lemma</span></span> poly_card_roots_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
       <span class="main">(</span>count_roots_below <span class="free">p</span> <span class="free">a</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> infinite_Ioo diff_add_cancel less_add_one<span class="main">)</span> 
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
                     <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">&lt;..&lt;</span><span class="free">a</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> infinite_Ioo<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_card_roots_leq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_roots_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> 
                       insert <span class="free">a</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>
                     <span class="main">(</span>card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> card_insert_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> count_roots_below_correct<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Sturm_Method-poly_no_roots_less_leq"><span class="command">lemma</span></span> poly_no_roots_less_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> count_roots_between_correct card_eq_0_iff not_le 
           <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span>

<span class="keyword1" id="Sturm_Method-poly_pos_between_less_leq"><span class="command">lemma</span></span> poly_pos_between_less_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_pos_between_less_leq Let_def 
                 poly_no_roots_less_leq<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1" id="Sturm_Method-poly_no_roots_leq_leq"><span class="command">lemma</span></span> poly_no_roots_leq_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> iffI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_between_correct card_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">=</span> <span class="free">a</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_roots_between_correct card_eq_0_iff
            <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sturm_Method-poly_pos_between_leq_leq"><span class="command">lemma</span></span> poly_pos_between_leq_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> 
   <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> 
                count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_pos_between_leq_leq Let_def poly_no_roots_leq_leq<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>



<span class="keyword1" id="Sturm_Method-poly_no_roots_less_less"><span class="command">lemma</span></span> poly_no_roots_less_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> 
   <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> 
       <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> A<span class="main">:</span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">b</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dense<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span>
                <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span>
                <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span>
                 card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">+</span>
                <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> count_roots_between_correct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> card_Un_disjoint<span class="main"><span class="keyword3">,</span></span> 
             <span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ poly_roots_finite<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 2
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_card_roots_less_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> count_roots_between_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> card_eq_0_iff<span class="main"><span class="keyword3">,</span></span> 
            <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Method-poly_pos_between_less_less"><span class="command">lemma</span></span> poly_pos_between_less_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> 
       count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_pos_between_less_less Let_def 
                 poly_no_roots_less_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Sturm_Method-poly_no_roots_leq_less"><span class="command">lemma</span></span> poly_no_roots_leq_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> 
       <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> poly_no_roots_less_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 2
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> 
               <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems <span class="keyword1"><span class="command">unfolding</span></span> Let_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> poly_no_roots_less_less<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> Let_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Method-poly_pos_between_leq_less"><span class="command">lemma</span></span> poly_pos_between_leq_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> 
   <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> count_roots_between <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> 
        <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_pos_between_leq_less Let_def 
                poly_no_roots_leq_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>


<span class="keyword1" id="Sturm_Method-poly_no_roots_greater"><span class="command">lemma</span></span> poly_no_roots_greater<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
       <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_above <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> gt_ex<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> count_roots_above_correct card_eq_0_iff
                        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_roots_finite <span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Method-poly_pos_greater"><span class="command">lemma</span></span> poly_pos_greater<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>
       <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> count_roots_above <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poly_pos_greater<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> poly_no_roots_greater<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>

<span class="keyword1" id="Sturm_Method-poly_no_roots_leq"><span class="command">lemma</span></span> poly_no_roots_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> 
       <span class="main">(</span> <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_below <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def count_roots_below_correct card_eq_0_iff
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span>

<span class="keyword1" id="Sturm_Method-poly_pos_leq"><span class="command">lemma</span></span> poly_pos_leq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> 
   <span class="main">(</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> count_roots_below <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_pos_leq Let_def poly_no_roots_leq<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>



<span class="keyword1" id="Sturm_Method-poly_no_roots_geq"><span class="command">lemma</span></span> poly_no_roots_geq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
       <span class="main">(</span> <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_above <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&gt;</span><span class="free">a</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> poly_no_roots_greater<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 2
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_above <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> poly_no_roots_greater<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> Let_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Method-poly_pos_geq"><span class="command">lemma</span></span> poly_pos_geq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_above <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_pos_geq Let_def poly_no_roots_geq<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Sturm_Method-poly_no_roots_less"><span class="command">lemma</span></span> poly_no_roots_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
       <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> count_roots_below <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 1
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lt_ex<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> count_roots_below_correct<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> 2
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">∪</span> 
            <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"count_roots_below <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">+</span>
            <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> count_roots_below_correct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> card_Un_disjoint<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> card_eq_0_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> poly_roots_finite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sturm_Method-poly_pos_less"><span class="command">lemma</span></span> poly_pos_less<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟶</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span>
   <span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly_neg_inf <span class="free">p</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> count_roots_below <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> 
       <span class="main">(</span><span class="keyword1">if</span> poly <span class="free">p</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> poly_pos_less Let_def poly_no_roots_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemmas</span></span> sturm_card_substs <span class="main">=</span> poly_card_roots poly_card_roots_less_leq 
    poly_card_roots_leq_less poly_card_roots_less_less poly_card_roots_leq_leq
    poly_card_roots_less poly_card_roots_leq poly_card_roots_greater
    poly_card_roots_geq 

<span class="keyword1"><span class="command">lemmas</span></span> sturm_prop_substs <span class="main">=</span> poly_no_roots poly_no_roots_less_leq 
    poly_no_roots_leq_leq poly_no_roots_less_less poly_no_roots_leq_less
    poly_no_roots_leq poly_no_roots_less poly_no_roots_geq 
    poly_no_roots_greater
    poly_pos poly_pos_greater poly_pos_geq poly_pos_less poly_pos_leq
    poly_pos_between_leq_less poly_pos_between_less_leq
    poly_pos_between_leq_leq poly_pos_between_less_less


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reification›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This subsection defines a number of equations to automatically convert 
  statements about roots of polynomials into a canonical form so that they 
  can be proven using the above substitutions.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PR_TAG</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Sturm_Method-sturm_id_PR_prio0"><span class="command">lemma</span></span> sturm_id_PR_prio0<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>PR_TAG <span class="free">P</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">¬</span><span class="main">(</span>PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PR_TAG_def<span class="main">)</span>

<span class="keyword1" id="Sturm_Method-sturm_id_PR_prio1"><span class="command">lemma</span></span> sturm_id_PR_prio1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span>PR_TAG <span class="free">P</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span>PR_TAG <span class="free">P</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span>PR_TAG <span class="free">P</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span>PR_TAG <span class="free">P</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">&lt;</span> <span class="free">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">&lt;</span> <span class="free">a</span><span class="main">.</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">≤</span> <span class="free">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">≤</span> <span class="free">a</span><span class="main">.</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">&gt;</span> <span class="free">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">&gt;</span> <span class="free">a</span><span class="main">.</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">≥</span> <span class="free">a</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">≥</span> <span class="free">a</span><span class="main">.</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">&lt;</span> <span class="free">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">&lt;</span> <span class="free">a</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">&gt;</span> <span class="free">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">&gt;</span> <span class="free">a</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">≤</span> <span class="free">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">≤</span> <span class="free">a</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">≥</span> <span class="free">a</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">::</span>real <span class="main">≥</span> <span class="free">a</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PR_TAG_def<span class="main">)</span>

<span class="keyword1" id="Sturm_Method-sturm_id_PR_prio2"><span class="command">lemma</span></span> sturm_id_PR_prio2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> 
       <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> PR_TAG <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> 
       <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> PR_TAG <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> 
       <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> PR_TAG <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> 
       <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∧</span> PR_TAG <span class="free">P</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span>PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span>PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span>PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span>PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PR_TAG_def<span class="main">)</span>



<span class="keyword1" id="Sturm_Method-PR_TAG_intro_prio0"><span class="command">lemma</span></span> PR_TAG_intro_prio0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">P</span> <span class="main">=</span> <span class="free">P'</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">¬</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P'</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>PR_TAG <span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> PR_TAG <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>gcd <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
 <span class="quoted"><span class="quoted">" <span class="main">⟦</span>PR_TAG <span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span> PR_TAG <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>

  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> PR_TAG <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> PR_TAG <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> PR_TAG <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">q</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> PR_TAG <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">q</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>

  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> PR_TAG <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span><span class="main">+</span><span class="free">q</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> PR_TAG <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> PR_TAG <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">q</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">[:</span><span class="free">a</span><span class="main">:]</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PR_TAG_def poly_eq_0_iff_dvd <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>


<span class="keyword1" id="Sturm_Method-PR_TAG_intro_prio1"><span class="command">lemma</span></span> PR_TAG_intro_prio1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≠</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> 
       PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> 
       PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span><span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> 
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>smult <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> 
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>smult <span class="free">a</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span> 
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>smult <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>monom <span class="main">1</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PR_TAG_def <span class="dynamic"><span class="dynamic">field_simps</span></span> poly_monom<span class="main">)</span>

<span class="keyword1" id="Sturm_Method-PR_TAG_intro_prio2"><span class="command">lemma</span></span> PR_TAG_intro_prio2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">/</span> <span class="free">b</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>monom <span class="main">(</span><span class="free">a</span><span class="main">/</span><span class="free">b</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="free">a</span> <span class="main">/</span> <span class="free">b</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>monom <span class="main">(</span><span class="free">a</span><span class="main">/</span><span class="free">b</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>monom <span class="free">a</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="free">a</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>monom <span class="free">a</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="free">n</span> <span class="main">/</span> <span class="free">a</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="main">(</span>monom <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="comment1">(* TODO: can this be done more efficiently? I should think so. *)</span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">^</span><span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span>Suc <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span>Suc <span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>
       <span class="main">⟹</span> PR_TAG <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">m</span> <span class="main">*</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PR_TAG_def <span class="dynamic"><span class="dynamic">field_simps</span></span> poly_monom power_add<span class="main">)</span>

<span class="keyword1" id="Sturm_Method-sturm_meta_spec"><span class="command">lemma</span></span> sturm_meta_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="Sturm_Method-sturm_imp_conv"><span class="command">lemma</span></span> sturm_imp_conv<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Setup for the ``sturm'' method›</span></span>

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">‹sturm.ML›</span>

<span class="keyword1"><span class="command">method_setup</span></span> sturm <span class="main">=</span> <span class="quoted">‹
  Scan.succeed <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="entity">SIMPLE_METHOD'</span> <span class="main">(</span><span class="entity">Sturm.sturm_tac</span> <span class="entity">ctxt</span> true<span class="main">)</span><span class="main">)</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="files/sturm.ML">
<div class="head">
<h1>File ‹sturm.ML›</h1>
</div>
<pre class="source">
<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">STURM</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> sturm_conv <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> conv
  <span class="keyword1"><span class="keyword">val</span></span> sturm_tac <span class="main">:</span>  <span class="entity">Proof.context</span> <span class="main">-&gt;</span> bool <span class="main">-&gt;</span> int <span class="main">-&gt;</span> tactic
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Sturm</span> <span class="main">:</span> <span class="entity">STURM</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sturm_conv</span> <span class="entity">ctxt</span> <span class="main">=</span> <span class="entity">Code_Runtime.dynamic_holds_conv</span> <span class="entity">ctxt</span> <span class="comment1">(* FIXME prefer static converson? *)</span>
<span class="comment1">(*    [@{const_name count_roots_between}, @{const_name count_roots},
     @{const_name count_roots_above},@{const_name count_roots_below},
     @{const_name Trueprop}, @{const_name Rat.of_int}, 
     @{const_name Power.power_class.power},
     @{const_name Real.ord_real_inst.less_eq_real},
     @{const_name Real.ord_real_inst.less_real},
     @{const_name Num.nat_of_num}]*)</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sturm_id_thmss</span> <span class="main">=</span> <span class="main">[</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> sturm_id_PR_prio2<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> sturm_id_PR_prio1<span class="antiquote">}</span></span></span><span class="main">,</span> 
          <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> sturm_id_PR_prio0<span class="antiquote">}</span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sturm_PR_tag_intro_thmss</span> <span class="main">=</span> <span class="main">[</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> PR_TAG_intro_prio2<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> PR_TAG_intro_prio1<span class="antiquote">}</span></span></span><span class="main">,</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> PR_TAG_intro_prio0<span class="antiquote">}</span></span></span><span class="main">]</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">extract_PR_tags</span> <span class="main">(</span><span class="entity">t</span> <span class="keyword1"><span class="keyword">as</span></span> <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> PR_TAG<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">t</span> :: <span class="entity">acc</span>
    <span class="main">|</span> <span class="entity">extract_PR_tags</span> <span class="main">(</span><span class="entity">s</span> $ <span class="entity">t</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">extract_PR_tags</span> <span class="entity">s</span> <span class="main">(</span><span class="entity">extract_PR_tags</span> <span class="entity">t</span> <span class="entity">acc</span><span class="main">)</span>
    <span class="main">|</span> <span class="entity">extract_PR_tags</span> <span class="main">(</span>Abs <span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="main">_</span><span class="main">,</span><span class="entity">t</span><span class="main">)</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">extract_PR_tags</span> <span class="entity">t</span> <span class="entity">acc</span>
    <span class="main">|</span> <span class="entity">extract_PR_tags</span> <span class="main">_</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">acc</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sturm_preprocess_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">subst_tac</span> <span class="entity">thms</span> <span class="main">=</span> <span class="entity">EqSubst.eqsubst_tac</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="inner_numeral">1</span><span class="main">]</span> <span class="entity">thms</span> <span class="entity">i</span>
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">process_PR_tag_tac</span> <span class="entity">thm</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">trms</span> <span class="main">=</span> <span class="entity">extract_PR_tags</span> <span class="main">(</span>Thm.prop_of <span class="entity">thm</span><span class="main">)</span> <span class="main">[</span><span class="main">]</span>
              <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">tac</span> <span class="entity">trm</span> <span class="main">=</span> 
                <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">subst</span> <span class="main">=</span> Thm.reflexive <span class="main">(</span>Thm.cterm_of <span class="entity">ctxt</span> <span class="entity">trm</span><span class="main">)</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> HOL.meta_eq_to_obj_eq<span class="antiquote">}</span></span></span>
                    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">subst</span> <span class="main">=</span> <span class="entity">subst</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> HOL.trans<span class="antiquote">}</span></span></span>
                    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">subst</span> <span class="main">=</span> <span class="entity">subst</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> HOL.ssubst<span class="antiquote">}</span></span></span>
                <span class="keyword2"><span class="keyword">in</span></span>  TRY <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">subst</span><span class="main">]</span> <span class="entity">i</span>
                    THEN REPEAT_ALL_NEW <span class="main">(</span>FIRST' <span class="main">(</span>map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thms</span> <span class="main">=&gt;</span> 
                             DETERM o resolve_tac <span class="entity">ctxt</span> <span class="entity">thms</span><span class="main">)</span> <span class="entity">sturm_PR_tag_intro_thmss</span><span class="main">)</span><span class="main">)</span> <span class="entity">i</span><span class="main">)</span>
                <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
          <span class="keyword2"><span class="keyword">in</span></span>  EVERY <span class="main">(</span>map <span class="entity">tac</span> <span class="entity">trms</span><span class="main">)</span> <span class="entity">thm</span>
          <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>  FIRST <span class="main">(</span>map <span class="entity">subst_tac</span> <span class="entity">sturm_id_thmss</span><span class="main">)</span>
        THEN REPEAT <span class="main">(</span><span class="entity">subst_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> HOL.nnf_simps<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>5<span class="main">)</span> not_less not_le<span class="antiquote">}</span></span></span><span class="main">)</span>
        THEN <span class="entity">process_PR_tag_tac</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">find_sturm_card_eq_thm</span> <span class="entity">ctxt</span> <span class="entity">s</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy</span> <span class="main">=</span> Proof_Context.theory_of <span class="entity">ctxt</span>
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">matches</span> <span class="entity">thm</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">case</span></span> Thm.concl_of <span class="entity">thm</span> <span class="keyword2"><span class="keyword">of</span></span>
            Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Trueprop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> HOL.eq<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ 
                <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Finite_Set.card<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">s'</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span>
              <span class="main">=&gt;</span> Pattern.matches <span class="entity">thy</span> <span class="main">(</span><span class="entity">s'</span><span class="main">,</span><span class="entity">s</span><span class="main">)</span>
          <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> 
              <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> warning <span class="main">(</span><span class="inner_quoted">"Invalid theorem in "</span> ^
                          <span class="inner_quoted">"sturm_card_eq_substs: \n"</span> ^ Pretty.string_of <span class="main">(</span>
                            Syntax.pretty_term <span class="entity">ctxt</span> <span class="main">(</span>Thm.concl_of <span class="entity">thm</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
               <span class="keyword2"><span class="keyword">in</span></span> false
              <span class="keyword2"><span class="keyword">end</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm</span> <span class="main">=</span> find_first <span class="entity">matches</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> sturm_card_substs<span class="antiquote">}</span></span></span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
        <span class="entity">thm</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sturm_card_eq_instantiate_tac</span> <span class="entity">ctxt</span> <span class="main">_</span> <span class="entity">thm</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> Thm.prems_of <span class="entity">thm</span> <span class="keyword2"><span class="keyword">of</span></span> <span class="entity">p</span> :: <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">p</span> <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> Thm.concl_of <span class="entity">thm</span>  <span class="comment1">(* FIXME tactic must not access main conclusion *)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.prop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
                                <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.conjunction<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ 
                                    <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.term<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
                                 <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">lhs</span><span class="main">,</span><span class="entity">rhs</span><span class="main">)</span> <span class="main">=</span> <span class="entity">prop</span> |&gt; <span class="entity">HOLogic.dest_Trueprop</span> |&gt; <span class="entity">HOLogic.dest_eq</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">vars</span> <span class="main">=</span> Term.add_vars <span class="entity">rhs</span> <span class="main">[</span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">in</span></span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">vars</span> <span class="keyword2"><span class="keyword">of</span></span>
          <span class="main">[</span><span class="entity">v</span><span class="main">]</span> <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">idxname</span><span class="main">,</span><span class="entity">ty</span><span class="main">)</span> <span class="main">=</span> <span class="entity">v</span>
                      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">n</span> <span class="main">=</span> <span class="entity">Code_Evaluation.dynamic_value</span> <span class="entity">ctxt</span> <span class="entity">lhs</span>  <span class="comment1">(* FIXME prefer static converson? *)</span>
                  <span class="keyword2"><span class="keyword">in</span></span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">n</span> <span class="keyword2"><span class="keyword">of</span></span>
                     NONE <span class="main">=&gt;</span> Seq.empty
                   <span class="main">|</span> SOME <span class="entity">n</span> <span class="main">=&gt;</span> 
                       <span class="comment1">(* FIXME fragile term as string composition *)</span>
                       <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">n'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">ty</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">nat</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span> <span class="inner_quoted">""</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">"%_. "</span><span class="main">)</span> ^ Int.toString <span class="main">(</span>snd <span class="main">(</span><span class="entity">HOLogic.dest_number</span> <span class="entity">n</span><span class="main">)</span><span class="main">)</span>
                       <span class="keyword2"><span class="keyword">in</span></span>  Seq.single <span class="main">(</span><span class="entity">Rule_Insts.read_instantiate</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="main">(</span><span class="main">(</span><span class="entity">idxname</span><span class="main">,</span> Position.none<span class="main">)</span><span class="main">,</span> <span class="entity">n'</span><span class="main">)</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="entity">thm</span><span class="main">)</span>
                       <span class="keyword2"><span class="keyword">end</span></span>
                  <span class="keyword2"><span class="keyword">end</span></span>
        <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> Seq.single <span class="entity">thm</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
    

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sturm_card_eq_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span> <span class="entity">thm</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> Thm.prems_of <span class="entity">thm</span> <span class="keyword2"><span class="keyword">of</span></span> <span class="entity">p</span> :: <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">p</span> <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> Thm.concl_of <span class="entity">thm</span> <span class="comment1">(* FIXME tactic must not access main conclusion *)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.prop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
                                <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.conjunction<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ 
                                    <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.term<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
                                 <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">s</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span>
                        Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Trueprop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $
                        <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> HOL.eq<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ 
                          <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Finite_Set.card<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">s</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span>
                        <span class="main">=&gt;</span> <span class="entity">s</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm'</span> <span class="main">=</span> <span class="entity">find_sturm_card_eq_thm</span> <span class="entity">ctxt</span> <span class="entity">s</span>
    <span class="keyword2"><span class="keyword">in</span></span>  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">thm'</span> <span class="keyword2"><span class="keyword">of</span></span>
          NONE <span class="main">=&gt;</span> Seq.empty
        <span class="main">|</span>  SOME <span class="entity">thm''</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">EqSubst.eqsubst_tac</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="inner_numeral">1</span><span class="main">]</span> <span class="main">[</span><span class="entity">thm''</span><span class="main">]</span> <span class="entity">i</span>
                          THEN <span class="entity">sturm_card_eq_instantiate_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span> <span class="entity">thm</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">find_sturm_prop_thm</span> <span class="entity">ctxt</span> <span class="entity">prop</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy</span> <span class="main">=</span> Proof_Context.theory_of <span class="entity">ctxt</span>
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">matches</span> <span class="entity">thm</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">case</span></span> Thm.concl_of <span class="entity">thm</span> <span class="keyword2"><span class="keyword">of</span></span>
            Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Trueprop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> HOL.eq<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop'</span> $ <span class="main">_</span><span class="main">)</span>
              <span class="main">=&gt;</span> Pattern.matches <span class="entity">thy</span> <span class="main">(</span><span class="entity">prop'</span><span class="main">,</span><span class="entity">prop</span><span class="main">)</span>
          <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> 
              <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> warning <span class="main">(</span><span class="inner_quoted">"Invalid theorem in "</span> ^
                          <span class="inner_quoted">"sturm_prop_substs: \n"</span> ^ Pretty.string_of <span class="main">(</span>
                            Syntax.pretty_term <span class="entity">ctxt</span> <span class="main">(</span>Thm.concl_of <span class="entity">thm</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
               <span class="keyword2"><span class="keyword">in</span></span> false
              <span class="keyword2"><span class="keyword">end</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm</span> <span class="main">=</span> find_first <span class="entity">matches</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> sturm_prop_substs<span class="antiquote">}</span></span></span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
        <span class="entity">thm</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sturm_prop_tac</span> <span class="entity">ctxt</span> <span class="entity">i</span> <span class="entity">thm</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> Thm.prems_of <span class="entity">thm</span> <span class="keyword2"><span class="keyword">of</span></span> <span class="entity">p</span> :: <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">p</span> <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> Thm.concl_of <span class="entity">thm</span> <span class="comment1">(* FIXME tactic must not access main conclusion *)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.prop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
                                 <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.conjunction<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ 
                                    <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.term<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
                                 <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Trueprop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
                                 <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm'</span> <span class="main">=</span> <span class="entity">find_sturm_prop_thm</span> <span class="entity">ctxt</span> <span class="entity">prop</span>
    <span class="keyword2"><span class="keyword">in</span></span>  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">thm'</span> <span class="keyword2"><span class="keyword">of</span></span>
          NONE <span class="main">=&gt;</span> Seq.empty
        <span class="main">|</span> SOME <span class="entity">thm'</span> <span class="main">=&gt;</span> <span class="entity">EqSubst.eqsubst_tac</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="inner_numeral">1</span><span class="main">]</span> <span class="main">[</span><span class="entity">thm'</span><span class="main">]</span> <span class="entity">i</span> <span class="entity">thm</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sturm_main_tac</span> <span class="entity">ctxt</span> <span class="entity">keep_goal</span> <span class="entity">i</span> <span class="entity">thm</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> Thm.prems_of <span class="entity">thm</span> <span class="keyword2"><span class="keyword">of</span></span> <span class="entity">p</span> :: <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">p</span> <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> Thm.concl_of <span class="entity">thm</span> <span class="comment1">(* FIXME tactic must not access main conclusion *)</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.prop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
                               <span class="main">|</span> <span class="main">_</span>  <span class="main">=&gt;</span> <span class="entity">prop</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.conjunction<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ 
                                    <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Pure.term<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span> $ <span class="entity">prop</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
                                 <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">prop</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tac</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">prop</span> <span class="keyword2"><span class="keyword">of</span></span>
                Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Trueprop<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $
                  <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> HOL.eq<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ 
                    <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Finite_Set.card<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span><span class="main">)</span> 
                  <span class="main">=&gt;</span> <span class="entity">sturm_card_eq_tac</span>
              <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">sturm_prop_tac</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>  <span class="main">(</span><span class="main">(</span><span class="entity">tac</span> <span class="entity">ctxt</span> <span class="entity">i</span>
         THEN CONVERSION <span class="main">(</span><span class="entity">sturm_conv</span> <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">i</span>
         THEN resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> TrueI<span class="antiquote">}</span></span></span> <span class="entity">i</span>
        <span class="main">)</span> ORELSE <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">keep_goal</span> <span class="keyword2"><span class="keyword">then</span></span> all_tac <span class="keyword2"><span class="keyword">else</span></span> no_tac<span class="main">)</span><span class="main">)</span> <span class="entity">thm</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">convert_meta_spec_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> SUBGOAL <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">goal</span><span class="main">,</span> <span class="entity">i</span><span class="main">)</span> <span class="main">=&gt;</span>
      <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">frees</span> <span class="main">=</span> Term.add_frees <span class="entity">goal</span> <span class="main">[</span><span class="main">]</span>  <span class="comment1">(* FIXME !? *)</span>
      <span class="keyword2"><span class="keyword">in</span></span> <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">frees</span> <span class="keyword2"><span class="keyword">of</span></span>
           <span class="main">[</span><span class="main">_</span><span class="main">]</span> <span class="main">=&gt;</span>
                <span class="keyword2"><span class="keyword">let</span></span>
                  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">goal'</span> <span class="main">=</span> Logic.close_form <span class="entity">goal</span>
                  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">rule</span> <span class="main">=</span> Goal.prove <span class="entity">ctxt</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="main">(</span>Logic.mk_implies <span class="main">(</span><span class="entity">goal'</span><span class="main">,</span> <span class="entity">goal</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span>
                     dresolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> sturm_meta_spec<span class="antiquote">}</span></span></span> <span class="entity">i</span> THEN assume_tac <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span>
                <span class="keyword2"><span class="keyword">in</span></span> resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">rule</span><span class="main">]</span> <span class="entity">i</span> <span class="keyword2"><span class="keyword">end</span></span>
         <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> no_tac
      <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">sturm_tac</span> <span class="entity">ctxt</span> <span class="entity">keep_goal</span> <span class="main">=</span> SELECT_GOAL
       <span class="main">(</span>prune_params_tac <span class="entity">ctxt</span>
        THEN TRY <span class="main">(</span>Object_Logic.full_atomize_tac <span class="entity">ctxt</span> <span class="inner_numeral">1</span><span class="main">)</span>
        THEN TRY <span class="main">(</span><span class="entity">EqSubst.eqsubst_tac</span> <span class="entity">ctxt</span> <span class="main">[</span><span class="inner_numeral">1</span><span class="main">]</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> sturm_imp_conv<span class="antiquote">}</span></span></span> <span class="inner_numeral">1</span><span class="main">)</span>
        THEN TRY <span class="main">(</span><span class="entity">convert_meta_spec_tac</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span><span class="main">)</span>
        THEN TRY <span class="main">(</span>Object_Logic.full_atomize_tac <span class="entity">ctxt</span> <span class="inner_numeral">1</span><span class="main">)</span>
        THEN <span class="entity">sturm_preprocess_tac</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span>
        THEN <span class="entity">sturm_main_tac</span> <span class="entity">ctxt</span> <span class="entity">keep_goal</span> <span class="inner_numeral">1</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
</pre>
</div><div id="Sturm">
<div class="head">
<h1>Theory Sturm</h1>
</div>
<pre class="source"><span class="comment1">(*
  Title: A Formalisation of Sturm's Theorem 
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt; 
  Maintainer: Manuel Eberl &lt;eberlm@in.tum.de&gt; 
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Sturm
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Sturm_Method.html">Sturm_Method</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Sturm_Ex">
<div class="head">
<h1>Theory Sturm_Ex</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Example usage of the ``sturm'' method›</span></span>
<span class="comment1">(* Author: Manuel Eberl &lt;eberlm@in.tum.de&gt; *)</span>
<span class="keyword1"><span class="command">theory</span></span> Sturm_Ex
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="Sturm.html">../Sturm</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we give a variety of statements about real polynomials that can b
  proven by the \emph{sturm} method.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">*</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">schematic_goal</span></span> A<span class="main">:</span>
<span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">-</span><span class="numeral">0.010831</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="numeral">0.010831</span> <span class="main">∧</span> 
    <span class="main">1</span><span class="main">/</span><span class="numeral">120</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">5</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="numeral">24</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="numeral">6</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">49</span><span class="main">/</span><span class="numeral">16777216</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">17</span><span class="main">/</span><span class="numeral">2097152</span><span class="main">*</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> 
  <span class="main">=</span> <span class="var">?n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">6</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">11</span><span class="main">*</span><span class="bound">x</span> <span class="main">=</span> <span class="numeral">6</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>


<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">6</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">11</span><span class="main">*</span><span class="bound">x</span> <span class="main">=</span> <span class="numeral">6</span><span class="main">}</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">-</span><span class="numeral">0.010831</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="numeral">0.010831</span> <span class="main">∧</span> 
     poly <span class="main">[:</span><span class="main">0</span><span class="main">,</span> <span class="main">-</span><span class="numeral">17</span><span class="main">/</span><span class="numeral">2097152</span><span class="main">,</span> <span class="main">-</span><span class="numeral">49</span><span class="main">/</span><span class="numeral">16777216</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span><span class="numeral">6</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span><span class="numeral">24</span><span class="main">,</span> <span class="main">1</span><span class="main">/</span><span class="numeral">120</span><span class="main">:]</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">*</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="bound">x</span><span class="main">*</span><span class="bound">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≠</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span><span class="main">*</span><span class="free">x</span><span class="main">+</span><span class="main">1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹3 examples related to continued fraction approximants to exp: LCP›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">7.29347719</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">^</span><span class="numeral">5</span> <span class="main">+</span> <span class="numeral">30</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">420</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="numeral">3360</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">15120</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">30240</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">^</span><span class="numeral">6</span> <span class="main">+</span> <span class="numeral">42</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">5</span> <span class="main">+</span> <span class="numeral">840</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">10080</span><span class="main">*</span><span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="numeral">75600</span><span class="main">*</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">332640</span><span class="main">*</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">665280</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">7</span> <span class="main">+</span> <span class="numeral">56</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">6</span> <span class="main">+</span> <span class="numeral">1512</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">5</span> <span class="main">+</span> <span class="numeral">25200</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">277200</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="numeral">1995840</span><span class="main">*</span><span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">8648640</span><span class="main">*</span><span class="bound">x</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">17297280</span><span class="main">}</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">sturm</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>