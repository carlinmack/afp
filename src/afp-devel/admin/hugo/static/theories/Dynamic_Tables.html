<div id="Tables_real">
<div class="head">
<h1>Theory Tables_real</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Tables_real
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Amortized_Complexity/Amortized_Framework0.html">Amortized_Complexity.Amortized_Framework0</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Final version with l :: real *)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Ψ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Ψ</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> of_nat_Suc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> of_nat_diff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An automatic proof:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Psi_diff_Ins<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">d</span> <span class="main">⟹</span> Ψ <span class="free">b</span> <span class="free">i</span> <span class="free">d</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">-</span> Ψ <span class="free">b</span> <span class="free">i</span> <span class="free">d</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span> <span class="main">≤</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mono <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ψ <span class="free">b</span> <span class="free">i</span> <span class="free">d</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> Ψ <span class="free">b</span> <span class="free">i</span> <span class="free">d</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">n</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">b</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">i</span> <span class="main">+</span> <span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">n</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Psi_diff_Del<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ψ <span class="free">b</span> <span class="free">i</span> <span class="free">d</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="free">n</span><span class="main">-</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> Ψ <span class="free">b</span> <span class="free">i</span> <span class="free">d</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">-</span> <span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> real <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">b</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">d</span> <span class="main">+</span> <span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="comment1">(* by (simp add: algebra_simps) *)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">d</span> <span class="main">+</span> <span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n</span> <span class="main">&gt;</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="free">d</span><span class="main">*</span><span class="main">(</span><span class="free">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">i</span><span class="main">*</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">x<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n</span> <span class="main">≥</span> <span class="free">x<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> Table0 <span class="main">=</span> 
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f1</span> <span class="free">f2</span> <span class="free">f1'</span> <span class="free">f2'</span> <span class="free">e</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span>
<span class="keyword2"><span class="keyword">assumes</span></span> e1<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> c1<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1cf2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="free">c</span> <span class="main">&lt;</span> <span class="free">f2</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1f2e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">&lt;</span> <span class="free">f2</span><span class="main">/</span><span class="free">e</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span> <span class="main">=</span> min <span class="main">(</span><span class="free">f1</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">f2</span><span class="main">/</span><span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f2'_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2'</span> <span class="main">=</span> max <span class="main">(</span><span class="free">f1</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">f2</span><span class="main">/</span><span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f2<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">f2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1f2e zero_less_divide_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f2</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> f2'<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">f2'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f2'_def max_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f2'_less_f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2'</span> <span class="main">&lt;</span> <span class="free">f2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1cf2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f2'_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f1_less_f1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">&lt;</span> <span class="free">f1'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1f2e <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1'_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f1'_gr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1_less_f1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1"><span class="command">lemma</span></span> f1'_le_f2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span> <span class="main">≤</span> <span class="free">f2'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1'_def f2'_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f1'c_le_f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">/</span><span class="free">c</span> <span class="main">≤</span> <span class="free">f1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1'_def min_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f2_le_f2'e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2</span> <span class="main">≤</span> <span class="free">f2'</span><span class="main">*</span><span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f2'_def max_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f1f2'c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">≤</span> <span class="free">f2'</span><span class="main">/</span><span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1f2e <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f2'_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f1'ef2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span> <span class="main">*</span> <span class="free">e</span> <span class="main">≤</span> <span class="free">f2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1cf2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1'_def <span class="dynamic"><span class="dynamic">field_simps</span></span> min_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> Table <span class="main">=</span> Table0 <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l0</span> <span class="main">::</span> <span class="quoted">real</span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0f2e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0f1c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f1</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f2f2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1'f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">f1'</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ai</span> <span class="main">=</span> <span class="free">f2</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">-</span><span class="free">f2'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ad</span> <span class="main">=</span> <span class="free">f1</span><span class="main">/</span><span class="main">(</span><span class="free">f1'</span><span class="main">-</span><span class="free">f1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aigr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ai <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f2'_less_f2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ai_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> adgr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ad <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1_less_f1' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ad_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l0_gr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> l0f2e
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f1_l0<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="free">l</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="main">(</span><span class="free">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f1</span><span class="main">*</span><span class="free">l</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="free">f1</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="free">c</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f1</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> l0f1c
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_le_cancel<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nxt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"op<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>b</sub> <span class="main">⇒</span> nat<span class="main">*</span>real <span class="main">⇒</span> nat<span class="main">*</span>real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nxt</span> Ins <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">else</span> <span class="free">e</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nxt</span> Del <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">if</span> <span class="free">f1</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≤</span> real<span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">l0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"op<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>b</sub> <span class="main">⇒</span> nat<span class="main">*</span>real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">T</span> Ins <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">T</span> Del <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f1</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≤</span> real<span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">l0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">*</span> real <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Φ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="free">f2'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> ai<span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="free">f2'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="free">f1'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∧</span> <span class="free">l0</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span> <span class="keyword1">then</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Phi_Psi<span class="main">:</span> <span class="quoted"><span class="quoted">"Φ <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">=</span> Ψ <span class="main">(</span><span class="free">l0</span> <span class="main">≤</span> <span class="free">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> ai ad <span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">(</span><span class="free">f2'</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">invar</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">invar</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≥</span> <span class="free">l0</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span> <span class="main">≥</span> <span class="free">l0</span> <span class="main">⟶</span> <span class="free">f1</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">f</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">f</span> <span class="keyword1">of</span> Ins <span class="main">⇒</span> ai<span class="main">+</span><span class="main">1</span> <span class="main">|</span> Del <span class="main">⇒</span> ad<span class="main">+</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> tb<span class="main">:</span> Amortized
  <span class="keyword2"><span class="keyword">where</span></span> init <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">l0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nxt <span class="main">=</span> <span class="quoted">nxt</span>
  <span class="keyword2"><span class="keyword">and</span></span> inv <span class="main">=</span> <span class="quoted">invar</span>
  <span class="keyword2"><span class="keyword">and</span></span> T <span class="main">=</span> <span class="quoted">T</span> <span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">Φ</span>
  <span class="keyword2"><span class="keyword">and</span></span> U <span class="main">=</span> <span class="quoted">U</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Ins
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="free">e</span> <span class="main">&lt;</span> <span class="free">f2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1f2e <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> l0f2e
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span>›</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">l</span><span class="main">*</span><span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span> <span class="main">*</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span><span class="main">≤</span><span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">with</span></span> 0 f1 f2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Del
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> real <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> real <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span><span class="main">/</span><span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1_l0<span class="main">[</span><span class="operator">OF</span> l<span class="main">]</span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1cf2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> l 0 f1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span><span class="main">/</span><span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">s</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> not_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">s</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Ins
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Φ.simps Ψ.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Phi_Psi Psi_diff_Ins<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> order_refl <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">≥</span><span class="free">l0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">-</span><span class="free">f2'</span>"</span></span><span class="main">]</span> f2'_less_f2 f2f2'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> Phi<span class="main">:</span> <span class="quoted"><span class="quoted">"Φ <span class="skolem">s</span> <span class="main">=</span> ai <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1'ef2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">-</span> ai<span class="main">*</span><span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ai <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2'</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">-</span> ai<span class="main">*</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Phi <span class="quoted"><span class="quoted">‹<span class="free">f1'</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ai<span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> ai<span class="main">+</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2'</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ai<span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="free">e</span> <span class="main">+</span> <span class="free">f2'</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ai<span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Phi
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2_le_f2'e <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ai<span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2'_less_f2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ai_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Del
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">∨</span> <span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">&lt;</span> <span class="free">l0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1'_le_f2'
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Φ.simps Ψ.simps <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Phi_Psi Psi_diff_Del<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">∨</span> <span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">&lt;</span> <span class="free">l0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="free">l0</span><span class="main">*</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 5
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1f2'c <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1'_le_f2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f1'</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> order_refl <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">≥</span><span class="free">l0</span><span class="main">*</span><span class="free">c</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">-</span><span class="free">f1</span>"</span></span><span class="main">]</span> f1_less_f1' f1'f1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> Phi<span class="main">:</span> <span class="quoted"><span class="quoted">"Φ <span class="skolem">s</span> <span class="main">=</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">-</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ad"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">∧</span> <span class="skolem">l</span><span class="main">/</span><span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Φ <span class="main">(</span>nxt <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Phi <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">/</span><span class="free">c</span> <span class="main">-</span> <span class="free">f1'</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ad"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> f1'c_le_f1
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">∧</span> <span class="skolem">l</span><span class="main">/</span><span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">≥</span> <span class="free">l0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Φ <span class="main">(</span>nxt <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Phi
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> ad"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ad"</span></span> <span class="keyword1"><span class="command">using</span></span> f1_less_f1' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ad_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> Optimal <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f2</span> <span class="free">c</span> <span class="free">e</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">l0</span> <span class="main">::</span> <span class="quoted">nat</span>
<span class="keyword2"><span class="keyword">assumes</span></span> e1<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> c1<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">*</span><span class="main">(</span>min <span class="free">e</span> <span class="free">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">l0</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> l0e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">l0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2</span> <span class="main">*</span> <span class="main">(</span><span class="free">l0</span> <span class="main">*</span> min <span class="free">e</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">f2</span> <span class="main">*</span> <span class="free">l0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def <span class="dynamic"><span class="dynamic">ac_simps</span></span> mult_right_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> l0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> l0c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">l0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2</span> <span class="main">*</span> <span class="main">(</span><span class="free">l0</span> <span class="main">*</span> min <span class="free">e</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">f2</span> <span class="main">*</span> <span class="free">l0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def <span class="dynamic"><span class="dynamic">ac_simps</span></span> mult_right_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> l0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> Table
<span class="keyword2"><span class="keyword">where</span></span> f1<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">/</span><span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">=</span><span class="quoted"><span class="free">f2</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">=</span><span class="quoted"><span class="free">e</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">=</span><span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword">and</span></span> f1'<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">/</span><span class="free">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2'<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">/</span><span class="free">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">=</span><span class="quoted"><span class="free">l0</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> e1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> c1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 7 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> l0e less_1_mult<span class="main">[</span><span class="operator">OF</span> c1 e1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> l0c <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 10 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">*</span><span class="free">e</span><span class="main">&gt;</span><span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> l0e <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 11 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">*</span><span class="free">e</span><span class="main">&gt;</span><span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> l0c
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> pos_le_divide_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ai <span class="main">=</span> <span class="free">e</span><span class="main">/</span><span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ai_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ad <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ad_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> I1<span class="main">:</span> Optimal <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">=</span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">=</span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">=</span><span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">=</span><span class="quoted"><span class="numeral">4</span></span> <span class="comment1">(* f1=1/4 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">interpretation</span></span> I2<span class="main">:</span> Optimal <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">=</span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">=</span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">=</span><span class="quoted"><span class="numeral">6</span></span> <span class="comment1">(* f1=3/16 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">interpretation</span></span> I3<span class="main">:</span> Optimal <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">=</span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">=</span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="numeral">0.8</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">=</span><span class="quoted"><span class="numeral">5</span></span> <span class="comment1">(* f1=1/5 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">interpretation</span></span> I4<span class="main">:</span> Optimal <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">=</span><span class="quoted"><span class="numeral">3</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">=</span><span class="quoted"><span class="numeral">3</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="numeral">0.9</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">=</span><span class="quoted"><span class="numeral">5</span></span> <span class="comment1">(* f1=1/10 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">interpretation</span></span> I5<span class="main">:</span> Optimal <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">=</span><span class="quoted"><span class="numeral">4</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">=</span><span class="quoted"><span class="numeral">4</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">=</span><span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">=</span><span class="quoted"><span class="numeral">6</span></span> <span class="comment1">(* f1=1/16 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">interpretation</span></span> I6<span class="main">:</span> Optimal <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="numeral">2.5</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="numeral">2.5</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">=</span><span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">=</span><span class="quoted"><span class="numeral">5</span></span> <span class="comment1">(* f1=4/25 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">interpretation</span></span> I7<span class="main">:</span> Optimal <span class="keyword2"><span class="keyword">where</span></span> f2<span class="main">=</span><span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">=</span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">=</span><span class="quoted"><span class="numeral">6</span></span> <span class="comment1">(* f1=1/3 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> I8<span class="main">:</span> Optimal <span class="keyword2"><span class="keyword">where</span></span> f2<span class="main">=</span><span class="quoted"><span class="main">1</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">=</span><span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword">and</span></span> l0<span class="main">=</span><span class="quoted"><span class="numeral">6</span></span> <span class="comment1">(* f1=1/3 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tables_nat">
<div class="head">
<h1>Theory Tables_nat</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Tables_nat
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Tables_real.html">Tables_real</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> le_of_int_ceiling<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="comment1">(* MOVE *)</span>

<span class="comment1">(* Final version with l :: nat in fully localized form, no duplication *)</span>

<span class="keyword1"><span class="command">locale</span></span> TableInv <span class="main">=</span> Table0 <span class="quoted"><span class="free">f1</span></span> <span class="quoted"><span class="free">f2</span></span> <span class="quoted"><span class="free">f1'</span></span> <span class="quoted"><span class="free">f2'</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">c</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f1</span> <span class="free">f2</span> <span class="free">f1'</span> <span class="free">f2'</span> <span class="free">e</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">l0</span> <span class="main">::</span> <span class="quoted">nat</span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0f2e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0f1c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f1</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">assumes</span></span> l0f2f1e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="free">f1</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f1</span><span class="main">*</span><span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0f2f1c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="free">f2</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f1</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> l0_gr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> l0f2e
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f1_l0<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="free">l</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="main">(</span><span class="free">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f1</span><span class="main">*</span><span class="free">l</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="free">f1</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="free">c</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f1</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1'_le_f2' f2'_less_f2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> l0f1c
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">*</span><span class="free">l0</span> <span class="main">≤</span> <span class="free">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_le_cancel<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nxt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"op<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>b</sub> <span class="main">⇒</span> nat<span class="main">*</span>nat <span class="main">⇒</span> nat<span class="main">*</span>nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nxt</span> Ins <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">else</span> nat<span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">⌉</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">nxt</span> Del <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span>
 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="keyword1">if</span> <span class="free">f1</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≤</span> real<span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">l0</span> <span class="main">≤</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="keyword1">then</span> nat<span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"op<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>b</sub> <span class="main">⇒</span> nat<span class="main">*</span>nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">T</span> Ins <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">T</span> Del <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f1</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≤</span> real<span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free">l0</span> <span class="main">≤</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">*</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">invar</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≥</span> <span class="free">l0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≥</span> <span class="free">l0</span> <span class="main">⟶</span> <span class="free">f1</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> invar_init<span class="main">:</span> <span class="quoted"><span class="quoted">"invar <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">l0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_floor_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> invar_pres<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"invar <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"invar<span class="main">(</span>nxt <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Ins
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">*</span> <span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">≤</span> <span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">*</span> <span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">≤</span> <span class="free">f1</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f1</span><span class="main">*</span><span class="free">e</span><span class="main">)</span><span class="main">*</span><span class="free">l0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> l0f2f1e f1f2e <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span>›</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1f2e<span class="main">[</span><span class="operator">simplified</span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">ac_simps</span></span> mult_left_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> l0f2e
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span>›</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="free">e</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="free">e</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span><span class="main">≤</span><span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">with</span></span> 0 f1 f2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Del
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">*</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≤</span> <span class="free">f1</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> times_divide_eq_right<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l' f1_l0<span class="main">[</span><span class="operator">OF</span> l'<span class="main">]</span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_floor_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span> <span class="main">*</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">-</span> <span class="free">f2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f1</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">*</span><span class="free">l0</span> <span class="main">≥</span> <span class="free">f2</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> l0f2f1c f1cf2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> mult_left_mono<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span><span class="main">/</span><span class="free">c</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">-</span><span class="free">f1</span><span class="main">*</span><span class="free">c</span>"</span></span><span class="main">]</span> f1cf2
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f1</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span> <span class="main">≥</span> <span class="free">f2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
              <span class="keyword1"><span class="command">from</span></span> mult_left_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">f2</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> l 0 f1 <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">l0</span> <span class="main">≤</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> 0 assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> Table1 <span class="main">=</span> TableInv <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f2f2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1'f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">f1'</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ai</span> <span class="main">=</span> <span class="free">f2</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">-</span><span class="free">f2'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ad</span> <span class="main">=</span> <span class="free">f1</span><span class="main">/</span><span class="main">(</span><span class="free">f1'</span><span class="main">-</span><span class="free">f1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> aigr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ai <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f2'_less_f2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ai_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> adgr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ad <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1_less_f1' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ad_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f1'ad<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span>ad <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> f2'ai<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2'</span><span class="main">*</span>ai <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">*</span> nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Φ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="free">f2'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> ai<span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="free">f2'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="free">f1'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∧</span> <span class="free">l0</span> <span class="main">≤</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="keyword1">then</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Phi_Psi<span class="main">:</span> <span class="quoted"><span class="quoted">"Φ <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">=</span> Ψ <span class="main">(</span><span class="free">l0</span> <span class="main">≤</span> <span class="main">⌊</span><span class="free">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span><span class="main">)</span> ai ad <span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">(</span><span class="free">f2'</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">f</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">f</span> <span class="keyword1">of</span> Ins <span class="main">⇒</span> ai<span class="main">+</span><span class="main">1</span> <span class="main">+</span> <span class="free">f1'</span><span class="main">*</span>ad <span class="main">|</span> Del <span class="main">⇒</span> ad<span class="main">+</span><span class="main">1</span> <span class="main">+</span> <span class="free">f2'</span><span class="main">*</span>ai"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> tb<span class="main">:</span> Amortized
  <span class="keyword2"><span class="keyword">where</span></span> init <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">l0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nxt <span class="main">=</span> <span class="quoted">nxt</span>
  <span class="keyword2"><span class="keyword">and</span></span> inv <span class="main">=</span> <span class="quoted">invar</span>
  <span class="keyword2"><span class="keyword">and</span></span> T <span class="main">=</span> <span class="quoted">T</span> <span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">Φ</span>
  <span class="keyword2"><span class="keyword">and</span></span> U <span class="main">=</span> <span class="quoted">U</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> invar_init<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> invar_pres<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">s</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> mult_le_0_iff le_floor_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">s</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Ins
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> ai<span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Φ.simps Ψ.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Phi_Psi Psi_diff_Ins<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> order_refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">l0</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">-</span><span class="free">f2'</span>"</span></span><span class="main">]</span> f2'_less_f2 f2f2'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> Phi<span class="main">:</span> <span class="quoted"><span class="quoted">"Φ <span class="skolem">s</span> <span class="main">=</span> ai <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.order_iff_strict<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">-</span> ai<span class="main">*</span><span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ai <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="free">f1'</span><span class="main">*</span>ad"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> f2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2'</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f1'</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span><span class="main">-</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> ai<span class="main">*</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Phi f2' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f1'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">≤</span> <span class="free">f1'</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">f1'</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> <span class="free">f1'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1'ef2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">+</span>ad<span class="main">*</span><span class="free">f1'</span><span class="main">-</span>ai<span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span>ai<span class="main">*</span><span class="main">(</span><span class="main">-</span>real<span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span><span class="main">+</span>ai<span class="main">+</span><span class="free">f1'</span><span class="main">*</span>ad<span class="main">+</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>real<span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> <span class="comment1">(* f1'*ad *)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f1'</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">-</span> ai<span class="main">*</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Phi f2' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span>ai<span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span>ai<span class="main">*</span><span class="main">(</span><span class="main">-</span>real<span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span><span class="main">+</span>ai<span class="main">+</span><span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>real<span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span>ai<span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">f2</span><span class="main">*</span><span class="skolem">l</span><span class="main">+</span><span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span><span class="main">+</span>ai<span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="var">?R</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2'</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ai<span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">+</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> ai<span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Phi
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2_le_f2'e <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span>ai<span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">f2</span><span class="main">*</span><span class="skolem">l</span><span class="main">+</span><span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span><span class="main">+</span>ai<span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ai<span class="main">+</span><span class="free">f1'</span><span class="main">*</span>ad<span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2'_less_f2
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ai_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Del
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">∨</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">&lt;</span> <span class="free">l0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> ad<span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1'_le_f2'
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Φ.simps Ψ.simps <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Phi_Psi Psi_diff_Del<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">∨</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">&lt;</span> <span class="free">l0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1'_le_f2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f1'</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> order_refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">l0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">-</span><span class="free">f1</span>"</span></span><span class="main">]</span>
          lc f1_less_f1' f1'f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> Phi<span class="main">:</span> <span class="quoted"><span class="quoted">"Φ <span class="skolem">s</span> <span class="main">=</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2'</span><span class="main">*</span><span class="skolem">l</span>›</span></span> lc <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">-</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ad <span class="main">+</span> <span class="free">f2'</span><span class="main">*</span>ai"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?R</span> <span class="main">+</span> <span class="main">_</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> f2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2'</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1'</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">∧</span> <span class="main">⌊</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Φ <span class="main">(</span>nxt <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2' n lc' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Phi n lc' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≤</span> <span class="skolem">l</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">/</span><span class="free">c</span><span class="main">-</span><span class="free">f1'</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span><span class="main">+</span>ad"</span></span>
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> f1'c_le_f1
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1'</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">∧</span> <span class="main">⌊</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≥</span> <span class="free">l0</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Φ <span class="main">(</span>nxt <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2' n lc' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Phi n lc'
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> ad"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> f2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2'</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ai<span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span><span class="main">)</span> <span class="main">-</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Phi n lc' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≤</span> <span class="free">f2'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2'</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1f2'c <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2'</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">≤</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span>ai<span class="main">*</span><span class="free">f2'</span><span class="main">-</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="free">f1'</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> ad <span class="main">+</span> <span class="free">f2'</span><span class="main">*</span>ai"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ad <span class="main">+</span> <span class="free">f2'</span><span class="main">*</span>ai"</span></span> <span class="keyword1"><span class="command">using</span></span> f1_less_f1' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ad_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> Table2_f1f2'' <span class="main">=</span> TableInv <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f1''</span> <span class="free">f2''</span> <span class="main">::</span> <span class="quoted">real</span>

<span class="keyword1"><span class="command">locale</span></span> Table2 <span class="main">=</span> Table2_f1f2'' <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f2f2''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2''</span><span class="main">)</span><span class="main">*</span><span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1''f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f1''</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">*</span><span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>

<span class="keyword2"><span class="keyword">assumes</span></span> f1_less_f1''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">&lt;</span> <span class="free">f1''</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1''_less_f1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span> <span class="main">&lt;</span> <span class="free">f1'</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f2'_less_f2''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2'</span> <span class="main">&lt;</span> <span class="free">f2''</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f2''_less_f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2''</span> <span class="main">&lt;</span> <span class="free">f2</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1''_f1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≥</span> real <span class="free">l0</span> <span class="main">⟹</span> <span class="free">f1''</span> <span class="main">*</span> <span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f1'</span><span class="main">*</span><span class="free">l</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f2'_f2''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≥</span> real <span class="free">l0</span> <span class="main">⟹</span> <span class="free">f2'</span> <span class="main">*</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">f2''</span> <span class="main">*</span> <span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ai</span> <span class="main">=</span> <span class="free">f2</span> <span class="main">/</span> <span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2''</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ad</span> <span class="main">=</span> <span class="free">f1</span> <span class="main">/</span> <span class="main">(</span><span class="free">f1''</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f1''_gr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1_less_f1'' f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1"><span class="command">lemma</span></span> f2''_gr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f2' f2'_less_f2'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1"><span class="command">lemma</span></span> aigr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ai <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f2''_less_f2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ai_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> adgr0<span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ad <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> f1_less_f1'' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ad_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">Φ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">*</span> nat <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Φ</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≥</span> <span class="free">f2''</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="keyword1">then</span> ai<span class="main">*</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">-</span> <span class="free">f2''</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="keyword1">else</span>
  <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≤</span> <span class="free">f1''</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∧</span> <span class="free">l0</span> <span class="main">≤</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="keyword1">then</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1''</span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Phi_Psi<span class="main">:</span> <span class="quoted"><span class="quoted">"Φ <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">l</span><span class="main">)</span> <span class="main">=</span> Ψ <span class="main">(</span><span class="free">l0</span> <span class="main">≤</span> <span class="main">⌊</span><span class="free">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span><span class="main">)</span> ai ad <span class="main">(</span><span class="free">f1''</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="main">(</span><span class="free">f2''</span><span class="main">*</span><span class="free">l</span><span class="main">)</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">f</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">f</span> <span class="keyword1">of</span> Ins <span class="main">⇒</span> ai<span class="main">+</span><span class="main">1</span> <span class="main">|</span> Del <span class="main">⇒</span> ad<span class="main">+</span><span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> tb<span class="main">:</span> Amortized
  <span class="keyword2"><span class="keyword">where</span></span> init <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">l0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nxt <span class="main">=</span> <span class="quoted">nxt</span>
  <span class="keyword2"><span class="keyword">and</span></span> inv <span class="main">=</span> <span class="quoted">invar</span>
  <span class="keyword2"><span class="keyword">and</span></span> T <span class="main">=</span> <span class="quoted">T</span> <span class="keyword2"><span class="keyword">and</span></span> Φ <span class="main">=</span> <span class="quoted">Φ</span>
  <span class="keyword2"><span class="keyword">and</span></span> U <span class="main">=</span> <span class="quoted">U</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> invar_init<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> invar_pres<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">s</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> mult_le_0_iff le_floor_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">s</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">n</span><span class="main">,</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Ins
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Φ.simps Ψ.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Phi_Psi Psi_diff_Ins<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≤</span> <span class="free">e</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span> <span class="main">≤</span> <span class="skolem">l</span>›</span></span> e1 mult_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">l0</span></span> <span class="quoted"><span class="skolem">l</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2''</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> order_refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">l0</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">-</span><span class="free">f2''</span>"</span></span><span class="main">]</span> f2''_less_f2 f2f2''
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="free">f2''</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> Phi<span class="main">:</span> <span class="quoted"><span class="quoted">"Φ <span class="skolem">s</span> <span class="main">=</span> ai <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f2''</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat <span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span><span class="main">)</span> <span class="main">=</span> real_of_int <span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.order_iff_strict<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">-</span> ai<span class="main">*</span><span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2''</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ai <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">≤</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> f2''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2''</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">≤</span> <span class="free">f1''</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> f1''_f1'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span> <span class="main">≤</span> <span class="free">e</span><span class="main">*</span><span class="skolem">l</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span><span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1'ef2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≤</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">-</span> ai<span class="main">*</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f2''</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Phi f2'' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">-</span>ai<span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="free">f2''</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span>ai<span class="main">*</span><span class="main">(</span><span class="main">-</span>real<span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="free">f2''</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span><span class="main">+</span>ai<span class="main">+</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>real<span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2''</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ai<span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">f2''</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">+</span> <span class="free">f2''</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> ai<span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Phi
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">f2''</span><span class="main">*</span><span class="main">⌈</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span><span class="main">⌉</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2''</span><span class="main">*</span><span class="free">e</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">f2''</span><span class="main">*</span><span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2'_less_f2'' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">f2'</span><span class="main">*</span><span class="free">e</span> <span class="main">≤</span> <span class="main">-</span><span class="free">f2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2_le_f2'e <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span>ai<span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">f2</span><span class="main">*</span><span class="skolem">l</span><span class="main">+</span><span class="free">f2''</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span><span class="main">+</span>ai<span class="main">+</span><span class="main">1</span> <span class="main">≤</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f2</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ai<span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2''_less_f2
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ai_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> Del
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_le_0_iff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">arith</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≠</span><span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">∨</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">&lt;</span> <span class="free">l0</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f1''_less_f1' f1'_le_f2' f2'_less_f2''
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Φ.simps Ψ.simps <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Phi_Psi Psi_diff_Del<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≥</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">∨</span> <span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">&lt;</span> <span class="free">l0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="skolem">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2''</span><span class="main">*</span><span class="skolem">l</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f1''_less_f1' f1'_le_f2' f2'_less_f2'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f1''</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> mult_mono<span class="main">[</span><span class="operator">OF</span> order_refl<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">l0</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span><span class="main">-</span><span class="free">f1</span>"</span></span><span class="main">]</span> lc f1_less_f1'' f1''f1
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> <span class="free">f1''</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> Phi<span class="main">:</span> <span class="quoted"><span class="quoted">"Φ <span class="skolem">s</span> <span class="main">=</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1''</span><span class="main">*</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f1''</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2''</span><span class="main">*</span><span class="skolem">l</span>›</span></span> lc <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">have</span></span> f2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f2''</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">≤</span> <span class="free">f2'</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1f2'c <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> f2'_f2''<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">≥</span><span class="free">l0</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2''</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f2''</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">-</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1''</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ad"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1''</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">∧</span> <span class="main">⌊</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≥</span> <span class="free">l0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Φ <span class="main">(</span>nxt <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1''</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2' n lc' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="free">f1''</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1''</span><span class="main">*</span><span class="skolem">l</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Phi n lc' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≤</span> <span class="skolem">l</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">+</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1''</span><span class="main">*</span><span class="main">(</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">-</span><span class="main">(</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1''</span><span class="main">*</span><span class="skolem">l</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">+</span>ad<span class="main">*</span><span class="main">(</span><span class="free">f1''</span><span class="main">/</span><span class="free">c</span><span class="main">-</span><span class="free">f1''</span><span class="main">)</span><span class="main">*</span><span class="skolem">l</span><span class="main">+</span>ad"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span><span class="main">/</span><span class="free">c</span> <span class="main">≤</span> <span class="free">f1'</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1''_less_f1' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> f1'c_le_f1
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">f1''</span><span class="main">*</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">∧</span> <span class="main">⌊</span><span class="main">⌊</span><span class="skolem">l</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span><span class="main">/</span><span class="free">c</span><span class="main">⌋</span> <span class="main">≥</span> <span class="free">l0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Φ <span class="main">(</span>nxt <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2' n lc' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="free">f1''</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Phi n lc'
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">+</span> ad<span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">-</span> <span class="free">f1''</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="main">+</span> ad"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">f1</span><span class="main">*</span><span class="skolem">l</span> <span class="main">+</span> ad"</span></span> <span class="keyword1"><span class="command">using</span></span> f1_less_f1'' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ad_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">locale</span></span> Table3 <span class="main">=</span> Table2_f1f2'' <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f1''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span> <span class="main">=</span> <span class="main">(</span><span class="free">f1'</span><span class="main">::</span>real<span class="main">)</span><span class="main">*</span><span class="free">l0</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> f2''_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2''</span> <span class="main">=</span> <span class="main">(</span><span class="free">f2'</span><span class="main">::</span>real<span class="main">)</span><span class="main">*</span><span class="free">l0</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="comment1">(* they imply (f2 - f2'')*l0 ≥ 1 and (f1 - f1'')*l0*c ≥ 1 *)</span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0_f2f2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">(</span><span class="free">f2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">-</span><span class="free">f2'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0_f1f1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">≥</span> <span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="free">c</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">f1'</span><span class="main">-</span><span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>

<span class="comment1">(* they imply f1&lt;f1'' and f2'&lt;f2'' and l0 &gt; 1 *)</span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0_f1_f1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">&gt;</span> <span class="free">f1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">f1'</span><span class="main">-</span><span class="free">f1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> l0_f2_f2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">&gt;</span> <span class="free">f2</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">-</span><span class="free">f2'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> l0_gr1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l0</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">-</span><span class="free">f2'</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2'_less_f2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> l0_f2_f2' f2'_less_f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f1''_less_f1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span> <span class="main">&lt;</span> <span class="free">f1'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1''_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f1_less_f1''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f1</span> <span class="main">&lt;</span> <span class="free">f1''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="free">l0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_pos_pos<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span><span class="main">&gt;</span> <span class="free">f1</span> <span class="main">⟷</span> <span class="free">l0</span> <span class="main">&gt;</span> <span class="free">f1</span><span class="main">/</span><span class="main">(</span><span class="main">(</span><span class="free">f1'</span><span class="main">-</span><span class="free">f1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f1_less_f1' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1''_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> l0_f1_f1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f2'_less_f2''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2'</span> <span class="main">&lt;</span> <span class="free">f2''</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> l0_gr1 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f2''_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> f2''_less_f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f2''</span> <span class="main">&lt;</span> <span class="free">f2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2''</span><span class="main">&lt;</span> <span class="free">f2</span> <span class="main">⟷</span> <span class="free">l0</span> <span class="main">&gt;</span> <span class="free">f2</span><span class="main">/</span><span class="main">(</span><span class="free">f2</span><span class="main">-</span><span class="free">f2'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2'_less_f2 l0_gr1 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f2''_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> True"</span></span> <span class="keyword1"><span class="command">using</span></span> l0_f2_f2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* This is the real constraint we want, not l0_f2f2',
   but it involves f2'', which depends on l0 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> f2f2''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2''</span><span class="main">)</span><span class="main">*</span><span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f2</span> <span class="main">-</span> <span class="free">f2''</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l0_gr1 l0_f2f2' f2'_less_f2
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f2''_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f2''_less_f2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* This is the real constraint we want, not l0_f1f1',
   but it involves f1'', which depends on l0 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> f1''f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f1''</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">*</span><span class="free">l0</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">f1'</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">*</span><span class="free">l0</span> <span class="main">-</span> <span class="free">f1'</span><span class="main">*</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l0_f1f1' f1_less_f1'
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f1'</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="free">l0</span><span class="main">)</span> <span class="main">-</span> <span class="free">f1</span><span class="main">)</span><span class="main">*</span><span class="free">c</span><span class="main">*</span><span class="free">l0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="free">l0</span> <span class="main">≤</span> <span class="free">l0</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1'</span><span class="main">*</span><span class="main">(</span><span class="free">l0</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f1'</span><span class="main">*</span><span class="free">l0</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> f1''_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f1''_f1'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≥</span> real <span class="free">l0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span><span class="main">*</span><span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f1'</span> <span class="main">*</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f1''</span><span class="main">*</span><span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">f1'</span><span class="main">*</span><span class="main">(</span><span class="free">l0</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f1''_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l0</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">l</span><span class="main">/</span><span class="main">(</span><span class="free">l</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l0</span> <span class="main">≤</span> <span class="free">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> f2'_f2''<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≥</span> real <span class="free">l0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2'</span> <span class="main">*</span> <span class="free">l</span> <span class="main">≤</span> <span class="free">f2''</span> <span class="main">*</span> <span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2'</span> <span class="main">*</span> <span class="free">l</span> <span class="main">=</span> <span class="free">f2'</span> <span class="main">*</span> <span class="free">l</span> <span class="main">+</span> <span class="free">f2'</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l0_gr1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">l</span><span class="main">≥</span><span class="free">l0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f2'</span><span class="main">*</span><span class="free">l</span> <span class="main">+</span> <span class="free">f2'</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free">l0</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">f2''</span><span class="main">*</span><span class="main">(</span><span class="free">l</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> l0_gr1 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f2''_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">sublocale</span></span> Table2
<span class="keyword1"><span class="command">proof</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> f1_less_f1'' f1''_less_f1' f2'_less_f2'' f2''_less_f2 f1''f1 f2f2'' f1''_f1' f2'_f2''<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>