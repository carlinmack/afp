<div id="Kruskal_Misc">
<div class="head">
<h1>Theory Kruskal_Misc</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Auxilliary Lemmas"</span></span>  
<span class="keyword1"><span class="command">theory</span></span> Kruskal_Misc
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../Collections/Partial_Equivalence_Relation.html">Collections.Partial_Equivalence_Relation</a>"</span>
    <span class="quoted">"<a href="../Automatic_Refinement/Misc.html">Automatic_Refinement.Misc</a>"</span>
    <a href="../Refine_Imperative_HOL/Sepref.html">Refine_Imperative_HOL.Sepref</a>
<span class="keyword2"><span class="keyword">begin</span></span>         
  
<span class="keyword1"><span class="command">lemma</span></span> card2_get2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"card <span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ccontr<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assms  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_cancel Diff_idemp card_1_singletonE insert_not_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> that ax <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Lemmas on equivalence relations"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> equiv_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv <span class="free">V</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equiv_def symD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv <span class="free">V</span> <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">z</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equiv_def transD<span class="main">)</span>
    
<span class="keyword1"><span class="command">lemma</span></span> equiv_trans_sym<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> equiv <span class="free">V</span> <span class="free">R</span><span class="main">;</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span><span class="main">;</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> equiv <span class="free">V</span> <span class="free">R</span><span class="main">;</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span><span class="main">;</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equiv_sym equiv_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> union_equiv<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"equiv <span class="free">V</span> <span class="free">R</span> <span class="main">⟹</span> equiv <span class="free">V</span> <span class="main">(</span>per_union <span class="free">R</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>        
  <span class="keyword1"><span class="command">unfolding</span></span> per_union_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> equiv_def refl_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> symI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> equiv_sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> transI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> equiv_trans equiv_trans_sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  
<span class="keyword1"><span class="command">lemma</span></span> equiv_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E'</span><span class="main">⊆</span><span class="free">E</span> <span class="main">⟹</span> equiv <span class="free">E</span> <span class="free">R1</span> <span class="main">⟹</span> equiv <span class="free">E'</span> <span class="main">(</span><span class="free">R1</span> <span class="main">∩</span> <span class="free">E'</span><span class="main">×</span><span class="free">E'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> equiv_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> refl_on_def subset_iff<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> equiv_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Sigma_iff symI sym_Int<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> equiv_def <span class="keyword1"><span class="command">using</span></span> trans_Restr <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
    

<span class="keyword1"><span class="command">lemma</span></span> unify2EquivClasses_alt<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">≠</span> <span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">⊆</span><span class="free">V</span><span class="main">×</span><span class="free">V</span>"</span></span>    
   <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv <span class="free">V</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">(</span>quotient <span class="free">V</span> <span class="main">(</span>per_union <span class="free">R</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>quotient <span class="free">V</span> <span class="free">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   
  <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> Rtrancl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> equivE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹equiv <span class="free">V</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"per_union <span class="free">R</span> <span class="free">x</span> <span class="free">y</span>"</span></span>  

  <span class="comment1">― ‹ the equivalence classes not contining x and y, stay unchanged when performing <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">per_union</span><span class="antiquote">}</span></span> ›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⟹</span> <span class="bound">z</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">⟹</span> per_union <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">``</span> <span class="main">{</span><span class="bound">z</span><span class="main">}</span> <span class="main">=</span> <span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="bound">z</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sym <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_def per_union_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">V</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">V</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  
  <span class="keyword1"><span class="command">have</span></span> R_respect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span> <span class="main">``</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">respects</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> congruent_def <span class="keyword1"><span class="command">using</span></span> eq equiv_class_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
      
  <span class="keyword1"><span class="command">have</span></span> R'_respect<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">xa</span><span class="main">.</span> <span class="main">{</span><span class="var">?R'</span> <span class="main">``</span> <span class="main">{</span><span class="bound">xa</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">respects</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> congruent_def per_union_def
      <span class="keyword1"><span class="command">using</span></span> eq equiv_class_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span> 

  <span class="comment1">― ‹some facts about the equivalence class of x, before and after the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">per_union</span><span class="antiquote">}</span></span> operation›</span>
  <span class="keyword1"><span class="command">have</span></span> xdrin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> UN_equiv_class<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> UN_equiv_class<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
      
  <span class="comment1">― ‹some facts about the equivalence class of y, before and after the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">per_union</span><span class="antiquote">}</span></span> operation›</span>
  <span class="keyword1"><span class="command">have</span></span> ydrin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> UN_equiv_class<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> UN_equiv_class<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  
  <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">∈</span><span class="var">?R'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> per_union_def <span class="keyword1"><span class="command">using</span></span> sym sym_def
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> eq eq_equiv_class <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> bla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">=</span> <span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> equiv_class_eq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> union_equiv<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
      
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Vm</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">V</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>  

  <span class="comment1">― ‹now consider the set of quotients wrt. the relation after the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">per_union</span><span class="antiquote">}</span></span>›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quotient <span class="free">V</span> <span class="var">?R'</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> quotient_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span>  <span class="comment1">― ‹decompose it into the quotients for elements equivalent to x, y in R, and the rest›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">V</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>
             <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>     
    <span class="keyword1"><span class="command">using</span></span> xdrin ydrin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
  <span class="keyword1"><span class="command">also</span></span>  <span class="comment1">― ‹for the elements equivalent to x and y in R the quotient is 
            the quotient containing x and y respectively ›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">V</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x1 y1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span>  <span class="comment1">― ‹which is after uniting them, the same quotient ›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">V</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> K bla <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> insert <span class="main">(</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="var">?Vm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> leftside<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient <span class="free">V</span> <span class="var">?R'</span> <span class="main">=</span> insert <span class="main">(</span><span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="var">?Vm</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      
  <span class="keyword1"><span class="command">have</span></span> notin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?R'</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">∉</span> <span class="var">?Vm</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_union_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Image_singleton_iff UnI1 assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq equiv_class_self local.sym symE<span class="main">)</span>  
  
  <span class="keyword1"><span class="command">have</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>quotient <span class="free">V</span> <span class="var">?R'</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="var">?Vm</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> leftside <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> card_insert_disjoint<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> notin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
  <span class="comment1">― ‹now consider the set of quotients wrt. the relation before the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">per_union</span><span class="antiquote">}</span></span>›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quotient <span class="free">V</span> <span class="free">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">V</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> quotient_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="comment1">― ‹decompose it into the quotients for elements equivalent to x, y in R, and the rest›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">V</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>
           <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>     
    <span class="keyword1"><span class="command">using</span></span> xdrin ydrin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
  <span class="keyword1"><span class="command">also</span></span> <span class="comment1">― ‹for the elements equivalent to x and y in R the quotient is 
            the quotient containing x and y respectively ›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">V</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x2 y2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="comment1">― ‹ these are two distinct quotients  ›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> insert <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="var">?Vm</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"quotient <span class="free">V</span> <span class="free">R</span> <span class="main">=</span> insert <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="var">?Vm</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      
      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∉</span> <span class="var">?Vm</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>   
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">∉</span> <span class="var">?Vm</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> eq equiv_class_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">∉</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="var">?Vm</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>quotient <span class="free">V</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="main">(</span>insert <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="var">?Vm</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ii<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> card_insert_disjoint<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>insert <span class="main">(</span><span class="free">R</span><span class="main">``</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="var">?Vm</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>card <span class="var">?Vm</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> card_insert_disjoint<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>quotient <span class="free">V</span> <span class="free">R</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>card <span class="var">?Vm</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> a o <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  


  
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"On the pigeon hole principle"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span><span class="main">⇒</span><span class="tfree">'d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">g</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'c</span><span class="main">⇒</span><span class="tfree">'d</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="bound">b</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>  coarser<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≥</span> card <span class="main">(</span><span class="free">g</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">d</span><span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">d</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">term</span></span> <span class="quoted">image</span> 
  <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">y</span></span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">g</span> <span class="bound">x</span><span class="main">}</span> "</span></span> 
     <span class="keyword1"><span class="command">unfolding</span></span> image_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> k  
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">have</span></span> uz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="var">?h</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="var">?h</span> <span class="main">`</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> card_image_le<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> uz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">`</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>  <span class="main">=</span> <span class="free">g</span> <span class="main">`</span> <span class="free">A</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>   
       

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"On sorting and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>max_node›</span></span></span></span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">edges_less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'w</span><span class="main">::</span><span class="main">{</span>linorder<span class="main">,</span> ordered_comm_monoid_add<span class="main">}</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'w</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">edges_less_eq</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> fst<span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">≤</span> fst<span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">sort_edges</span> <span class="main">≡</span> quicksort_by_rel edges_less_eq <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">max_node</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> Max <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>fst<span class="main">`</span>set <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">∪</span> <span class="main">(</span>snd <span class="keyword1">o</span> snd<span class="main">)</span><span class="main">`</span>set <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> max_node_impl<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"max_node <span class="free">l</span> <span class="main">=</span> fold <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">,</span><span class="bound">w</span><span class="main">)</span> <span class="bound">x</span><span class="main">.</span> max <span class="bound">u</span> <span class="main">(</span>max <span class="bound">w</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fold <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">,</span><span class="bound">w</span><span class="main">)</span> <span class="bound">x</span><span class="main">.</span> max <span class="bound">u</span> <span class="main">(</span>max <span class="bound">w</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">l</span> <span class="skolem">a</span> <span class="main">=</span> Max <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>fst<span class="main">`</span>set <span class="free">l</span> <span class="main">∪</span> <span class="main">(</span>snd <span class="keyword1">o</span> snd<span class="main">)</span><span class="main">`</span>set <span class="free">l</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b l aa
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> max_node_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_linorder_rel</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> edges_less_eq_linorder<span class="main">:</span> <span class="quoted"><span class="quoted">"is_linorder_rel edges_less_eq"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> edges_less_eq_def is_linorder_rel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linear order_trans<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> sort_edges_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt edges_less_eq <span class="main">(</span>quicksort_by_rel edges_less_eq <span class="main">[]</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> edges_less_eq_linorder is_linorder_rel_def sorted_wrt_quicksort_by_rel<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_mset_eq<span class="main">:</span><span class="quoted"><span class="quoted">"distinct <span class="free">a</span> <span class="main">⟹</span> mset <span class="free">a</span> <span class="main">=</span> mset <span class="free">b</span> <span class="main">⟹</span> distinct <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_distinct distinct_card set_mset_mset size_mset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quicksort_by_rel_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">l</span> <span class="main">⟹</span> distinct <span class="main">(</span>quicksort_by_rel edges_less_eq <span class="main">[]</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> distinct_mset_eq<span class="main">)</span>

 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"On <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">list_rel</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> map_in_list_rel_conv<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="main">,</span> <span class="free">l'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>br <span class="free">α</span> <span class="free">I</span><span class="main">⟩</span>list_rel <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">l</span><span class="main">.</span> <span class="free">I</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="free">l'</span><span class="main">=</span>map <span class="free">α</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l'</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">l</span> <span class="skolem">l'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">l'</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_br_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> list_relD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>br <span class="free">a</span> <span class="free">I</span><span class="main">⟩</span>list_rel <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> map <span class="free">a</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_in_list_rel_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> list_relD2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>br <span class="free">a</span> <span class="free">I</span><span class="main">⟩</span>list_rel <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> map <span class="free">a</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">x</span><span class="main">.</span> <span class="free">I</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_in_list_rel_conv<span class="main">)</span> 


<span class="keyword1"><span class="command">lemma</span></span> list_set_rel_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">∈</span>br <span class="free">a</span> <span class="free">I</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span><span class="free">S</span><span class="main">)</span><span class="main">∈</span><span class="main">⟨</span>br <span class="free">a</span> <span class="free">I</span><span class="main">⟩</span>list_set_rel <span class="main">⟹</span> <span class="free">s</span><span class="main">∉</span><span class="free">S</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span>insert <span class="free">s</span> <span class="free">S</span><span class="main">)</span><span class="main">∈</span><span class="main">⟨</span>br <span class="free">a</span> <span class="free">I</span><span class="main">⟩</span>list_set_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_set_rel_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> relcompI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"map <span class="free">a</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_br_conv<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">parametricity</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> list_relD <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_br_conv<span class="main">)</span>
 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Auxiliary lemmas for Sepref"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> pure_fold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">c</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span><span class="bound">c</span> <span class="main">=</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pure Id"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemma</span></span> list_assn_emp<span class="main">:</span> <span class="quoted"><span class="quoted">"list_assn id_assn <span class="free">L</span> <span class="free">L</span> <span class="main">=</span> <span class="keyword1">emp</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">L</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pure_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SeprefUF">
<div class="head">
<h1>Theory SeprefUF</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Union Find in Sepref›</span></span>

<span class="keyword1"><span class="command">theory</span></span> SeprefUF
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../Refine_Imperative_HOL/Sepref.html">Refine_Imperative_HOL.Sepref</a> <span class="quoted">"<a href="../Separation_Logic_Imperative_HOL/Union_Find.html">Separation_Logic_Imperative_HOL.Union_Find</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO:  move to sepref/IICF *)</span>

  <span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> per <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">×</span><span class="tfree">'a</span><span class="main">)</span> set"</span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">per_init</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">|</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">per_compare</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">per_init'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat per"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">per_init'</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span> <span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> per_init_of_nat_range<span class="main">:</span> <span class="quoted"><span class="quoted">"per_init <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">}</span> <span class="main">=</span> per_init' <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_init_def per_init'_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> per_init_per<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"part_equiv <span class="main">(</span>per_init <span class="free">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> per_init_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> part_equiv_def sym_def trans_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> per_init_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span>per_init <span class="free">D</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> per_init_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">lemma</span></span> per_union_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span><span class="main">)</span><span class="main">∈</span>per_union <span class="free">R</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_union_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> per_union_related<span class="main">:</span>
    <span class="quoted"><span class="quoted">"part_equiv <span class="free">R</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">∈</span>Domain <span class="free">R</span> <span class="main">⟹</span> <span class="free">b</span><span class="main">∈</span>Domain  <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span>per_union <span class="free">R</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> per_union_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> part_equiv_refl<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> part_equiv_refl'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"part_equiv <span class="free">R</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∈</span>Domain <span class="free">R</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> part_equiv_refl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">R</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">per_supset_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> per <span class="main">×</span> <span class="tfree">'a</span> per<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">per_supset_rel</span>
      <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">p2</span><span class="main">)</span><span class="main">.</span> <span class="bound">p1</span> <span class="main">∩</span> Domain <span class="bound">p2</span> <span class="main">×</span> Domain <span class="bound">p2</span> <span class="main">=</span> <span class="bound">p2</span> <span class="main">∧</span> <span class="bound">p1</span> <span class="main">-</span> <span class="main">(</span>Domain <span class="bound">p2</span> <span class="main">×</span> Domain <span class="bound">p2</span><span class="main">)</span> <span class="main">⊆</span> Id<span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> per_supset_rel_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">∈</span> per_supset_rel <span class="main">⟹</span> Domain <span class="free">p1</span> <span class="main">⊇</span> Domain <span class="free">p2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_supset_rel_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> per_supset_compare<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">∈</span> per_supset_rel <span class="main">⟹</span> <span class="free">x1</span><span class="main">∈</span>Domain <span class="free">p2</span> <span class="main">⟹</span> <span class="free">x2</span><span class="main">∈</span>Domain <span class="free">p2</span> <span class="main">⟹</span> per_compare <span class="free">p1</span> <span class="free">x1</span> <span class="free">x2</span> <span class="main">⟷</span> per_compare <span class="free">p2</span> <span class="free">x1</span> <span class="free">x2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_supset_rel_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> per_supset_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">∈</span> per_supset_rel <span class="main">⟹</span> <span class="free">x1</span><span class="main">∈</span>Domain <span class="free">p2</span> <span class="main">⟹</span> <span class="free">x2</span><span class="main">∈</span>Domain <span class="free">p2</span> <span class="main">⟹</span>
    <span class="main">(</span>per_union <span class="free">p1</span> <span class="free">x1</span> <span class="free">x2</span><span class="main">,</span> per_union <span class="free">p2</span> <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span> <span class="main">∈</span> per_supset_rel"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_supset_rel_def per_union_def Domain_unfold <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> subsetI conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1"><span class="command">sepref_register</span></span> <span class="quoted">per_init</span> <span class="quoted">per_init'</span> <span class="quoted">per_compare</span> <span class="quoted">per_union</span>

  <span class="keyword1"><span class="command">lemma</span></span> per_init_Domain<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Domain <span class="main">(</span>per_init <span class="free">D</span><span class="main">)</span> <span class="main">=</span> <span class="free">D</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_init_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> per_init'_Domain<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Domain <span class="main">(</span>per_init' <span class="free">N</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">&lt;</span><span class="free">N</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_init'_def<span class="main">)</span>


  <span class="keyword1"><span class="command">lemma</span></span> per_init'_sepref_rule<span class="main">[</span><span class="operator">sepref_fr_rules</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uf_init<span class="main">,</span>RETURN <span class="keyword1">o</span> per_init'<span class="main">)</span> <span class="main">∈</span> nat_assn<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>a</sub></span> is_uf"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> per_init'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sepref_to_hoare</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">sep_auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> per_compare_sepref_rule<span class="main">[</span><span class="operator">sepref_fr_rules</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uncurry2 uf_cmp<span class="main">,</span> uncurry2 <span class="main">(</span>RETURN <span class="keyword1">ooo</span> per_compare<span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
    is_uf<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>a</sub></span> bool_assn"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> per_compare_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sepref_to_hoare</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">sep_auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> per_union_sepref_rule<span class="main">[</span><span class="operator">sepref_fr_rules</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uncurry2 uf_union<span class="main">,</span> uncurry2 <span class="main">(</span>RETURN <span class="keyword1">ooo</span> per_union<span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
    <span class="main">[</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">R</span><span class="main">,</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="bound">j</span><span class="main">)</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span>Domain <span class="bound">R</span> <span class="main">∧</span> <span class="bound">j</span><span class="main">∈</span>Domain <span class="bound">R</span> <span class="keyword1">]<span class="hidden">⇩</span><sub>a</sub></span> is_uf<span class="keyword1"><span class="hidden">⇧</span><sup>d</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">*<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="main">→</span> is_uf"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> per_compare_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sepref_to_hoare</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">sep_auto</span>



  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">abs_test</span> <span class="main">≡</span> <span class="keyword1">do</span> <span class="main">{</span>
    <span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> per_init' <span class="main">(</span><span class="numeral">5</span><span class="main">::</span>nat<span class="main">)</span><span class="main">;</span>
    <span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> per_union <span class="bound">u</span> <span class="main">1</span> <span class="numeral">2</span><span class="main">;</span>
    <span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> per_union <span class="bound">u</span> <span class="numeral">2</span> <span class="numeral">3</span><span class="main">;</span>
    RETURN <span class="main">(</span>per_compare <span class="bound">u</span> <span class="main">1</span> <span class="numeral">3</span><span class="main">)</span>
  <span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">sepref_definition</span></span> <span class="entity">abs_test_impl</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"uncurry0 abs_test"</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"unit_assn<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>a</sub></span> bool_assn"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> abs_test_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">sepref</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MinWeightBasis">
<div class="head">
<h1>Theory MinWeightBasis</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Minimum Weight Basis›</span></span>

<span class="keyword1"><span class="command">theory</span></span> MinWeightBasis
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../Refine_Monadic/Refine_Monadic.html">Refine_Monadic.Refine_Monadic</a>"</span> <a href="../Matroids/Matroid.html">Matroids.Matroid</a>    
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For a matroid together with a weight function, assigning each element
  of the carrier set an weight, we construct a greedy algorithm that determines
  a minimum weight basis.›</span></span>

<span class="comment1">(* TODO: consider greedoids instead of matroids as a more
   general class of structures that allow a greedy min weight algorithm *)</span>

<span class="keyword1"><span class="command">locale</span></span> weighted_matroid <span class="main">=</span> matroid <span class="quoted"><span class="free">carrier</span></span> <span class="quoted"><span class="free">indep</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">carrier</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">indep</span>  <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">weight</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>linorder<span class="main">,</span> ordered_comm_monoid_add<span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minBasis</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minBasis</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> basis <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">B'</span><span class="main">.</span> basis <span class="bound">B'</span> <span class="main">⟶</span> sum <span class="free">weight</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≤</span> sum <span class="free">weight</span> <span class="bound">B'</span><span class="main">)</span>"</span></span>

                             
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preparations›</span></span>
     
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">in_sort_edge</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">in_sort_edge</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span>"</span></span> 
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">in_sort_edge</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">weight</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free">weight</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span> <span class="free">in_sort_edge</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span>"</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>in_sort_edge <span class="free">x</span> <span class="free">L</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">x</span> <span class="main">(</span>set <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">L</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> in_sort_edge<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="free">weight</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">e2</span><span class="main">)</span> <span class="free">L</span>
         <span class="main">⟹</span> sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="free">weight</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">(</span>in_sort_edge <span class="free">x</span> <span class="free">L</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">L</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   
<span class="keyword1"><span class="command">lemma</span></span> in_sort_edge_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="free">L</span> <span class="main">⟹</span> distinct <span class="free">L</span> <span class="main">⟹</span> distinct <span class="main">(</span>in_sort_edge <span class="free">x</span> <span class="free">L</span><span class="main">)</span>"</span></span>    
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">L</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
    
<span class="keyword1"><span class="command">lemma</span></span> finite_sorted_edge_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> 
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">L</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="free">weight</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">e2</span><span class="main">)</span> <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> set <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">L</span><span class="main">.</span>  distinct <span class="bound">L</span> <span class="main">∧</span> sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="free">weight</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">L</span> <span class="main">∧</span> <span class="free">S</span> <span class="main">=</span> set <span class="bound">L</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x L <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"in_sort_edge <span class="skolem">x</span> <span class="skolem">L</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_sort_edge in_sort_edge_distinct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>    
    
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">wsorted</span> <span class="main">==</span> sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="free">weight</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">e2</span><span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> sum_list_map_cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="free">weight</span> <span class="main">(</span><span class="free">y</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">weight</span> <span class="free">y</span> <span class="main">+</span> sum_list <span class="main">(</span>map <span class="free">weight</span> <span class="free">ys</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     
<span class="keyword1"><span class="command">lemma</span></span> exists_greater<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">F</span> <span class="main">=</span> length <span class="free">F'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="free">weight</span> <span class="free">F</span><span class="main">)</span> <span class="main">&gt;</span> sum_list <span class="main">(</span>map <span class="free">weight</span> <span class="free">F'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">F</span><span class="main">.</span> <span class="free">weight</span> <span class="main">(</span><span class="free">F</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">weight</span> <span class="main">(</span><span class="free">F'</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> len sum    
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>    
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="free">weight</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">weight</span> <span class="skolem">x</span> <span class="main">⟹</span> sum_list <span class="main">(</span>map <span class="free">weight</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">&lt;</span> sum_list <span class="main">(</span>map <span class="free">weight</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_mono not_less sum_list_map_cons<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>              
    <span class="keyword1"><span class="command">using</span></span> Cons * 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">weight</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="free">weight</span> <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  
  
<span class="keyword1"><span class="command">lemma</span></span> wsorted_nth_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wsorted <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span><span class="main">≤</span><span class="free">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span><span class="main">&lt;</span>length <span class="free">L</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">weight</span> <span class="main">(</span><span class="free">L</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">weight</span> <span class="main">(</span><span class="free">L</span><span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">L</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nth_Cons'<span class="main">)</span> 

    
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Weight restricted set›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹limi T g is the set T restricted  
     to elements only with weight
    strictly smaller than g.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">limi</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">==</span> <span class="main">{</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">∧</span> <span class="free">weight</span> <span class="bound">e</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">}</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> limi_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"limi <span class="free">T</span> <span class="free">g</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> limi_def<span class="main">)</span>  
  
<span class="keyword1"><span class="command">lemma</span></span> limi_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> limi <span class="free">A</span> <span class="free">g</span> <span class="main">⊆</span> limi <span class="free">B</span> <span class="free">g</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> limi_def<span class="main">)</span> 

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The greedy idea›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">no_smallest_element_skipped</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>
   <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="free">carrier</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">g</span></span><span class="main">&gt;</span><span class="free">weight</span> <span class="bound">e</span><span class="main">.</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="main">(</span>limi <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">e</span> <span class="main">∈</span> limi <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span>  <span class="quoted"><span class="plain_text">‹let <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> be a set of elements
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹limi <span class="free"><span class="free">F</span></span> <span class="free"><span class="free">g</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> restricted to elements with weight smaller than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  let <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">E</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> be a set of elements we want to exclude.
    
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹no_smallest_element_skipped <span class="free"><span class="free">E</span></span> <span class="free"><span class="free">F</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> expresses,
     that going greedily over <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">carrier</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">E</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, every element that did not
     render the accumulated set dependent, was added to the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>


<span class="keyword1"><span class="command">lemma</span></span> no_smallest_element_skipped_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"no_smallest_element_skipped <span class="free">carrier</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> no_smallest_element_skipped_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> no_smallest_element_skippedD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"no_smallest_element_skipped <span class="free">E</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span><span class="free">carrier</span> <span class="main">-</span> <span class="free">E</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">weight</span> <span class="free">e</span> <span class="main">&lt;</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">indep</span> <span class="main">(</span>insert <span class="free">e</span> <span class="main">(</span>limi <span class="free">F</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">∈</span> limi <span class="free">F</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> no_smallest_element_skipped_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> no_smallest_element_skipped_skip<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> createsCycle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="free">e</span> <span class="free">F</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span>    I<span class="main">:</span> <span class="quoted"><span class="quoted">"no_smallest_element_skipped <span class="main">(</span><span class="free">E</span><span class="main">∪</span><span class="main">{</span><span class="free">e</span><span class="main">}</span><span class="main">)</span> <span class="free">F</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span>    sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="free">E</span><span class="main">∪</span><span class="main">{</span><span class="free">e</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="free">weight</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_smallest_element_skipped <span class="free">E</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> no_smallest_element_skipped_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">weight</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">(</span>limi <span class="free">F</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> limi <span class="free">F</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">e</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True 
    <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"limi <span class="free">F</span> <span class="skolem">g</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> limi_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">weight</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">g</span>›</span></span> sorted <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    <span class="keyword1"><span class="command">with</span></span> createsCycle f True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> I<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> no_smallest_element_skippedD<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">weight</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">g</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> x f False
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> no_smallest_element_skipped_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"no_smallest_element_skipped <span class="main">(</span><span class="free">E</span><span class="main">∪</span><span class="main">{</span><span class="free">e</span><span class="main">}</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"no_smallest_element_skipped <span class="free">E</span> <span class="main">(</span>insert <span class="free">e</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> no_smallest_element_skipped_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> xc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">carrier</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> wx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">weight</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">(</span>limi <span class="main">(</span>insert <span class="free">e</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">∈</span> limi <span class="main">(</span>insert <span class="free">e</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="free">e</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> limi_def
      <span class="keyword1"><span class="command">using</span></span> wx <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">(</span>limi <span class="free">F</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> indep_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> limi_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">(</span>limi <span class="free">F</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> limi <span class="free">F</span> <span class="skolem">g</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> I<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> no_smallest_element_skippedD<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> False xc wx x <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> ind <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> limi_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>      
<span class="keyword1"><span class="command">qed</span></span>  


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Minimum Weight Basis algorithm›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">obtain_sorted_carrier</span> <span class="main">≡</span> SPEC <span class="main">(</span><span class="main">λ</span><span class="bound">L</span><span class="main">.</span> wsorted <span class="bound">L</span> <span class="main">∧</span> set <span class="bound">L</span> <span class="main">=</span> <span class="free">carrier</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">empty_basis</span> <span class="main">≡</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To compute a minimum weight basis one obtains a list of the carrier set sorted ascendingly
  by the weight function. Then one iterates over the list and adds an elements greedily to 
  the independent set if it does not render the set dependet.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minWeightBasis</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">minWeightBasis</span> <span class="main">≡</span> <span class="keyword1">do</span> <span class="main">{</span>
        <span class="bound">l</span> <span class="main">←</span> obtain_sorted_carrier<span class="main">;</span>
        ASSERT <span class="main">(</span>set <span class="bound">l</span> <span class="main">=</span> <span class="free">carrier</span><span class="main">)</span><span class="main">;</span>
        <span class="bound">T</span> <span class="main">←</span> nfoldli <span class="bound">l</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span> 
        <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="bound">T</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span> 
            ASSERT <span class="main">(</span><span class="free">indep</span> <span class="bound">T</span> <span class="main">∧</span> <span class="bound">e</span><span class="main">∈</span><span class="free">carrier</span> <span class="main">∧</span> <span class="bound">T</span><span class="main">⊆</span><span class="free">carrier</span><span class="main">)</span><span class="main">;</span>
            <span class="keyword1">if</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="bound">T</span><span class="main">)</span> <span class="keyword1">then</span>
              RETURN <span class="main">(</span>insert <span class="bound">e</span> <span class="bound">T</span><span class="main">)</span>
            <span class="keyword1">else</span> 
              RETURN <span class="bound">T</span>
        <span class="main">}</span><span class="main">)</span> empty_basis<span class="main">;</span>
        RETURN <span class="bound">T</span>
      <span class="main">}</span>"</span></span>

 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The heart of the argument›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The algorithmic idea above is correct, as an independent set, which
  is inclusion maximal and has not skipped any smaller element, is a minimum weight basis. ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> greedy_approach_leads_to_minBasis<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> indep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> inclmax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="free">carrier</span> <span class="main">-</span> <span class="free">F</span><span class="main">.</span> <span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"no_smallest_element_skipped <span class="main">{}</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minBasis <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="comment1">― ‹from our assumptions we have that F is a basis›</span>  
  <span class="keyword1"><span class="command">from</span></span> indep inclmax <span class="keyword1"><span class="command">have</span></span> bF<span class="main">:</span> <span class="quoted"><span class="quoted">"basis <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> indep_not_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="comment1">― ‹towards a contradiction, assume F is not a minimum Basis›</span>
  <span class="keyword3"><span class="command">assume</span></span> notmin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> minBasis <span class="free">F</span>"</span></span>    
  <span class="comment1">― ‹then we can get a smaller Basis B›</span>
  <span class="keyword1"><span class="command">from</span></span> bF notmin<span class="main">[</span><span class="operator">unfolded</span> minBasis_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> bB<span class="main">:</span> <span class="quoted"><span class="quoted">"basis <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"sum <span class="free">weight</span> <span class="skolem">B</span> <span class="main">&lt;</span> sum <span class="free">weight</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="comment1">― ‹lets us obtain two sorted lists for the bases F and B›</span>
  <span class="keyword1"><span class="command">from</span></span> bF basis_finite finite_sorted_edge_distinct
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">FL</span></span> <span class="keyword2"><span class="keyword">where</span></span> dF<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">FL</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wF<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wsorted <span class="skolem">FL</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> sF<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> set <span class="skolem">FL</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> bB basis_finite finite_sorted_edge_distinct
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">BL</span></span> <span class="keyword2"><span class="keyword">where</span></span> dB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">BL</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wsorted <span class="skolem">BL</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sB<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> set <span class="skolem">BL</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="comment1">― ‹as basis F has more total weight than basis B (and the basis have the same length) ...›</span>
  <span class="keyword1"><span class="command">from</span></span> sum <span class="keyword1"><span class="command">have</span></span> suml<span class="main">:</span> <span class="quoted"><span class="quoted">"sum_list <span class="main">(</span>map <span class="free">weight</span> <span class="skolem">BL</span><span class="main">)</span> <span class="main">&lt;</span> sum_list <span class="main">(</span>map <span class="free">weight</span> <span class="skolem">FL</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.distinct_set_conv_list<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> bB bF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> card <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> basis_card <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">FL</span> <span class="main">=</span> length <span class="skolem">BL</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_card<span class="main">)</span> 
  <span class="comment1">― ‹... there exists an index i such that the ith element of the BL is strictly smaller 
      than the ith element of FL ›</span>
  <span class="keyword1"><span class="command">from</span></span> exists_greater<span class="main">[</span><span class="operator">OF</span> l suml<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">&lt;</span>length <span class="skolem">FL</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> gr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">weight</span> <span class="main">(</span><span class="skolem">BL</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">weight</span> <span class="main">(</span><span class="skolem">FL</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?FL_restricted</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"limi <span class="main">(</span>set <span class="skolem">FL</span><span class="main">)</span> <span class="main">(</span><span class="free">weight</span> <span class="main">(</span><span class="skolem">FL</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="comment1">― ‹now let us look at the two independent sets X and Y:
        let X and Y be the set if we take the first i-1 elements of BL
         and the first i elements of FL respectively. 
      We want to use the augment property of Matroids in order to show that we must have skipped
      and optimal element, which then contradicts our assumption. ›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="skolem">i</span> <span class="skolem">FL</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> X_size<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="var">?X</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_card<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> X_indep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>set <span class="var">?X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bF
    <span class="keyword1"><span class="command">using</span></span> indep_iff_subset_basis set_take_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">BL</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Y_size<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="var">?Y</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i l
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_card<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Y_indep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>set <span class="var">?Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bB
    <span class="keyword1"><span class="command">using</span></span> indep_iff_subset_basis set_take_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="var">?X</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>set <span class="var">?Y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> X_size Y_size <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="comment1">― ‹X and Y are independent and X is smaller than Y, thus we can augment X with some element x›</span>
  <span class="keyword1"><span class="command">with</span></span> Y_indep X_indep                                 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">BL</span><span class="main">)</span> <span class="main">-</span> set <span class="var">?X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> indepX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="main">(</span>set <span class="var">?X</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> augment <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹we know many things about x now, i.e. x weights strictly less than the ith element of FL ...›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">carrier</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> indepX indep_subset_carrier <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>     
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">BL</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xnX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> set <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> xs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">BL</span><span class="main">)</span><span class="main">!</span><span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">≤</span><span class="skolem">i</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i in_set_conv_nth l length_take less_Suc_eq_le min_Suc_gt<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">BL</span><span class="main">!</span><span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> il<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">BL</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i l <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">weight</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">weight</span> <span class="main">(</span><span class="skolem">BL</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wsorted_nth_mono<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">weight</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">weight</span> <span class="main">(</span><span class="skolem">FL</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹... and that adding x to X gives us an independent set›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?FL_restricted</span> <span class="main">⊆</span> set <span class="var">?X</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span>  limi_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> i in_set_conv_nth length_take
              min_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> not_less nth_take wF wsorted_nth_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="var">?FL_restricted</span> <span class="main">⊆</span> insert <span class="skolem">x</span> <span class="main">(</span>set <span class="var">?X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> xnX <span class="quoted"><span class="quoted">‹<span class="var">?FL_restricted</span> <span class="main">⊆</span> set <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">FL</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> indep_subset<span class="main">[</span><span class="operator">OF</span> indepX z'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> add_x_stay_indep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="var">?FL_restricted</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="comment1">― ‹... finally this means that we must have taken the element during our greedy algorithm›</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹no_smallest_element_skipped <span class="main">{}</span> <span class="free">F</span>›</span></span>
      <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">carrier</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">weight</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">weight</span> <span class="main">(</span><span class="skolem">FL</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>›</span></span> add_x_stay_indep
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?FL_restricted</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_smallest_element_skippedD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?FL_restricted</span> <span class="main">⊆</span> set <span class="var">?X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="var">?X</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹... but we actually didn't. This finishes our proof by contradiction.›</span>  
  <span class="keyword1"><span class="command">with</span></span> xnX <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>              
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The Invariant"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following predicate is invariant during the execution of the 
  minimum weight basis algorithm, and implies that its result is a minimum weight basis.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">I_minWeightBasis</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">I_minWeightBasis</span> <span class="main">==</span> <span class="main">λ</span><span class="main">(</span><span class="bound">T</span><span class="main">,</span><span class="bound">E</span><span class="main">)</span><span class="main">.</span> <span class="free">indep</span> <span class="bound">T</span> 
                <span class="main">∧</span> <span class="bound">T</span> <span class="main">⊆</span> <span class="free">carrier</span>
                 <span class="main">∧</span> <span class="bound">E</span> <span class="main">⊆</span> <span class="free">carrier</span>  
                 <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">T</span><span class="main">.</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">E</span><span class="main">.</span> <span class="free">weight</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">y</span><span class="main">)</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="free">carrier</span><span class="main">-</span><span class="bound">E</span><span class="main">-</span><span class="bound">T</span><span class="main">.</span> <span class="main">~</span><span class="free">indep</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="bound">T</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">∧</span> no_smallest_element_skipped <span class="bound">E</span> <span class="bound">T</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> I_minWeightBasisD<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> 
   <span class="quoted"><span class="quoted">"I_minWeightBasis <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">E</span><span class="main">)</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free">carrier</span><span class="main">-</span><span class="free">E</span><span class="main">-</span><span class="free">T</span> <span class="main">⟹</span> <span class="main">~</span><span class="free">indep</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">T</span> <span class="main">⟹</span> <span class="bound">y</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> <span class="free">weight</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">y</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
    <span class="quoted"><span class="quoted">"no_smallest_element_skipped <span class="free">E</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> no_smallest_element_skipped_def I_minWeightBasis_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> I_minWeightBasisI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">indep</span> <span class="free">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free">carrier</span><span class="main">-</span><span class="free">E</span><span class="main">-</span><span class="free">T</span> <span class="main">⟹</span> <span class="main">~</span><span class="free">indep</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="free">T</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">T</span> <span class="main">⟹</span> <span class="bound">y</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> <span class="free">weight</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">y</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">⊆</span> <span class="free">carrier</span>"</span></span>
    <span class="quoted"><span class="quoted">"no_smallest_element_skipped <span class="free">E</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"I_minWeightBasis <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> no_smallest_element_skipped_def I_minWeightBasis_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> I_minWeightBasisG<span class="main">:</span> <span class="quoted"><span class="quoted">"I_minWeightBasis <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">E</span><span class="main">)</span> <span class="main">⟹</span> no_smallest_element_skipped <span class="free">E</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> I_minWeightBasis_sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"I_minWeightBasis <span class="main">(</span><span class="free">T</span><span class="main">,</span><span class="free">E</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">T</span><span class="main">.</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">E</span><span class="main">.</span> <span class="free">weight</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">weight</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Invariant proofs›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> I_minWeightBasis_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"I_minWeightBasis <span class="main">(</span><span class="main">{}</span><span class="main">,</span> <span class="free">carrier</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> I_minWeightBasis_final<span class="main">:</span> <span class="quoted"><span class="quoted">"I_minWeightBasis <span class="main">(</span><span class="free">T</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">⟹</span> minBasis <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> greedy_approach_leads_to_minBasis I_minWeightBasis_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> indep_aux<span class="main">:</span>       
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="free">carrier</span> <span class="main">-</span> <span class="free">E</span> <span class="main">-</span> <span class="free">F</span><span class="main">.</span> <span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="free">F</span><span class="main">)</span>"</span></span>        
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">carrier</span> <span class="main">-</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="main">{</span><span class="free">e</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> insert <span class="free">e</span> <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="free">x</span> <span class="main">(</span>insert <span class="free">e</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms indep_iff_subset_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> preservation_if<span class="main">:</span> <span class="quoted"><span class="quoted">"wsorted <span class="free">x</span> <span class="main">⟹</span>   set <span class="free">x</span> <span class="main">=</span> <span class="free">carrier</span> <span class="main">⟹</span>
    <span class="free">x</span> <span class="main">=</span> <span class="free">l1</span> <span class="main">@</span> <span class="free">xa</span> <span class="main">#</span> <span class="free">l2</span> <span class="main">⟹</span> I_minWeightBasis <span class="main">(</span><span class="free">σ</span><span class="main">,</span> set <span class="main">(</span><span class="free">xa</span> <span class="main">#</span> <span class="free">l2</span><span class="main">)</span><span class="main">)</span>  <span class="main">⟹</span> <span class="free">indep</span> <span class="free">σ</span>
   <span class="main">⟹</span> <span class="free">xa</span> <span class="main">∈</span> <span class="free">carrier</span> <span class="main">⟹</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="free">xa</span> <span class="free">σ</span><span class="main">)</span> <span class="main">⟹</span> I_minWeightBasis <span class="main">(</span>insert <span class="free">xa</span> <span class="free">σ</span><span class="main">,</span> set <span class="free">l2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> I_minWeightBasisI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>      
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_minWeightBasis_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> indep_aux<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">xa</span> <span class="main">#</span> <span class="free">l2</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_iff list.set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> I_minWeightBasis_sorted
        sorted_wrt_append sorted_wrt.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> no_smallest_element_skipped_add<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>  <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> preservation_else<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">x</span> <span class="main">=</span> <span class="free">carrier</span> <span class="main">⟹</span>
    <span class="free">x</span> <span class="main">=</span> <span class="free">l1</span> <span class="main">@</span> <span class="free">xa</span> <span class="main">#</span> <span class="free">l2</span> <span class="main">⟹</span> I_minWeightBasis <span class="main">(</span><span class="free">σ</span><span class="main">,</span> set <span class="main">(</span><span class="free">xa</span> <span class="main">#</span> <span class="free">l2</span><span class="main">)</span><span class="main">)</span>
     <span class="main">⟹</span> <span class="free">indep</span> <span class="free">σ</span>   <span class="main">⟹</span> <span class="main">¬</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="free">xa</span> <span class="free">σ</span><span class="main">)</span> <span class="main">⟹</span> I_minWeightBasis <span class="main">(</span><span class="free">σ</span><span class="main">,</span> set <span class="free">l2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> I_minWeightBasisI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DiffD2 I_minWeightBasis_def<span class="main">)</span>   
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>   
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> no_smallest_element_skipped_skip<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>  <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The refinement lemma›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> minWeightBasis_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>minWeightBasis<span class="main">,</span> SPEC minBasis<span class="main">)</span><span class="main">∈</span><span class="main">⟨</span>Id<span class="main">⟩</span>nres_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minWeightBasis_def obtain_sorted_carrier_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">refine_vcg</span> nfoldli_rule<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">s</span><span class="main">.</span> I_minWeightBasis <span class="main">(</span><span class="bound">s</span><span class="main">,</span>set <span class="bound">l2</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_empty<span class="main">)</span>
      <span class="comment1">― ‹asserts›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_def<span class="main">)</span>   
      <span class="comment1">― ‹branches›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> preservation_if<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> preservation_else<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="comment1">― ‹final›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I_minWeightBasis_final<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹locale minWeightBasis›</span>
  
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Kruskal">
<div class="head">
<h1>Theory Kruskal</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Kruskal interface›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Kruskal
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Kruskal_Misc.html">Kruskal_Misc</a> <a href="MinWeightBasis.html">MinWeightBasis</a>  
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In order to instantiate Kruskal's algorithm for different graph formalizations we provide
  an interface consisting of the relevant concepts needed for the algorithm, but hiding the concrete
  structure of the graph formalization.
  We thus enable using both undirected graphs and symmetric directed graphs.

  Based on the interface, we show that the set of edges together with the predicate of being 
  cycle free (i.e. a forest) forms the cycle matroid.
  Together with a weight function on the edges we obtain a <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>weighted_matroid›</span></span></span></span> and thus
  an instance of the minimum weight basis algorithm, which is an abstract version of Kruskal.›</span></span>
 
  
<span class="keyword1"><span class="command">locale</span></span> Kruskal_interface <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'edge</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">vertices</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'edge</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">joins</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'edge</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">forest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'edge</span> set <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">connected</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'edge</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">*</span><span class="tfree">'a</span><span class="main">)</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">weight</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'edge</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>linorder<span class="main">,</span> ordered_comm_monoid_add<span class="main">}</span>"</span></span>
 <span class="keyword2"><span class="keyword">assumes</span></span> 
      finiteE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span>"</span></span>  
   <span class="keyword2"><span class="keyword">and</span></span> forest_subE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="free">E'</span> <span class="main">⟹</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> forest_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="main">{}</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> forest_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">forest</span> <span class="free">Y</span>"</span></span>  
   <span class="keyword2"><span class="keyword">and</span></span> connected_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">connected</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">u</span><span class="main">=</span><span class="free">v</span> <span class="main">∧</span> <span class="free">v</span><span class="main">∈</span><span class="free">V</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> findaugmenting_aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E1</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">E2</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">connected</span> <span class="free">E1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">∉</span> <span class="free">connected</span> <span class="free">E2</span>
           <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∉</span> <span class="free">connected</span> <span class="free">E2</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">∉</span> <span class="free">E2</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">∈</span> <span class="free">E1</span> <span class="main">∧</span> <span class="free">joins</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">e</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> augment_forest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">E</span><span class="main">-</span><span class="free">F</span> <span class="main">⟹</span> <span class="free">joins</span> <span class="free">u</span> <span class="free">v</span> <span class="free">e</span>
           <span class="main">⟹</span> <span class="free">forest</span> <span class="main">(</span>insert <span class="free">e</span> <span class="free">F</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∉</span> <span class="free">connected</span> <span class="free">F</span>"</span></span>  
   <span class="keyword2"><span class="keyword">and</span></span> equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> equiv <span class="free">V</span> <span class="main">(</span><span class="free">connected</span> <span class="free">F</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> connected_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">connected</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">×</span> <span class="free">V</span>"</span></span>      
   <span class="keyword2"><span class="keyword">and</span></span> insert_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">e</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> <span class="free">joins</span> <span class="free">x</span> <span class="free">y</span> <span class="free">e</span>
           <span class="main">⟹</span> <span class="free">connected</span> <span class="main">(</span>insert <span class="free">e</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> per_union <span class="main">(</span><span class="free">connected</span> <span class="free">F</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>   
   <span class="keyword2"><span class="keyword">and</span></span> exhaust<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">joins</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> vertices_constr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">e</span><span class="main">.</span> <span class="free">joins</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">e</span> <span class="main">⟹</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">vertices</span> <span class="bound">e</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> joins_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">e</span><span class="main">.</span> <span class="free">joins</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">e</span> <span class="main">=</span> <span class="free">joins</span> <span class="bound">b</span> <span class="bound">a</span> <span class="bound">e</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> selfloop_no_forest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> <span class="free">joins</span> <span class="free">a</span> <span class="free">a</span> <span class="bound">e</span> <span class="main">⟹</span> <span class="main">~</span><span class="free">forest</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="free">F</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> finite_vertices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">vertices</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
  
  <span class="keyword2"><span class="keyword">and</span></span> edgesinvertices<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span> <span class="free">vertices</span> <span class="main">`</span> <span class="free">E</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> finiteV<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> joins_connected<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">joins</span> <span class="free">a</span> <span class="free">b</span> <span class="free">e</span> <span class="main">⟹</span> <span class="free">T</span><span class="main">⊆</span><span class="free">E</span> <span class="main">⟹</span> <span class="free">e</span><span class="main">∈</span><span class="free">T</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">connected</span> <span class="free">T</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Derived facts›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> joins_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">joins</span> <span class="free">a</span> <span class="free">b</span> <span class="free">e</span> <span class="main">⟹</span> <span class="free">e</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">∈</span><span class="free">V</span> <span class="main">∧</span> <span class="free">b</span><span class="main">∈</span><span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> vertices_constr<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> edgesinvertices <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">lemma</span></span> finiteE_finiteV<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span> <span class="main">⟹</span> finite <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_vertices <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1"><span class="command">lemma</span></span> E_inV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> <span class="free">vertices</span> <span class="bound">e</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> edgesinvertices <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">CC</span> <span class="free"><span class="bound"><span class="entity">E'</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">connected</span> <span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">)</span><span class="main">``</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>      

<span class="keyword1"><span class="command">lemma</span></span> sameCC_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">u</span><span class="main">∈</span><span class="free">V</span> <span class="main">⟹</span> <span class="free">v</span><span class="main">∈</span><span class="free">V</span> <span class="main">⟹</span> CC <span class="free">E'</span> <span class="free">u</span> <span class="main">=</span> CC <span class="free">E'</span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">connected</span> <span class="free">E'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CC_def <span class="keyword1"><span class="command">using</span></span>  equiv_class_eq_iff<span class="main">[</span><span class="operator">OF</span> equiv <span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">CCs</span> <span class="free"><span class="bound"><span class="entity">E'</span></span></span> <span class="main">=</span> quotient <span class="free">V</span> <span class="main">(</span><span class="free">connected</span> <span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">)</span>"</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"quotient <span class="free">V</span> Id <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span><span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> quotient_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

<span class="keyword1"><span class="command">lemma</span></span> CCs_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"CCs <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span><span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">}</span>"</span></span>   
  <span class="keyword1"><span class="command">unfolding</span></span> CCs_def <span class="keyword1"><span class="command">unfolding</span></span> quotient_def <span class="keyword1"><span class="command">using</span></span> connected_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> CCs_empty_card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>CCs <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> card <span class="free">V</span>"</span></span>   
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span><span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span><span class="main">)</span><span class="main">`</span><span class="free">V</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>CCs <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">{</span><span class="main">{</span><span class="bound">v</span><span class="main">}</span><span class="main">|</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span><span class="free">V</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> CCs_empty  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span><span class="main">)</span><span class="main">`</span><span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> i<span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> CCs_imageCC<span class="main">:</span> <span class="quoted"><span class="quoted">"CCs <span class="free">F</span> <span class="main">=</span> <span class="main">(</span>CC <span class="free">F</span><span class="main">)</span> <span class="main">`</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> CCs_def CC_def quotient_def  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> union_eqclass_decreases_components<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"CC <span class="free">F</span> <span class="free">x</span> <span class="main">≠</span> CC <span class="free">F</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∉</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">∈</span><span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">joins</span> <span class="free">x</span> <span class="free">y</span> <span class="free">e</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">(</span>CCs <span class="main">(</span>insert <span class="free">e</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>CCs <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> xny<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> CCs_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> insert_reachable<span class="main"><span class="main">[</span></span><span class="operator">OF</span>   assms<span class="main"><span class="main"><span class="main">(</span></span></span>3-7<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> unify2EquivClasses_alt<span class="main">)</span>          
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> CC_def<span class="main"><span class="main">]</span></span><span class="main">)</span>                           
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> connected_in<span class="main">)</span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>    
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> equiv<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> finiteV<span class="main">)</span>      
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> forest_CCs<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="free">E'</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>CCs <span class="free">E'</span><span class="main">)</span> <span class="main">+</span> card <span class="free">E'</span> <span class="main">=</span> card <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">E'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> forest_subE
    <span class="keyword1"><span class="command">using</span></span> finiteE finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">E'</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> forest_subE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> xab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">joins</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> xab xE selfloop_no_forest insert<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xab'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>4<span class="main">)</span> forest_mono <span class="keyword1"><span class="command">have</span></span> fF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> insert<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>CCs <span class="skolem">F</span><span class="main">)</span> <span class="main">+</span> card <span class="skolem">F</span> <span class="main">=</span> card <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

    <span class="keyword1"><span class="command">from</span></span> insert<span class="main">(</span>4<span class="main">)</span> forest_subE <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
    <span class="keyword1"><span class="command">from</span></span> xab xab' <span class="keyword1"><span class="command">have</span></span> abV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vertices_constr E_inV xE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> <span class="free">connected</span> <span class="skolem">F</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> augment_forest<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> fF<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> xE xab xab insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> k abV sameCC_reachable <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"CC <span class="skolem">F</span> <span class="skolem">a</span> <span class="main">≠</span> CC <span class="skolem">F</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>card <span class="main">(</span>CCs <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>CCs <span class="skolem">F</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> union_eqclass_decreases_components<span class="main">)</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> xab insert<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> eq   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CCs_empty_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pigeonhole_CCs<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> finiteV<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardlt<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>CCs <span class="free">E1</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>CCs <span class="free">E2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span><span class="main">∈</span><span class="free">V</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">∈</span><span class="free">V</span> <span class="main">∧</span> CC <span class="free">E1</span> <span class="bound">u</span> <span class="main">=</span> CC <span class="free">E1</span> <span class="bound">v</span> <span class="main">∧</span> CC <span class="free">E2</span> <span class="bound">u</span> <span class="main">≠</span> CC <span class="free">E2</span> <span class="bound">v</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> CC <span class="free">E1</span> <span class="bound">u</span> <span class="main">=</span> CC <span class="free">E1</span> <span class="bound">v</span> <span class="main">⟶</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟶</span> CC <span class="free">E2</span> <span class="bound">u</span> <span class="main">=</span> CC <span class="free">E2</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span><span class="main">∈</span><span class="free">V</span> <span class="main">⟹</span> <span class="bound">v</span><span class="main">∈</span><span class="free">V</span> <span class="main">⟹</span> CC <span class="free">E1</span> <span class="bound">u</span> <span class="main">=</span> CC <span class="free">E1</span> <span class="bound">v</span> <span class="main">⟹</span> CC <span class="free">E2</span> <span class="bound">u</span> <span class="main">=</span> CC <span class="free">E2</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">with</span></span> coarser<span class="main">[</span><span class="operator">OF</span> finiteV<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span>CC <span class="free">E1</span><span class="main">)</span> <span class="main">`</span> <span class="free">V</span><span class="main">)</span> <span class="main">≥</span> card <span class="main">(</span><span class="main">(</span>CC <span class="free">E2</span><span class="main">)</span> <span class="main">`</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">with</span></span> CCs_imageCC cardlt <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The edge set and forest form the cycle matroid›</span></span> 
 

<span class="keyword1"><span class="command">theorem</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="free">E1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="free">E2</span>"</span></span>  
  <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">E1</span> <span class="main">&gt;</span> card <span class="free">E2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> augment<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">∈</span><span class="free">E1</span><span class="main">-</span><span class="free">E2</span><span class="main">.</span> <span class="free">forest</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="free">E2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹as E1 and E2 are both forests, and E1 has more edges than E2, E2 has more connected
        components than E1›</span> 
  <span class="keyword1"><span class="command">from</span></span> forest_CCs<span class="main">[</span><span class="operator">OF</span> f1<span class="main">]</span> forest_CCs<span class="main">[</span><span class="operator">OF</span> f2<span class="main">]</span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>CCs <span class="free">E1</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>CCs <span class="free">E2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="comment1">― ‹by an pigeonhole argument, we can obtain two vertices u and v
     that are in the same components of E1, but in different components of E2›</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> sameCCinE1<span class="main">:</span> <span class="quoted"><span class="quoted">"CC <span class="free">E1</span> <span class="skolem">u</span> <span class="main">=</span> CC <span class="free">E1</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    diffCCinE2<span class="main">:</span> <span class="quoted"><span class="quoted">"CC <span class="free">E2</span> <span class="skolem">u</span> <span class="main">≠</span> CC <span class="free">E2</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pigeonhole_CCs<span class="main">[</span><span class="operator">OF</span> finiteV<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   

  <span class="keyword1"><span class="command">from</span></span> diffCCinE2 <span class="keyword1"><span class="command">have</span></span> unv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹this means that there is a path from u to v in E1 ...›</span>   
  <span class="keyword1"><span class="command">from</span></span> f1 forest_subE <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E1</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">with</span></span>   sameCC_reachable k sameCCinE1 <span class="keyword1"><span class="command">have</span></span> pathinE1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">connected</span> <span class="free">E1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="comment1">― ‹... but none in E2›</span>  
  <span class="keyword1"><span class="command">from</span></span> f2 forest_subE <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E2</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">with</span></span>   sameCC_reachable k diffCCinE2
  <span class="keyword1"><span class="command">have</span></span> nopathinE2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> <span class="free">connected</span> <span class="free">E2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹hence, we can find vertices a and b that are not connected in E2,
          but are connected by an edge in E1›</span>    
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> pe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> <span class="free">connected</span> <span class="free">E2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abE2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∉</span> <span class="free">E2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> abE1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">E1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">joins</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> findaugmenting_aux<span class="main">[</span><span class="operator">OF</span> e1 e2 pathinE1 nopathinE2<span class="main">]</span>    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> forest_subE<span class="main">[</span><span class="operator">OF</span> f1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> abE1 abE2 <span class="keyword1"><span class="command">have</span></span> abdif<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">E1</span> <span class="main">-</span> <span class="free">E2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> e1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹we can savely add this edge between a and b to E2 and obtain a bigger forest›</span>    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="main">(</span>insert <span class="skolem">e</span> <span class="free">E2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> augment_forest<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">∈</span><span class="free">E1</span><span class="main">-</span><span class="free">E2</span><span class="main">.</span> <span class="free">forest</span> <span class="main">(</span>insert <span class="bound">e</span> <span class="free">E2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abdif
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> weighted_matroid <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="free">forest</span></span> <span class="quoted"><span class="free">weight</span></span>
<span class="keyword1"><span class="command">proof</span></span>             
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> forest_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> <span class="free">forest</span> <span class="bound">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> forest_subE forest_mono augment<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹locale <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">Kruskal_interface</span><span class="antiquote">}</span></span>›</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Kruskal_Refine">
<div class="head">
<h1>Theory Kruskal_Refine</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Refine Kruskal›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Kruskal_Refine
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Kruskal.html">Kruskal</a> <a href="SeprefUF.html">SeprefUF</a>
<span class="keyword2"><span class="keyword">begin</span></span>
 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement I: cycle check by connectedness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As a first refinement step, the check for introduction of a cycle when adding an edge <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  can be replaced by checking whether the edge's endpoints are already connected. 
  By this we can shift from an edge-centric perspective to a vertex-centric perspective.›</span></span>

<span class="keyword1"><span class="command">context</span></span> Kruskal_interface
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">empty_forest</span> <span class="main">≡</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">a_endpoints</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> SPEC <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="free">joins</span> <span class="bound">a</span> <span class="bound">b</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kruskal0</span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">kruskal0</span> <span class="main">≡</span> <span class="keyword1">do</span> <span class="main">{</span>
    <span class="bound">l</span> <span class="main">←</span> obtain_sorted_carrier<span class="main">;</span>
    <span class="bound">spanning_forest</span> <span class="main">←</span> nfoldli <span class="bound">l</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="bound">T</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span> 
            ASSERT <span class="main">(</span><span class="bound">e</span> <span class="main">∈</span> <span class="free">E</span><span class="main">)</span><span class="main">;</span>      
            <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> a_endpoints <span class="bound">e</span><span class="main">;</span>
            ASSERT <span class="main">(</span><span class="free">joins</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">e</span> <span class="main">∧</span> <span class="free">forest</span> <span class="bound">T</span> <span class="main">∧</span> <span class="bound">e</span><span class="main">∈</span><span class="free">E</span> <span class="main">∧</span> <span class="bound">T</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">)</span><span class="main">;</span>
            <span class="keyword1">if</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">connected</span> <span class="bound">T</span> <span class="keyword1">then</span>
              <span class="keyword1">do</span> <span class="main">{</span> 
                ASSERT <span class="main">(</span><span class="bound">e</span><span class="main">∉</span><span class="bound">T</span><span class="main">)</span><span class="main">;</span>
                RETURN <span class="main">(</span>insert <span class="bound">e</span> <span class="bound">T</span><span class="main">)</span>
              <span class="main">}</span>
            <span class="keyword1">else</span> 
              RETURN <span class="bound">T</span>
        <span class="main">}</span><span class="main">)</span> empty_forest<span class="main">;</span>
        RETURN <span class="bound">spanning_forest</span>
      <span class="main">}</span>"</span></span>
 

<span class="keyword1"><span class="command">lemma</span></span> if_subst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="free">e</span> <span class="free">T</span><span class="main">)</span> <span class="keyword1">then</span>
              RETURN <span class="main">(</span>insert <span class="free">e</span> <span class="free">T</span><span class="main">)</span>
            <span class="keyword1">else</span> 
              RETURN <span class="free">T</span><span class="main">)</span>
        <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">e</span><span class="main">∉</span> <span class="free">T</span> <span class="main">∧</span> <span class="free">indep</span> <span class="main">(</span>insert <span class="free">e</span> <span class="free">T</span><span class="main">)</span> <span class="keyword1">then</span>
              RETURN <span class="main">(</span>insert <span class="free">e</span> <span class="free">T</span><span class="main">)</span>
            <span class="keyword1">else</span> 
              RETURN <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> kruskal0_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kruskal0<span class="main">,</span> minWeightBasis<span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>Id<span class="main">⟩</span>nres_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> kruskal0_def minWeightBasis_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> if_subst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">refine_vcg</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">refine_dref_type</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">all</span> <span class="quoted">‹(<span class="operator">auto</span><span class="keyword3">;</span> <span class="operator">fail</span>)<span class="keyword3">?</span>›</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> augment_forest<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> augment_forest joins_connected <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement II: connectedness by PER operation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Connectedness in the subgraph spanned by a set of edges is a partial equivalence relation and
  can be represented in a disjoint sets. This data structure is maintained while executing Kruskal's
  algorithm and can be used to efficiently check for connectedness (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">per_compare</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">corresponding_union_find</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> per <span class="main">⇒</span> <span class="tfree">'edge</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">corresponding_union_find</span> <span class="free"><span class="bound"><span class="entity">uf</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> per_compare <span class="free"><span class="bound"><span class="entity">uf</span></span></span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span> <span class="free">connected</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">uf_graph_invar</span> <span class="free"><span class="bound"><span class="entity">uf_T</span></span></span>
   <span class="main">≡</span> <span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">uf_T</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">uf</span><span class="main">,</span> <span class="bound">T</span><span class="main">)</span> <span class="main">⇒</span> corresponding_union_find <span class="bound">uf</span> <span class="bound">T</span> <span class="main">∧</span> Domain <span class="bound">uf</span> <span class="main">=</span> <span class="free">V</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uf_graph_invarD<span class="main">:</span> <span class="quoted"><span class="quoted">"uf_graph_invar <span class="main">(</span><span class="free">uf</span><span class="main">,</span> <span class="free">T</span><span class="main">)</span> <span class="main">⟹</span> corresponding_union_find <span class="free">uf</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uf_graph_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">uf_graph_rel</span> <span class="main">≡</span> br snd uf_graph_invar"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uf_graph_relsndD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> uf_graph_rel <span class="main">⟹</span> <span class="free">b</span><span class="main">=</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uf_graph_rel_def in_br_conv<span class="main">)</span>   

<span class="keyword1"><span class="command">lemma</span></span> uf_graph_relD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> uf_graph_rel <span class="main">⟹</span> <span class="free">b</span><span class="main">=</span><span class="free">c</span> <span class="main">∧</span> uf_graph_invar <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uf_graph_rel_def in_br_conv<span class="main">)</span>      

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kruskal1</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">kruskal1</span> <span class="main">≡</span> <span class="keyword1">do</span> <span class="main">{</span>
    <span class="bound">l</span> <span class="main">←</span> obtain_sorted_carrier<span class="main">;</span>
    <span class="keyword1">let</span> <span class="bound">initial_union_find</span> <span class="main">=</span> per_init <span class="free">V</span><span class="main">;</span>
    <span class="main">(</span><span class="bound">per</span><span class="main">,</span> <span class="bound">spanning_forest</span><span class="main">)</span> <span class="main">←</span> nfoldli <span class="bound">l</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">e</span> <span class="main">(</span><span class="bound">uf</span><span class="main">,</span> <span class="bound">T</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span> 
            ASSERT <span class="main">(</span><span class="bound">e</span> <span class="main">∈</span> <span class="free">E</span><span class="main">)</span><span class="main">;</span>
            <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> a_endpoints <span class="bound">e</span><span class="main">;</span>
            ASSERT <span class="main">(</span><span class="bound">a</span><span class="main">∈</span><span class="free">V</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span><span class="free">V</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> Domain <span class="bound">uf</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> Domain <span class="bound">uf</span> <span class="main">∧</span> <span class="bound">T</span><span class="main">⊆</span><span class="free">E</span><span class="main">)</span><span class="main">;</span>
            <span class="keyword1">if</span> <span class="main">¬</span> per_compare <span class="bound">uf</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">then</span>
              <span class="keyword1">do</span> <span class="main">{</span> 
                <span class="keyword1">let</span> <span class="bound">uf</span> <span class="main">=</span> per_union <span class="bound">uf</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span>
                ASSERT <span class="main">(</span><span class="bound">e</span><span class="main">∉</span><span class="bound">T</span><span class="main">)</span><span class="main">;</span>
                RETURN <span class="main">(</span><span class="bound">uf</span><span class="main">,</span> insert <span class="bound">e</span> <span class="bound">T</span><span class="main">)</span>
              <span class="main">}</span>
            <span class="keyword1">else</span> 
              RETURN <span class="main">(</span><span class="bound">uf</span><span class="main">,</span><span class="bound">T</span><span class="main">)</span>
        <span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="bound">initial_union_find</span><span class="main">,</span> empty_forest<span class="main">)</span><span class="main">;</span>
        RETURN <span class="bound">spanning_forest</span>
      <span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> corresponding_union_find_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"corresponding_union_find <span class="main">(</span>per_init <span class="free">V</span><span class="main">)</span> empty_forest"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> corresponding_union_find_def connected_same per_init_def<span class="main">)</span> 
   

<span class="keyword1"><span class="command">lemma</span></span> empty_forest_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>per_init <span class="free">V</span><span class="main">,</span> empty_forest<span class="main">)</span><span class="main">,</span> empty_forest<span class="main">)</span><span class="main">∈</span>uf_graph_rel"</span></span>
  <span class="keyword1"><span class="command">using</span></span> corresponding_union_find_empty
  <span class="keyword1"><span class="command">unfolding</span></span>  uf_graph_rel_def uf_graph_invar_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_br_conv per_init_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uf_graph_invar_preserve<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"uf_graph_invar <span class="main">(</span><span class="free">uf</span><span class="main">,</span> <span class="free">T</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">V</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="free">joins</span> <span class="free">a</span> <span class="free">b</span> <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">∈</span><span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span><span class="main">⊆</span><span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uf_graph_invar <span class="main">(</span>per_union <span class="free">uf</span> <span class="free">a</span> <span class="free">b</span><span class="main">,</span> insert <span class="free">e</span> <span class="free">T</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uf_graph_invar_def corresponding_union_find_def
                  insert_reachable per_union_def<span class="main">)</span>    

<span class="keyword1"><span class="command">theorem</span></span> kruskal1_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kruskal1<span class="main">,</span> kruskal0<span class="main">)</span><span class="main">∈</span><span class="main">⟨</span>Id<span class="main">⟩</span>nres_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> kruskal1_def kruskal0_def Let_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">refine_rcg</span> empty_forest_refine<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">refine_dref_type</span> 
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> uf_graph_relD E_inV uf_graph_invarD
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> corresponding_union_find_def uf_graph_rel_def
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_br_conv uf_graph_invar_preserve<span class="main">)</span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uf_graph_invar_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> joins_in_V<span class="main">)</span>  

<span class="keyword2"><span class="keyword">end</span></span>
      
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Kruskal_Impl">
<div class="head">
<h1>Theory Kruskal_Impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Kruskal Implementation"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Kruskal_Impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Kruskal_Refine.html">Kruskal_Refine</a> <a href="../Refine_Imperative_HOL/IICF.html">Refine_Imperative_HOL.IICF</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement III: concrete edges›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Given a concrete representation of edges and their endpoints as a pair, we refine
  Kruskal's algorithm to work on these concrete edges.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Kruskal_concrete <span class="main">=</span> Kruskal_interface <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">vertices</span></span>  <span class="quoted"><span class="free">joins</span></span>  <span class="quoted"><span class="free">forest</span></span> <span class="quoted"><span class="free">connected</span></span>  <span class="quoted"><span class="free">weight</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">E</span> <span class="free">V</span> <span class="free">vertices</span> <span class="free">joins</span> <span class="free">forest</span> <span class="free">connected</span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">weight</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'edge</span> <span class="main">⇒</span> int"</span></span>  <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span>
    <span class="free">α</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'cedge</span> <span class="main">⇒</span> <span class="tfree">'edge</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">endpoints</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'cedge</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">*</span><span class="tfree">'a</span><span class="main">)</span> nres"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  
    endpoints_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="free">xi</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">endpoints</span> <span class="free">xi</span> <span class="main">≤</span> <span class="main">⇓</span> Id <span class="main">(</span>a_endpoints <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wsorted'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wsorted'</span> <span class="main">==</span> sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">weight</span> <span class="main">(</span><span class="free">α</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">weight</span> <span class="main">(</span><span class="free">α</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> wsorted_mapα<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wsorted' <span class="free">s</span> <span class="main">⟹</span> wsorted <span class="main">(</span>map <span class="free">α</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wsorted'_def sorted_wrt_map<span class="main">)</span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">obtain_sorted_carrier'</span> <span class="main">==</span> SPEC <span class="main">(</span><span class="main">λ</span><span class="bound">L</span><span class="main">.</span> wsorted' <span class="bound">L</span> <span class="main">∧</span> <span class="free">α</span> <span class="main">`</span> set <span class="bound">L</span> <span class="main">=</span> <span class="free">E</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">concrete_edge_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'cedge</span>  <span class="main">×</span> <span class="tfree">'edge</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">concrete_edge_rel</span> <span class="main">≡</span> br <span class="free">α</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> obtain_sorted_carrier'_refine<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>obtain_sorted_carrier'<span class="main">,</span> obtain_sorted_carrier<span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span><span class="main">⟨</span>concrete_edge_rel<span class="main">⟩</span>list_rel<span class="main">⟩</span>nres_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> obtain_sorted_carrier'_def obtain_sorted_carrier_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">refine_vcg</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> RES_refine <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>     <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"map <span class="free">α</span> <span class="skolem">s</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> map_in_list_rel_conv in_br_conv<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kruskal2</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">kruskal2</span> <span class="main">≡</span> <span class="keyword1">do</span> <span class="main">{</span>
    <span class="bound">l</span> <span class="main">←</span> obtain_sorted_carrier'<span class="main">;</span>
    <span class="keyword1">let</span> <span class="bound">initial_union_find</span> <span class="main">=</span> per_init <span class="free">V</span><span class="main">;</span>
    <span class="main">(</span><span class="bound">per</span><span class="main">,</span> <span class="bound">spanning_forest</span><span class="main">)</span> <span class="main">←</span> nfoldli <span class="bound">l</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">ce</span> <span class="main">(</span><span class="bound">uf</span><span class="main">,</span> <span class="bound">T</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span> 
            ASSERT <span class="main">(</span><span class="free">α</span> <span class="bound">ce</span> <span class="main">∈</span> <span class="free">E</span><span class="main">)</span><span class="main">;</span>
            <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="free">endpoints</span> <span class="bound">ce</span><span class="main">;</span>
            ASSERT <span class="main">(</span><span class="bound">a</span><span class="main">∈</span><span class="free">V</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">∈</span><span class="free">V</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> Domain <span class="bound">uf</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> Domain <span class="bound">uf</span> <span class="main">)</span><span class="main">;</span>
            <span class="keyword1">if</span> <span class="main">¬</span> per_compare <span class="bound">uf</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">then</span>
              <span class="keyword1">do</span> <span class="main">{</span> 
                <span class="keyword1">let</span> <span class="bound">uf</span> <span class="main">=</span> per_union <span class="bound">uf</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span>
                ASSERT <span class="main">(</span><span class="bound">ce</span> <span class="main">∉</span> set <span class="bound">T</span><span class="main">)</span><span class="main">;</span>
                RETURN <span class="main">(</span><span class="bound">uf</span><span class="main">,</span> <span class="bound">T</span><span class="main">@</span><span class="main">[</span><span class="bound">ce</span><span class="main">]</span><span class="main">)</span>
              <span class="main">}</span>
            <span class="keyword1">else</span> 
              RETURN <span class="main">(</span><span class="bound">uf</span><span class="main">,</span><span class="bound">T</span><span class="main">)</span>
        <span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="bound">initial_union_find</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
        RETURN <span class="bound">spanning_forest</span>
      <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lst_graph_rel_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>concrete_edge_rel<span class="main">⟩</span>list_set_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_set_rel_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> relcompI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_br_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> loop_initial_rel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>per_init <span class="free">V</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> per_init <span class="free">V</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> Id <span class="keyword1">×<span class="hidden">⇩</span><sub>r</sub></span> <span class="main">⟨</span>concrete_edge_rel<span class="main">⟩</span>list_set_rel"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> concrete_edge_rel_list_set_rel<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>concrete_edge_rel<span class="main">⟩</span>list_set_rel <span class="main">⟹</span> <span class="free">α</span> <span class="main">`</span> <span class="main">(</span>set <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_br_conv list_set_rel_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> list_relD2<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> kruskal2_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kruskal2<span class="main">,</span> kruskal1<span class="main">)</span><span class="main">∈</span><span class="main">⟨</span><span class="main">⟨</span>concrete_edge_rel<span class="main">⟩</span>list_set_rel<span class="main">⟩</span>nres_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> kruskal1_def kruskal2_def Let_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">refine_rcg</span> obtain_sorted_carrier'_refine<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> nres_relD<span class="main"><span class="main">]</span></span>
                    endpoints_refine loop_initial_rel<span class="main">)</span>     
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> list_set_rel_append
            <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> concrete_edge_rel_list_set_rel
            <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_br_conv<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement to Imperative/HOL with Sepref-Tool›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Given implementations for the operations of getting a list of concrete edges 
  and getting the endpoints of a concrete edge we synthesize Kruskal in Imperative/HOL.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> Kruskal_Impl <span class="main">=</span> Kruskal_concrete <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">vertices</span></span> <span class="quoted"><span class="free">joins</span></span> <span class="quoted"><span class="free">forest</span></span> <span class="quoted"><span class="free">connected</span></span> <span class="quoted"><span class="free">weight</span></span> <span class="quoted"><span class="free">α</span></span> <span class="quoted"><span class="free">endpoints</span></span>                       
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">E</span> <span class="free">V</span> <span class="free">vertices</span> <span class="free">joins</span> <span class="free">forest</span> <span class="free">connected</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">weight</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'edge</span> <span class="main">⇒</span> int"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">α</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">endpoints</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">×</span> int <span class="main">×</span> nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> nres"</span></span>
    <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">getEdges</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> list nres"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">getEdges_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> list Heap"</span></span>         
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">superE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> set"</span></span>         
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">endpoints_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> Heap"</span></span>                    
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    getEdges_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">getEdges</span> <span class="main">≤</span> SPEC <span class="main">(</span><span class="main">λ</span><span class="bound">L</span><span class="main">.</span> <span class="free">α</span> <span class="main">`</span> set <span class="bound">L</span> <span class="main">=</span> <span class="free">E</span> 
                            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">wv</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>set <span class="bound">L</span><span class="main">.</span>  <span class="free">weight</span> <span class="main">(</span><span class="free">α</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">wv</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">wv</span><span class="main">)</span> <span class="main">∧</span> set <span class="bound">L</span> <span class="main">⊆</span> <span class="free">superE</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    getEdges_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uncurry0 <span class="free">getEdges_impl</span><span class="main">,</span> uncurry0 <span class="free">getEdges</span><span class="main">)</span>
                     <span class="main">∈</span> unit_assn<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>a</sub></span> list_assn <span class="main">(</span>nat_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> int_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 
    max_node_is_Max_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="free">α</span> <span class="main">`</span> set <span class="free">la</span> <span class="main">⟹</span> max_node <span class="free">la</span> <span class="main">=</span> Max <span class="main">(</span>insert <span class="main">0</span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    endpoints_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="free">endpoints_impl</span><span class="main">,</span>  <span class="free">endpoints</span><span class="main">)</span> 
                      <span class="main">∈</span> <span class="main">(</span>nat_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> int_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>a</sub></span> <span class="main">(</span>nat_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> this_loc<span class="main">:</span> <span class="quoted"><span class="quoted">"Kruskal_Impl <span class="free">E</span> <span class="free">V</span> <span class="free">vertices</span>  <span class="free">joins</span>  <span class="free">forest</span> <span class="free">connected</span>  <span class="free">weight</span>
            <span class="free">α</span> <span class="free">endpoints</span> <span class="free">getEdges</span> <span class="free">getEdges_impl</span> <span class="free">superE</span>    <span class="free">endpoints_impl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  
  
  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Refinement IV: given an edge set›</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now assume to have an implementation of the operation to obtain a list of the edges of
    a graph. By sorting this list we refine <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">obtain_sorted_carrier'</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">obtain_sorted_carrier''</span> <span class="main">=</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">l</span> <span class="main">←</span> SPEC <span class="main">(</span><span class="main">λ</span><span class="bound">L</span><span class="main">.</span>  <span class="free">α</span> <span class="main">`</span> set <span class="bound">L</span> <span class="main">=</span> <span class="free">E</span> 
                              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">wv</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>set <span class="bound">L</span><span class="main">.</span>  <span class="free">weight</span> <span class="main">(</span><span class="free">α</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">wv</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">wv</span><span class="main">)</span> <span class="main">∧</span> set <span class="bound">L</span> <span class="main">⊆</span> <span class="free">superE</span><span class="main">)</span><span class="main">;</span>
      SPEC <span class="main">(</span><span class="main">λ</span><span class="bound">L</span><span class="main">.</span> sorted_wrt edges_less_eq <span class="bound">L</span> <span class="main">∧</span> set <span class="bound">L</span> <span class="main">=</span> set <span class="bound">l</span><span class="main">)</span>
  <span class="main">}</span>"</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> wsorted'_sorted_wrt_edges_less_eq<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">wv</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>set <span class="free">s</span><span class="main">.</span>  <span class="free">weight</span> <span class="main">(</span><span class="free">α</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">wv</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">wv</span>"</span></span>
        <span class="quoted"><span class="quoted">"sorted_wrt edges_less_eq <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wsorted' <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">unfolding</span></span> wsorted'_def   <span class="keyword1"><span class="command">unfolding</span></span> edges_less_eq_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sorted_wrt_mono_rel <span class="main">)</span>    
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> case_prod_beta<span class="main">)</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> obtain_sorted_carrier''_refine<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>obtain_sorted_carrier''<span class="main">,</span> obtain_sorted_carrier'<span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>Id<span class="main">⟩</span>nres_rel"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> obtain_sorted_carrier''_def obtain_sorted_carrier'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">refine_vcg</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_br_conv   wsorted'_sorted_wrt_edges_less_eq
        distinct_map map_in_list_rel_conv<span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">obtain_sorted_carrier'''</span> <span class="main">=</span>
        <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">l</span> <span class="main">←</span> <span class="free">getEdges</span><span class="main">;</span> 
      RETURN <span class="main">(</span>quicksort_by_rel edges_less_eq <span class="main">[]</span> <span class="bound">l</span><span class="main">,</span> max_node <span class="bound">l</span><span class="main">)</span>
  <span class="main">}</span>"</span></span> 
    
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_size_rel</span>   <span class="main">=</span> br fst <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span><span class="main">=</span> Max <span class="main">(</span>insert <span class="main">0</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>    
  
  <span class="keyword1"><span class="command">lemma</span></span> obtain_sorted_carrier'''_refine<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>obtain_sorted_carrier'''<span class="main">,</span> obtain_sorted_carrier''<span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>add_size_rel<span class="main">⟩</span>nres_rel"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> obtain_sorted_carrier'''_def obtain_sorted_carrier''_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">refine_rcg</span> getEdges_refine<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> RETURN_SPEC_refine <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quicksort_by_rel_distinct sort_edges_correct
        add_size_rel_def in_br_conv  max_node_is_Max_V
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> distinct_mapI<span class="main">)</span>

  <span class="keyword1"><span class="command">lemmas</span></span> osc_refine <span class="main">=</span>  obtain_sorted_carrier'''_refine<span class="main">[</span><span class="operator">FCOMP</span> obtain_sorted_carrier''_refine<span class="main">,</span>
                                                        <span class="operator">to_foparam</span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">kruskal3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> list nres"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">kruskal3</span>  <span class="main">≡</span> <span class="keyword1">do</span> <span class="main">{</span>
      <span class="main">(</span><span class="bound">sl</span><span class="main">,</span><span class="bound">mn</span><span class="main">)</span> <span class="main">←</span> obtain_sorted_carrier'''<span class="main">;</span>
      <span class="keyword1">let</span> <span class="bound">initial_union_find</span> <span class="main">=</span> per_init' <span class="main">(</span><span class="bound">mn</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span>
      <span class="main">(</span><span class="bound">per</span><span class="main">,</span> <span class="bound">spanning_forest</span><span class="main">)</span> <span class="main">←</span> nfoldli <span class="bound">sl</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">ce</span> <span class="main">(</span><span class="bound">uf</span><span class="main">,</span> <span class="bound">T</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">do</span> <span class="main">{</span> 
              ASSERT <span class="main">(</span><span class="free">α</span> <span class="bound">ce</span> <span class="main">∈</span> <span class="free">E</span><span class="main">)</span><span class="main">;</span>
              <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">←</span> <span class="free">endpoints</span> <span class="bound">ce</span><span class="main">;</span>
              ASSERT <span class="main">(</span><span class="bound">a</span> <span class="main">∈</span> Domain <span class="bound">uf</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> Domain <span class="bound">uf</span><span class="main">)</span><span class="main">;</span>
              <span class="keyword1">if</span> <span class="main">¬</span> per_compare <span class="bound">uf</span> <span class="bound">a</span> <span class="bound">b</span> <span class="keyword1">then</span>
                <span class="keyword1">do</span> <span class="main">{</span> 
                  <span class="keyword1">let</span> <span class="bound">uf</span> <span class="main">=</span> per_union <span class="bound">uf</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">;</span>
                  ASSERT <span class="main">(</span><span class="bound">ce</span><span class="main">∉</span>set <span class="bound">T</span><span class="main">)</span><span class="main">;</span>
                  RETURN <span class="main">(</span><span class="bound">uf</span><span class="main">,</span> <span class="bound">T</span><span class="main">@</span><span class="main">[</span><span class="bound">ce</span><span class="main">]</span><span class="main">)</span>
                <span class="main">}</span>
              <span class="keyword1">else</span> 
                RETURN <span class="main">(</span><span class="bound">uf</span><span class="main">,</span><span class="bound">T</span><span class="main">)</span>
          <span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="bound">initial_union_find</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">;</span>
          RETURN <span class="bound">spanning_forest</span>
        <span class="main">}</span>"</span></span>
 
  <span class="keyword1"><span class="command">lemma</span></span> endpoints_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">endpoints</span> <span class="free">ce</span> <span class="main">≤</span> SPEC <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> endpoints_refine<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>    

  <span class="keyword1"><span class="command">lemma</span></span>  kruskal3_subset<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"kruskal3 <span class="keyword1">≤<span class="hidden">⇩</span><sub>n</sub></span> SPEC <span class="main">(</span><span class="main">λ</span><span class="bound">T</span><span class="main">.</span> distinct <span class="bound">T</span> <span class="main">∧</span> set <span class="bound">T</span> <span class="main">⊆</span> <span class="free">superE</span> <span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> kruskal3_def obtain_sorted_carrier'''_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">refine_vcg</span> getEdges_refine<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> leof_lift<span class="main"><span class="main">]</span></span> endpoints_spec<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> leof_lift<span class="main"><span class="main">]</span></span>
        nfoldli_leof_rule<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">T</span><span class="main">)</span><span class="main">.</span> distinct <span class="bound">T</span> <span class="main">∧</span>  set <span class="bound">T</span> <span class="main">⊆</span> <span class="free">superE</span> "</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_self_conv in_set_conv_decomp set_quicksort_by_rel subset_iff<span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">per_supset_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> per <span class="main">×</span> <span class="tfree">'a</span> per<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">per_supset_rel</span>
      <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">p1</span><span class="main">,</span><span class="bound">p2</span><span class="main">)</span><span class="main">.</span> <span class="bound">p1</span> <span class="main">∩</span> Domain <span class="bound">p2</span> <span class="main">×</span> Domain <span class="bound">p2</span> <span class="main">=</span> <span class="bound">p2</span> <span class="main">∧</span> <span class="bound">p1</span> <span class="main">-</span> <span class="main">(</span>Domain <span class="bound">p2</span> <span class="main">×</span> Domain <span class="bound">p2</span><span class="main">)</span> <span class="main">⊆</span> Id<span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> per_supset_rel_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">∈</span> per_supset_rel <span class="main">⟹</span> Domain <span class="free">p1</span> <span class="main">⊇</span> Domain <span class="free">p2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_supset_rel_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> per_supset_compare<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">∈</span> per_supset_rel <span class="main">⟹</span> <span class="free">x1</span><span class="main">∈</span>Domain <span class="free">p2</span> <span class="main">⟹</span> <span class="free">x2</span><span class="main">∈</span>Domain <span class="free">p2</span>
       <span class="main">⟹</span> per_compare <span class="free">p1</span> <span class="free">x1</span> <span class="free">x2</span> <span class="main">⟷</span> per_compare <span class="free">p2</span> <span class="free">x1</span> <span class="free">x2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_supset_rel_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> per_supset_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p1</span><span class="main">,</span> <span class="free">p2</span><span class="main">)</span> <span class="main">∈</span> per_supset_rel <span class="main">⟹</span> <span class="free">x1</span><span class="main">∈</span>Domain <span class="free">p2</span> <span class="main">⟹</span> <span class="free">x2</span><span class="main">∈</span>Domain <span class="free">p2</span> <span class="main">⟹</span>
    <span class="main">(</span>per_union <span class="free">p1</span> <span class="free">x1</span> <span class="free">x2</span><span class="main">,</span> per_union <span class="free">p2</span> <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span> <span class="main">∈</span> per_supset_rel"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_supset_rel_def per_union_def Domain_unfold <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> subsetI conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">lemma</span></span> per_initN_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>per_init' <span class="main">(</span>Max <span class="main">(</span>insert <span class="main">0</span> <span class="free">V</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> per_init <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> per_supset_rel"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> per_supset_rel_def per_init'_def per_init_def max_node_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_Suc_eq_le  <span class="main">)</span> 

  <span class="keyword1"><span class="command">theorem</span></span> kruskal3_refine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>kruskal3<span class="main">,</span> kruskal2<span class="main">)</span><span class="main">∈</span><span class="main">⟨</span>Id<span class="main">⟩</span>nres_rel"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> kruskal2_def kruskal3_def Let_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">refine_rcg</span> osc_refine<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> nres_relD<span class="main"><span class="main">]</span></span>   <span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> RELATESI<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> R<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"per_supset_rel<span class="main">::</span><span class="main">(</span>nat per <span class="main">×</span> <span class="main">_</span><span class="main">)</span> set"</span></span><span class="main">,</span> <span class="operator">refine_dref_RELATES</span><span class="main">]</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">refine_dref_type</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_size_rel_def in_br_conv<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> per_initN_refine <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_size_rel_def in_br_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_size_rel_def in_br_conv per_supset_compare per_supset_union
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> per_supset_rel_dom
        <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> per_compare_def <span class="main">)</span> 


  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Synthesis of Kruskal by SepRef›</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">sepref_import_param</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sort_edges<span class="main">,</span>sort_edges<span class="main">)</span><span class="main">∈</span><span class="main">⟨</span>Id<span class="keyword1">×<span class="hidden">⇩</span><sub>r</sub></span>Id<span class="keyword1">×<span class="hidden">⇩</span><sub>r</sub></span>Id<span class="main">⟩</span>list_rel <span class="main">→</span><span class="main">⟨</span>Id<span class="keyword1">×<span class="hidden">⇩</span><sub>r</sub></span>Id<span class="keyword1">×<span class="hidden">⇩</span><sub>r</sub></span>Id<span class="main">⟩</span>list_rel"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">sepref_import_param</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>max_node<span class="main">,</span> max_node<span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>Id<span class="keyword1">×<span class="hidden">⇩</span><sub>r</sub></span>Id<span class="keyword1">×<span class="hidden">⇩</span><sub>r</sub></span>Id<span class="main">⟩</span>list_rel <span class="main">→</span> nat_rel"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">sepref_register</span></span> <span class="quoted"><span class="quoted">"<span class="free">getEdges</span>"</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> list nres"</span></span>
  <span class="keyword1"><span class="command">sepref_register</span></span> <span class="quoted"><span class="quoted">"<span class="free">endpoints</span>"</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>nat<span class="main">*</span>nat<span class="main">)</span> nres"</span></span>
 
 
  <span class="keyword1"><span class="command">declare</span></span> getEdges_impl <span class="main">[</span><span class="operator">sepref_fr_rules</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> endpoints_impl <span class="main">[</span><span class="operator">sepref_fr_rules</span><span class="main">]</span>
  
  <span class="keyword1"><span class="command">schematic_goal</span></span> kruskal_impl<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>uncurry0 <span class="var">?c</span><span class="main">,</span> uncurry0 kruskal3 <span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>unit_assn<span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>a</sub></span> list_assn <span class="main">(</span>nat_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> int_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> kruskal3_def obtain_sorted_carrier'''_def 
    <span class="keyword1"><span class="command">unfolding</span></span> sort_edges_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rewrite</span> <span class="quasi_keyword">at</span> <span class="quoted"><span class="quoted"><span class="quoted">"nfoldli <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">_</span></span><span class="main"><span class="main">,</span></span>rewrite_HOLE<span class="main"><span class="main">)</span></span>"</span></span></span> HOL_list.fold_custom_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">sepref</span> 

  <span class="keyword1"><span class="command">concrete_definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> <span class="entity">kruskal</span> <span class="keyword2"><span class="keyword">uses</span></span> Kruskal_Impl.kruskal_impl
  <span class="keyword1"><span class="command">prepare_code_thms</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> kruskal_def
  <span class="keyword1"><span class="command">lemmas</span></span> kruskal_refine <span class="main">=</span> kruskal.refine<span class="main">[</span><span class="operator">OF</span> this_loc<span class="main">]</span>

  
  
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">MSF</span> <span class="main">==</span> minBasis"</span></span>   
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">SpanningForest</span> <span class="main">==</span> basis"</span></span>
  <span class="keyword1"><span class="command">lemmas</span></span> SpanningForest_def <span class="main">=</span> basis_def
  <span class="keyword1"><span class="command">lemmas</span></span> MSF_def <span class="main">=</span> minBasis_def 
  
  <span class="keyword1"><span class="command">lemmas</span></span> kruskal3_ref_spec_ <span class="main">=</span> kruskal3_refine<span class="main">[</span><span class="operator">FCOMP</span> kruskal2_refine<span class="main">,</span> <span class="operator">FCOMP</span> kruskal1_refine<span class="main">,</span>
      <span class="operator">FCOMP</span> kruskal0_refine<span class="main">,</span>
      <span class="operator">FCOMP</span> minWeightBasis_refine<span class="main">]</span> 
  
  <span class="keyword1"><span class="command">lemma</span></span> kruskal3_ref_spec'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>uncurry0 kruskal3<span class="main">,</span> uncurry0 <span class="main">(</span>SPEC <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> MSF <span class="main">(</span><span class="free">α</span> <span class="main">`</span> set <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> unit_rel <span class="keyword1">→<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">⟨</span>Id<span class="main">⟩</span>nres_rel"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> fref_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nres_relI<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span>  kruskal3_ref_spec_<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">unfolded</span> fref_def<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">simplified</span><span class="main"><span class="main"><span class="main">,</span></span></span>  <span class="operator">THEN</span> nres_relD<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> conc_fun_def list_set_rel_def in_br_conv <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> list_relD2<span class="main">)</span> 
  
  <span class="keyword1"><span class="command">lemma</span></span> kruskal3_ref_spec<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span>uncurry0 kruskal3<span class="main">,</span>
      uncurry0 <span class="main">(</span>SPEC <span class="main">(</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> distinct <span class="bound">r</span> <span class="main">∧</span> set <span class="bound">r</span> <span class="main">⊆</span> <span class="free">superE</span> <span class="main">∧</span>  MSF <span class="main">(</span><span class="free">α</span> <span class="main">`</span> set <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> unit_rel <span class="keyword1">→<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">⟨</span>Id<span class="main">⟩</span>nres_rel"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> fref_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> nres_relI<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> SPEC_rule_conj_leofI2<span class="main">[</span><span class="operator">OF</span> kruskal3_subset kruskal3_ref_spec'
              <span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> fref_def<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span>  <span class="operator">THEN</span> nres_relD<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">fcomp_norm_simps</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"list_assn <span class="main">(</span>nat_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> int_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="main">)</span> <span class="main">=</span> id_assn"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> list_assn_pure_conv<span class="main">)</span>
  
  <span class="keyword1"><span class="command">lemmas</span></span> kruskal_ref_spec <span class="main">=</span> kruskal_refine<span class="main">[</span><span class="operator">FCOMP</span> kruskal3_ref_spec<span class="main">]</span>
  

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The final correctness lemma for Kruskal's algorithm. ›</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> kruskal_correct_forest<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">&lt;</span><span class="keyword1">emp</span><span class="main">&gt;</span> kruskal <span class="free">getEdges_impl</span> <span class="free">endpoints_impl</span> <span class="main">()</span>
             <span class="main">&lt;</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">↑</span><span class="main">(</span> distinct <span class="bound">r</span> <span class="main">∧</span> set <span class="bound">r</span> <span class="main">⊆</span> <span class="free">superE</span> <span class="main">∧</span> MSF <span class="main">(</span>set <span class="main">(</span>map <span class="free">α</span> <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="keyword1">&gt;<span class="hidden">⇩</span><sub>t</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> kruskal_ref_spec<span class="main">[</span><span class="operator">to_hnr</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> hn_refine_def  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> cons_post_rule<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sep_auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hn_ctxt_def pure_def list_set_rel_def in_br_conv <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> list_relD<span class="main">)</span>     
  <span class="keyword1"><span class="command">qed</span></span>                            

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">― ‹locale <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">Kruskal_Impl</span><span class="antiquote">}</span></span>›</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="UGraph">
<div class="head">
<h1>Theory UGraph</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹UGraph - undirected graph with Uprod edges›</span></span>

<span class="keyword1"><span class="command">theory</span></span> UGraph
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <span class="quoted">"<a href="../Automatic_Refinement/Misc.html">Automatic_Refinement.Misc</a>"</span>
    <span class="quoted">"<a href="../Collections/Partial_Equivalence_Relation.html">Collections.Partial_Equivalence_Relation</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Uprod.html">HOL-Library.Uprod</a>"</span>   
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Edge path"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">epath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> uprod set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> uprod<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">epath</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">epath</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">≠</span><span class="bound">w</span> <span class="main">∧</span> Upair <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">w</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free">epath</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">w</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">E</span></span></span>"</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="main">[]</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> epath_subset_E<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> set <span class="free">p</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> path_append_conv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="main">(</span><span class="free">p</span><span class="main">@</span><span class="free">q</span><span class="main">)</span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> epath <span class="free">E</span> <span class="free">u</span> <span class="free">p</span> <span class="bound">w</span> <span class="main">∧</span> epath <span class="free">E</span> <span class="bound">w</span> <span class="free">q</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> epath_rev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">y</span> <span class="main">(</span>rev <span class="free">p</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> epath <span class="free">E</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free">E</span> <span class="free">y</span> <span class="bound">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"rev <span class="free">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> epath_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊆</span> <span class="free">E'</span> <span class="main">⟹</span> epath <span class="free">E</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> epath <span class="free">E'</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> epath_restrict<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> <span class="free">I</span> <span class="main">⟹</span> epath <span class="free">E</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> epath <span class="main">(</span><span class="free">E</span><span class="main">∩</span><span class="free">I</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">A'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> epath <span class="free">A</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">A'</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> epath_diff_edge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span>set <span class="free">p</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">A'</span> <span class="main">∩</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">A</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> ii<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> epath_restrict  <span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> epath_restrict'<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="free">e</span> <span class="free">E</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span>  <span class="free">e</span><span class="main">∉</span>set <span class="free">p</span> <span class="main">⟹</span> epath <span class="free">E</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="free">e</span> <span class="free">E</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">∉</span>set <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> epath_subset_E<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="free">e</span> <span class="free">E</span> <span class="main">∩</span> <span class="free">E</span> <span class="main">=</span> <span class="free">E</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> epath_restrict<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">E</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> E<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"insert <span class="free">e</span> <span class="free">E</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span> e<span class="main"><span class="main">]</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> epath_not_direct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ep<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> unv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> edge_notin<span class="main">:</span> <span class="quoted"><span class="quoted">"Upair <span class="free">u</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">E</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ep <span class="keyword1"><span class="command">have</span></span> setp<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> epath_subset_E <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>length <span class="free">p</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">&lt;</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> ep unv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> list_decomp_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">with</span></span> ep <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span>Upair <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> p i setp <span class="keyword2"><span class="keyword">and</span></span> edge_notin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> epath_decompose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> elem <span class="main">:</span><span class="quoted"><span class="quoted">"Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">p'</span> <span class="bound">p''</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> epath <span class="free">G</span> <span class="free">v</span> <span class="bound">p'</span> <span class="bound">u</span> <span class="main">∧</span> epath <span class="free">G</span> <span class="bound">u'</span> <span class="bound">p''</span> <span class="free">v'</span> <span class="main">∧</span>
          length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="free">p</span> <span class="main">∧</span> length <span class="bound">p''</span> <span class="main">&lt;</span> length <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> elem <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">@</span> <span class="main">(</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_set_conv_decomp
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="free">v</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">@</span> <span class="main">(</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p''</span><span class="main">)</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="free">v</span> <span class="skolem">p'</span> <span class="skolem">z</span>"</span></span>  <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="skolem">z'</span> <span class="skolem">p''</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"Upair <span class="skolem">z</span> <span class="skolem">z'</span><span class="main">=</span>Upair <span class="free">a</span> <span class="free">b</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> u <span class="keyword1"><span class="command">have</span></span> u'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">z'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p'</span> <span class="main">&lt;</span> length <span class="free">p</span>"</span></span>  <span class="quoted"><span class="quoted">"length <span class="skolem">p''</span> <span class="main">&lt;</span> length <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">from</span></span> len pr u' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> epath_decompose'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> elem <span class="main">:</span><span class="quoted"><span class="quoted">"Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">u'</span> <span class="bound">p'</span> <span class="bound">p''</span> <span class="main">.</span> Upair <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Upair <span class="bound">u</span> <span class="bound">u'</span> <span class="main">∧</span> epath <span class="free">G</span> <span class="free">v</span> <span class="bound">p'</span> <span class="bound">u</span> <span class="main">∧</span> epath <span class="free">G</span> <span class="bound">u'</span> <span class="bound">p''</span> <span class="free">v'</span> <span class="main">∧</span>
          length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="free">p</span> <span class="main">∧</span> length <span class="bound">p''</span> <span class="main">&lt;</span> length <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> elem <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">@</span> <span class="main">(</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_set_conv_decomp
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="free">v</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">@</span> <span class="main">(</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p''</span><span class="main">)</span> <span class="free">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="free">v</span> <span class="skolem">p'</span> <span class="skolem">z</span>"</span></span>  <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="skolem">z'</span> <span class="skolem">p''</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"Upair <span class="skolem">z</span> <span class="skolem">z'</span><span class="main">=</span>Upair <span class="free">a</span> <span class="free">b</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p'</span> <span class="main">&lt;</span> length <span class="free">p</span>"</span></span>  <span class="quoted"><span class="quoted">"length <span class="skolem">p''</span> <span class="main">&lt;</span> length <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">from</span></span> len pr u <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* adapted from Julian's is_path_undir_split_distinct *)</span>
<span class="keyword1"><span class="command">lemma</span></span> epath_split_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p'</span> <span class="bound">p''</span> <span class="bound">u</span> <span class="bound">u'</span><span class="main">.</span>
            epath <span class="free">G</span> <span class="free">v</span> <span class="bound">p'</span> <span class="bound">u</span> <span class="main">∧</span> epath <span class="free">G</span> <span class="bound">u'</span> <span class="bound">p''</span> <span class="free">v'</span> <span class="main">∧</span>
            length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="free">p</span> <span class="main">∧</span> length <span class="bound">p''</span> <span class="main">&lt;</span> length <span class="free">p</span> <span class="main">∧</span>
            <span class="main">(</span><span class="bound">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
            Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="bound">p'</span> <span class="main">∧</span> Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="bound">p''</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="skolem">n</span> <span class="main"><span class="main">==</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">p'</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p''<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">G</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="skolem">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> len_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p'</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len_p''<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p''</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> epath_decompose<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 1 len_p' p' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> set <span class="skolem">p'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p'2</span> <span class="bound">u2</span><span class="main">.</span>
            epath <span class="free">G</span> <span class="skolem">v</span> <span class="bound">p'2</span> <span class="bound">u2</span> <span class="main">∧</span>
            length <span class="bound">p'2</span> <span class="main">&lt;</span> length <span class="skolem">p'</span> <span class="main">∧</span>
            <span class="bound">u2</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span>
            Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="bound">p'2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">with</span></span> len_p' p' u <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">u</span><span class="main">.</span> epath <span class="free">G</span> <span class="skolem">v</span> <span class="bound">p'</span> <span class="bound">u</span> <span class="main">∧</span> length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="skolem">p</span> <span class="main">∧</span>
      <span class="bound">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∧</span> Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="bound">p'</span> <span class="main">∧</span> Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="bound">p'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> 1 len_p'' p'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> set <span class="skolem">p''</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p''2</span> <span class="bound">u'2</span><span class="main">.</span>
            epath <span class="free">G</span> <span class="bound">u'2</span> <span class="bound">p''2</span> <span class="skolem">v'</span> <span class="main">∧</span>
            length <span class="bound">p''2</span> <span class="main">&lt;</span> length <span class="skolem">p''</span> <span class="main">∧</span>
            <span class="bound">u'2</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span>
            Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="bound">p''2</span> <span class="main">∧</span> Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="bound">p''2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">with</span></span> len_p'' p'' u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p''</span> <span class="bound">u'</span><span class="main">.</span> epath <span class="free">G</span> <span class="bound">u'</span> <span class="bound">p''</span> <span class="skolem">v'</span><span class="main">∧</span> length <span class="bound">p''</span> <span class="main">&lt;</span> length <span class="skolem">p</span> <span class="main">∧</span>
      <span class="bound">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∧</span> Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="bound">p''</span> <span class="main">∧</span> Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="bound">p''</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> p' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Distinct edge path"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">depath</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">dp</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> epath <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">dp</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> distinct <span class="free"><span class="bound"><span class="entity">dp</span></span></span>"</span></span>      

<span class="keyword1"><span class="command">lemma</span></span> epath_to_depath<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> <span class="free">I</span> <span class="main">⟹</span> epath <span class="free">E</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">dp</span><span class="main">.</span> depath <span class="free">E</span> <span class="free">u</span> <span class="bound">dp</span> <span class="free">v</span> <span class="main">∧</span> set <span class="bound">dp</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> length_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p'</span><span class="main">.</span> <span class="main">⟦</span>length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="skolem">p</span><span class="main">;</span> set <span class="bound">p'</span> <span class="main">⊆</span> <span class="free">I</span><span class="main">;</span> epath <span class="free">E</span> <span class="free">u</span> <span class="bound">p'</span> <span class="free">v</span><span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p'</span><span class="main">.</span> depath <span class="free">E</span> <span class="free">u</span> <span class="bound">p'</span> <span class="free">v</span> <span class="main">∧</span> set <span class="bound">p'</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> PATH<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> depath <span class="free">E</span> <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">∧</span> set <span class="bound">p</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> PATH set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> depath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>distinct <span class="skolem">p</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pv1</span></span> <span class="skolem"><span class="skolem">pv2</span></span> <span class="skolem"><span class="skolem">pv3</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">pv1</span><span class="main">@</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">pv2</span><span class="main">@</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">pv3</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_distinct_decomp<span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> PATH <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="skolem">pv1</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">pv2</span><span class="main">@</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">pv3</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">=</span>Upair <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="skolem">b</span> <span class="main">(</span><span class="skolem">pv2</span><span class="main">@</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">pv3</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="skolem">b</span> <span class="skolem">pv2</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="skolem">c</span> <span class="main">(</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">pv3</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">∈</span>set_uprod <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">pv1</span><span class="main">@</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">pv3</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">pv1</span><span class="main">@</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">pv3</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="main">(</span><span class="skolem">pv1</span><span class="main">@</span><span class="skolem">w</span><span class="main">#</span><span class="skolem">pv3</span><span class="main">)</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 4 p set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span><span class="main">.</span> depath <span class="free">E</span> <span class="free">u</span> <span class="bound">p'</span> <span class="free">v</span> <span class="main">∧</span> set <span class="bound">p'</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> ab cw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> 4 ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="skolem">a</span> <span class="skolem">pv3</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">pv1</span><span class="main">@</span><span class="skolem">pv3</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">pv1</span><span class="main">@</span><span class="skolem">pv3</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="main">(</span><span class="skolem">pv1</span><span class="main">@</span><span class="skolem">pv3</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p 1 set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span><span class="main">.</span> depath <span class="free">E</span> <span class="free">u</span> <span class="bound">p'</span> <span class="free">v</span> <span class="main">∧</span> set <span class="bound">p'</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> epath_to_depath'<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">dp</span><span class="main">.</span> depath <span class="free">E</span> <span class="free">u</span> <span class="bound">dp</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> epath_to_depath<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"set <span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">decycle</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">==</span> epath <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> length <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&gt;</span> <span class="numeral">2</span> <span class="main">∧</span> distinct <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Connectivity in undirected Graphs"</span></span>    

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">uconnected</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">}</span>"</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> uconnectedempty<span class="main">:</span> <span class="quoted"><span class="quoted">"uconnected <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">|</span><span class="bound">a</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def 
  <span class="keyword1"><span class="command">using</span></span> epath.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>    

<span class="keyword1"><span class="command">lemma</span></span> uconnected_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"refl <span class="main">(</span>uconnected <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> refl_on_def uconnected_def<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> uconnected_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>uconnected <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_def uconnected_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y p <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"rev <span class="skolem">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> uconnected_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>uconnected <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trans_def uconnected_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y p z q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">@</span><span class="skolem">q</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> uconnected_symI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> uconnected <span class="free">E</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span> uconnected <span class="free">E</span>"</span></span>    
  <span class="keyword1"><span class="command">using</span></span> uconnected_sym sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"equiv UNIV <span class="main">(</span>uconnected <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> refl_on_def uconnected_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_def uconnected_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y p <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"rev <span class="skolem">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> uconnected_trans<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> uconnected_refcl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uconnected <span class="free">E</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> <span class="main">(</span>uconnected <span class="free">E</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> trans_rtrancl_eq_reflcl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> uconnected_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uconnected_transcl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uconnected <span class="free">E</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> uconnected <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> uconnected_refcl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uconnected_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uconnected_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">A'</span> <span class="main">⟹</span> uconnected <span class="free">A</span> <span class="main">⊆</span> uconnected <span class="free">A'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> epath_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>



<span class="keyword1"><span class="command">lemma</span></span> findaugmenting_edge<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E1</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free">E2</span> <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∉</span> uconnected <span class="free">E2</span> <span class="main">∧</span> Upair <span class="bound">a</span> <span class="bound">b</span> <span class="main">∉</span> <span class="free">E2</span> <span class="main">∧</span> Upair <span class="bound">a</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">E1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> axy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span>Upair <span class="skolem">u</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">≠</span><span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e'<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E1</span> <span class="skolem">w</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uwE1<span class="main">:</span> <span class="quoted"><span class="quoted">"Upair <span class="skolem">u</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">E1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">E2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> e2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free">E2</span> <span class="skolem">w</span> <span class="bound">p</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E2</span> <span class="skolem">w</span> <span class="skolem">p2</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> True axy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E2</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">p2</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> e' e2'<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> e2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free">E2</span> <span class="skolem">w</span> <span class="bound">p</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> e' e2'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> e2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free">E2</span> <span class="skolem">w</span> <span class="bound">p</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E2</span> <span class="skolem">w</span> <span class="skolem">p1</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

      <span class="keyword1"><span class="command">from</span></span> False axy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Upair <span class="skolem">u</span> <span class="skolem">w</span><span class="main">∉</span><span class="free">E2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span> <span class="main">∉</span> uconnected <span class="free">E2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uconnected_def<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p2</span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E2</span> <span class="skolem">u</span> <span class="skolem">p2</span> <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> p1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E2</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">@</span><span class="skolem">p1</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> uwE1   
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Forest"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">≡</span> <span class="main">~</span><span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">p</span><span class="main">.</span> decycle <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">u</span> <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> forest_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> forest <span class="free">X</span> <span class="main">⟹</span> forest <span class="free">Y</span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> forest_def decycle_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> epath_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">lemma</span></span> forrest2_E<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> uconnected <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Upair <span class="free">u</span> <span class="free">v</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>                    
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> forest <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">E</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> uconnected_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="skolem">p'</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> ep<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">E</span> <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dep<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> epath_to_depath' <span class="keyword1"><span class="command">unfolding</span></span> depath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span> ep <span class="keyword1"><span class="command">have</span></span> setp<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> epath_subset_E <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">have</span></span> lengthp<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> epath_not_direct<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> epath_mono<span class="main">[</span><span class="operator">OF</span> _ ep<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ep'<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">E</span><span class="main">)</span> <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">E</span><span class="main">)</span> <span class="free">v</span> <span class="main">(</span><span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">#</span><span class="skolem">p</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">#</span><span class="skolem">p</span><span class="main">)</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span>  <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">#</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ep' assms<span class="main">(</span>3<span class="main">)</span> lengthp dep setp assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"decycle <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">E</span><span class="main">)</span> <span class="free">v</span> <span class="main">(</span><span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">#</span><span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> decycle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> forest_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> insert_stays_forest_means_not_connected<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∉</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> uconnected <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> forrest2_E assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 

<span class="keyword1"><span class="command">lemma</span></span> epath_singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="free">a</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main">=</span> Upair <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> forest_alt1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free">F</span> <span class="main">⟹</span> proper_uprod <span class="bound">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∉</span>  uconnected <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> anb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> uconnected <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">a</span> <span class="skolem">p</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> dp<span class="main">:</span> <span class="quoted"><span class="quoted">"depath <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">a</span> <span class="skolem">p'</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> epath_to_depath' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"Upair <span class="free">a</span> <span class="free">b</span> <span class="main">∉</span> set <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> depath_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> epath_subset_E<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> anb dp <span class="keyword1"><span class="command">have</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> depath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ab dp <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> depath_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> One_nat_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> list_decomp_1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> n0 n1 <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p'</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">from</span></span> dp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="free">a</span> <span class="skolem">p'</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> epath_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> depath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="free">b</span> <span class="main">(</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">#</span><span class="skolem">p'</span><span class="main">)</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> anb <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> dp ab <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">#</span><span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> depath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> d e l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"decycle <span class="free">F</span> <span class="free">b</span> <span class="main">(</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">#</span><span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decycle_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> forest_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> forest_alt2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free">F</span> <span class="main">⟹</span> proper_uprod <span class="bound">e</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> Upair <span class="bound">a</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∉</span>  uconnected <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Upair <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> forest <span class="free">F</span>"</span></span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> decycle_def forest_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Upair <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">p'</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_1 epath.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> less_imp_not_less list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> neq_NilE zero_less_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"Upair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">∈</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="main">(</span>Upair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Upair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b</span> <span class="skolem">p'</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> epath_restrict'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Upair <span class="skolem">a</span> <span class="skolem">b</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> e  p' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Upair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">}</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">(</span>rev <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span>   assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> u<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> forest_alt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free">F</span> <span class="main">⟹</span> proper_uprod <span class="bound">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">F</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> Upair <span class="bound">a</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∉</span>  uconnected <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span>Upair <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms forest_alt1 forest_alt2
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  


<span class="keyword1"><span class="command">lemma</span></span> augment_forest_overedges<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">⊆</span><span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∉</span> uconnected <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> notsame<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">≠</span><span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> forest_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decycle_def <span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">p</span> 
  <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">w</span> <span class="skolem">p</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> setep<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> epath_subset_E v
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">have</span></span> uvF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">∉</span><span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="free">u</span> <span class="main">[</span><span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">]</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> notsame <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> uconnected <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  uconnected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span> <span class="main">∩</span> <span class="free">F</span> <span class="main">=</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="keyword2"><span class="keyword">where</span></span> ep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_set_conv_decomp
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> pr<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">w</span> <span class="skolem">as</span> <span class="skolem">z</span>"</span></span>   <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span><span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">from</span></span> d ep <span class="keyword1"><span class="command">have</span></span> uvas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">as</span><span class="main">@</span><span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> setasbs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">bs</span><span class="main">@</span><span class="skolem">as</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ep setep <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span><span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> pr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">w</span> <span class="skolem">as</span> <span class="free">u</span>"</span></span>   <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert<span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">bs</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">v</span> <span class="main">(</span><span class="skolem">bs</span><span class="main">@</span><span class="skolem">as</span><span class="main">)</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> epath_restrict<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">F</span></span><span class="main">,</span> <span class="operator">OF</span> setasbs this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="free">v</span> <span class="main">(</span><span class="skolem">bs</span><span class="main">@</span><span class="skolem">as</span><span class="main">)</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uvF <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span> uconnected <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uconnected_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> uconnected <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uconnected_symI<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">≠</span><span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span><span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pr<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> pr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">w</span> <span class="skolem">as</span> <span class="free">v</span>"</span></span>   <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">u</span> <span class="skolem">bs</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">u</span> <span class="main">(</span><span class="skolem">bs</span><span class="main">@</span><span class="skolem">as</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> epath_restrict<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">F</span></span><span class="main">,</span> <span class="operator">OF</span> setasbs this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="free">u</span> <span class="main">(</span><span class="skolem">bs</span><span class="main">@</span><span class="skolem">as</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uvF <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> uconnected <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uconnected_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>  
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> uconnected <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> setep <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span> <span class="main">∩</span> <span class="free">F</span><span class="main">)</span> <span class="skolem">w</span> <span class="skolem">p</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> epath_restrict<span class="main">[</span><span class="operator">OF</span> _ v<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">F</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="skolem">w</span> <span class="skolem">p</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹forest <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> forest_def decycle_def <span class="keyword1"><span class="command">using</span></span> p d
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"uGraph locale"</span></span>

<span class="keyword1"><span class="command">locale</span></span> uGraph <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> uprod set"</span></span>   
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> uprod <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">::</span><span class="main">{</span>linorder<span class="main">,</span> ordered_comm_monoid_add<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ecard2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> proper_uprod <span class="bound">e</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> finiteE<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">uconnected_on</span> <span class="free"><span class="bound"><span class="entity">E'</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> uconnected <span class="free"><span class="bound"><span class="entity">E'</span></span></span> <span class="main">∩</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">×</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">verts</span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">(</span>set_uprod <span class="main">`</span> <span class="free">E</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_uprod_nonemptyY<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"set_uprod <span class="free">x</span>  <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">uconnectedV</span> <span class="free"><span class="bound"><span class="entity">E'</span></span></span> <span class="main">≡</span> Restr <span class="main">(</span>uconnected <span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">)</span> verts"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> equiv_unconnected_on<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv <span class="free">V</span> <span class="main">(</span>uconnected_on <span class="free">E'</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> refl_on_def uconnected_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_def uconnected_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y p <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"rev <span class="skolem">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trans_def uconnected_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y z p q <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">@</span><span class="skolem">q</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> uconnectedV_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E'</span><span class="main">⊆</span><span class="free">E</span> <span class="main">⟹</span> refl_on verts <span class="main">(</span>uconnectedV <span class="free">E'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> refl_on_def uconnected_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> uconnectedV_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">(</span>uconnectedV <span class="free">E'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trans_def uconnected_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y z p a b c q <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">@</span><span class="skolem">q</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> uconnectedV_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>uconnectedV <span class="free">E'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_def uconnected_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x y p <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"rev <span class="skolem">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_vert_uconnected<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv verts <span class="main">(</span>uconnectedV <span class="free">E'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> equiv_unconnected_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



<span class="keyword1"><span class="command">lemma</span></span> uconnectedV_tracl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>=</sup></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> trans_rtrancl_eq_reflcl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> uconnectedV_trans<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> uconnectedV_cl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> trancl_id<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> uconnectedV_trans<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> uconnectedV_Restrcl<span class="main">:</span> <span class="quoted"><span class="quoted">"Restr <span class="main">(</span><span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> verts <span class="main">=</span> <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> uconnectedV_tracl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> restr_ucon<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> uconnected <span class="free">F</span> <span class="main">=</span> uconnectedV <span class="free">F</span> <span class="main">∪</span> Id"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">es</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">es</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> list.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span> set_uprod <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev <span class="skolem">p</span><span class="main">≠</span><span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="skolem">b</span> <span class="main">(</span>rev <span class="skolem">p</span><span class="main">)</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">es</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"rev <span class="skolem">p</span><span class="main">=</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">es</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> list.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span> set_uprod <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">∈</span><span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> relI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">=</span><span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> in_per_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">⟹</span>  <span class="free">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">}</span> <span class="main">⟹</span>  <span class="free">x</span><span class="main">∈</span><span class="free">V</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">∈</span><span class="free">V</span> <span class="main">⟹</span>
    refl_on <span class="free">V</span> <span class="free">R</span> <span class="main">⟹</span> part_equiv <span class="free">R</span>  <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">u'</span><span class="main">)</span> <span class="main">∈</span> per_union <span class="free">R</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_union_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> refl_onD<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> uconnectedV_mono<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span>uconnectedV <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span><span class="main">⊆</span><span class="free">F'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span>uconnectedV <span class="free">F'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> epath_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> per_union_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> <span class="free">R</span><span class="main">⊆</span><span class="free">S</span> <span class="main">×</span> <span class="free">S</span> <span class="main">⟹</span> per_union <span class="free">R</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> per_union_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* adapted preserve_corresponding_union_find_add by Julian Biendarra *)</span>
<span class="keyword1"><span class="command">lemma</span></span> insert_uconnectedV_per<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>verts"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span>verts"</span></span> <span class="keyword2"><span class="keyword">and</span></span> subE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">⊆</span><span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uconnectedV <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> per_union <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"uconnectedV <span class="var">?F'</span> <span class="main">=</span> per_union <span class="var">?uf</span> <span class="free">x</span> <span class="free">y</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> PER<span class="main">:</span> <span class="quoted"><span class="quoted">"part_equiv <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> part_equiv_def 
    <span class="keyword1"><span class="command">using</span></span> uconnectedV_sym uconnectedV_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> PER <span class="keyword1"><span class="command">have</span></span> PER'<span class="main">:</span> <span class="quoted"><span class="quoted">"part_equiv <span class="main">(</span>per_union <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> union_part_equivp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ref<span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on verts <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uconnectedV_refl assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> relI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> uconnectedV <span class="var">?F'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="var">?F'</span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>verts"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span>verts"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">∈</span>per_union <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Upair <span class="free">x</span> <span class="free">y</span><span class="main">∈</span>set <span class="skolem">p</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"epath <span class="var">?F'</span> <span class="skolem">a</span> <span class="skolem">p'</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"epath <span class="var">?F'</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="skolem">b</span>"</span></span><span class="keyword2"><span class="keyword">and</span></span>
        u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">u'</span><span class="main">∈</span><span class="main">{</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"Upair <span class="free">x</span> <span class="free">y</span> <span class="main">∉</span> set <span class="skolem">p'</span>"</span></span> <span class="quoted"><span class="quoted">"Upair <span class="free">x</span> <span class="free">y</span> <span class="main">∉</span> set <span class="skolem">p''</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> epath_split_distinct<span class="main">[</span><span class="operator">OF</span> p True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="skolem">a</span> <span class="skolem">p'</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> epath_restrict'<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command">using</span></span> u ab assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> a 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">∈</span>per_union <span class="var">?uf</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_union_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span><span class="main">∈</span>per_union <span class="var">?uf</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> in_per_union<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> u inV ref PER <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="main">(</span>part_equiv_trans<span class="main">[</span><span class="operator">OF</span> PER'<span class="main">]</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">∈</span>per_union <span class="var">?uf</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_union_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">finally</span></span> <span class="main">(</span>part_equiv_trans<span class="main">[</span><span class="operator">OF</span> PER'<span class="main">]</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">∈</span>per_union <span class="var">?uf</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> epath_restrict'<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">∈</span>uconnectedV <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uconnected_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> per_union_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">∈</span>per_union <span class="var">?uf</span> <span class="free">x</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"per_union <span class="var">?uf</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⊆</span> verts <span class="main">×</span> verts"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> per_union_subs<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> inV <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">with</span></span> asm <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>verts"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span>verts"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Upair <span class="free">x</span> <span class="free">y</span> <span class="main">∈</span> <span class="var">?F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> uconnectedV <span class="var">?F'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> uconnectedV_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> asm part_equiv_sym<span class="main">[</span><span class="operator">OF</span> PER<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span> <span class="main">∧</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span>  <span class="main">∨</span>  <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span> <span class="main">∧</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> per_union_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span><span class="main">∈</span>verts›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span><span class="main">∈</span>verts›</span></span> inV  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="free">x</span> <span class="main">∧</span> epath <span class="free">F</span> <span class="free">y</span> <span class="skolem">q</span> <span class="skolem">b</span>  <span class="main">∨</span>  epath <span class="free">F</span> <span class="skolem">a</span> <span class="skolem">p'</span> <span class="free">y</span> <span class="main">∧</span> epath <span class="free">F</span> <span class="free">x</span> <span class="skolem">q'</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="var">?F'</span> <span class="skolem">a</span> <span class="skolem">p</span> <span class="free">x</span> <span class="main">∧</span> epath <span class="var">?F'</span> <span class="free">y</span> <span class="skolem">q</span> <span class="skolem">b</span>  <span class="main">∨</span>  epath <span class="var">?F'</span> <span class="skolem">a</span> <span class="skolem">p'</span> <span class="free">y</span> <span class="main">∧</span> epath <span class="var">?F'</span> <span class="free">x</span> <span class="skolem">q'</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> epath_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="var">?F'</span> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> Upair <span class="free">x</span> <span class="free">y</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">∨</span>  epath <span class="var">?F'</span> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">@</span> Upair <span class="free">x</span> <span class="free">y</span> <span class="main">#</span> <span class="skolem">q'</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def
        <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> epath_filter_selfloop<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">a</span> <span class="free">p</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free">F</span> <span class="free">a</span> <span class="bound">p</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="skolem">n</span> <span class="main"><span class="main">==</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> indhyp<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xa</span><span class="main">.</span> length <span class="bound">xa</span> <span class="main">&lt;</span> length <span class="skolem">p</span> <span class="main">⟹</span> epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">a</span> <span class="bound">xa</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free">F</span> <span class="free">a</span> <span class="bound">p</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> epath_subset_E <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span> <span class="main">∩</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> epath_restrict<span class="main">[</span><span class="operator">OF</span> a 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> F <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="free">F</span> <span class="free">a</span> <span class="skolem">p</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free">F</span> <span class="free">a</span> <span class="bound">p</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> set <span class="skolem">p</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Upair <span class="free">x</span> <span class="free">x</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> Upair <span class="free">x</span> <span class="free">x</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> split_list_last<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">a</span> <span class="skolem">xs</span> <span class="free">x</span>"</span></span>  <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">x</span> <span class="skolem">ys</span> <span class="free">b</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"epath <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">@</span><span class="skolem">ys</span><span class="main">)</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> indhyp<span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> epath <span class="free">F</span> <span class="free">a</span> <span class="bound">p</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> uconnectedV_insert_selfloop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>verts <span class="main">⟹</span> uconnectedV <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> uconnectedV <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> epath_filter_selfloop <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetCE subset_insertI uconnected_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> equiv_selfloop_per_union_id<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv <span class="free">S</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> per_union <span class="free">F</span> <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> per_union_def     
    <span class="keyword1"><span class="command">using</span></span> equiv_class_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> per_union_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

<span class="keyword1"><span class="command">lemma</span></span> insert_uconnectedV_per_eq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span>    inV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>verts"</span></span>   <span class="keyword2"><span class="keyword">and</span></span> subE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">⊆</span><span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uconnectedV <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">x</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> per_union <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span> <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uconnectedV_insert_selfloop equiv_selfloop_per_union_id<span class="main"><span class="main">[</span></span><span class="operator">OF</span> equiv_vert_uconnected<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> insert_uconnectedV_per'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span>  inV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>verts"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span>verts"</span></span> <span class="keyword2"><span class="keyword">and</span></span> subE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">⊆</span><span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uconnectedV <span class="main">(</span>insert <span class="main">(</span>Upair <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> per_union <span class="main">(</span>uconnectedV <span class="free">F</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms insert_uconnectedV_per_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms insert_uconnectedV_per <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">subforest</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> forest <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spanningForest</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">spanningForest</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟷</span> subforest <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">¬</span> subforest <span class="main">(</span>insert <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">minSpanningForest</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> spanningForest <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F'</span><span class="main">.</span> spanningForest <span class="bound">F'</span> <span class="main">⟶</span> sum <span class="free">w</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≤</span> sum <span class="free">w</span> <span class="bound">F'</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="UGraph_Impl">
<div class="head">
<h1>Theory UGraph_Impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Kruskal on UGraphs"</span></span>

<span class="keyword1"><span class="command">theory</span></span> UGraph_Impl
<span class="keyword2"><span class="keyword">imports</span></span>
 <a href="Kruskal_Impl.html">Kruskal_Impl</a> <a href="UGraph.html">UGraph</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> Upair <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Interpreting <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Kruskl_Impl›</span></span></span></span> with a UGraph"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> uGraph<span class="main">)</span>
  <span class="quoted"><span class="quoted">"<span class="free">getEdges_SPEC</span> <span class="free"><span class="bound"><span class="entity">csuper_E</span></span></span>
    <span class="main">≡</span> <span class="main">(</span>SPEC <span class="main">(</span><span class="main">λ</span><span class="bound">L</span><span class="main">.</span> distinct <span class="main">(</span>map α <span class="bound">L</span><span class="main">)</span> <span class="main">∧</span> α <span class="main">`</span> set <span class="bound">L</span> <span class="main">=</span> <span class="free">E</span> 
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">wv</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span>set <span class="bound">L</span><span class="main">.</span> <span class="free">w</span> <span class="main">(</span>α <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">wv</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">wv</span><span class="main">)</span> <span class="main">∧</span> set <span class="bound">L</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">csuper_E</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> uGraph_impl <span class="main">=</span> uGraph <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="free">w</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat uprod set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat uprod <span class="main">⇒</span> int"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">getEdges_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> list Heap"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">csuper_E</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> set"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> getEdges_impl<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>uncurry0 <span class="free">getEdges_impl</span><span class="main">,</span> uncurry0 <span class="main">(</span>getEdges_SPEC <span class="free">csuper_E</span><span class="main">)</span><span class="main">)</span>
       <span class="main">∈</span> unit_assn<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>a</sub></span> list_assn <span class="main">(</span>nat_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> int_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

 

  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">≡</span> <span class="main">⋃</span> <span class="main">(</span>set_uprod <span class="main">`</span> <span class="free">E</span><span class="main">)</span>"</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> max_node_is_Max_V<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">E</span> <span class="main">=</span> α <span class="main">`</span> set <span class="free">la</span> <span class="main">⟹</span>  max_node <span class="free">la</span> <span class="main">=</span> Max <span class="main">(</span>insert <span class="main">0</span> V<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> α <span class="main">`</span> set <span class="free">la</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">la</span> <span class="main">∪</span> <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> set <span class="free">la</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">la</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span> <span class="bound">x1a</span><span class="main">,</span> <span class="bound">x2a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">{</span><span class="bound">x1</span><span class="main">,</span> <span class="bound">x2a</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">force</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> E <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> α_def  max_node_def prod.case_distrib<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>




<span class="keyword1"><span class="command">sublocale</span></span> s<span class="main">:</span> Kruskal_Impl <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set_uprod <span class="main">`</span> <span class="free">E</span><span class="main">)</span>"</span></span> <span class="quoted">set_uprod</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">e</span><span class="main">.</span> Upair <span class="bound">u</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">e</span>"</span></span>
  <span class="quoted"><span class="quoted">"subforest"</span></span> <span class="quoted"><span class="quoted">"uconnectedV"</span></span>  <span class="quoted"><span class="free">w</span></span> <span class="quoted">α</span> <span class="quoted"><span class="quoted">"PR_CONST <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> RETURN <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"PR_CONST <span class="main">(</span>getEdges_SPEC <span class="free">csuper_E</span><span class="main">)</span>"</span></span>
 <span class="quoted"><span class="free">getEdges_impl</span></span> <span class="quoted"><span class="quoted">"<span class="free">csuper_E</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> return <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> subforest_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"forest <span class="skolem">E'</span> <span class="main">∧</span> <span class="skolem">E'</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">{}</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> decycle_def forest_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> epath.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"forest <span class="skolem">X</span> <span class="main">∧</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"forest <span class="skolem">Y</span> <span class="main">∧</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> forest_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">using</span></span> epath.elims<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">E1</span> <span class="skolem">E2</span> <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>uconnected <span class="skolem">E1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> V"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"epath <span class="skolem">E1</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> 6 uv <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span>  epath <span class="skolem">E2</span> <span class="skolem">u</span> <span class="bound">p</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∉</span> uconnected <span class="skolem">E2</span>
           <span class="main">∧</span> Upair <span class="bound">a</span> <span class="bound">b</span> <span class="main">∉</span> <span class="skolem">E2</span> <span class="main">∧</span> Upair <span class="bound">a</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">E1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> findaugmenting_edge<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">F</span> <span class="skolem">e</span> <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> f <span class="main">=</span> <span class="quoted"><span class="quoted">‹forest <span class="skolem">F</span> <span class="main">∧</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="free">E</span>›</span></span>
  <span class="keyword1"><span class="command">note</span></span> notin <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹Upair <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">e</span>›</span></span>
  <span class="keyword1"><span class="command">from</span></span> notin ecard2 <span class="keyword1"><span class="command">have</span></span> unv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">≠</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>forest <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∧</span> insert <span class="skolem">e</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> uconnectedV <span class="skolem">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∧</span> insert <span class="skolem">e</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="free">E</span> "</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> uconnected <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> insert_stays_forest_means_not_connected<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> notin a unv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Restr <span class="main">(</span>uconnected <span class="skolem">F</span><span class="main">)</span> V<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> Restr <span class="main">(</span>uconnected <span class="skolem">F</span><span class="main">)</span> V"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>insert <span class="main">(</span>Upair <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> augment_forest_overedges<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">E</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> notin f a unv  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">e</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> notin f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">∧</span> insert <span class="skolem">e</span> <span class="skolem">F</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> notin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>      
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">⊆</span><span class="free">E</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"equiv V <span class="main">(</span>uconnectedV <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> equiv_vert_uconnected<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>                                 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> insert_uconnectedV_per' <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>13 <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>14 <span class="skolem">a</span> <span class="skolem">F</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ecard2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>15 <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ecard2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 16
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"V <span class="main">⊆</span> V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 17
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>18 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">e</span> <span class="skolem">T</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> uconnected_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> ecard2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>19 <span class="skolem">xi</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> α_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 20
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 21
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> getEdges_impl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>22 <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> max_node_is_Max_V<span class="main">[</span><span class="operator">OF</span> 22<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max_node <span class="skolem">l</span> <span class="main">=</span> Max <span class="main">(</span>insert <span class="main">0</span> V<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>23<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sepref_to_hoare</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sep_auto</span> 
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> spanningForest_eq_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"spanningForest <span class="main">=</span> s.basis"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> spanningForest_def  s.basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> minSpanningForest_eq_minbasis<span class="main">:</span> <span class="quoted"><span class="quoted">"minSpanningForest <span class="main">=</span> s.minBasis"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> minSpanningForest_def  s.MSF_def spanningForest_eq_basis <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> kruskal_correct'<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">&lt;</span><span class="keyword1">emp</span><span class="main">&gt;</span> kruskal <span class="free">getEdges_impl</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> return <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">()</span>
    <span class="main">&lt;</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span>distinct <span class="bound">r</span> <span class="main">∧</span> set <span class="bound">r</span> <span class="main">⊆</span> <span class="free">csuper_E</span> <span class="main">∧</span> s.MSF <span class="main">(</span>set <span class="main">(</span>map α <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="keyword1">&gt;<span class="hidden">⇩</span><sub>t</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> s.kruskal_correct_forest   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> kruskal_correct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">&lt;</span><span class="keyword1">emp</span><span class="main">&gt;</span> kruskal <span class="free">getEdges_impl</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> return <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">()</span>
    <span class="main">&lt;</span><span class="main">λ</span><span class="bound">r</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span>distinct <span class="bound">r</span> <span class="main">∧</span> set <span class="bound">r</span> <span class="main">⊆</span> <span class="free">csuper_E</span> <span class="main">∧</span> minSpanningForest <span class="main">(</span>set <span class="main">(</span>map α <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="keyword1">&gt;<span class="hidden">⇩</span><sub>t</sub></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> s.kruskal_correct_forest minSpanningForest_eq_minbasis  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Kruskal on UGraph from list of concrete edges"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">uGraph_from_list_α_weight</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">w</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a'</span> <span class="bound">b'</span><span class="main">.</span> Upair <span class="bound">a'</span> <span class="bound">b'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a'</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">b'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">uGraph_from_list_α_edges</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≡</span> α <span class="main">`</span> set <span class="free"><span class="bound"><span class="entity">L</span></span></span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> fromlist <span class="main">=</span> <span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map α <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> no_selfloop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">w</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">∈</span>set <span class="free">L</span> <span class="main">⟶</span> <span class="bound">u</span><span class="main">≠</span><span class="bound">v</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> not_distinct_map<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span>set <span class="free">l</span> <span class="main">⟹</span> <span class="free">b</span><span class="main">∈</span>set <span class="free">l</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">⟹</span> α <span class="free">a</span> <span class="main">=</span> α <span class="free">b</span> <span class="main">⟹</span> <span class="main">¬</span> distinct <span class="main">(</span>map α <span class="free">l</span><span class="main">)</span>"</span></span>
   
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> distinct_map_eq<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">aa</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">L</span> <span class="main">⟹</span> uGraph_from_list_α_weight <span class="free">L</span> <span class="main">(</span>Upair <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">aa</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uGraph_from_list_α_weight_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> w a' b'
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> distinct_map_eq<span class="main">[</span><span class="operator">OF</span> dist<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">aa</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> α_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> distinct_map_eq<span class="main">[</span><span class="operator">OF</span> dist<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">aa</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> α_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1"><span class="command">sublocale</span></span> uGraph_impl <span class="quoted"><span class="quoted">"α <span class="main">`</span> set <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"uGraph_from_list_α_weight <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"return <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">L</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> α <span class="main">`</span> set <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> α <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proper_uprod <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> no_selfloop <span class="keyword1"><span class="command">unfolding</span></span> α_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>α <span class="main">`</span> set <span class="free">L</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>uncurry0 <span class="main">(</span>return <span class="free">L</span><span class="main">)</span><span class="main">,</span>uncurry0<span class="main">(</span><span class="main">(</span>SPEC
          <span class="main">(</span><span class="main">λ</span><span class="bound">La</span><span class="main">.</span> distinct <span class="main">(</span>map α <span class="bound">La</span><span class="main">)</span> <span class="main">∧</span> α <span class="main">`</span> set <span class="bound">La</span> <span class="main">=</span> α <span class="main">`</span> set <span class="free">L</span> 
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">wv</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span><span class="main">∈</span>set <span class="bound">La</span><span class="main">.</span> uGraph_from_list_α_weight <span class="free">L</span> <span class="main">(</span>α <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">wv</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">wv</span><span class="main">)</span>
      <span class="main">∧</span> set <span class="bound">La</span> <span class="main">⊆</span> set <span class="free">L</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∈</span> unit_assn<span class="keyword1"><span class="hidden">⇧</span><sup>k</sup></span> <span class="keyword1">→<span class="hidden">⇩</span><sub>a</sub></span> list_assn <span class="main">(</span>nat_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> int_assn <span class="keyword1">×<span class="hidden">⇩</span><sub>a</sub></span> nat_assn<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sepref_to_hoare</span> <span class="keyword1"><span class="command">using</span></span> dist  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sep_auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> ii <span class="keyword1"><span class="command">unfolding</span></span> α_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pure_fold list_assn_emp<span class="main">)</span>   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span> kruskal_correct <span class="main">=</span> kruskal_correct

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">kruskal_algo</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> kruskal <span class="main">(</span>return <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> return <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">()</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Outside the locale›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uGraph_from_list_invar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">×</span>int<span class="main">×</span>nat<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">uGraph_from_list_invar</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span>distinct <span class="main">(</span>map α <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">p</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span><span class="bound">u</span><span class="main">≠</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> uGraph_from_list_invar_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">L</span> <span class="main">=</span> fromlist <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uGraph_from_list_invar_def fromlist_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> uGraph_from_list_invar_subset<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">L</span> <span class="main">⟹</span> set <span class="free">L'</span><span class="main">⊆</span> set <span class="free">L</span> <span class="main">⟹</span> distinct <span class="free">L'</span> <span class="main">⟹</span> uGraph_from_list_invar <span class="free">L'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> uGraph_from_list_invar_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> distinct_map inj_on_subset<span class="main">)</span>  


<span class="keyword1"><span class="command">lemma</span></span>  uGraph_from_list_α_inj_on<span class="main">:</span> <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">E</span> <span class="main">⟹</span> inj_on α <span class="main">(</span>set <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> distinct_map uGraph_from_list_invar_def  <span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> sum_easier<span class="main">:</span> <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">L</span> 
    <span class="main">⟹</span> set <span class="free">E</span> <span class="main">⊆</span> set <span class="free">L</span>
    <span class="main">⟹</span> sum <span class="main">(</span>uGraph_from_list_α_weight <span class="free">L</span><span class="main">)</span> <span class="main">(</span>uGraph_from_list_α_edges <span class="free">E</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span>set <span class="free">E</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">L</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">E</span> <span class="main">⊆</span> set <span class="free">L</span>"</span></span> 

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span>set <span class="free">E</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="keyword1">THE</span> <span class="bound">w</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a'</span> <span class="bound">b'</span><span class="main">.</span> Upair <span class="bound">a'</span> <span class="bound">b'</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a'</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">b'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">L</span><span class="main">)</span> <span class="main">∘</span> α<span class="main">)</span> <span class="bound">e</span>
       <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> α_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uGraph_from_list_invar_def distinct_map <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>  
      <span class="keyword1"><span class="command">using</span></span> α_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> α_def inj_onD old.prod.case prod.inject set_mp<span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
  <span class="keyword1"><span class="command">have</span></span> inj_on_E<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on α <span class="main">(</span>set <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> inj_on_subset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> uGraph_from_list_α_inj_on<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> 

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uGraph_from_list_α_weight_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sum.reindex<span class="main"><span class="main">[</span></span><span class="operator">OF</span> inj_on_E<span class="main"><span class="main">]</span></span> <span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>
 


<span class="keyword1"><span class="command">lemma</span></span> corr<span class="main">:</span> <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">L</span> <span class="main">⟹</span>
  <span class="main">&lt;</span><span class="keyword1">emp</span><span class="main">&gt;</span> kruskal_algo <span class="free">L</span>
     <span class="main">&lt;</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span>uGraph_from_list_invar <span class="bound">F</span> <span class="main">∧</span> set <span class="bound">F</span> <span class="main">⊆</span> set <span class="free">L</span> <span class="main">∧</span>               
       uGraph.minSpanningForest <span class="main">(</span>uGraph_from_list_α_edges <span class="free">L</span><span class="main">)</span>
         <span class="main">(</span>uGraph_from_list_α_weight <span class="free">L</span><span class="main">)</span> <span class="main">(</span>uGraph_from_list_α_edges <span class="bound">F</span><span class="main">)</span><span class="main">)</span><span class="keyword1">&gt;<span class="hidden">⇩</span><sub>t</sub></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">sep_auto</span> <span class="quasi_keyword">heap</span><span class="main"><span class="main">:</span></span> fromlist.kruskal_correct
          <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uGraph_from_list_invar_conv kruskal_algo_def  <span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> uGraph_from_list_invar_subset uGraph_from_list_invar_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">L</span> <span class="main">⟹</span>
  <span class="main">&lt;</span><span class="keyword1">emp</span><span class="main">&gt;</span> kruskal_algo <span class="free">L</span>
     <span class="main">&lt;</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span>uGraph_from_list_invar <span class="bound">F</span> <span class="main">∧</span> set <span class="bound">F</span> <span class="main">⊆</span> set <span class="free">L</span> <span class="main">∧</span>
       uGraph.spanningForest <span class="main">(</span>uGraph_from_list_α_edges <span class="free">L</span><span class="main">)</span> <span class="main">(</span>uGraph_from_list_α_edges <span class="bound">F</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F'</span><span class="main">.</span> uGraph.spanningForest <span class="main">(</span>uGraph_from_list_α_edges <span class="free">L</span><span class="main">)</span> <span class="main">(</span>uGraph_from_list_α_edges <span class="bound">F'</span><span class="main">)</span>
          <span class="main">⟶</span> set <span class="bound">F'</span> <span class="main">⊆</span> set <span class="free">L</span> <span class="main">⟶</span>  sum <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">F</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">F'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="keyword1">&gt;<span class="hidden">⇩</span><sub>t</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> fromlist <span class="quoted"><span class="free">L</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uGraph_from_list_invar_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">sep_auto</span> <span class="quasi_keyword">heap</span><span class="main"><span class="main">:</span></span> corr <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minSpanningForest_def sum_easier<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Kruskal with input check›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">kruskal'</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> kruskal <span class="main">(</span>return <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span>  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> return <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">()</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">kruskal_checked</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> uGraph_from_list_invar <span class="free"><span class="bound"><span class="entity">L</span></span></span>
                             <span class="keyword1">then</span> <span class="keyword1">do</span> <span class="main">{</span> <span class="bound">F</span> <span class="main">←</span> kruskal' <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">;</span> return <span class="main">(</span>Some <span class="bound">F</span><span class="main">)</span> <span class="main">}</span>
                             <span class="keyword1">else</span> return None<span class="main">)</span>"</span></span>

 
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">&lt;</span><span class="keyword1">emp</span><span class="main">&gt;</span> kruskal_checked <span class="free">L</span> <span class="main">&lt;</span><span class="main">λ</span>
    Some <span class="bound">F</span> <span class="main">⇒</span> <span class="main">↑</span> <span class="main">(</span>uGraph_from_list_invar <span class="free">L</span> <span class="main">∧</span> set <span class="bound">F</span> <span class="main">⊆</span> set <span class="free">L</span>
       <span class="main">∧</span> uGraph.minSpanningForest <span class="main">(</span>uGraph_from_list_α_edges <span class="free">L</span><span class="main">)</span> <span class="main">(</span>uGraph_from_list_α_weight <span class="free">L</span><span class="main">)</span>
           <span class="main">(</span>uGraph_from_list_α_edges <span class="bound">F</span><span class="main">)</span><span class="main">)</span>
  <span class="main">|</span> None <span class="main">⇒</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> uGraph_from_list_invar <span class="free">L</span><span class="main">)</span><span class="keyword1">&gt;<span class="hidden">⇩</span><sub>t</sub></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> kruskal_checked_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">L</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"uGraph_from_list_invar <span class="free">L</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> fromlist <span class="quoted"><span class="free">L</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uGraph_from_list_invar_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> kruskal'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sep_auto</span> <span class="quasi_keyword">heap</span><span class="main"><span class="main">:</span></span> kruskal_correct<span class="main">)</span>   
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sep_auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code export›</span></span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">uGraph_from_list_invar</span></span> <span class="keyword2"><span class="keyword">checking</span></span> SML_imp
<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">kruskal_checked</span></span> <span class="keyword2"><span class="keyword">checking</span></span> SML_imp

<span class="keyword1"><span class="command">ML_val</span></span> <span class="quoted">‹
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">export_nat</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">integer_of_nat</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">import_nat</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">export_int</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">integer_of_int</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">import_int</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">int_of_integer</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">import_list</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="entity">b</span><span class="main">,</span><span class="entity">c</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">import_nat</span> <span class="entity">a</span><span class="main">,</span> <span class="main">(</span><span class="entity">import_int</span> <span class="entity">b</span><span class="main">,</span> <span class="entity">import_nat</span> <span class="entity">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">export_list</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="main">(</span><span class="entity">b</span><span class="main">,</span><span class="entity">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">export_nat</span> <span class="entity">a</span><span class="main">,</span> <span class="entity">export_int</span> <span class="entity">b</span><span class="main">,</span> <span class="entity">export_nat</span> <span class="entity">c</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">export_Some_list</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> SOME <span class="entity">l</span> <span class="main">=&gt;</span> SOME <span class="main">(</span><span class="entity">export_list</span> <span class="entity">l</span><span class="main">)</span> <span class="main">|</span> NONE <span class="main">=&gt;</span> NONE<span class="main">)</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">kruskal</span> <span class="entity">l</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">kruskal</span><span class="antiquote">}</span></span></span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">import_list</span> <span class="entity">l</span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="entity">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="entity">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">)</span> <span class="main">(</span><span class="main">)</span>
                     |&gt; <span class="entity">export_list</span> 
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">kruskal_checked</span> <span class="entity">l</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">kruskal_checked</span><span class="antiquote">}</span></span></span> <span class="main">(</span><span class="entity">import_list</span> <span class="entity">l</span><span class="main">)</span> <span class="main">(</span><span class="main">)</span>  |&gt; <span class="entity">export_Some_list</span>


  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result</span> <span class="main">=</span> <span class="entity">kruskal</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result4</span> <span class="main">=</span> <span class="entity">kruskal</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~100</span><span class="main">,</span><span class="inner_numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">64</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">13</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">20</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">4</span><span class="main">,</span><span class="inner_numeral">80</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">4</span><span class="main">,</span><span class="inner_numeral">40</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">]</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result'</span> <span class="main">=</span> <span class="entity">kruskal_checked</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result1'</span> <span class="main">=</span> <span class="entity">kruskal_checked</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result2'</span> <span class="main">=</span> <span class="entity">kruskal_checked</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result3'</span> <span class="main">=</span> <span class="entity">kruskal_checked</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result4'</span> <span class="main">=</span> <span class="entity">kruskal_checked</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~100</span><span class="main">,</span><span class="inner_numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">64</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">13</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">20</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span>
                                   <span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">4</span><span class="main">,</span><span class="inner_numeral">80</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">4</span><span class="main">,</span><span class="inner_numeral">40</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">]</span>
›</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Graph_Definition">
<div class="head">
<h1>Theory Graph_Definition</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Undirected Graphs as symmetric directed graphs"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Graph_Definition
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="../Dijkstra_Shortest_Path/Graph.html">Dijkstra_Shortest_Path.Graph</a>
    <a href="../Dijkstra_Shortest_Path/Weight.html">Dijkstra_Shortest_Path.Weight</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_path_undir</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> path <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">is_path_undir</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">∈</span>nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">is_path_undir</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span>
       <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">∈</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">)</span><span class="main">∈</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">is_path_undir</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">nodes_connected</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> is_path_undir <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">degree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">degree</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> card <span class="main">{</span><span class="bound"><span class="bound">e</span></span><span class="main">∈</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∨</span> snd <span class="main">(</span>snd <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> forest <span class="main">=</span> valid_graph <span class="quoted"><span class="free">G</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cycle_free<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>E<span class="main">.</span> <span class="main">¬</span> nodes_connected <span class="main">(</span>delete_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="free">G</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> connected_graph <span class="main">=</span> valid_graph <span class="quoted"><span class="free">G</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> connected<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>V<span class="main">.</span> <span class="main">∀</span><span class="bound">v'</span><span class="main">∈</span>V<span class="main">.</span> nodes_connected <span class="free">G</span> <span class="bound">v</span> <span class="bound">v'</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> tree <span class="main">=</span> forest <span class="main">+</span> connected_graph

<span class="keyword1"><span class="command">locale</span></span> finite_graph <span class="main">=</span> valid_graph <span class="quoted"><span class="free">G</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> graph"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_E<span class="main">:</span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    finite_V<span class="main">:</span> <span class="quoted"><span class="quoted">"finite V"</span></span>

<span class="keyword1"><span class="command">locale</span></span> finite_weighted_graph <span class="main">=</span> finite_graph <span class="quoted"><span class="free">G</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span><span class="tfree">'w</span><span class="main">::</span>weight<span class="main">)</span> graph"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subgraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subgraph</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⊆</span> edges <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">edge_weight</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="tfree">'w</span><span class="main">::</span>weight"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">edge_weight</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> sum <span class="main">(</span>fst <span class="keyword1">o</span> snd<span class="main">)</span> <span class="main">(</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">edges_less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'w</span><span class="main">::</span>weight <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'w</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">edges_less_eq</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> fst<span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">≤</span> fst<span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maximally_connected</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">maximally_connected</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">v'</span><span class="main">∈</span>nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span>
    <span class="main">(</span>nodes_connected <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>nodes_connected <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spanning_forest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">spanning_forest</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> forest <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> maximally_connected <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> subgraph <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">optimal_forest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">::</span>weight<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">optimal_forest</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph<span class="main">.</span>
      spanning_forest <span class="bound">F'</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟶</span> edge_weight <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≤</span> edge_weight <span class="bound">F'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minimum_spanning_forest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">::</span>weight<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minimum_spanning_forest</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> spanning_forest <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> optimal_forest <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spanning_tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">spanning_tree</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> tree <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> subgraph <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">optimal_tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">::</span>weight<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">optimal_tree</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F'</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph<span class="main">.</span>
      spanning_tree <span class="bound">F'</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟶</span> edge_weight <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≤</span> edge_weight <span class="bound">F'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minimum_spanning_tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">::</span>weight<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'w</span><span class="main">)</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minimum_spanning_tree</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> spanning_tree <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> optimal_tree <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Helping lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nodes_delete_edge<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edge_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> edges_delete_edge<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"edges <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">e</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edge_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> subgraph_node<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> nodes <span class="free">G</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">∈</span> nodes <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> delete_add_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> nodes <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> nodes <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">∉</span> edges <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">c</span> <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">c</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> delete_edge_def add_edge_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> swap_delete_add_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"delete_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">(</span>add_edge <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> add_edge <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> delete_edge_def add_edge_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> swap_delete_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">(</span>delete_edge <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">H</span><span class="main">)</span>
           <span class="main">=</span> delete_edge <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_edge_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> valid_graph
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> valid_subgraph<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms E_valid <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def valid_graph_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">lemma</span></span> is_path_undir_simps<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="main">[]</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">v</span><span class="main">∈</span>V"</span></span>
    <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="main">[</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">]</span> <span class="free">v'</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>E <span class="main">∨</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">∈</span>E"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> is_path_undir_memb<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span> <span class="main">⟹</span> <span class="free">v</span><span class="main">∈</span>V <span class="main">∧</span> <span class="free">v'</span><span class="main">∈</span>V"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">lemma</span></span> is_path_undir_memb_edges<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> E <span class="main">∨</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> E"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> is_path_undir_split<span class="main">:</span>
    <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="main">(</span><span class="free">p1</span><span class="main">@</span><span class="free">p2</span><span class="main">)</span> <span class="free">v'</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="free">p1</span> <span class="bound">u</span> <span class="main">∧</span> is_path_undir <span class="free">G</span> <span class="bound">u</span> <span class="free">p2</span> <span class="free">v'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> is_path_undir_split'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="main">(</span><span class="free">p1</span><span class="main">@</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">u'</span><span class="main">)</span><span class="main">#</span><span class="free">p2</span><span class="main">)</span> <span class="free">v'</span>
      <span class="main">⟷</span> is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="free">p1</span> <span class="free">u</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">u'</span><span class="main">)</span><span class="main">∈</span>E <span class="main">∨</span> <span class="main">(</span><span class="free">u'</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">∈</span>E<span class="main">)</span> <span class="main">∧</span> is_path_undir <span class="free">G</span> <span class="free">u'</span> <span class="free">p2</span> <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_path_undir_split<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> is_path_undir_sym<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v'</span> <span class="main">(</span>rev <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">u'</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u'</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> is_path_undir_subgraph<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_path_undir.simps
    <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> no_path_in_empty_graph<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"E <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> is_path_undir_split_distinct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p'</span> <span class="bound">p''</span> <span class="bound">u</span> <span class="bound">u'</span><span class="main">.</span>
            is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="bound">p'</span> <span class="bound">u</span> <span class="main">∧</span> is_path_undir <span class="free">G</span> <span class="bound">u'</span> <span class="bound">p''</span> <span class="free">v'</span> <span class="main">∧</span>
            length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="free">p</span> <span class="main">∧</span> length <span class="bound">p''</span> <span class="main">&lt;</span> length <span class="free">p</span> <span class="main">∧</span>
            <span class="main">(</span><span class="bound">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p'</span> <span class="main">∧</span>
            <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p''</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p''</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="skolem">n</span> <span class="main"><span class="main">==</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="skolem">u'</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> split_list <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">p''</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="skolem">u'</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p''</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p'</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> len_p''<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p''</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1 p <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">p'</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p''<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1 len_p' p' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p'</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p'</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p'2</span> <span class="bound">u2</span><span class="main">.</span>
            is_path_undir <span class="free">G</span> <span class="skolem">v</span> <span class="bound">p'2</span> <span class="bound">u2</span> <span class="main">∧</span>
            length <span class="bound">p'2</span> <span class="main">&lt;</span> length <span class="skolem">p'</span> <span class="main">∧</span>
            <span class="bound">u2</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span>
            <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p'2</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p'2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> len_p' p' u <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span> <span class="bound">u</span><span class="main">.</span> is_path_undir <span class="free">G</span> <span class="skolem">v</span> <span class="bound">p'</span> <span class="bound">u</span> <span class="main">∧</span> length <span class="bound">p'</span> <span class="main">&lt;</span> length <span class="skolem">p</span> <span class="main">∧</span>
      <span class="bound">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> 1 len_p'' p'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p''</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p''</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p''2</span> <span class="bound">u'2</span><span class="main">.</span>
            is_path_undir <span class="free">G</span> <span class="bound">u'2</span> <span class="bound">p''2</span> <span class="skolem">v'</span> <span class="main">∧</span>
            length <span class="bound">p''2</span> <span class="main">&lt;</span> length <span class="skolem">p''</span> <span class="main">∧</span>
            <span class="bound">u'2</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span>
            <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p''2</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p''2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> len_p'' p'' u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p''</span> <span class="bound">u'</span><span class="main">.</span> is_path_undir <span class="free">G</span> <span class="bound">u'</span> <span class="bound">p''</span> <span class="skolem">v'</span><span class="main">∧</span> length <span class="bound">p''</span> <span class="main">&lt;</span> length <span class="skolem">p</span> <span class="main">∧</span>
      <span class="bound">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p''</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="bound">p''</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> p' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> add_edge_is_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> E_valid <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> valid_graph_def add_edge_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms is_path_undir.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"add_edge <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">b</span></span> <span class="free"><span class="free">c</span></span> <span class="free"><span class="free">G</span></span>"</span></span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> add_edge_was_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> V"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> V"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> E_valid <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> valid_graph_def add_edge_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms is_path_undir.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"add_edge <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">b</span></span> <span class="free"><span class="free">c</span></span> <span class="free"><span class="free">G</span></span>"</span></span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> delete_edge_is_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> E_valid <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> valid_graph_def delete_edge_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms is_path_undir.simps<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"delete_edge <span class="free"><span class="free">a</span></span> <span class="free"><span class="free">b</span></span> <span class="free"><span class="free">c</span></span> <span class="free"><span class="free">G</span></span>"</span></span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> delete_node_is_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> fst<span class="main">`</span>set <span class="free">p</span> <span class="main">∪</span> snd<span class="main">`</span>snd<span class="main">`</span>set <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> delete_node_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> delete_edge_was_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> subset_was_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">H</span> <span class="main">⊆</span> E"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">H</span> <span class="main">⊆</span> V"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> delete_node_was_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">x</span> <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> delete_node_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> add_edge_preserve_subgraph<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> E"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms E_validD <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> nodes <span class="free">H</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> nodes <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> delete_edge_preserve_subgraph<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> add_delete_edge<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> E"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">c</span> <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms E_validD <span class="keyword1"><span class="command">unfolding</span></span> delete_edge_def add_edge_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> swap_add_edge_in_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">w'</span><span class="main">,</span><span class="free">a'</span><span class="main">)</span> <span class="main">∈</span> E <span class="main">∨</span> <span class="main">(</span><span class="free">a'</span><span class="main">,</span><span class="free">w'</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> E"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> is_path_undir <span class="main">(</span>add_edge <span class="free">a'</span> <span class="free">w''</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="bound">p</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> E_validD
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a'</span> <span class="free">w''</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">[]</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">p'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">e_w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v2</span><span class="main">,</span> <span class="skolem">e_w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">e_w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
         edge_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">e_w</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> edges <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span>
                   <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">e_w</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> edges <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
         p'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">p'</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> is_path_undir <span class="main">(</span>add_edge <span class="free">a'</span> <span class="free">w''</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">v</span> <span class="bound">p</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> True e assms<span class="main">(</span>2<span class="main">)</span> E_validD
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a'</span> <span class="free">w''</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">[</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">w'</span><span class="main">,</span><span class="free">a'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">a'</span><span class="main">,</span><span class="free">w''</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">]</span> <span class="skolem">x</span>
          <span class="main">∨</span> is_path_undir <span class="main">(</span>add_edge <span class="free">a'</span> <span class="free">w''</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">[</span><span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">w''</span><span class="main">,</span><span class="free">a'</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">a'</span><span class="main">,</span><span class="free">w'</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">]</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> edge_e e
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a'</span> <span class="free">w''</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> p' Cons.IH 
     <span class="keyword2"><span class="keyword">and</span></span> valid_graph.is_path_undir_split<span class="main">[</span><span class="operator">OF</span> add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_graph.intro<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E_valid<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> induce_maximally_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>E<span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> valid_subgraph<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="free">G</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> valid_H<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nodes_connected <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>nodes_connected <span class="free">H</span> <span class="skolem">v</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟶</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span><span class="main">∈</span>V"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="skolem">v'</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">p</span> <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">with</span></span> subgraph_node<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_path_undir.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">p</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> prod_cases3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> awb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> assms Cons.prems valid_graph.is_path_undir_sym<span class="main">[</span><span class="operator">OF</span> valid_H<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="skolem">a</span> <span class="skolem">p'</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">from</span></span> assms awb Cons.prems Cons.IH<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="skolem">b</span> <span class="skolem">p''</span> <span class="skolem">v'</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> Cons.prems awb assms p' valid_graph.is_path_undir_split<span class="main">[</span><span class="operator">OF</span> valid_H<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="skolem">v</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">@</span><span class="skolem">p''</span><span class="main">)</span> <span class="skolem">v'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> maximally_connected_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> add_edge_maximally_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> E"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nodes_connected <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>nodes_connected <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟶</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> vv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> V"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="skolem">v'</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹maximally_connected <span class="free">H</span> <span class="free">G</span>›</span></span> vv' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="skolem">v</span> <span class="skolem">p</span> <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> maximally_connected_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> valid_graph.add_edge_is_path<span class="main">[</span><span class="operator">OF</span> valid_subgraph<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="free">G</span>›</span></span><span class="main"><span class="main">]</span></span> this<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> maximally_connected_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> delete_edge_maximally_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> pab<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">a</span> <span class="free">pab</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> valid_subgraph<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="free">G</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> valid_H<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nodes_connected <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>nodes_connected <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">v'</span><span class="main">)</span>"</span></span> 
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟶</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> vv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> V"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="skolem">v'</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹maximally_connected <span class="free">H</span> <span class="free">G</span>›</span></span> vv' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="skolem">v</span> <span class="skolem">p</span> <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> maximally_connected_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> p valid_graph.is_path_undir_split_distinct<span class="main">[</span><span class="operator">OF</span> valid_H p<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">u'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="skolem">v</span> <span class="skolem">p'</span> <span class="skolem">u</span> <span class="main">∧</span> is_path_undir <span class="free">H</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p'</span> <span class="main">∧</span>
            <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p''</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p''</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> valid_graph.delete_edge_is_path<span class="main">[</span><span class="operator">OF</span> valid_H<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">p''</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">p'</span> <span class="skolem">u</span> <span class="main">∧</span>
                 is_path_undir <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="skolem">v'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">note</span></span> dev_H <span class="main">=</span> delete_edge_valid<span class="main">[</span><span class="operator">OF</span> valid_H<span class="main">]</span>
        <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> valid_graph.is_path_undir_split<span class="main">[</span><span class="operator">OF</span> dev_H<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">from</span></span> valid_graph.is_path_undir_sym<span class="main">[</span><span class="operator">OF</span> delete_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_H<span class="main"><span class="main">]</span></span> pab<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pab'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">b</span> <span class="skolem">pab'</span> <span class="free">a</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> assms u p' valid_graph.is_path_undir_split<span class="main">[</span><span class="operator">OF</span> dev_H<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">p''</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
          *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="free">pab</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">@</span><span class="free">pab</span>"</span></span> <span class="quoted"><span class="skolem">p''</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">pab'</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">@</span><span class="skolem">pab'</span>"</span></span> <span class="quoted"><span class="skolem">p''</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> valid_graph.delete_edge_is_path<span class="main">[</span><span class="operator">OF</span> valid_H p<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> maximally_connected_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> connected_impl_maximally_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_graph <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> subgraph<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> connected_graph_def connected_graph_axioms_def maximally_connected_def
      subgraph_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">lemma</span></span> add_edge_is_connected<span class="main">:</span>
    <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
    <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span> <span class="free">c</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> valid_graph.is_path_undir_simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span>
        add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_graph_axioms<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span>
      valid_graph.is_path_undir_simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span>
        add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_graph_axioms<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> swap_edges<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> V"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> V"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="free">G</span> <span class="free">v</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">w'</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">p</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> awb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> add_edge_was_path<span class="main">[</span><span class="operator">OF</span> p _ _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>4<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> valid_graph.is_path_undir_split_distinct<span class="main">[</span><span class="operator">OF</span>
        add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_graph_axioms<span class="main"><span class="main">]</span></span> p awb<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
         <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">p'</span> <span class="skolem">u</span> <span class="main">∧</span>
          is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p'</span> <span class="main">∧</span>
          <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p''</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p''</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> add_edge_was_path
    <span class="keyword1"><span class="command">have</span></span> paths<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="skolem">p'</span> <span class="skolem">u</span> <span class="main">∧</span>
                 is_path_undir <span class="free">G</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> is_path_undir_split<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">p''</span></span> <span class="quoted"><span class="free">v'</span></span><span class="main">]</span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">u'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> paths assms add_edge_is_path
    <span class="keyword1"><span class="command">have</span></span> paths'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">w'</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="skolem">p'</span> <span class="skolem">u</span> <span class="main">∧</span>
                  is_path_undir <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">w'</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> add_edge_valid<span class="main">[</span><span class="operator">OF</span> valid_graph_axioms<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> add_edge_is_connected <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'''</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">w'</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="free">v'</span> <span class="skolem">p'''</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> paths' valid_graph.is_path_undir_split<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w'</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">p''</span></span> <span class="quoted"><span class="skolem">p'''</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">w'</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">u'</span> <span class="main">(</span><span class="skolem">p''</span><span class="main">@</span><span class="skolem">p'''</span><span class="main">)</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> paths' valid_graph.is_path_undir_split<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w'</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span><span class="main">@</span><span class="skolem">p'''</span>"</span></span> <span class="quoted"><span class="skolem">p'</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">w'</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">u'</span> <span class="main">(</span><span class="skolem">p''</span><span class="main">@</span><span class="skolem">p'''</span><span class="main">@</span><span class="skolem">p'</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> u <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">u'</span>›</span></span> valid_graph.is_path_undir_sym<span class="main">[</span><span class="operator">OF</span> * this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> subgraph_impl_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_graph <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> subgraph<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected_graph <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_path_undir_subgraph<span class="main">[</span><span class="operator">OF</span> _ subgraph<span class="main">]</span> valid_graph_axioms
    <span class="keyword1"><span class="command">unfolding</span></span> connected_graph_def connected_graph_axioms_def maximally_connected_def
      subgraph_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">lemma</span></span> add_node_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>V <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>V <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span><span class="main">.</span> nodes_connected <span class="free">G</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> E <span class="main">∨</span> <span class="main">(</span><span class="free">v'</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> E"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>V<span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>V<span class="main">.</span> nodes_connected <span class="free">G</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">G</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span>V"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="free">v</span>›</span></span> a is_path_undir_simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> V"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> b assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">G</span> <span class="free">v'</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="free">v</span>›</span></span> is_path_undir.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> V"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> a assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">v'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">G</span> <span class="skolem">a</span> <span class="free">v'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="free">v</span>›</span></span> is_path_undir.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
          is_path_undir_sym
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> assms<span class="main">(</span>1<span class="main">)</span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> connected_graph
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> maximally_connected_impl_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> subgraph<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected_graph <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms connected_graph_axioms valid_subgraph<span class="main">[</span><span class="operator">OF</span> subgraph<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> connected_graph_def connected_graph_axioms_def maximally_connected_def
      subgraph_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> forest
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">lemmas</span></span> delete_edge_valid' <span class="main">=</span> delete_edge_valid<span class="main">[</span><span class="operator">OF</span> valid_graph_axioms<span class="main">]</span>

  <span class="keyword1"><span class="command">lemma</span></span> delete_edge_from_path<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">G</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="free">H</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> E <span class="main">-</span> edges <span class="free">H</span><span class="main">.</span>  <span class="main">(</span><span class="main">¬</span> nodes_connected <span class="main">(</span>delete_edge <span class="bound">x</span> <span class="bound">w</span> <span class="bound">y</span> <span class="free">G</span><span class="main">)</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>nodes_connected <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w'</span> <span class="free">b</span> <span class="main">(</span>delete_edge <span class="bound">x</span> <span class="bound">w</span> <span class="bound">y</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">a</span> <span class="skolem">p</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="skolem">n</span> <span class="main"><span class="main">==</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">from</span></span> valid_subgraph<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> valid_H<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="skolem">a</span> <span class="main">[]</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">p'</span><span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a2</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> Cons <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">)</span> Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> e12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">e2</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">e1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          edge_e12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> E"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> Cons e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="skolem">a'</span> <span class="skolem">p'</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> is_path_undir_split_distinct<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">]</span> Cons
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'_dst</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span>  p'_dst<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="skolem">u'</span> <span class="skolem">p'_dst</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">u'</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">a'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            e_not_in_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">a'</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p'_dst</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p'_dst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            len_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">p'_dst</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> <span class="skolem">a'</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> 1 len_p' p'_dst <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> p'_dst <span class="keyword1"><span class="command">have</span></span> path_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="skolem">a'</span> <span class="skolem">p'_dst</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">H</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="free">H</span> <span class="skolem">a'</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">H</span> <span class="skolem">a'</span> <span class="skolem">b</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p_H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="skolem">a'</span> <span class="skolem">p_H</span> <span class="skolem">b</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> True e12 e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">p_H</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> path_p' 1<span class="main">(</span>1<span class="main">)</span> len_p' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> E <span class="main">-</span> edges <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              IH1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span>nodes_connected <span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">y</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a'</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              IH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nodes_connected <span class="main">(</span>add_edge <span class="skolem">a'</span> <span class="free">w'</span> <span class="skolem">b</span> <span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">y</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> xy_neq_e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> thm1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">y</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">y</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p_e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">y</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">p_e</span> <span class="skolem">b</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> edge_e12 e12 e xy_neq_e
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">y</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a'</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a'</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">p_e</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> IH1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">from</span></span> IH2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p_xy</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="skolem">a'</span> <span class="free">w'</span> <span class="skolem">b</span> <span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">y</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">p_xy</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> valid_graph.swap_add_edge_in_path<span class="main">[</span><span class="operator">OF</span> delete_edge_valid' this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">w'</span></span><span class="main">]</span> edge_e12
              e12 e edges_delete_edge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> xy_neq_e
            <span class="keyword1"><span class="command">have</span></span> thm2<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>add_edge <span class="skolem">a</span> <span class="free">w'</span> <span class="skolem">b</span> <span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">z</span> <span class="skolem">y</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> thm1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> xy <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">have</span></span> thm1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="main">(</span>delete_edge <span class="skolem">e1</span> <span class="skolem">w</span> <span class="skolem">e2</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>delete_edge <span class="skolem">e1</span> <span class="skolem">w</span> <span class="skolem">e2</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p_e</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_e<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="skolem">e1</span> <span class="skolem">w</span> <span class="skolem">e2</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">p_e</span> <span class="skolem">b</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> delete_edge_is_path<span class="main">[</span><span class="operator">OF</span> path_p'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">e1</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">e2</span></span><span class="main">]</span> e_not_in_p' e12 e
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="skolem">e1</span> <span class="skolem">w</span> <span class="skolem">e2</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a'</span> <span class="skolem">p'_dst</span> <span class="skolem">b</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> valid_graph.is_path_undir_sym<span class="main">[</span><span class="operator">OF</span> delete_edge_valid' this<span class="main">]</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p_rev</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="skolem">e1</span> <span class="skolem">w</span> <span class="skolem">e2</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">b</span> <span class="skolem">p_rev</span> <span class="skolem">a'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> p_e valid_graph.is_path_undir_split<span class="main">[</span><span class="operator">OF</span> delete_edge_valid'<span class="main">]</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>delete_edge <span class="skolem">e1</span> <span class="skolem">w</span> <span class="skolem">e2</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">(</span><span class="skolem">p_e</span><span class="main">@</span><span class="skolem">p_rev</span><span class="main">)</span> <span class="skolem">a'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> cycle_free edge_e12 e12 e
                <span class="keyword2"><span class="keyword">and</span></span> valid_graph.is_path_undir_sym<span class="main">[</span><span class="operator">OF</span> delete_edge_valid' this<span class="main">]</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                <span class="keyword1"><span class="command">unfolding</span></span> valid_graph_def
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">note</span></span> ** <span class="main">=</span> delete_edge_is_path<span class="main">[</span><span class="operator">OF</span> path_p'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">e1</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">e2</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">from</span></span> valid_graph.is_path_undir_split<span class="main">[</span><span class="operator">OF</span> add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delete_edge_valid'<span class="main"><span class="main">]</span></span><span class="main">]</span>
              valid_graph.add_edge_is_path<span class="main">[</span><span class="operator">OF</span> delete_edge_valid' **<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">w'</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
              valid_graph.is_path_undir_simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delete_edge_valid'<span class="main"><span class="main">]</span></span><span class="main">,</span>
                                                 <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="free">w'</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">e1</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">e2</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="free">w'</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
              e_not_in_p' e12 e
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="skolem">a</span> <span class="free">w'</span> <span class="skolem">b</span> <span class="main">(</span>delete_edge <span class="skolem">e1</span> <span class="skolem">w</span> <span class="skolem">e2</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a'</span> <span class="main">(</span><span class="skolem">p'_dst</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="free">w'</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">a</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> valid_graph.is_path_undir_sym<span class="main">[</span><span class="operator">OF</span> add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> delete_edge_valid'<span class="main"><span class="main">]</span></span> this<span class="main">]</span>
              e12 e
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>add_edge <span class="skolem">a</span> <span class="free">w'</span> <span class="skolem">b</span> <span class="main">(</span>delete_edge <span class="skolem">e1</span> <span class="skolem">w</span> <span class="skolem">e2</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">e1</span> <span class="skolem">e2</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> thm1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> False edge_e12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> forest_add_edge<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> V"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> V"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="free">G</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_path_undir <span class="free">G</span> <span class="free">a</span> <span class="main">[</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span><span class="main">]</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> awb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> E <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> E"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="main">(</span>delete_edge <span class="skolem">v</span> <span class="skolem">w'</span> <span class="skolem">v'</span> <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">v'</span>"</span></span>
       <span class="keyword2"><span class="keyword">if</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w'</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span> edges <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="skolem">w'</span> <span class="skolem">v'</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w'</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> assms awb delete_add_edge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> e <span class="keyword1"><span class="command">have</span></span> e'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w'</span><span class="main">,</span><span class="skolem">v'</span><span class="main">)</span><span class="main">∈</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>delete_edge <span class="skolem">v</span> <span class="skolem">w'</span> <span class="skolem">v'</span> <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> swap_delete_add_edge<span class="main">[</span><span class="operator">OF</span> False<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span>
          valid_graph.swap_edges<span class="main">[</span><span class="operator">OF</span> delete_edge_valid'<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">w'</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">w'</span></span><span class="main">]</span>
          add_delete_edge<span class="main">[</span><span class="operator">OF</span> e'<span class="main">]</span> cycle_free assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> e'
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">G</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> cycle_free add_edge_valid<span class="main">[</span><span class="operator">OF</span> valid_graph_axioms<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> forest_def forest_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> forest_subsets<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">H</span> <span class="main">⊆</span> E"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">H</span> <span class="main">⊆</span> V"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹edges <span class="free">H</span> <span class="main">⊆</span> E›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> edges<span class="main">:</span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹nodes <span class="free">H</span> <span class="main">⊆</span> V›</span></span> 
      <span class="keyword1"><span class="command">have</span></span> nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> nodes <span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> asm valid_graph.subset_was_path<span class="main">[</span><span class="operator">OF</span> delete_edge_valid' _ edges nodes<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> cycle_free e <span class="quoted"><span class="quoted">‹edges <span class="free">H</span> <span class="main">⊆</span> E›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> forest_def forest_axioms_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> subgraph_forest<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"forest <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms forest_subsets valid_subgraph
    <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">lemma</span></span> forest_delete_edge<span class="main">:</span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">w</span> <span class="free">c</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> forest_subsets<span class="main">[</span><span class="operator">OF</span> delete_edge_valid'<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> delete_edge_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> forest_delete_node<span class="main">:</span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>delete_node <span class="free">n</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> forest_subsets<span class="main">[</span><span class="operator">OF</span> delete_node_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_graph_axioms<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> delete_node_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> finite_graph
<span class="keyword2"><span class="keyword">begin</span></span>
 

  <span class="keyword1"><span class="command">lemma</span></span> finite_subgraphs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">T</span><span class="main">.</span> subgraph <span class="bound">T</span> <span class="free">G</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> finite_E <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">E'</span><span class="main">.</span> <span class="bound">E'</span> <span class="main">⊆</span> E<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">⦇</span>nodes <span class="main">=</span> V<span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span><span class="main">⦈</span><span class="main">|</span> <span class="bound">E'</span><span class="main">.</span> <span class="bound">E'</span> <span class="main">⊆</span> E<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⦇</span>nodes <span class="main">=</span> V<span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span><span class="main">⦈</span><span class="main">|</span> <span class="bound">E'</span><span class="main">.</span> <span class="bound">E'</span> <span class="main">⊆</span> E<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">T</span><span class="main">.</span> subgraph <span class="bound">T</span> <span class="free">G</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> old.unit.exhaust select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> surjective<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> minimum_spanning_forest_impl_tree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"minimum_spanning_forest <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> valid_G<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected_graph <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minimum_spanning_tree <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms valid_graph.connected_impl_maximally_connected<span class="main">[</span><span class="operator">OF</span> valid_G<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> minimum_spanning_forest_def minimum_spanning_tree_def
    spanning_forest_def spanning_tree_def tree_def
    optimal_forest_def optimal_tree_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> minimum_spanning_forest_impl_tree2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"minimum_spanning_forest <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> connected_G<span class="main">:</span> <span class="quoted"><span class="quoted">"connected_graph <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minimum_spanning_tree <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms connected_graph.maximally_connected_impl_connected<span class="main">[</span><span class="operator">OF</span> connected_G<span class="main">]</span>
    minimum_spanning_forest_impl_tree connected_graph.axioms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> connected_G<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> minimum_spanning_forest_def spanning_forest_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Graph_Definition_Aux">
<div class="head">
<h1>Theory Graph_Definition_Aux</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Auxiliary lemmas for graphs"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Graph_Definition_Aux
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Graph_Definition.html">Graph_Definition</a> <a href="SeprefUF.html">SeprefUF</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> valid_graph
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  nodes_connected_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">G</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> nodes_connected <span class="free">G</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_path_undir_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span>  Domain_nodes_connected<span class="main">:</span> <span class="quoted"><span class="quoted">"Domain <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">G</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> V"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span>  Range_nodes_connected<span class="main">:</span> <span class="quoted"><span class="quoted">"Range <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">G</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> V"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">― ‹adaptation of a proof by Julian Biendarra›</span>
<span class="keyword1"><span class="command">lemma</span></span>   nodes_connected_insert_per_union<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>nodes_connected <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> per_union <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span>  <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> PER<span class="main">:</span> <span class="quoted"><span class="quoted">"part_equiv <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span>V"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?uf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> valid_subgraph<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="free">G</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> valid_H<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> nodes_H<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="free">H</span> <span class="main">=</span> V"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span>V›</span></span>
  <span class="keyword1"><span class="command">have</span></span> nodes_add_H<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Domain <span class="var">?uf</span> <span class="main">=</span> nodes <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_graph.Domain_nodes_connected<span class="main">[</span><span class="operator">OF</span> valid_H<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">x</span> <span class="skolem">p</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹Domain <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">|</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> nodes <span class="free">H</span>›</span></span> nodes_H
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span>Domain <span class="main">(</span>per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span>Domain <span class="main">(</span>per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> PER <span class="keyword1"><span class="command">have</span></span> PER'<span class="main">:</span> <span class="quoted"><span class="quoted">"part_equiv <span class="main">(</span>per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> union_part_equivp<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span> <span class="main">∨</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> valid_graph.is_path_undir_split_distinct<span class="main">[</span><span class="operator">OF</span> add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_H<span class="main"><span class="main">]</span></span> p True<span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">x</span> <span class="skolem">p'</span> <span class="skolem">u</span> <span class="main">∧</span>
        is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∧</span> <span class="skolem">u'</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p'</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p''</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p''</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹Domain <span class="var">?uf</span> <span class="main">=</span> nodes <span class="free">H</span>›</span></span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="free">G</span>›</span></span>
        valid_graph.add_edge_was_path<span class="main">[</span><span class="operator">OF</span> valid_H<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="free">x</span> <span class="skolem">p'</span> <span class="skolem">u</span> <span class="main">∧</span> is_path_undir <span class="free">H</span> <span class="skolem">u'</span> <span class="skolem">p''</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> V  u nodes_H <span class="keyword1"><span class="command">have</span></span> comps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u'</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> comps  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> per_union_impl<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> u <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹Domain <span class="var">?uf</span> <span class="main">=</span> nodes <span class="free">H</span>›</span></span> nodes_H
        part_equiv_refl'<span class="main">[</span><span class="operator">OF</span> PER' <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">∈</span>Domain <span class="main">(</span>per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>›</span></span><span class="main">]</span>
        part_equiv_refl'<span class="main">[</span><span class="operator">OF</span> PER' <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span>Domain <span class="main">(</span>per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span><span class="main">)</span>›</span></span><span class="main">]</span> part_equiv_sym<span class="main">[</span><span class="operator">OF</span> PER'<span class="main">]</span>
        per_union_related<span class="main">[</span><span class="operator">OF</span> PER<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span> <span class="main">∈</span> per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="main">(</span>part_equiv_trans<span class="main">[</span><span class="operator">OF</span> PER'<span class="main">]</span><span class="main">)</span> <span class="keyword1"><span class="command">from</span></span> comps 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> per_union_impl<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="main">(</span>part_equiv_trans<span class="main">[</span><span class="operator">OF</span> PER'<span class="main">]</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span>V›</span></span> nodes_H valid_graph.add_edge_was_path<span class="main">[</span><span class="operator">OF</span> valid_H p<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="free">x</span> <span class="skolem">p</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span>     nodes_add_H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">∈</span><span class="var">?uf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> per_union_impl<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> per_union <span class="var">?uf</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> nodes_add_H <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">H</span> <span class="free">x</span> <span class="free">y</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> valid_graph.add_edge_is_path<span class="main">[</span><span class="operator">OF</span> valid_H<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> asm part_equiv_sym<span class="main">[</span><span class="operator">OF</span> PER<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span> <span class="main">∧</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span> <span class="main">∨</span>
              <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span> <span class="main">∧</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?uf</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> per_union_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">a</span><span class="main">∈</span>V›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span><span class="main">∈</span>V›</span></span> nodes_H nodes_add_H <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">H</span> <span class="free">x</span> <span class="skolem">p</span> <span class="free">a</span> <span class="main">∧</span> is_path_undir <span class="free">H</span> <span class="free">b</span> <span class="skolem">q</span> <span class="free">y</span> <span class="main">∨</span>
                 is_path_undir <span class="free">H</span> <span class="free">x</span> <span class="skolem">p'</span> <span class="free">b</span> <span class="main">∧</span> is_path_undir <span class="free">H</span> <span class="free">a</span> <span class="skolem">q'</span> <span class="free">y</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">with</span></span> valid_graph.add_edge_is_path<span class="main">[</span><span class="operator">OF</span> valid_H<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">x</span> <span class="skolem">p</span> <span class="free">a</span> <span class="main">∧</span>
              is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">b</span> <span class="skolem">q</span> <span class="free">y</span> <span class="main">∨</span>
              is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">x</span> <span class="skolem">p'</span> <span class="free">b</span> <span class="main">∧</span>
              is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">a</span> <span class="skolem">q'</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> valid_graph.is_path_undir_split'<span class="main">[</span><span class="operator">OF</span> add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_H<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">x</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">y</span> <span class="main">∨</span>
              is_path_undir <span class="main">(</span>add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="free">H</span><span class="main">)</span> <span class="free">x</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">@</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">q'</span><span class="main">)</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> valid_graph.is_path_undir_sym<span class="main">[</span><span class="operator">OF</span> add_edge_valid<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_H<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span>  is_path_undir_append<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="free">p1</span> <span class="free">u</span> <span class="main">⟹</span> is_path_undir <span class="free">G</span> <span class="free">u</span> <span class="free">p2</span> <span class="free">w</span>
      <span class="main">⟹</span> is_path_undir <span class="free">G</span> <span class="free">v</span> <span class="main">(</span><span class="free">p1</span><span class="main">@</span><span class="free">p2</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_path_undir_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemma</span></span> 
  augment_edge<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G1</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G2</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="free">G1</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> notinE2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="free">G2</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="free">G2</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">∉</span> edges <span class="free">G2</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">∈</span> edges <span class="free">G1</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">a</span><span class="main">=</span><span class="bound">aa</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">ba</span> <span class="main">∨</span> <span class="bound">a</span><span class="main">=</span><span class="bound">ba</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="bound">aa</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> sg <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="free">G1</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"nodes <span class="free">G2</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G1</span> <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> notinE2 <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> is_path_undir <span class="free">G2</span> <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">=</span><span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span>nodes <span class="free">G1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G2</span> <span class="skolem">u</span> <span class="main">[]</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="free">G2</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">with</span></span> Nil<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> axy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">=</span><span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">=</span><span class="skolem">u'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">x</span><span class="main">=</span><span class="skolem">u'</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">=</span><span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G1</span> <span class="skolem">u'</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uwE1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G1</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G2</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G2</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> e2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> is_path_undir <span class="free">G2</span> <span class="skolem">u'</span> <span class="bound">p</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G2</span> <span class="skolem">u'</span> <span class="skolem">p2</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> True axy 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G2</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">p2</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> e' e2'<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> e2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> is_path_undir <span class="free">G2</span> <span class="skolem">u'</span> <span class="bound">p</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> e' e2'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> e2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> is_path_undir <span class="free">G2</span> <span class="skolem">u'</span> <span class="bound">p</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G2</span> <span class="skolem">u'</span> <span class="skolem">p1</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

      <span class="keyword1"><span class="command">from</span></span> False axy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">∉</span>edges <span class="free">G2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="free">G2</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  <span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p2</span> 
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G2</span> <span class="skolem">u</span> <span class="skolem">p2</span> <span class="skolem">u'</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> p1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_path_undir <span class="free">G2</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">@</span><span class="skolem">p1</span><span class="main">)</span> <span class="free">v</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> valid_graph.is_path_undir_append<span class="main">[</span><span class="operator">OF</span> valid_subgraph<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> uwE1   
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">u'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  nodes_connected_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span>V <span class="main">⟹</span> nodes_connected <span class="free">G</span> <span class="free">a</span> <span class="free">a</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  


<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> sg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> connected_VV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⊆</span> V<span class="main">×</span>V"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> connected_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"refl_on V <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> connected_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> connected_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> connected_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv V <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">R</span> <span class="bound">S</span><span class="main">.</span> Domain <span class="bound">R</span> <span class="main">⊆</span> <span class="bound">S</span> <span class="main">⟹</span> Range <span class="bound">R</span> <span class="main">⊆</span> <span class="bound">S</span> <span class="main">⟹</span> <span class="bound">R</span> <span class="main">⊆</span> <span class="bound">S</span><span class="main">×</span><span class="bound">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> sg <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="free">H</span> <span class="main">=</span> V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sg valid_subgraph <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="free">H</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> valid_graph.Domain_nodes_connected<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> valid_graph.Range_nodes_connected<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⊆</span> V<span class="main">×</span>V"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> *<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> V <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> valid_graph.nodes_connected_refl<span class="main">[</span><span class="operator">OF</span> v<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"refl_on V <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> refl_onI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> valid_graph.is_path_undir_append<span class="main">[</span><span class="operator">OF</span> v<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword1"><span class="command">from</span></span> valid_graph.nodes_connected_sym<span class="main">[</span><span class="operator">OF</span> v<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"equiv V <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equivI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  forest_maximally_connected_incl_max1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"forest <span class="free">H</span>"</span></span>
    <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>                                                                
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span> <span class="main">-</span> edges <span class="free">H</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>forest <span class="main">(</span>add_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> maximally_connected <span class="free">H</span> <span class="free">G</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> V<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="free">H</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">assume</span></span> pff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>E <span class="main">-</span> edges <span class="free">H</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>forest <span class="main">(</span>add_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span>V"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">G</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="free">G</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">H</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>nodes_connected <span class="free">H</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> augment_edge<span class="main">[</span><span class="operator">OF</span> this assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> i ii<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span>
         k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="free">H</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∉</span> edges <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> E"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ee<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">a</span><span class="main">=</span><span class="bound">aa</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">=</span><span class="bound">ba</span> <span class="main">∨</span> <span class="skolem">a</span><span class="main">=</span><span class="bound">ba</span> <span class="main">∧</span> <span class="skolem">b</span><span class="main">=</span><span class="bound">aa</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> e ee <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">x</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">=</span><span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">with</span></span> k <span class="keyword1"><span class="command">have</span></span> k'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="free">H</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> valid_graph.nodes_connected_sym<span class="main">[</span><span class="operator">OF</span> valid_subgraph<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">using</span></span> e nn<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nxy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>nodes <span class="free">H</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>nodes <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> forest.forest_add_edge<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nxy k' <span class="main">]</span>  <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"forest <span class="main">(</span>add_edge <span class="skolem">x</span> <span class="skolem">w</span> <span class="skolem">y</span> <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">∈</span>E<span class="main">-</span>edges <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nn e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> pff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>       
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> maximally_connected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>   forest_maximally_connected_incl_max2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"forest <span class="free">H</span>"</span></span>
    <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="free">H</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>E <span class="main">-</span> edges <span class="free">H</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>forest <span class="main">(</span>add_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> V<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="free">H</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">assume</span></span> mc<span class="main">:</span> <span class="quoted"><span class="quoted">"maximally_connected <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v</span><span class="main">∈</span>V <span class="main">⟹</span>  <span class="bound">v'</span><span class="main">∈</span>V <span class="main">⟹</span> 
          nodes_connected <span class="free">G</span> <span class="bound">v</span> <span class="bound">v'</span> <span class="main">⟹</span> nodes_connected <span class="free">H</span> <span class="bound">v</span> <span class="bound">v'</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> maximally_connected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>E <span class="main">-</span> edges <span class="free">H</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>forest <span class="main">(</span>add_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">w</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> E"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ni<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> edges <span class="free">H</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>add_edge <span class="skolem">x</span> <span class="skolem">w</span> <span class="skolem">y</span> <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> f <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">wa</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>insert <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>edges <span class="free">H</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> nodes_connected <span class="main">(</span>delete_edge <span class="bound">a</span> <span class="bound">wa</span> <span class="bound">b</span> <span class="main">(</span>add_edge <span class="skolem">x</span> <span class="skolem">w</span> <span class="skolem">y</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> forest_def forest_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">w</span> <span class="skolem">y</span> <span class="main">(</span>add_edge <span class="skolem">x</span> <span class="skolem">w</span> <span class="skolem">y</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>delete_edge <span class="skolem">x</span> <span class="skolem">w</span> <span class="skolem">y</span> <span class="main">(</span>add_edge <span class="skolem">x</span> <span class="skolem">w</span> <span class="skolem">y</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">H</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ni xy <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_edge_def delete_edge_def insert_absorb<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="free">H</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nodes_connected <span class="free">G</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E_validD<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span>   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> k<span class="main">[</span><span class="operator">OF</span> xy<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  forest_maximally_connected_incl_max_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"forest <span class="free">H</span>"</span></span>
    <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"maximally_connected <span class="free">H</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>E <span class="main">-</span> edges <span class="free">H</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span>forest <span class="main">(</span>add_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms forest_maximally_connected_incl_max2 forest_maximally_connected_incl_max1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Graph_Definition_Impl">
<div class="head">
<h1>Theory Graph_Definition_Impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Kruskal on Symmetric Directed Graph"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Graph_Definition_Impl
<span class="keyword2"><span class="keyword">imports</span></span>
 <a href="Kruskal_Impl.html">Kruskal_Impl</a> <a href="Graph_Definition_Aux.html">Graph_Definition_Aux</a>
<span class="keyword2"><span class="keyword">begin</span></span>
 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Interpreting <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Kruskl_Impl›</span></span></span></span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> fromlist <span class="main">=</span> <span class="keyword2"><span class="keyword">fixes</span></span>
  <span class="free">L</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> list"</span></span> 
<span class="keyword2"><span class="keyword">begin</span></span>

 
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span><span class="main">≡</span>set <span class="free">L</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span><span class="main">≡</span>fst <span class="main">`</span> E <span class="main">∪</span> <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> E"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">ind</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">::</span><span class="main">(</span>nat <span class="main">×</span> int <span class="main">×</span> nat<span class="main">)</span> set<span class="main">)</span> <span class="main">≡</span> <span class="main">⦇</span>nodes<span class="main">=</span>V<span class="main">,</span> edges<span class="main">=</span><span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">subforest</span> <span class="free"><span class="bound"><span class="entity">E'</span></span></span> <span class="main">≡</span> forest <span class="main">(</span>ind <span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">)</span> <span class="main">∧</span> subgraph <span class="main">(</span>ind <span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">)</span>  <span class="main">(</span>ind E<span class="main">)</span>"</span></span>


  <span class="keyword1"><span class="command">lemma</span></span> max_node_is_Max_V<span class="main">:</span> <span class="quoted"><span class="quoted">" E <span class="main">=</span>  set <span class="free">la</span> <span class="main">⟹</span> max_node <span class="free">la</span> <span class="main">=</span> Max <span class="main">(</span>insert <span class="main">0</span> V<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"E <span class="main">=</span>  set <span class="free">la</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">la</span> <span class="main">∪</span> <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> set <span class="free">la</span>
             <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">la</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span> <span class="bound">x1a</span><span class="main">,</span> <span class="bound">x2a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">{</span><span class="bound">x1</span><span class="main">,</span> <span class="bound">x2a</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">force</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> E  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>    max_node_def prod.case_distrib * <span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> ind_valid_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">E'</span><span class="main">.</span> <span class="bound">E'</span> <span class="main">⊆</span> E <span class="main">⟹</span> valid_graph <span class="main">(</span>ind <span class="bound">E'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> valid_graph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> vE<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ind_valid_graph<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> ind_valid_graph'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">E'</span><span class="main">.</span> subgraph <span class="main">(</span>ind <span class="bound">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span> <span class="main">⟹</span> valid_graph <span class="main">(</span>ind <span class="bound">E'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ind_valid_graph<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def<span class="main">)</span> 
    
  <span class="keyword1"><span class="command">lemma</span></span> add_edge_ind<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span>E <span class="main">⟹</span> add_edge <span class="free">a</span> <span class="free">w</span> <span class="free">b</span> <span class="main">(</span>ind <span class="free">F</span><span class="main">)</span> <span class="main">=</span> ind <span class="main">(</span>insert <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> add_edge_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
                                                     
  <span class="keyword1"><span class="command">lemma</span></span> nodes_connected_ind_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">⊆</span>E <span class="main">⟹</span> sym <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="free">F</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> ind_valid_graph<span class="main">)</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">using</span></span> valid_graph.nodes_connected_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>  
  <span class="keyword1"><span class="command">lemma</span></span> nodes_connected_ind_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">⊆</span>E <span class="main">⟹</span> trans <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="free">F</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> ind_valid_graph<span class="main">)</span> 
     <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">using</span></span> valid_graph.is_path_undir_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> part_equiv_nodes_connected_ind<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">⊆</span>E <span class="main">⟹</span> part_equiv <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="free">F</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> nodes_connected_ind_trans nodes_connected_ind_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  
  <span class="keyword1"><span class="command">sublocale</span></span> s<span class="main">:</span> Kruskal_Impl <span class="quoted">E</span> <span class="quoted">V</span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="main">{</span>fst <span class="bound">e</span><span class="main">,</span> snd <span class="main">(</span>snd <span class="bound">e</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">u</span> <span class="bound">v</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">u</span><span class="main">=</span><span class="bound">a</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">=</span><span class="bound">b</span> <span class="main">∨</span> <span class="bound">u</span><span class="main">=</span><span class="bound">b</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">=</span><span class="bound">a</span>"</span></span>
    <span class="quoted"><span class="quoted">"subforest"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">E'</span><span class="main">.</span> <span class="main">{</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="bound">E'</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span>"</span></span> <span class="quoted">id</span>  <span class="quoted"><span class="quoted">"PR_CONST <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> RETURN <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"PR_CONST <span class="main">(</span>RETURN <span class="free">L</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"return <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">L</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> return <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite E"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>ind <span class="skolem">E'</span><span class="main">)</span> <span class="main">∧</span> subgraph <span class="main">(</span>ind <span class="skolem">E'</span><span class="main">)</span>  <span class="main">⦇</span>nodes<span class="main">=</span>V<span class="main">,</span> edges<span class="main">=</span>E<span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">⊆</span> E"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subforest <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def forest_def valid_graph_def forest_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>ind <span class="skolem">Y</span><span class="main">)</span> <span class="main">(</span>ind <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>ind <span class="skolem">Y</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> forest.subgraph_forest <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>ind <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ind_valid_graph<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> p  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> p  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">E1</span> <span class="skolem">E2</span> <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ind_valid_graph<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> valid_graph.augment_edge<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ind E"</span></span> <span class="quoted"><span class="quoted">"ind <span class="skolem">E1</span>"</span></span> <span class="quoted"><span class="quoted">"ind <span class="skolem">E2</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">,</span> <span class="operator">OF</span> *<span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">F</span> <span class="skolem">e</span> <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 7 <span class="keyword1"><span class="command">have</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> e 7<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> abuv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">=</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">u</span><span class="main">=</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">=</span><span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> subgraph <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span> insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">.</span> 
                <span class="main">¬</span>nodes_connected <span class="main">(</span>delete_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> forest_def forest_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> e <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ind <span class="skolem">F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>2<span class="main">)</span> e <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delete_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> nodes_connected <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>3<span class="main">)</span>   valid_graph.nodes_connected_sym<span class="main">[</span><span class="operator">OF</span> ind_valid_graph'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> s<span class="main"><span class="main">]</span></span><span class="main">]</span> e <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> s 7<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> sg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> abuv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  valid_graph.nodes_connected_sym<span class="main">[</span><span class="operator">OF</span> ind_valid_graph'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> s<span class="main"><span class="main">]</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span>nodes_connected <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>add_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> forest.forest_add_edge<span class="main"><span class="main">[</span></span><span class="operator">OF</span> f _ _ nn<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> uv abuv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>2<span class="main">)</span> add_edge_ind <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e<span class="main">)</span>   
      <span class="keyword1"><span class="command">from</span></span> f' sg <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"forest <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> subgraph <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">F</span><span class="main">)</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> valid_graph.connected_VV<span class="main">[</span><span class="operator">OF</span> vE s<span class="main">]</span> 
      <span class="keyword3"><span class="command">show</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="main">⊆</span> V<span class="main">×</span>V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       
    <span class="keyword1"><span class="command">from</span></span> valid_graph.connected_equiv<span class="main">[</span><span class="operator">OF</span> vE s<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"equiv V <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">F</span> <span class="skolem">e</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 10 <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>V"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> 10<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ad_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"add_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="main">=</span> ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e <span class="keyword1"><span class="command">unfolding</span></span> add_edge_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>  
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="main">(</span>add_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">b</span> <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span>
             <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> per_union <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nodes_connected <span class="main">(</span>ind <span class="skolem">F</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> valid_graph.nodes_connected_insert_per_union<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ind E"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ind_valid_graph<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 10<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> part_equiv_nodes_connected_ind<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">using</span></span> xy e 10<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 10<span class="main">(</span>5<span class="main">)</span> e * ad_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 11
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 12
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 13
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>14 <span class="skolem">a</span> <span class="skolem">F</span> <span class="skolem">e</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 14 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span>V"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">:</span> edges <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes_connected <span class="main">(</span>delete_edge <span class="skolem">a</span> <span class="skolem">w</span> <span class="skolem">a</span> <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          nodes_connected <span class="main">(</span>delete_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> * p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> forest <span class="main">(</span>ind <span class="main">(</span>insert <span class="skolem">e</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> forest_def forest_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>15 <span class="skolem">e</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 16
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 17
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>18 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> w <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> w <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">w</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 19 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split <span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 20
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 21
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sepref_to_hoare</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sep_auto</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pure_fold list_assn_emp<span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>22 <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> max_node_is_Max_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 23
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">sepref_to_hoare</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">sep_auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Showing the equivalence of minimum spanning forest definitions›</span></span>
  
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As the definition of the minimum spanning forest from the minWeightBasis algorithm differs
    from the one of our graph formalization, we new show their equivalence.›</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> spanning_forest_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"s.SpanningForest <span class="free">E'</span> <span class="main">=</span> spanning_forest <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">rule</span>
    <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"s.SpanningForest <span class="free">E'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>forest <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>E <span class="main">-</span> <span class="free">E'</span><span class="main">.</span>  <span class="main">¬</span> <span class="main">(</span>forest <span class="main">(</span>ind <span class="main">(</span> insert <span class="bound">x</span> <span class="free">E'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> subgraph <span class="main">(</span>ind <span class="main">(</span> insert <span class="bound">x</span> <span class="free">E'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> t<span class="main">[</span><span class="operator">unfolded</span>  s.SpanningForest_def <span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">have</span></span> vE<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ind_valid_graph<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>E<span class="main">-</span><span class="free">E'</span> <span class="main">⟹</span> subgraph <span class="main">(</span>ind <span class="main">(</span> insert <span class="bound">x</span> <span class="free">E'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sub <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>E <span class="main">-</span> <span class="free">E'</span><span class="main">.</span>  <span class="main">¬</span> <span class="main">(</span>forest <span class="main">(</span>ind <span class="main">(</span> insert <span class="bound">x</span> <span class="free">E'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>ind E<span class="main">)</span> <span class="main">-</span> edges <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span><span class="main">.</span>  <span class="main">¬</span> <span class="main">(</span>forest <span class="main">(</span>add_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> valid_graph.E_validD<span class="main">[</span><span class="operator">OF</span> vE<span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_edge_def insert_absorb<span class="main">)</span>  
  
    <span class="keyword1"><span class="command">have</span></span> mc<span class="main">:</span> <span class="quoted"><span class="quoted">"maximally_connected <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> valid_graph.forest_maximally_connected_incl_max1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" spanning_forest <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> spanning_forest_def <span class="keyword1"><span class="command">using</span></span> f sub mc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"spanning_forest <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span>  f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>forest <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        n<span class="main">:</span> <span class="quoted"><span class="quoted">"maximally_connected <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t<span class="main">[</span><span class="operator">unfolded</span> spanning_forest_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span>E<span class="main">-</span><span class="free">E'</span> <span class="main">⟹</span> subgraph <span class="main">(</span>ind <span class="main">(</span> insert <span class="bound">x</span> <span class="free">E'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sub <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> vE<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_graph <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ind_valid_graph<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>ind E<span class="main">)</span> <span class="main">-</span> edges <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> forest <span class="main">(</span>add_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> valid_graph.forest_maximally_connected_incl_max2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>ind E<span class="main">)</span> <span class="main">-</span> edges <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span>
                   <span class="main">⟹</span> <span class="main">¬</span> forest <span class="main">(</span>add_edge <span class="bound">a</span> <span class="bound">w</span> <span class="bound">b</span> <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>E <span class="main">-</span> <span class="free">E'</span><span class="main">.</span>  <span class="main">¬</span> <span class="main">(</span>forest <span class="main">(</span>ind <span class="main">(</span> insert <span class="bound">x</span> <span class="free">E'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a w b <span class="keyword1"><span class="command">using</span></span> t<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> valid_graph.E_validD<span class="main">[</span><span class="operator">OF</span> vE<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_edge_def insert_absorb<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
    <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword1"><span class="command">have</span></span> 
      iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>E <span class="main">-</span> <span class="free">E'</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>forest <span class="main">(</span>ind <span class="main">(</span> insert <span class="bound">x</span> <span class="free">E'</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> subgraph <span class="main">(</span>ind <span class="main">(</span> insert <span class="bound">x</span> <span class="free">E'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"s.SpanningForest <span class="free">E'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> s.SpanningForest_def <span class="keyword1"><span class="command">using</span></span> iii f sub  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> edge_weight_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"edge_weight <span class="free">G</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="keyword1">o</span> snd  <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> edge_weight_def f <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> <span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> MSF_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"s.MSF <span class="free">E'</span> <span class="main">=</span> minimum_spanning_forest <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> s.MSF_def minimum_spanning_forest_def optimal_forest_def
    <span class="keyword1"><span class="command">unfolding</span></span> spanning_forest_eq edge_weight_alt
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"spanning_forest <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">B'</span><span class="main">.</span> spanning_forest <span class="main">(</span>ind <span class="bound">B'</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span>
             <span class="main">⟶</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span><span class="free">E'</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span><span class="bound">B'</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"spanning_forest <span class="skolem">F'</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> sf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="skolem">F'</span> <span class="main">(</span>ind E<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spanning_forest_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">=</span> ind <span class="main">(</span>edges <span class="skolem">F'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> B sf <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>edges <span class="main">(</span>ind <span class="free">E'</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">w</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">∈</span>edges <span class="skolem">F'</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">lemma</span></span> kruskal_correct<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">&lt;</span><span class="keyword1">emp</span><span class="main">&gt;</span> kruskal <span class="main">(</span>return <span class="free">L</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> return <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">()</span>
      <span class="main">&lt;</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span>distinct <span class="bound">F</span> <span class="main">∧</span> set <span class="bound">F</span> <span class="main">⊆</span> E <span class="main">∧</span> minimum_spanning_forest <span class="main">(</span>ind <span class="main">(</span>set <span class="bound">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ind E<span class="main">)</span><span class="main">)</span><span class="keyword1">&gt;<span class="hidden">⇩</span><sub>t</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s.kruskal_correct_forest <span class="keyword1"><span class="command">unfolding</span></span> MSF_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">kruskal_algo</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">=</span> kruskal <span class="main">(</span>return <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> return <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">()</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Outside the locale›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">GD_from_list_α_weight</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">GD_from_list_α_graph</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>nodes<span class="main">=</span>fst <span class="main">`</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>snd <span class="main">∘</span> snd<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">,</span> edges<span class="main">=</span>set <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">⦈</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> corr<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">&lt;</span><span class="keyword1">emp</span><span class="main">&gt;</span> kruskal_algo <span class="free">L</span>
     <span class="main">&lt;</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span>set <span class="bound">F</span> <span class="main">⊆</span> set <span class="free">L</span> <span class="main">∧</span>               
       minimum_spanning_forest <span class="main">(</span>GD_from_list_α_graph <span class="free">L</span> <span class="bound">F</span><span class="main">)</span> <span class="main">(</span>GD_from_list_α_graph <span class="free">L</span> <span class="free">L</span><span class="main">)</span><span class="main">)</span><span class="keyword1">&gt;<span class="hidden">⇩</span><sub>t</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">sep_auto</span> <span class="quasi_keyword">heap</span><span class="main"><span class="main">:</span></span> fromlist.kruskal_correct <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  kruskal_algo_def  <span class="main">)</span> 
 

<span class="keyword1"><span class="command">lemma</span></span> kruskal_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">&lt;</span><span class="keyword1">emp</span><span class="main">&gt;</span> kruskal_algo <span class="free">L</span>
     <span class="main">&lt;</span><span class="main">λ</span><span class="bound">F</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span>set <span class="bound">F</span> <span class="main">⊆</span> set <span class="free">L</span> <span class="main">∧</span>
       spanning_forest <span class="main">(</span>GD_from_list_α_graph <span class="free">L</span> <span class="bound">F</span><span class="main">)</span> <span class="main">(</span>GD_from_list_α_graph <span class="free">L</span> <span class="free">L</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F'</span><span class="main">.</span> spanning_forest <span class="main">(</span>GD_from_list_α_graph <span class="free">L</span> <span class="bound">F'</span><span class="main">)</span> <span class="main">(</span>GD_from_list_α_graph <span class="free">L</span> <span class="free">L</span><span class="main">)</span> 
               <span class="main">⟶</span>  sum <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">F</span><span class="main">)</span> <span class="main">≤</span> sum <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">F'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="keyword1">&gt;<span class="hidden">⇩</span><sub>t</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">interpret</span></span> fromlist <span class="quoted"><span class="free">L</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F'</span><span class="main">.</span> edge_weight <span class="main">(</span>ind <span class="bound">F'</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span><span class="main">)</span> <span class="bound">F'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> edge_weight_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fn_snd_conv fst_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">sep_auto</span> <span class="quasi_keyword">heap</span><span class="main"><span class="main">:</span></span> corr <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minimum_spanning_forest_def optimal_forest_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Code export›</span></span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">kruskal_algo</span></span> <span class="keyword2"><span class="keyword">checking</span></span> SML_imp 

<span class="keyword1"><span class="command">ML_val</span></span> <span class="quoted">‹
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">export_nat</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">integer_of_nat</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">import_nat</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">nat_of_integer</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">export_int</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">integer_of_int</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">import_int</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">int_of_integer</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">import_list</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="entity">b</span><span class="main">,</span><span class="entity">c</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">import_nat</span> <span class="entity">a</span><span class="main">,</span> <span class="main">(</span><span class="entity">import_int</span> <span class="entity">b</span><span class="main">,</span> <span class="entity">import_nat</span> <span class="entity">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">export_list</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="main">(</span><span class="entity">b</span><span class="main">,</span><span class="entity">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">export_nat</span> <span class="entity">a</span><span class="main">,</span> <span class="entity">export_int</span> <span class="entity">b</span><span class="main">,</span> <span class="entity">export_nat</span> <span class="entity">c</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">export_Some_list</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> SOME <span class="entity">l</span> <span class="main">=&gt;</span> SOME <span class="main">(</span><span class="entity">export_list</span> <span class="entity">l</span><span class="main">)</span> <span class="main">|</span> NONE <span class="main">=&gt;</span> NONE<span class="main">)</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">kruskal</span> <span class="entity">l</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">kruskal</span><span class="antiquote">}</span></span></span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">import_list</span> <span class="entity">l</span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="entity">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span><span class="entity">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">)</span> <span class="main">(</span><span class="main">)</span>
                     |&gt; <span class="entity">export_list</span> 
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">kruskal_algo</span> <span class="entity">l</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">code</span> <span class="quoted">kruskal_algo</span><span class="antiquote">}</span></span></span> <span class="main">(</span><span class="entity">import_list</span> <span class="entity">l</span><span class="main">)</span> <span class="main">(</span><span class="main">)</span>  |&gt; <span class="entity">export_list</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result</span> <span class="main">=</span> <span class="entity">kruskal</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result4</span> <span class="main">=</span> <span class="entity">kruskal</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~100</span><span class="main">,</span><span class="inner_numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">64</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">13</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">20</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">4</span><span class="main">,</span><span class="inner_numeral">80</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">4</span><span class="main">,</span><span class="inner_numeral">40</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">]</span>

  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result'</span> <span class="main">=</span> <span class="entity">kruskal_algo</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result1'</span> <span class="main">=</span> <span class="entity">kruskal_algo</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result2'</span> <span class="main">=</span> <span class="entity">kruskal_algo</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result3'</span> <span class="main">=</span> <span class="entity">kruskal_algo</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~9</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">~3</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~4</span><span class="main">,</span><span class="inner_numeral">1</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">result4'</span> <span class="main">=</span> <span class="entity">kruskal_algo</span> <span class="main">[</span><span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">~100</span><span class="main">,</span><span class="inner_numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">64</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">1</span><span class="main">,</span><span class="inner_numeral">13</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">3</span><span class="main">,</span><span class="inner_numeral">20</span><span class="main">,</span><span class="inner_numeral">2</span><span class="main">)</span><span class="main">,</span> 
                               <span class="main">(</span><span class="inner_numeral">2</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">4</span><span class="main">,</span><span class="inner_numeral">80</span><span class="main">,</span><span class="inner_numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_numeral">4</span><span class="main">,</span><span class="inner_numeral">40</span><span class="main">,</span><span class="inner_numeral">5</span><span class="main">)</span><span class="main">]</span>
›</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>