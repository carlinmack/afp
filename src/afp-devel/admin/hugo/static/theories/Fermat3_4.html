<div id="Fermat4">
<div class="head">
<h1>Theory Fermat4</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Fermat4.thy
    Author:     Roelof Oosterhuis
                2007  Rijksuniversiteit Groningen
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Pythagorean triples and Fermat's last theorem, case $n=4$›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Fermat4
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Computational_Algebra/Primes.html">HOL-Computational_Algebra.Primes</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* TODO: this lemma is also used in Fermat3 with a slightly different generalization to ints.
Maybe it should be generalized to factorial rings and moved to another theory. *)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> nat_relprime_power_divisors<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="free">b</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span><span class="main">^</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n0 power_one zero_power <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq_sym_conv<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_factor_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">c</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> dvd_mult2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">c</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>1<span class="main">)</span> prime_dvd_power_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> dvd_power_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> coprime_common_divisor_nat <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n0 p<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dvd_trans dvd_power<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> p<span class="main">(</span>1<span class="main">)</span> prime_elem_divprod_pow <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">c'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h1 dvdE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> dvdE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> prime_dvd_power_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> p<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="skolem">c'</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c'</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a'</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>4<span class="main">)</span> ac<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h2 dvd_0_right gr0I True <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">^</span> <span class="free">n</span>›</span></span> n0 nat_0_less_mult_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> n0
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_gt_Suc_0_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ac<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> n0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ac<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> int_relprime_power_divisors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span><span class="main">^</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="main">^</span> <span class="free">n</span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> power_even_abs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> zero_le_power_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">a</span> <span class="main">*</span> nat <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>nat <span class="main">¦</span><span class="free">c</span><span class="main">¦</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_mult_distrib<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms mult_less_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>nat <span class="free">a</span><span class="main">)</span> <span class="main">(</span>nat <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> coprime_nat_abs_left_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> nat <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nat_relprime_power_divisors<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="free">c</span><span class="main">¦</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> int_nat_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_power<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proof of Fermat's last theorem for the case $n=4$: $$\forall x,y,z:~x^4 + y^4 = z^4 \Longrightarrow xyz=0.$$›</span></span>

<span class="comment1">(* 
NB: this lemma is quite slow, maybe use more steps *)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> nat_power2_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">(</span><span class="free">b</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a_ge_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a2_ge_b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a_ge_b <span class="keyword1"><span class="command">have</span></span> ab_ge_b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">b</span> <span class="main">≥</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square diff_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2 power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> a2_ge_b2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> ab_ge_b2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span> <span class="main">-</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2 power2_eq_square mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> nat_power_le_imp_le_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="free">a</span><span class="main">^</span><span class="free">n</span> <span class="main">≤</span> <span class="free">b</span><span class="main">^</span><span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> nat_power_inject_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="free">a</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="free">n</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> not0_implies_Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span>Suc <span class="skolem">m</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span>Suc <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power_inject_base<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Parametrisation of Pythagorean triples (over $\mathbb{N}$ and $\mathbb{Z}$)›</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">theorem</span></span> nat_euclid_pyth_triples<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aodd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="bound">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">p</span><span class="main">*</span><span class="bound">q</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">=</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="bound">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> two0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> abc <span class="keyword1"><span class="command">have</span></span> a2cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="comment1">― ‹factor $a^2$ in coprime factors $(c-b)$ and $(c+b)$; hence both are squares›</span>
  <span class="keyword1"><span class="command">have</span></span> a2factor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">*</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">*</span><span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> a2cb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">c</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="free">c</span><span class="main">*</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">*</span><span class="free">b</span> <span class="main">-</span> <span class="free">b</span><span class="main">*</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">-</span> <span class="free">b</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2 add_mult_distrib mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> diff_mult_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> a_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> aodd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> b_less_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> abc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">with</span></span> two0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nat_power_le_imp_le_base<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">=</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> a2cb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> a_nonzero <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> b2_le_c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bc_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> b2_le_c2 <span class="keyword1"><span class="command">have</span></span> cancelb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="free">b</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> gcd <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> cancelb2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> gcd <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> gcd <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gcd_add2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> gcd_add1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a2cb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcd_dvd2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span> <span class="var">?g</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> gcd <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcd_greatest<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ab_relprime <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> factors_odd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">∧</span> odd <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> a2factor <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_mult2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> aodd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a2factor <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> aodd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> cb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">-</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">-</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">+</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> b_less_c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">+</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> diff_add_assoc2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span><span class="main">+</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> cb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main">+</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">+</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> b_less_c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">…</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> diff_add_assoc2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> factors_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> cb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">-</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">-</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">+</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> b_less_c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">+</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> diff_add_assoc2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span><span class="main">+</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> gcd <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> cb1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> gcd <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">-</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> back_subst<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> g2c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcd_dvd1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> gcd <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gcd_add2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">-</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> cb2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> gcd <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> back_subst<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> g2b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcd_dvd2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> g2c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">*</span> gcd <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcd_greatest gcd_mult_distrib_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> bc_relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> b_less_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="var">?g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g1or2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="var">?g</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">≠</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="free">c</span> <span class="main">-</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> factors_odd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> a2factor <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span><span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> factors_relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">c</span><span class="main">-</span><span class="free">b</span> <span class="main">=</span> <span class="bound">k</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_relprime_power_divisors<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">-</span><span class="free">b</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> a2factor <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span><span class="main">1</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> factors_relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">c</span><span class="main">+</span><span class="free">b</span> <span class="main">=</span> <span class="bound">k</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_relprime_power_divisors <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">+</span><span class="free">b</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹now $p := (s+r)/2$ and $q := (s-r)/2$ is our solution›</span>
  <span class="keyword1"><span class="command">have</span></span> rs_odd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="skolem">r</span> <span class="main">∧</span> odd <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">r</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">c</span><span class="main">-</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_eq_square dvd_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> factors_odd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">with</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">c</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_eq_square dvd_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> factors_odd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">-</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> r s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">with</span></span> two0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nat_power_le_imp_le_base<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> m <span class="keyword1"><span class="command">have</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">m</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> rs_odd <span class="keyword2"><span class="keyword">and</span></span> m2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> m2 <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">+</span><span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> cb1 <span class="keyword2"><span class="keyword">and</span></span> r <span class="keyword2"><span class="keyword">and</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">c</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">+</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> cb2 <span class="keyword2"><span class="keyword">and</span></span> r <span class="keyword2"><span class="keyword">and</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="free">b</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_sum<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square add_mult_distrib2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≥</span><span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> p2_ge_q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> a2cb <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_sum power_mult_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> p2_ge_q2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_power2_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> two0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nat_power_inject_base<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">p</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">∧</span> <span class="var">?k</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> b <span class="keyword2"><span class="keyword">and</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span> <span class="var">?k</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="keyword1">dvd</span> gcd <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcd_greatest<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ab_relprime <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now for the case of integers. Based on \textit{nat-euclid-pyth-triples}.›</span></span>
  
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">corollary</span></span> int_euclid_pyth_triples<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> coprime <span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">)</span> <span class="free">b</span><span class="main">;</span> odd <span class="free">a</span><span class="main">;</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="bound">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">p</span><span class="main">*</span><span class="bound">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">=</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="bound">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> ab_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aodd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat<span class="main">¦</span><span class="free">a</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat<span class="main">¦</span><span class="free">b</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat<span class="main">¦</span><span class="free">c</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ab2_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat<span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> nat<span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_add_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> abc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat<span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> nat<span class="main">(</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat<span class="main">(</span><span class="main">¦</span><span class="free">a</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">(</span><span class="main">¦</span><span class="free">b</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> nat<span class="main">(</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> new_abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="var">?b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_mult_distrib power2_eq_square nat_add_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ab_rel <span class="keyword1"><span class="command">have</span></span> new_ab_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="var">?a</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd_int_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> new_a_odd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> aodd
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="var">?a</span> <span class="main">=</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="bound">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="var">?b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">p</span><span class="main">*</span><span class="bound">q</span> <span class="main">∧</span> <span class="var">?c</span> <span class="main">=</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="bound">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nat_euclid_pyth_triples<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> mn<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="var">?b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">n</span> <span class="main">∧</span> <span class="var">?c</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="skolem">m</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> mn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> new_a_odd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> mn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="var">?a</span> <span class="main">=</span> int<span class="main">(</span><span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"int <span class="var">?b</span> <span class="main">=</span> int<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"int <span class="var">?c</span> <span class="main">=</span> int<span class="main">(</span><span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> int<span class="main">(</span><span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> int<span class="main">(</span><span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">b</span><span class="main">¦</span> <span class="main">=</span> int<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">=</span> int<span class="main">(</span><span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> int<span class="main">(</span><span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> absabc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span>int <span class="skolem">m</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>int <span class="skolem">m</span><span class="main">)</span><span class="main">*</span>int <span class="skolem">n</span>
    <span class="main">∧</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span>int <span class="skolem">m</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> mn <span class="keyword1"><span class="command">have</span></span> mn_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>int <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd_int_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="bound">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">p</span><span class="main">*</span><span class="bound">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">=</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="bound">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span>"</span></span> 
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">p</span> <span class="bound">q</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> apos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> int <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="var">?Q</span> <span class="skolem">p</span> <span class="bound">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> bpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> p apos bpos absabc mn_rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> bneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">-</span> int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> p apos bneg absabc mn_rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">a</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> aneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">q</span><span class="main">.</span> <span class="var">?Q</span> <span class="skolem">p</span> <span class="bound">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> bpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> int <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> p aneg bpos absabc mn_rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">p</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> bneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">-</span> int <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> p aneg bneg absabc mn_rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Fermat's last theorem, case $n=4$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Core of the proof. Constructs a smaller solution over $\mathbb{Z}$ of $$a^4+b^4=c^2\,\land\,coprime\,a\,b\,\land\,abc\ne 0\,\land\,a~{\rm odd}.$$›</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> smaller_fermat4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="numeral">4</span><span class="main">+</span><span class="free">b</span><span class="main">^</span><span class="numeral">4</span><span class="main">=</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abc0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aodd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="free">a</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> ab_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">^</span><span class="numeral">4</span><span class="main">+</span><span class="bound">q</span><span class="main">^</span><span class="numeral">4</span><span class="main">=</span><span class="bound">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">p</span><span class="main">*</span><span class="bound">q</span><span class="main">*</span><span class="bound">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="bound">p</span> <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="comment1">― ‹put equation in shape of a pythagorean triple and obtain $u$ and $v$›</span>
  <span class="keyword1"><span class="command">from</span></span> ab_relprime <span class="keyword1"><span class="command">have</span></span> a2b2relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> aodd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> abc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> uvabc<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">u</span><span class="main">*</span><span class="skolem">v</span> <span class="main">∧</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="skolem">u</span> <span class="skolem">v</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> int_euclid_pyth_triples<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> abc0 <span class="keyword1"><span class="command">have</span></span> uv0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> av_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="skolem">v</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">a</span> <span class="skolem">v</span> <span class="keyword1">dvd</span> gcd <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> uvabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">v</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">dvd</span> gcd <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> a2b2relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="skolem">v</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">a</span> <span class="skolem">v</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">― ‹make again a pythagorean triple and obtain $k$ and $l$›</span>
  <span class="keyword1"><span class="command">from</span></span> uvabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> av_relprime <span class="keyword2"><span class="keyword">and</span></span> aodd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    klavu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">l</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">u</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> kl_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">k</span> <span class="skolem">l</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> int_euclid_pyth_triples<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="comment1">― ‹prove $b=2m$ and $kl(k^2 + l^2) = m^2$, for coprime $k$, $l$ and $k^2+l^2$›</span>
  <span class="keyword1"><span class="command">from</span></span> uvabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> bm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> evenE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
    <span class="keyword1"><span class="command">from</span></span> bm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">¦</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> uvabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">v</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="main">¦</span><span class="skolem">u</span><span class="main">¦</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> klavu <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">l</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> kl_rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> kl_rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k</span><span class="main">+</span><span class="skolem">l</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gcd_add_mult <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="skolem">k</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">l</span> <span class="main">(</span><span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">¦</span><span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> kl_rel <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">l</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">l</span><span class="main">*</span><span class="skolem">l</span><span class="main">)</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">l</span><span class="main">*</span><span class="skolem">l</span><span class="main">+</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gcd_add_mult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">*</span><span class="skolem">l</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">=</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span> <span class="main">=</span> <span class="bound">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">=</span> <span class="bound">z</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> int_relprime_power_divisors<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">l</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span>
      int_relprime_power_divisors<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">l</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span>
      int_relprime_power_divisors<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">l</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> albega<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">α</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">β</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹show this is a new solution›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">α</span><span class="main">^</span><span class="numeral">4</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> albega <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">α</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">β</span><span class="main">^</span><span class="numeral">4</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> albega <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">β</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> gamma2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">l</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> albega <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> newabc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="skolem">β</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> uv0 klavu albega <span class="keyword1"><span class="command">have</span></span> albega0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">*</span> <span class="skolem">β</span> <span class="main">*</span> <span class="skolem">γ</span>  <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹show the coprimality›</span>
  <span class="keyword1"><span class="command">have</span></span> alphabeta_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">α</span> <span class="skolem">β</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> classical<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">α</span> <span class="skolem">β</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> coprime <span class="skolem">α</span> <span class="skolem">β</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> gnot1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">=</span><span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="skolem">α</span><span class="main">¦</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">with</span></span> albega0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> gnot1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> gcd <span class="skolem">k</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="skolem">α</span> <span class="main">∧</span> <span class="var">?g</span> <span class="keyword1">dvd</span> <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> albega <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">∧</span> <span class="var">?g</span> <span class="keyword1">dvd</span> <span class="main">¦</span><span class="skolem">l</span><span class="main">¦</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="skolem">k</span> <span class="main">∧</span> <span class="var">?g</span> <span class="keyword1">dvd</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">k</span> <span class="skolem">l</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> kl_rel <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">― ‹choose $p$ and $q$ in the right way›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="bound">q</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">p</span><span class="main">*</span><span class="bound">q</span><span class="main">*</span><span class="skolem">γ</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="bound">p</span> <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">α</span> <span class="main">∨</span> odd <span class="skolem">β</span>"</span></span>      
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>odd <span class="skolem">α</span> <span class="main">∨</span> odd <span class="skolem">β</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">α</span> <span class="main">∧</span> even <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">α</span> <span class="main">∧</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> gcd <span class="skolem">α</span> <span class="skolem">β</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> alphabeta_relprime <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">α</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> newabc albega0 alphabeta_relprime <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">α</span> <span class="main">∧</span> <span class="skolem">q</span><span class="main">=</span><span class="skolem">β</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">γ</span>  <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="skolem">p</span> <span class="main">∧</span> coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> newabc albega0 alphabeta_relprime <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="skolem">α</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">=</span><span class="skolem">β</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">γ</span>  <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="skolem">p</span> <span class="main">∧</span> coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">― ‹show the solution is smaller›</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> gamma2 klavu <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">u</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">u</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> self_le_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">u</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> uv0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> uv0 <span class="keyword1"><span class="command">have</span></span> v2non0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> <span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> v2non0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> uvabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> self_le_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">c</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> h1 h2 h3 uvabc <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Show that no solution exists, by infinite descent of $c^2$.›</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> no_rewritten_fermat4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span>int<span class="main">)</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="bound">b</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">*</span><span class="bound">b</span><span class="main">*</span><span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="bound">a</span> <span class="main">∧</span> coprime <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_descent0_measure<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">c</span></span><span class="main"><span class="main">.</span></span> nat<span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">c</span></span><span class="main"><span class="main">^</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int<span class="main">(</span>nat<span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>smaller <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">^</span><span class="numeral">4</span><span class="main">+</span><span class="bound">q</span><span class="main">^</span><span class="numeral">4</span><span class="main">=</span><span class="bound">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">p</span><span class="main">*</span><span class="bound">q</span><span class="main">*</span><span class="bound">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="bound">p</span>
    <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> smaller_fermat4<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> pqr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> odd <span class="skolem">p</span>
    <span class="main">∧</span> coprime <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zero_le_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"int<span class="main">(</span>nat<span class="main">(</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> int<span class="main">(</span>nat<span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> pqr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int<span class="main">(</span>nat<span class="main">(</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> int<span class="main">(</span>nat<span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat<span class="main">(</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">&lt;</span> nat<span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">with</span></span> pqr <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The theorem. Puts equation in requested shape.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> fermat_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="free">z</span><span class="main">^</span><span class="numeral">4</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="free">z</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="keyword1">div</span> <span class="var">?g</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xyz0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="comment1">― ‹divide out the g.c.d.›</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="var">?g</span><span class="main">*</span><span class="skolem">a</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="var">?g</span><span class="main">*</span><span class="skolem">b</span> <span class="main">∧</span> coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> gcd_coprime_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="var">?c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> zgab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">4</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> ab ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="main">(</span><span class="var">?g</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">^</span><span class="numeral">4</span><span class="main">+</span><span class="main">(</span><span class="var">?g</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> cgz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">*</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> zgab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">z</span><span class="main">^</span><span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="keyword1">div</span> <span class="var">?g</span><span class="main">)</span><span class="main">*</span><span class="var">?g</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> dvd_mult_div_cancel<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> xyz0 <span class="keyword1"><span class="command">have</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> xyz0 <span class="keyword1"><span class="command">have</span></span> g0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">4</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span><span class="main">*</span><span class="var">?g</span><span class="main">^</span><span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="main">(</span><span class="var">?c</span><span class="main">*</span><span class="var">?g</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> cgz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">z</span><span class="main">^</span><span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> zgab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">4</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> g0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ab xyz0 c0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="var">?c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">― ‹choose the parity right›</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="bound">q</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="bound">p</span><span class="main">*</span><span class="bound">q</span><span class="main">*</span><span class="var">?c</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> odd <span class="bound">p</span> <span class="main">∧</span> coprime <span class="bound">p</span> <span class="bound">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">a</span> <span class="main">∨</span> odd <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>odd <span class="skolem">a</span> <span class="main">∨</span> odd <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> gcd <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ab abc <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> 
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
      <span class="keyword1"><span class="command">with</span></span> ab abc <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="var">?c</span><span class="main">≠</span><span class="main">0</span> <span class="main">∧</span> odd <span class="skolem">p</span> <span class="main">∧</span> coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">― ‹show contradiction using the earlier result›</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> no_rewritten_fermat4<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> fermat_mult4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">z</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="free">z</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">*</span><span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> xyz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">^</span><span class="numeral">4</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">^</span><span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">z</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fermat_4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Quad_Form">
<div class="head">
<h1>Theory Quad_Form</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      QuadForm.thy
    Author:     Roelof Oosterhuis
                2007  Rijksuniversiteit Groningen
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The quadratic form $x^2 + Ny^2$›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quad_Form
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Number_Theory/Number_Theory.html">HOL-Number_Theory.Number_Theory</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Shows some properties of the quadratic form $x^2+Ny^2$, such as how to multiply and divide them. The second part focuses on the case $N=3$ and is used in the proof of the case $n=3$ of Fermat's last theorem. The last part -- not used for FLT3 -- shows which primes can be written as $x^2 + 3y^2$.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions and auxiliary results›</span></span>

<span class="comment1">(* TODO: move this lemma to the distribution (?). (It is used also in TwoSquares and FourSquares) *)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> best_division_abs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="free">a</span> <span class="main">-</span> <span class="bound">k</span><span class="main">*</span><span class="free">n</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">div</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_mult_mod_eq <span class="dynamic"><span class="dynamic">algebra_simps</span></span> k_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="free">a</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">*</span><span class="free">n</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h pos_mod_sign a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">n</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">mod</span> <span class="free">n</span> <span class="main">-</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="main">¦</span><span class="free">a</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">k</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">n</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h pos_mod_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> a False <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prime_power_dvd_cancel_right<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="free">p</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>semiring_gcd<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">^</span> <span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">p</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_imp_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_dvd_mult_left_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_qfN</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_qfN</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">*</span><span class="bound">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">is_cube_form</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_cube_form</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="bound">p</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="bound">p</span><span class="main">*</span><span class="bound">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="bound">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="bound">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="bound">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> abs_eq_impl_unitfactor<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">::</span>int<span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">u</span><span class="main">*</span><span class="free">b</span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">u</span><span class="main">¦</span><span class="main">=</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">1</span><span class="main">*</span><span class="free">b</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">*</span><span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u</span><span class="main">=</span><span class="main">1</span> <span class="main">∨</span> <span class="skolem">u</span><span class="main">=</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> prime_3_nat<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic facts if $N \ge 1$›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">N</span> <span class="main">≥</span> <span class="main">1</span><span class="main">;</span> is_qfN <span class="free">A</span> <span class="free">N</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="free">A</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_qfN_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> N <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="free">N</span><span class="main">*</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≥</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">N</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≥</span> <span class="main">1</span><span class="main">;</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> N <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="free">N</span><span class="main">*</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> abN <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> N <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">&gt;</span><span class="free">N</span><span class="main">*</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> abN <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplication and division›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_mult1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_mult2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
  <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">+</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> is_qfN_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"is_qfN <span class="free">A</span> <span class="free">N</span> <span class="main">⟹</span> is_qfN <span class="free">B</span> <span class="free">N</span> <span class="main">⟹</span> is_qfN <span class="main">(</span><span class="free">A</span><span class="main">*</span><span class="free">B</span><span class="main">)</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_qfN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qfN_mult1<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> is_qfN_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> is_qfN <span class="free">A</span> <span class="free">N</span> <span class="main">⟹</span> is_qfN <span class="main">(</span><span class="free">A</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_qfN_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_div_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="bound">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">e</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="bound">u</span><span class="main">+</span><span class="bound">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="bound">v</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="bound">v</span> <span class="main">-</span> <span class="bound">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="bound">u</span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">e</span><span class="main">¦</span><span class="main">=</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?P</span><span class="main">*</span><span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">e</span><span class="main">.</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="bound">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?P</span> <span class="main">-</span> <span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">U</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_abs_mult_distrib prime_int_iff prime_dvd_mult_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="main">1</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="main">-</span><span class="main">1</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">=</span> <span class="var">?P</span><span class="main">*</span><span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">*</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">*</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qfN_mult2 add.commute mult_1_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">U</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> left_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvdI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">e</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> e <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">*</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?A</span> <span class="main">*</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span> <span class="main">-</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qfN_mult1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">U</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> left_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvdI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span> <span class="main">=</span> <span class="var">?P</span><span class="main">*</span><span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> e <span class="keyword1"><span class="command">have</span></span> e2_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_mult_self_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="var">?P</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="var">?P</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> distrib_right <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> v u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span> right_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e2_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="skolem">u</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="var">?P</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="var">?P</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> left_diff_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> v u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span> right_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e2_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qfN_mult1 <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">e</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qfN_mult2 <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> qfN_div_prime_weak<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> prime <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="bound">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="bound">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">e</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="bound">u</span><span class="main">+</span><span class="bound">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="bound">v</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="bound">v</span> <span class="main">-</span> <span class="bound">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="bound">u</span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">e</span><span class="main">¦</span><span class="main">=</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> qfN_div_prime<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> qfN_div_prime_general<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> prime <span class="free">P</span><span class="main">;</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">A</span><span class="main">;</span> is_qfN <span class="free">A</span> <span class="free">N</span><span class="main">;</span> is_qfN <span class="free">P</span> <span class="free">N</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">Q</span><span class="main">.</span> <span class="free">A</span> <span class="main">=</span> <span class="bound">Q</span><span class="main">*</span><span class="free">P</span> <span class="main">∧</span> is_qfN <span class="bound">Q</span> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="bound">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="free">P</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> is_qfN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qfN_div_prime_weak<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_power_div_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">P</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">P</span> <span class="main">∧</span> odd <span class="free">P</span> <span class="main">∧</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>
  <span class="main">∧</span> <span class="free">A</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> coprime <span class="free">p</span> <span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">∧</span> <span class="free">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="bound">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> coprime <span class="bound">u</span> <span class="bound">v</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">e</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="bound">u</span><span class="main">+</span><span class="bound">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="bound">v</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="bound">v</span><span class="main">-</span><span class="bound">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="bound">u</span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">A</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="skolem">U</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_def <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">e</span><span class="main">.</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="bound">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> Pn_dvd_prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">-</span> <span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">^</span><span class="free">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> distrib_right distrib_left<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">U</span><span class="main">)</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> left_diff_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">∨</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> PdvdPn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="free">n</span> <span class="main">=</span> Suc <span class="bound">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not0_implies_Suc<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">P</span><span class="main">*</span><span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">∨</span>  <span class="main">¬</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">∧</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">-</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> prime_dvd_multD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">∧</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> pdvd2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> Pl2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> pdvd2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zdvd_not_zless<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">∧</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∨</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> prime_dvd_multD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> Pdvdp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_mult power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> PdvdPn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">-</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_diff<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">N</span> <span class="main">∨</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_dvd_multD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">q</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_dvd_multD ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">with</span></span> Pdvdp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> gcd <span class="free">p</span> <span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> PdvdNq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> PdvdPn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_diff<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">*</span><span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_dvd_multD<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> PdvdNq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> gcd <span class="free">p</span> <span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> gcd <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> Pn_dvd_prod <span class="keyword2"><span class="keyword">and</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> prime_power_dvd_cancel_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> Pn_dvd_prod <span class="keyword2"><span class="keyword">and</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> prime_power_dvd_cancel_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="main">1</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="free">a</span><span class="main">*</span><span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="main">-</span><span class="main">1</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span> <span class="main">=</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">*</span><span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">U</span> <span class="main">=</span> <span class="free">A</span><span class="main">^</span><span class="free">n</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e1 ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qfN_mult2 add.commute mult_1_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">U</span> <span class="main">-</span> <span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> right_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvdI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">e</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> e <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> U <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">U</span> <span class="main">=</span> <span class="free">A</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e1 ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span> <span class="main">-</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qfN_mult1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> v <span class="keyword2"><span class="keyword">and</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">U</span><span class="main">-</span><span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">-</span> <span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> right_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvdI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span> <span class="main">=</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">*</span><span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> e <span class="keyword1"><span class="command">have</span></span> e2_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_mult_self_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> distrib_right <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> v <span class="keyword2"><span class="keyword">and</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span> right_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e2_1 <span class="keyword2"><span class="keyword">and</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="skolem">u</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> prime_int_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="free">n</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> left_diff_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> v u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="free">p</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">a</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">p</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span> right_diff_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e2_1 <span class="keyword2"><span class="keyword">and</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span> <span class="main">*</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">*</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> prime_int_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="free">P</span><span class="main">^</span><span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qfN_mult1 <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">e</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword2"><span class="keyword">and</span></span> b <span class="keyword2"><span class="keyword">and</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qfN_mult2 <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">a</span> <span class="free">b</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">dvd</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">dvd</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">dvd</span> <span class="skolem">u</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="keyword1">dvd</span> <span class="skolem">v</span><span class="main">*</span><span class="free">p</span> <span class="main">-</span> <span class="skolem">u</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> e <span class="keyword2"><span class="keyword">and</span></span> ass <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∧</span> <span class="free">A</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">P</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_primedivisor_not<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> is_qfN <span class="main">(</span><span class="free">P</span><span class="main">*</span><span class="free">Q</span><span class="main">)</span> <span class="free">N</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="free">P</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>prime <span class="bound">R</span> <span class="main">∧</span> <span class="bound">R</span> <span class="keyword1">dvd</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="bound">R</span> <span class="free">N</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> ass2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="keyword1">dvd</span> <span class="free">Q</span> <span class="main">⟶</span> prime <span class="bound">R</span> <span class="main">⟶</span> is_qfN <span class="bound">R</span> <span class="free">N</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">=</span> prime_factorization <span class="main">(</span>nat <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> ps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set_mset <span class="skolem">ps</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">=</span> int <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ps_def prod_mset_prime_factorization_int<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ps_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set_mset <span class="skolem">ps</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> is_qfN <span class="main">(</span><span class="free">P</span><span class="main">*</span>int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">N</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">R</span><span class="main">.</span> <span class="main">(</span>prime <span class="bound">R</span> <span class="main">∧</span> <span class="bound">R</span> <span class="keyword1">dvd</span> int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> is_qfN <span class="bound">R</span> <span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="skolem">ps</span> <span class="main">⟹</span> False"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="free">P</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="skolem">ps</span> <span class="main">⟹</span> False"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">p</span><span class="main">#}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span> <span class="keyword1">dvd</span> int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">p</span><span class="main">#}</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> IH <span class="keyword1"><span class="command">have</span></span> pqfN<span class="main">:</span> <span class="quoted"><span class="quoted">"is_qfN <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span> <span class="free">N</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">P</span><span class="main">*</span>int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">p</span><span class="main">#}</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="main">(</span><span class="free">P</span><span class="main">*</span>int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">p</span><span class="main">#}</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">N</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">*</span>int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">p</span><span class="main">#}</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">S</span><span class="main">*</span><span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span> <span class="main">∧</span> is_qfN <span class="skolem">S</span> <span class="free">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> qfN_div_prime_general <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">P</span><span class="main">*</span> int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> p S <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="main">(</span><span class="free">P</span><span class="main">*</span>int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set_mset <span class="skolem">ps</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> IH <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">R</span><span class="main">.</span> prime <span class="bound">R</span> <span class="main">∧</span> <span class="bound">R</span> <span class="keyword1">dvd</span> int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> is_qfN <span class="bound">R</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ass3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> ps ass2 ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prime_factor_int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">k</span> <span class="main">::</span> <span class="quoted">int</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">k</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="keyword1">dvd</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms prime_divisor_exists <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_oddprime_cube<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> prime <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">;</span> odd <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">;</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="free">N</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="bound">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="bound">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="bound">a</span> <span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="var">?P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Podd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="var">?P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> suc23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">=</span> Suc <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">q</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> abP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="var">?a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="var">?b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="var">?b</span> <span class="var">?a</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="var">?b</span> <span class="var">?a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?h</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="var">?h</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="var">?h</span> <span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> abP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> prime_int_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> prime <span class="bound">g</span> <span class="main">∧</span> <span class="bound">g</span> <span class="keyword1">dvd</span> <span class="var">?h</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prime_factor_int <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="var">?h</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="var">?b</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">q</span> <span class="main">∨</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">∨</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_dvd_multD<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> gpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="var">?P</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> gNq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def power2_eq_square<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> gp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> gNq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> g2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> gNq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> dvd_add<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">+</span><span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> g1 <span class="keyword1"><span class="command">have</span></span> gpq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> gpq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_diff<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> g2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> gpq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_diff<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> prime_dvd_multD<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> gdvd2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zdvd_not_zless<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> gdvd2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="var">?a</span> <span class="main">∧</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="var">?a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">N</span><span class="main">*</span><span class="var">?b</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> abP <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_add<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="var">?P</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="var">?P</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Podd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> P gpos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">g</span> <span class="main">=</span> <span class="var">?P</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> Pab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="var">?a</span> <span class="main">∧</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> Pab P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">∨</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_dvd_multD<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_refl dvd_mult<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_add<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="numeral">4</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="numeral">4</span> <span class="main">∨</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> prime_dvd_multD<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="numeral">4</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> Pdvd4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="numeral">4</span>"</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">≤</span> <span class="numeral">4</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span> <span class="main">≤</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">&gt;</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zdvd_not_zless<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> Pdvd4 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">≠</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="var">?P</span> <span class="main">≠</span> <span class="numeral">4</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="var">?P</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">with</span></span> Podd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> Pdvd4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">dvd</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">*</span><span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_dvd_multD<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"gcd <span class="free">N</span> <span class="var">?a</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="free">N</span> <span class="var">?a</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?h</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="var">?h</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="var">?h</span> <span class="main">&gt;</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">with</span></span> N1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">.</span> prime <span class="bound">g</span> <span class="main">∧</span> <span class="bound">g</span> <span class="keyword1">dvd</span> <span class="var">?h</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prime_factor_int <span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="var">?h</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> gN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> right_diff_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> gN <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_add dvd_mult2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span> <span class="main">∨</span> <span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">*</span><span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_dvd_multD power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> gp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_dvd_multD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> gN <span class="keyword1"><span class="command">have</span></span> gP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">dvd</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> gP P g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="skolem">g</span> <span class="main">=</span> <span class="var">?P</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> primes_dvd_imp_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> g <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> gp <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> Pdvdp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> pP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> p0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zdvd_not_zless<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Pdvdp <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">*</span><span class="main">1</span> <span class="main">&lt;</span> <span class="var">?P</span><span class="main">*</span><span class="var">?P</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> prime_int_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="main">(</span><span class="main">0</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_qfN_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> N1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qfN_pos<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> neg <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcd <span class="var">?a</span> <span class="var">?b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"gcd <span class="var">?a</span> <span class="free">N</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="var">?a</span> <span class="var">?b</span>"</span></span> <span class="quoted"><span class="quoted">"coprime <span class="var">?a</span> <span class="free">N</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="var">?a</span> <span class="main">(</span><span class="free">N</span> <span class="main">*</span> <span class="var">?b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> abP <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Uniqueness ($N&gt;1$)›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_prime_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> prime <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span><span class="main">;</span> <span class="free">N</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">;</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">d</span><span class="main">^</span><span class="numeral">2</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">∧</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">d</span><span class="main">¦</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="var">?P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abcdN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">d</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">+</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="var">?P</span><span class="main">*</span><span class="main">(</span><span class="free">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">+</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="free">d</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> abcdN <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">+</span><span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">∨</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">b</span><span class="main">*</span><span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> mult <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">+</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_dvd_multD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">+</span><span class="free">b</span><span class="main">*</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">+</span><span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">=</span> <span class="var">?P</span><span class="main">*</span><span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> abcdN <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">+</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qfN_mult2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> Q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> <span class="free">N</span><span class="main">*</span><span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">d</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≠</span> <span class="free">d</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> P mult Q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> prime_int_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> N <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span> <span class="main">&gt;</span> <span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">1</span> <span class="main">&lt;</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> pos <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">b</span><span class="main">*</span><span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">=</span> <span class="var">?P</span><span class="main">*</span><span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> abcdN <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qfN_mult1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> Q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≥</span> <span class="free">N</span><span class="main">*</span><span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">d</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≠</span> <span class="free">d</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> P mult Q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> prime_int_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> N <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span> <span class="main">&gt;</span> <span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">1</span> <span class="main">&lt;</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">Q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">N</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> pos <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> bd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">d</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> abcdN <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_square_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">∧</span> <span class="free">N</span><span class="main">&gt;</span><span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="free">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="free">r</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">r</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">∧</span> <span class="main">¦</span><span class="free">s</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="numeral">2</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">¦</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">s</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> P1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> APP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?P</span><span class="main">*</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="var">?P</span> <span class="main">∧</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvdI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> uve<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">u</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">v</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">v</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">u</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">e</span><span class="main">¦</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule_tac</span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> qfN_div_prime<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> APP P1 ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">N</span><span class="main">&gt;</span><span class="main">1</span> <span class="main">∧</span> <span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">u</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">p</span><span class="main">¦</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">v</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">q</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> qfN_prime_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="free">p</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">f</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">*</span><span class="free">q</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">g</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> abs_eq_impl_unitfactor<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> uve <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="free">q</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="skolem">f</span><span class="main">)</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="skolem">f</span><span class="main">)</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_eq_square left_diff_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> s0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">=</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"gcd <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> <span class="main">¦</span><span class="free">r</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">r</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_1_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> s0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> P1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="var">?P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span>  <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_strict_mono<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="skolem">e</span><span class="main">*</span><span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> f g uve <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">g</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">e</span><span class="main">*</span><span class="skolem">f</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> gef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> uve <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">*</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">f</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> abs_mult_self_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="skolem">f</span><span class="main">)</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rs gef <span class="keyword1"><span class="command">unfolding</span></span> right_diff_distrib <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">r</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">f</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span>
    <span class="main">∧</span> <span class="main">¦</span><span class="free">s</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">e</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="skolem">f</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="numeral">2</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> uve f g <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult_1_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qfN_cube_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">∧</span> <span class="free">N</span> <span class="main">&gt;</span> <span class="main">1</span>
  <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">∧</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">q</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">N</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> P1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> APP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?P</span><span class="main">*</span><span class="var">?P</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square power3_eq_cube<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="var">?P</span> <span class="main">∧</span> <span class="var">?P</span> <span class="keyword1">dvd</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvdI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> uve<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">u</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">v</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">u</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">e</span><span class="main">¦</span><span class="main">=</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule_tac</span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> qfN_div_prime<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprimeI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> uve <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="free">a</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_common_divisor<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> P1 uve APP ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="var">?P</span> <span class="main">∧</span> <span class="free">N</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="var">?P</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="free">N</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span>
    <span class="main">∧</span> coprime <span class="skolem">u</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">u</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">v</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="numeral">2</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qfN_square_prime<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">f</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">g</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> abs_eq_impl_unitfactor<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> uve <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">f</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">g</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span>
    <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="free">p</span><span class="main">*</span><span class="skolem">g</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span> <span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="skolem">f</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">-</span><span class="skolem">f</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">e</span><span class="main">*</span><span class="skolem">g</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>
    <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">g</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">q</span> <span class="main">-</span> <span class="skolem">e</span><span class="main">*</span><span class="skolem">f</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">q</span> <span class="main">+</span> <span class="skolem">e</span><span class="main">*</span><span class="skolem">f</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> right_diff_distrib power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> f <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_mult_self_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> g <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abs_mult_self_eq <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">≠</span> <span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> efg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> ab g2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">f</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> Pa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2 power2_eq_square<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> efg <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">q</span><span class="main">+</span><span class="skolem">g</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g</span><span class="main">*</span><span class="free">q</span><span class="main">)</span><span class="main">*</span><span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> Pa <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> gcd <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> P1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> f g uve <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">f</span><span class="main">*</span><span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">*</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f2 g2 <span class="keyword1"><span class="command">unfolding</span></span> power2_eq_square <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">f</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">g</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">q</span> <span class="main">-</span> <span class="skolem">g</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">f</span><span class="main">*</span><span class="main">(</span><span class="free">p</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">N</span><span class="main">*</span><span class="free">p</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">g</span><span class="main">*</span><span class="main">(</span> <span class="numeral">3</span><span class="main">*</span><span class="free">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="free">q</span> <span class="main">-</span> <span class="free">N</span><span class="main">*</span><span class="free">q</span><span class="main">^</span><span class="numeral">3</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> right_diff_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span> power2_eq_square power3_eq_cube<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> f g <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The case $N=3$›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qf3_even<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">B</span><span class="main">.</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="bound">B</span> <span class="main">∧</span> is_qfN <span class="bound">B</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> even<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>odd <span class="free">a</span> <span class="main">∧</span> odd <span class="free">b</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>even <span class="free">a</span> <span class="main">∧</span> even <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> odd <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> even <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> even <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">3</span><span class="main">+</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> even <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="free">a</span> <span class="main">∧</span> even <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> abcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> evenE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> evenE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="main">(</span><span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_qfN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">a</span> <span class="main">∧</span> odd <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> abcd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span><span class="main">+</span><span class="main">1</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">d</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> oddE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> oddE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="skolem">c</span><span class="main">-</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∨</span> even <span class="main">(</span><span class="skolem">c</span><span class="main">-</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">c</span><span class="main">-</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">-</span><span class="skolem">d</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> evenE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> abcd <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">-</span><span class="free">b</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">hence</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e1 e2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">4</span><span class="main">*</span><span class="skolem">e</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="main">(</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_qfN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="skolem">c</span><span class="main">-</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">-</span><span class="skolem">d</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">e</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> oddE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> abcd <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">+</span><span class="free">b</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="skolem">d</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">b</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="skolem">d</span><span class="main">-</span><span class="free">b</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="var">?A</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="free">a</span><span class="main">+</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e1 e2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="skolem">d</span><span class="main">-</span><span class="free">b</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="skolem">d</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="skolem">d</span><span class="main">-</span><span class="free">b</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="skolem">d</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="main">(</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="skolem">d</span><span class="main">-</span><span class="free">b</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">+</span><span class="skolem">d</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_qfN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qf3_even_general<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> is_qfN <span class="free">A</span> <span class="numeral">3</span><span class="main">;</span> even <span class="free">A</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">B</span><span class="main">.</span> <span class="free">A</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="bound">B</span> <span class="main">∧</span> is_qfN <span class="bound">B</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="free">A</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_qfN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qf3_even<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qf3_oddprimedivisor_not<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">P</span> <span class="main">∧</span> odd <span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">∧</span> is_qfN <span class="main">(</span><span class="free">P</span><span class="main">*</span><span class="free">Q</span><span class="main">)</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="free">P</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">R</span><span class="main">.</span> prime <span class="bound">R</span> <span class="main">∧</span> odd <span class="bound">R</span> <span class="main">∧</span> <span class="bound">R</span> <span class="keyword1">dvd</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="bound">R</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> ass2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">R</span><span class="main">.</span> <span class="bound">R</span> <span class="keyword1">dvd</span> <span class="free">Q</span> <span class="main">⟶</span> prime <span class="bound">R</span> <span class="main">⟶</span> even <span class="bound">R</span> <span class="main">∨</span> is_qfN <span class="bound">R</span> <span class="numeral">3</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="free">Q</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> nat <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> int <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> is_qfN <span class="main">(</span><span class="free">P</span><span class="main">*</span>int <span class="skolem">n</span><span class="main">)</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="var">?A</span><span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="skolem">n</span> <span class="main">⟹</span> False"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span><span class="main">&lt;</span><span class="skolem">n</span> <span class="main">∧</span> <span class="var">?B</span> <span class="bound">m</span> <span class="main">⟹</span> False"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> Bn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> odd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Bn ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="free">P</span> <span class="main">∧</span> int <span class="skolem">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> is_qfN <span class="main">(</span><span class="free">P</span><span class="main">*</span>int <span class="skolem">n</span><span class="main">)</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="free">P</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">R</span><span class="main">.</span> prime <span class="bound">R</span> <span class="main">∧</span> <span class="bound">R</span> <span class="keyword1">dvd</span> int <span class="skolem">n</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="bound">R</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qfN_primedivisor_not<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">R</span> <span class="main">∧</span> <span class="skolem">R</span> <span class="keyword1">dvd</span> int <span class="skolem">n</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="skolem">R</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> odd <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">R</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> R <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">R</span><span class="main">*</span><span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> odd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Bn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> even<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> odd <span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span><span class="main">*</span><span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Bn <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="free">P</span><span class="main">*</span>int <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> is_qfN <span class="main">(</span><span class="free">P</span><span class="main">*</span>int <span class="skolem">n</span><span class="main">)</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">B</span><span class="main">.</span> <span class="free">P</span><span class="main">*</span><span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="bound">B</span> <span class="main">∧</span> is_qfN <span class="bound">B</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qf3_even_general<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">*</span><span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">B</span> <span class="main">∧</span> is_qfN <span class="skolem">B</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="main">(</span>int <span class="skolem">n</span><span class="main">)</span><span class="main">*</span><span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">P</span> <span class="main">∧</span> even <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> int <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> p<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> prime_power_dvd_cancel_right<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">im</span></span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"int <span class="skolem">n</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">im</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> nat <span class="skolem">im</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="main">(</span><span class="free">P</span><span class="main">*</span>int <span class="skolem">m</span><span class="main">)</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> m Bn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> m Bn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">(</span>int <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Bm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Bn m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">with</span></span> IH Bm <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> ass ass2 n <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qf3_oddprimedivisor<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> prime <span class="main">(</span><span class="free">P</span><span class="main">::</span>int<span class="main">)</span><span class="main">;</span> odd <span class="free">P</span><span class="main">;</span> coprime <span class="free">a</span> <span class="free">b</span><span class="main">;</span> <span class="free">P</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">⟧</span>
  <span class="main">⟹</span> is_qfN <span class="free">P</span> <span class="numeral">3</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">P</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>infinite_descent0_measure<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">P</span></span><span class="main"><span class="main">.</span></span> nat<span class="main"><span class="main">¦</span></span><span class="bound"><span class="bound">P</span></span><span class="main"><span class="main">¦</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>smaller <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> abx<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">x</span> <span class="main">∧</span> odd <span class="skolem">x</span> <span class="main">∧</span> coprime <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="main">∧</span> <span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="skolem">x</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> abx <span class="keyword1"><span class="command">have</span></span> x0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">x</span><span class="main">¦</span><span class="main">≤</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> best_division_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> abx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">x</span><span class="main">¦</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> odd_two_times_div_two_succ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> cm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">-</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">x</span> <span class="main">∧</span> <span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span><span class="main">¦</span><span class="main">≤</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> best_division_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> abx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span><span class="main">¦</span><span class="main">&lt;</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> odd_two_times_div_two_succ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> dn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">-</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span> <span class="main">∧</span> <span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">d</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> C3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_qfN <span class="var">?C</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_qfN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> hlp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> hlp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">d</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qfN_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> cm dn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">*</span><span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> gcd <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> abx <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="keyword1">dvd</span> <span class="var">?C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">¦</span><span class="skolem">d</span><span class="main">¦</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_abs<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> cm dn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">b</span><span class="main">-</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
      <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span><span class="main">*</span><span class="main">(</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> abx M <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
      <span class="skolem">x</span><span class="main">*</span><span class="skolem">M</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">m</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib distrib_left <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="skolem">M</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">m</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">n</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square distrib_left right_diff_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> yx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">-</span><span class="skolem">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> hlp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">d</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="numeral">2</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">d</span><span class="main">¦</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> cm dn hlp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">d</span><span class="main">¦</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">d</span><span class="main">¦</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> power_strict_mono <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="main">¦</span><span class="skolem">b</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">b</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">*</span><span class="numeral">4</span><span class="main">*</span><span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> contr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_diff_distrib<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">-</span><span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> contr <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">x</span><span class="main">-</span><span class="skolem">y</span> <span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> xy <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">-</span><span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> x0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span><span class="main">*</span><span class="main">(</span><span class="skolem">x</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">x</span><span class="main">*</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> contr <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">y</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> y <span class="keyword2"><span class="keyword">and</span></span> C0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> x0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">*</span><span class="skolem">y</span> <span class="main">&lt;</span> <span class="skolem">x</span><span class="main">*</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> C0 y <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">c</span><span class="main">≠</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">d</span><span class="main">≠</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="skolem">d</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> C0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> ef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="var">?g</span><span class="main">*</span><span class="skolem">e</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> <span class="var">?g</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">∧</span> coprime <span class="skolem">e</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gcd_coprime_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> gcd_pos_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> g2nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> C0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">f</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> E3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_qfN <span class="var">?E</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_qfN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> CgE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?E</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="var">?E</span> <span class="main">=</span> <span class="main">(</span><span class="var">?g</span><span class="main">*</span><span class="skolem">e</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="var">?g</span><span class="main">*</span><span class="skolem">f</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ef <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> y <span class="keyword1"><span class="command">have</span></span> g2dvdxy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">y</span><span class="main">*</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">x</span> <span class="main">(</span><span class="var">?g</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="var">?g</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="var">?g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="var">?g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">m</span><span class="main">*</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">c</span><span class="main">+</span><span class="skolem">m</span><span class="main">*</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_add<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> cm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">d</span><span class="main">+</span><span class="skolem">n</span><span class="main">*</span><span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_add<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> dn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> gcd <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> abx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="var">?g</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> coprime_dvd_mult_right_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> CgE y g2nonzero <span class="keyword1"><span class="command">have</span></span> Ewx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?E</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">*</span><span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">w</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="skolem">w</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> w y0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> wneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">&lt;</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> g2nonzero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">with</span></span> wneg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">w</span> <span class="main">&lt;</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> w y0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> w_le_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> wy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">&gt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> g2nonzero <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> w wy <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">*</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">w</span><span class="main">*</span><span class="var">?g</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> w <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> wy <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> Ewx E3 abx <span class="quoted"><span class="quoted">‹<span class="skolem">w</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"prime <span class="skolem">x</span> <span class="main">∧</span> odd <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> is_qfN <span class="main">(</span><span class="skolem">x</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="skolem">x</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">z</span> <span class="main">∧</span> odd <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="keyword1">dvd</span> <span class="skolem">w</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="skolem">z</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> qf3_oddprimedivisor_not<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Ewx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1">dvd</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">dvd</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dvd_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> z ef <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="skolem">z</span> <span class="main">∧</span> odd <span class="skolem">z</span> <span class="main">∧</span> coprime <span class="skolem">e</span> <span class="skolem">f</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="keyword1">dvd</span> <span class="var">?E</span> <span class="main">∧</span> <span class="main">¬</span> is_qfN <span class="skolem">z</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat<span class="main">¦</span><span class="skolem">z</span><span class="main">¦</span> <span class="main">&lt;</span> nat<span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">&lt;</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">z</span> <span class="keyword1">dvd</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zdvd_not_zless<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> z <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> w_le_y yx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> z <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">z</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qf3_cube_prime_impl_cube_form<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ab_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">P</span> <span class="main">∧</span> odd <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_cube_form <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> abP <span class="keyword1"><span class="command">have</span></span> qfP3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_qfN <span class="main">(</span><span class="free">P</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_qfN_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> PvdP3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">dvd</span> <span class="free">P</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> abP ab_relprime P <span class="keyword1"><span class="command">have</span></span> qfP<span class="main">:</span> <span class="quoted"><span class="quoted">"is_qfN <span class="free">P</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qf3_oddprimedivisor<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_qfN_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> P abP ab_relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>
    <span class="main">∧</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">¦</span> <span class="main">∧</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qfN_cube_prime<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">q</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_cube_form_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a1 s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_cube_form_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> ar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ar <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_cube_form_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> r s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ar s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_cube_form_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cube_form_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> is_cube_form <span class="free">a</span> <span class="free">b</span><span class="main">;</span> is_cube_form <span class="free">c</span> <span class="free">d</span><span class="main">;</span> <span class="main">¦</span><span class="free">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟧</span>
  <span class="main">⟹</span> is_cube_form <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">+</span><span class="free">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">d</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">e</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"is_cube_form <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"is_cube_form <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_cube_form_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> c_d <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="skolem">r</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_cube_form_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">*</span><span class="skolem">r</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">*</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">e</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">=</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">=</span><span class="main">1</span> <span class="main">∨</span> <span class="free">e</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">=</span><span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">*</span><span class="free">e</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> e3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">*</span><span class="main">1</span> <span class="main">=</span> <span class="free">e</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power2_eq_square power3_eq_cube<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">c</span><span class="main">+</span><span class="free">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">d</span> <span class="main">=</span> <span class="var">?t</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="var">?t</span><span class="main">*</span><span class="var">?u</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="var">?t</span><span class="main">*</span><span class="var">?u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span>
      <span class="main">+</span> <span class="free">e</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">18</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
      <span class="main">-</span> <span class="free">e</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">54</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">e</span><span class="main">*</span><span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e2 e3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
      <span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">+</span> <span class="numeral">81</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">3</span>
      <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="free">e</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="free">e</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square power3_eq_cube<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> pq rs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> left_diff_distrib right_diff_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">e</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="var">?t</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?u</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="var">?u</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="var">?t</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="var">?u</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="var">?u</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span>
      <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="main">(</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">18</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span>
      <span class="main">-</span> <span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">18</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">s</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">e</span><span class="main">*</span><span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span>
      <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">e</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">e</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> e2 e3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">-</span> <span class="free">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">18</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span>
      <span class="main">-</span> <span class="numeral">18</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">+</span> <span class="numeral">27</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="free">e</span><span class="main">*</span><span class="numeral">27</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">3</span>
      <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square power3_eq_cube<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> pq rs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main">*</span><span class="free">d</span><span class="main">-</span><span class="free">e</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> left_diff_distrib right_diff_distrib <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_cube_form_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qf3_cube_primelist_impl_cube_form<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set_mset <span class="free">ps</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">)</span><span class="main">;</span> odd <span class="main">(</span>int <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="free">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">!!</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> coprime <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="bound">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="bound">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span>int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="free">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">⟹</span> is_cube_form <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">hence</span></span> ab1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> b0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">with</span></span> ab1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> ab1 <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">=</span><span class="main">1</span> <span class="main">∨</span> <span class="skolem">a</span><span class="main">=</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square zmult_eq_1_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword2"><span class="keyword">and</span></span> b0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_cube_form <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_cube_form_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>add <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1"><span class="command">hence</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∧</span> odd <span class="main">(</span>int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">p</span><span class="main">#}</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∧</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">p</span><span class="main">#}</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span>  <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set_mset <span class="skolem">ps</span><span class="main">.</span> prime <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> prime <span class="main">(</span>int <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> coprime <span class="bound">u</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="bound">v</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span>
    <span class="main">∧</span> odd <span class="main">(</span>int<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> is_cube_form <span class="bound">u</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">p</span><span class="main">#}</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"int <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ge3_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> pw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">*</span> <span class="var">?X</span> <span class="main">∧</span> odd <span class="var">?p</span> <span class="main">∧</span> odd <span class="var">?X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">p</span><span class="main">#}</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">ps</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> wpx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">*</span> <span class="var">?X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_nat_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"even <span class="var">?p</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> wpx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">=</span> <span class="var">?X</span><span class="main">*</span><span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"even <span class="var">?X</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="var">?p</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="var">?p</span><span class="main">*</span><span class="var">?X</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="var">?p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> pw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> qf3_oddprimedivisor<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="keyword2"><span class="keyword">where</span></span> alphabeta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="skolem">α</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">β</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_qfN_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> alphabeta <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> pw <span class="keyword1"><span class="command">have</span></span> w3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="var">?w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_mult2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> vab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">27</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">9</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dvd_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_dvd_power_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">::</span>int"</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> vab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">27</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dvd_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_dvd_power_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">::</span>int"</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> gcd <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> alphabeta pw ass <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="skolem">α</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">β</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> odd <span class="main">(</span><span class="skolem">α</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">β</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> cdp<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">α</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">β</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> coprime <span class="skolem">c</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> qfN_oddprime_cube<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ass pw alphabeta <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="bound">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
    <span class="main">∧</span> coprime <span class="bound">u</span> <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">e</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span><span class="bound">u</span><span class="main">+</span><span class="bound">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">*</span><span class="bound">v</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span><span class="bound">v</span><span class="main">-</span><span class="bound">e</span><span class="main">*</span><span class="skolem">d</span><span class="main">*</span><span class="bound">u</span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?w</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> qfN_power_div_prime<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> uve<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>
    <span class="main">∧</span> coprime <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span><span class="skolem">u</span><span class="main">+</span><span class="skolem">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">*</span><span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">*</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">e</span><span class="main">*</span><span class="skolem">d</span><span class="main">*</span><span class="skolem">u</span> <span class="main">∧</span> <span class="main">¦</span><span class="skolem">e</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_cube_form <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> uvX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?X</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword1"><span class="command">have</span></span> p0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> pw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="var">?X</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="var">?w</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> uve <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">c</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> cdp alphabeta <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?p</span><span class="main">^</span><span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="var">?X</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> p0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> pw IH uve <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_cube_form <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprimeI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">dvd</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">dvd</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">dvd</span> <span class="skolem">c</span><span class="main">*</span><span class="skolem">u</span> <span class="main">+</span> <span class="skolem">d</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="keyword1">dvd</span> <span class="skolem">c</span><span class="main">*</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">d</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span><span class="main">*</span><span class="skolem">u</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> uve <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_common_divisor<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> pw cdp ass alphabeta <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> qf3_cube_prime_impl_cube_form<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_cube_form <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cube_form_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qf3_cube_impl_cube_form<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="free">w</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> odd <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_cube_form <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">w</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass not_sum_power2_lt_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> zero_le_power2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">arith</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> prime_factorization <span class="main">(</span>nat <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set_mset <span class="skolem">M</span><span class="main">.</span> prime <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">=</span> int <span class="main">(</span><span class="main">∏</span><span class="bound">i</span><span class="main">∈#</span><span class="skolem">M</span><span class="main">.</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def prod_mset_prime_factorization_int<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> qf3_cube_primelist_impl_cube_form<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Existence ($N=3$)›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This part contains the proof that all prime numbers $\equiv 1 \bmod 6$ can be written as $x^2 + 3y^2$.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First show $(\frac{a}{p})(\frac{b}{p}) = (\frac{ab}{p})$, where $p$ is an odd prime.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> Legendre_zmult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span><span class="main">;</span> prime <span class="free">p</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Legendre <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Legendre <span class="free">a</span> <span class="free">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Legendre <span class="free">b</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> prp<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> prp <span class="keyword1"><span class="command">have</span></span> prp'<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>nat <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p12</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nat<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Labp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Legendre <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Lap</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Legendre <span class="free">a</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Lbp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Legendre <span class="free">b</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>nat <span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> nat <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?Labp</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="free">b</span><span class="main">)</span><span class="main">^</span><span class="var">?p12</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prp p2 euler_criterion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">*</span><span class="free">b</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">a</span><span class="main">^</span><span class="var">?p12</span> <span class="main">*</span> <span class="free">b</span><span class="main">^</span><span class="var">?p12</span> <span class="main">=</span> <span class="var">?Labp</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib cong_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?Lap</span> <span class="main">*</span> <span class="var">?Lbp</span> <span class="main">=</span> <span class="free">a</span><span class="main">^</span><span class="var">?p12</span><span class="main">*</span><span class="free">b</span><span class="main">^</span><span class="var">?p12</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> euler_criterion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="free">p</span>"</span></span><span class="main">]</span> p2 prp' h1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?Lap</span> <span class="main">*</span> <span class="var">?Lbp</span> <span class="main">=</span> <span class="var">?Labp</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cong_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Labp</span> <span class="main">=</span> <span class="main">(</span><span class="var">?Lap</span><span class="main">*</span><span class="var">?Lbp</span><span class="main">)</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_iff_lin<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> p2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">*</span><span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> p2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">*</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">*</span><span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> k1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">*</span><span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span> <span class="keyword1"><span class="command">}</span></span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span><span class="main">*</span><span class="free">p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">p</span><span class="main">¦</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">*</span><span class="free">p</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Labp</span> <span class="main">-</span> <span class="var">?Lap</span><span class="main">*</span><span class="var">?Lbp</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span><span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?Labp</span> <span class="main">-</span> <span class="var">?Lap</span><span class="main">*</span><span class="var">?Lbp</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Labp</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="var">?Labp</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Labp</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Legendre_def<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Lap</span><span class="main">*</span><span class="var">?Lbp</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="var">?Lap</span><span class="main">*</span><span class="var">?Lbp</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Lap</span><span class="main">*</span><span class="var">?Lbp</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Legendre_def<span class="main">)</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">with</span></span> k <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now show $(\frac{-3}{p}) = +1$ for primes $p \equiv 1 \bmod 6$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Legendre_1mod6<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="free">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> Legendre <span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span> <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="free">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">6</span><span class="main">*</span><span class="free">m</span><span class="main">+</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Legendre <span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span> <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Legendre <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?L3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Legendre <span class="numeral">3</span> <span class="var">?p</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span>nat <span class="var">?p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> neg1cube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">m</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> pn3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="main">(</span>Legendre <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="var">?p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Legendre <span class="numeral">3</span> <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> b<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Legendre_zmult<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>Legendre <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="var">?p</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span>nat <span class="free">m</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="var">?p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat<span class="main">(</span><span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>nat <span class="var">?p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?L1</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>nat<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="var">?p</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="var">?p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> euler_criterion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"nat <span class="var">?p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span> p' p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span> nat <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat<span class="main">(</span><span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> nat <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> neg1cube <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span>nat <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span>nat <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span>nat <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L3</span> <span class="main">*</span> <span class="main">(</span>Legendre <span class="var">?p</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span>nat <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">(</span><span class="numeral">3</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">6</span> <span class="main">*</span> <span class="free">m</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span>nat <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L3</span> <span class="main">*</span> <span class="main">(</span>Legendre <span class="var">?p</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span>nat <span class="free">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Quadratic_Reciprocity_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span>"</span></span><span class="main">]</span> p' pn3 p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> neg1cube <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Legendre <span class="var">?p</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">1</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?p</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cong_iff_dvd_diff dvd_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"QuadRes <span class="numeral">3</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> QuadRes_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[</span><span class="var">?p</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?p</span> <span class="main">=</span> <span class="main">0</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_iff_dvd_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="numeral">6</span><span class="main">*</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="var">?p</span><span class="main">-</span> <span class="numeral">6</span><span class="main">*</span><span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_diff<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Legendre_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?L</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>nat <span class="free">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>nat <span class="free">m</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="var">?p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cong_scalar_right<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?L</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="main">(</span>nat <span class="free">m</span><span class="main">)</span><span class="main">+</span><span class="main">(</span>nat <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="var">?p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_add<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="free">m</span><span class="main">)</span><span class="main">+</span><span class="main">(</span>nat <span class="free">m</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>nat <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?L</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span>nat <span class="free">m</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="var">?p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="var">?L</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>nat <span class="free">m</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="var">?p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">1</span> <span class="main">=</span> <span class="var">?L</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="var">?p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cong_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">-</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cong_iff_dvd_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="var">?L</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?L</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Legendre_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="var">?p</span> <span class="keyword1">dvd</span> <span class="main">1</span> <span class="main">∨</span> <span class="var">?L</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="var">?p</span> <span class="keyword1">dvd</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> p2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zdvd_not_zless<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Use this to prove that such primes can be written as $x^2 + 3y^2$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> qf3_prime_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="free">m</span><span class="main">+</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="numeral">6</span><span class="main">*</span><span class="free">m</span><span class="main">+</span><span class="main">1</span> <span class="main">=</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="bound">y</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">6</span><span class="main">*</span><span class="free">m</span><span class="main">+</span><span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Legendre <span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span> <span class="var">?p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Legendre_1mod6<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> QuadRes <span class="var">?p</span> <span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Legendre <span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span> <span class="var">?p</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Legendre_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"QuadRes <span class="var">?p</span> <span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">3</span><span class="main">]</span> <span class="main">(</span><span class="keyword1">mod</span> <span class="var">?p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> QuadRes_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">dvd</span> <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> cong_iff_dvd_diff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">dvd</span> <span class="skolem">s</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">1</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">s</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="free">m</span><span class="main">)</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_qfN <span class="var">?p</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> qf3_oddprimedivisor <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_qfN_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Fermat3">
<div class="head">
<h1>Theory Fermat3</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Fermat3.thy
    Author:     Roelof Oosterhuis, 2007  Rijksuniversiteit Groningen
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Fermat's last theorem, case $n=3$›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Fermat3
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Quad_Form.html">Quad_Form</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Proof of Fermat's last theorem for the case $n=3$: $$\forall x,y,z:~x^3 + y^3 = z^3 \Longrightarrow xyz=0.$$›</span></span>

<span class="comment1">(* TODO: this lemma is also used in Fermat4 with a slightly different generalization to ints.
Maybe it should be generalized to factorial rings and moved to another theory. *)</span>
<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> nat_relprime_power_divisors<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>nat<span class="main">)</span><span class="main">*</span><span class="free">b</span> <span class="main">=</span> <span class="free">c</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span><span class="main">^</span><span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat_less_induct<span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n0 power_one zero_power  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq_sym_conv<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_factor_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">c</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> dvd_mult2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="main">(</span><span class="skolem">c</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>1<span class="main">)</span> prime_dvd_power_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> dvd_power_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">p</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> coprime_common_divisor_nat <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n0 p<span class="main">(</span>1<span class="main">)</span>  dvd_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> gcd_nat.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> p<span class="main">(</span>1<span class="main">)</span> prime_elem_divprod_pow <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">c'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> h1 dvdE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> dvdE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> prime_dvd_power_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> p<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="free">n</span> <span class="main">*</span> <span class="skolem">c'</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c'</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a'</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>4<span class="main">)</span> ac<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h2 dvd_0_right gr0I True <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p<span class="main">(</span>1<span class="main">)</span> 1<span class="main">(</span>3<span class="main">)</span> nat_0_less_mult_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> n0 prime_gt_Suc_0_nat
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">&lt;</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ac<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> n0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">*</span><span class="skolem">k</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ac<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> int_relprime_odd_power_divisors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"odd <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span> <span class="free">c</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"coprime <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">k</span><span class="main">^</span><span class="free">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">b</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> power_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">*</span> nat <span class="main">¦</span><span class="free">b</span><span class="main">¦</span> <span class="main">=</span> nat <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_mult_distrib <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">b</span><span class="main">¦</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> nat_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span>nat <span class="main">¦</span><span class="free">a</span><span class="main">¦</span><span class="main">)</span> <span class="main">(</span>nat <span class="main">¦</span><span class="free">b</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> gcd_int_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span><span class="main">.</span> nat <span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="bound">k</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nat_relprime_power_divisors<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="free">a</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="free">b</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="free">c</span><span class="main">¦</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">k'</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> int <span class="skolem">k'</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> int_nat_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">a</span><span class="main">¦</span>"</span></span><span class="main">]</span> of_nat_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k'</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="skolem">k</span><span class="main">^</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="skolem">k</span><span class="main">^</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">k</span><span class="main">)</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> power_minus_odd <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> factor_sum_cubes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> two_not_abs_cube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">⟹</span> False"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> x32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_abs<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> x32 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_0_left<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span><span class="main">^</span><span class="numeral">3</span> <span class="main">&gt;</span> <span class="numeral">2</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_strict_mono<span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> x32 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Shows there exists no solution $v^3+w^3 = x^3$ with $vwx\ne 0$ and $coprime v w$ and $x$ even, by constructing a solution with a smaller $|x^3|$.›</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> no_rewritten_fermat3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">v</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="bound">w</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="bound">v</span><span class="main">*</span><span class="bound">w</span><span class="main">*</span><span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> even <span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span> <span class="main">∧</span> coprime <span class="bound">v</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_descent0_measure<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> V<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> nat<span class="main"><span class="main">¦</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">^</span></span><span class="numeral"><span class="numeral">3</span></span><span class="main"><span class="main">¦</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>0 <span class="skolem">x</span><span class="main">)</span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>smaller <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> vwx<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span><span class="main">=</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">*</span><span class="skolem">w</span><span class="main">*</span><span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> even <span class="skolem">x</span> <span class="main">∧</span> coprime <span class="skolem">v</span> <span class="skolem">w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">v</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">α</span> <span class="bound">β</span> <span class="bound">γ</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">α</span> <span class="bound">β</span> <span class="bound">γ</span> <span class="main">∧</span> nat<span class="main">¦</span><span class="bound">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">&lt;</span> nat<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="comment1">― ‹obtain coprime $p$ and $q$ such that $v = p+q$ and $w = p-q$›</span>
    <span class="keyword1"><span class="command">have</span></span> vwOdd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="skolem">v</span> <span class="main">∧</span> odd <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"odd <span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> ve<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> vwx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">-</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> vwx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">-</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ve <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> gcd <span class="skolem">v</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> vwx <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> vwx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="main">(</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> vwx <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">v</span><span class="main">+</span><span class="skolem">w</span><span class="main">)</span> <span class="main">∧</span> even <span class="main">(</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">+</span><span class="skolem">w</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">-</span><span class="skolem">w</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> evenE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">+</span><span class="skolem">w</span>"</span></span><span class="main">]</span> evenE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">-</span><span class="skolem">w</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">hence</span></span> vw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">+</span><span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">-</span><span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="comment1">― ‹show that $x^3 = (2p)(p^2 + 3q^2)$ and that these factors are›</span>
    <span class="comment1">― ‹either coprime (first case), or have $3$ as g.c.d. (second case)›</span>
    <span class="keyword1"><span class="command">have</span></span> vwpq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">v</span><span class="main">+</span><span class="skolem">w</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">*</span><span class="skolem">w</span> <span class="main">+</span> <span class="skolem">w</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> factor_sum_cubes<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> pq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">*</span><span class="skolem">w</span> <span class="main">+</span> <span class="skolem">w</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">v</span><span class="main">+</span><span class="skolem">w</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">v</span><span class="main">-</span><span class="skolem">w</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> pq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?g</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> vwpq vwx <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> nat<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> gOdd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="var">?g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> odd <span class="var">?g</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span><span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">-</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="skolem">q</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">-</span><span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">*</span><span class="skolem">w</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vw <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∨</span> even <span class="main">(</span><span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> vwOdd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> even_odd_p_q<span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="skolem">p</span> <span class="main">∧</span> odd <span class="skolem">q</span> <span class="main">∨</span> odd <span class="skolem">p</span> <span class="main">∧</span> even <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="comment1">― ‹first case: $p$ is not a multiple of $3$; hence $2p$ and $p^2+3q^2$›</span>
    <span class="comment1">― ‹are coprime; hence both are cubes›</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="var">?g</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> prime_dvd_multD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prime_dvd_mult_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> p3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">v</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> pq_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">with</span></span> vw <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">w</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">p</span> <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="main">(</span><span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> factors_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
        <span class="keyword3"><span class="command">assume</span></span> g2p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gpq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">p</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="numeral">2</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> g2p gpq even_odd_p_q dvd_trans <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> g2p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_dvd_mult_left_iff <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">p</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> gpq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_add_right_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="numeral">3</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>›</span></span> p3 dvd_trans <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_imp_coprime<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">dvd</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_dvd_mult_right_iff <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> vwx vwpq <span class="keyword1"><span class="command">have</span></span> pqx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span> <span class="main">=</span> <span class="bound">c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_relprime_odd_power_divisors<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pqx factors_relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">d</span><span class="main">.</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="bound">d</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_relprime_odd_power_divisors<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> odd <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">d</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_triv_left<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> gcd <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> d factors_relprime <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> d pq_relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> odd <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_cube_form <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qf3_cube_impl_cube_form<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">q</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_cube_form_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pq_relprime ab <span class="keyword1"><span class="command">have</span></span> ab_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coprime_imp_coprime<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab1<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> h2a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="numeral">2</span> <span class="skolem">h</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ab even_odd_p_q hab dvd_trans <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> h2a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_dvd_mult_left_iff <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> hab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">h</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dvd_trans <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> ab <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_add_right_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="numeral">3</span> <span class="skolem">h</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_imp_coprime<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_dvd_mult_left_iff <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="skolem">b</span> <span class="main">⟷</span> odd <span class="skolem">a</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ab3<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> ab4<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> h2a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> hab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">h</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dvd_trans <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> ab <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>›</span></span> dvd_add_right_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="numeral">3</span> <span class="skolem">h</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prime_imp_coprime<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coprime_dvd_mult_left_iff <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> ab1 <span class="keyword1"><span class="command">have</span></span> ab2<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
          <span class="main">(</span><span class="operator">use</span> dvd_add <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="numeral"><span class="numeral"><span class="numeral">3</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">b</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="numeral"><span class="numeral"><span class="numeral">3</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">b</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="bound">l</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">=</span> <span class="bound">m</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ab2 ab3 ab4 abc
          int_relprime_odd_power_divisors <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
          int_relprime_odd_power_divisors <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
          int_relprime_odd_power_divisors <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> albega<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span> <span class="main">=</span> <span class="skolem">α</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span> <span class="main">=</span> <span class="skolem">β</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="comment1">― ‹show this is a (smaller) solution›</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">β</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">*</span><span class="skolem">β</span><span class="main">*</span><span class="skolem">γ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">*</span> <span class="skolem">β</span> <span class="main">*</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> albega ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_0_left<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> vwpq vwx <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">γ</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> albega <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">α</span> <span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ab2 <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> ha<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">β</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">α</span> <span class="main">*</span> <span class="skolem">α</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">β</span> <span class="main">*</span> <span class="skolem">β</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">α</span><span class="main">^</span>Suc <span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">β</span><span class="main">^</span>Suc <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> albega <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat<span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">&lt;</span> nat<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> vwx vwpq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span><span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> albega <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span> <span class="main">*</span><span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> nat<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> eqpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> Ag1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?A</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> Aqf3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_qfN <span class="var">?A</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_qfN_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> triv3b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> qfN_pos<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∨</span> <span class="var">?A</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?A</span> <span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> triv3b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qfN_zero<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> vwpq vwx <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> 
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">=</span><span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_le_power2<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
              <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">with</span></span> pq_relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">p</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> vwpq vwx A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> two_not_abs_cube<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">¦</span><span class="main">*</span><span class="main">1</span> <span class="main">&lt;</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="var">?A</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> zmult_zless_mono2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> eqpos <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">¦</span><span class="main">*</span><span class="main">¦</span><span class="var">?A</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
          <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> nat<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">*</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zmult_zless_mono2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="comment1">― ‹second case: $p = 3r$ and hence $x^3 = (18r)(q^2+3r^2)$ and these›</span>
    <span class="comment1">― ‹factors are coprime; hence both are cubes›</span> 
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_triv_left<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> pq3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> g3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">v</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> qr_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">q</span> <span class="skolem">r</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> hq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> hq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">with</span></span> vw <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">w</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> factors_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="numeral">18</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> g3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> g1 k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"prime <span class="skolem">h</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> prime_divisor_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> k <span class="keyword1"><span class="command">have</span></span> hg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_dvd_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">h</span><span class="main">)</span><span class="main">*</span><span class="skolem">s</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> rqh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">+</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">*</span><span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> hp r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zdvd_mult_cancel<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">r</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> prime_dvd_multD<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">2</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">2</span>"</span></span> 
            <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">=</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zdvd_not_zless<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="skolem">h</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prime_int_iff<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> hg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_mult_left<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> gOdd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> hr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">*</span><span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">*</span><span class="main">(</span><span class="skolem">h</span><span class="main">*</span><span class="skolem">t</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> rqh <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span><span class="main">*</span><span class="skolem">s</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">h</span><span class="main">*</span><span class="skolem">t</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">h</span><span class="main">*</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">h</span><span class="main">*</span><span class="skolem">t</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> right_diff_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> h <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_dvd_multD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">q</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> hr <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> gcd <span class="skolem">q</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> h qr_relprime <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> prime_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> k r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">=</span> gcd <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> gcd <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">*</span> gcd <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gcd_mult_distrib_int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> gcd_eq_1_imp_coprime<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="numeral">9</span> <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">v</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="main">::</span> <span class="quoted">int</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_unit <span class="skolem">h</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> h9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">9</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hrq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">9</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">3</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"normalize <span class="skolem">h</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> divides_primepow<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_unit <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹normalize <span class="skolem">h</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">^</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">h</span><span class="main">¦</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">*</span> <span class="numeral">3</span> <span class="main">^</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="main">¦</span><span class="skolem">h</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">h</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="numeral">3</span> <span class="main">*</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> hrq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> prime_dvd_power_int <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> p3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">p</span> <span class="main">-</span> <span class="skolem">q</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">with</span></span> vw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">w</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="skolem">v</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_unit <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_common_divisor<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">w</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">*</span> <span class="numeral">9</span><span class="main">)</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> coprime_mult_left_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> rqx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">18</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> vwx vwpq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">9</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="numeral">18</span><span class="main">*</span><span class="skolem">r</span> <span class="main">=</span> <span class="bound">c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_relprime_odd_power_divisors<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">c1</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prime <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="skolem">c1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prime_dvd_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> c1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span><span class="skolem">c</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">r</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib dvd_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> rqx factors_relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="numeral">18</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="numeral">18</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">d</span><span class="main">.</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="bound">d</span><span class="main">^</span><span class="numeral">3</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_relprime_odd_power_divisors<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> odd <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="skolem">d</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">9</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_triv_left<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="keyword1">dvd</span> gcd <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="main">(</span><span class="numeral">9</span><span class="main">*</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> d factors_relprime <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> d qr_relprime <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">q</span> <span class="skolem">r</span> <span class="main">∧</span> <span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">r</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> odd <span class="skolem">d</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_cube_form <span class="skolem">q</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qf3_cube_impl_cube_form<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">9</span><span class="main">*</span><span class="skolem">a</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="main">=</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> is_cube_form_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> qr_relprime ab <span class="keyword1"><span class="command">have</span></span> ab_relprime<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> coprime_imp_coprime<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab1<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> h2b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">h</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">h</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> hab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dvd_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">r</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> coprime_common_divisor_int qr_relprime <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> h2b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">b</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> coprime_dvd_mult_right_iff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="numeral">2</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> hab <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dvd_diff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> ab1 <span class="keyword1"><span class="command">have</span></span> ab2<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> hab1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hab2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dvd_diff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> ab1 <span class="keyword1"><span class="command">have</span></span> ab3<span class="main">:</span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> hab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h2b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">+</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hab h2b dvd_add <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"even <span class="skolem">b</span> <span class="main">⟷</span> odd <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">k</span> <span class="bound">l</span> <span class="bound">m</span><span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span> <span class="main">=</span> <span class="bound">k</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span> <span class="main">=</span> <span class="bound">l</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span> <span class="main">=</span> <span class="bound">m</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc ab1 ab2 ab3
          int_relprime_odd_power_divisors <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
          int_relprime_odd_power_divisors <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
          int_relprime_odd_power_divisors <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α1</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span> <span class="main">=</span> <span class="skolem">α1</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span> <span class="main">=</span> <span class="skolem">β</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">α1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">― ‹show this is a (smaller) solution›</span>
      <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">-</span><span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">β</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span><span class="main">*</span><span class="skolem">β</span><span class="main">*</span><span class="skolem">γ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">*</span> <span class="skolem">β</span> <span class="main">*</span> <span class="skolem">γ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> a1 a2 ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_0_left<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> r vwpq vwx <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">γ</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">α</span> <span class="skolem">β</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ab2 <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> ha<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">α</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">β</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">α</span> <span class="main">*</span> <span class="skolem">α</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">β</span> <span class="main">*</span> <span class="skolem">β</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">α</span><span class="main">^</span>Suc <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">β</span><span class="main">^</span>Suc <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> a1 a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">b</span> <span class="main">-</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_diff_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat<span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">&lt;</span> nat<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="skolem">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> vwx vwpq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">p</span><span class="main">*</span><span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">6</span><span class="main">*</span><span class="skolem">r</span><span class="main">*</span><span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="main">(</span><span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span> <span class="main">*</span><span class="main">(</span><span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">¦</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> nat<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
          <span class="keyword1"><span class="command">from</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> nat<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">*</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="numeral">9</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">+</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">-</span><span class="skolem">b</span><span class="main">)</span><span class="main">*</span><span class="var">?A</span><span class="main">¦</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zmult_zless_mono2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">¦</span><span class="skolem">γ</span><span class="main">^</span><span class="numeral">3</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The theorem. Puts equation in requested shape.›</span></span>  

<span class="keyword1"><span class="command">theorem</span></span> fermat_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="free">z</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="free">z</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcd <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="keyword1">div</span> <span class="var">?g</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> xyz0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="free">z</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="comment1">― ‹divide out the g.c.d.›</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="var">?g</span><span class="main">*</span><span class="skolem">a</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="var">?g</span><span class="main">*</span><span class="skolem">b</span> <span class="main">∧</span> coprime <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gcd_coprime_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">*</span><span class="var">?g</span> <span class="main">=</span> <span class="free">z</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="var">?c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> xyz0 <span class="keyword1"><span class="command">have</span></span> g0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> zgab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword2"><span class="keyword">and</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="var">?g</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="main">(</span><span class="var">?g</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> cgz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">*</span> <span class="var">?g</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
      <span class="keyword1"><span class="command">from</span></span> zgab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">^</span><span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="free">z</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">dvd</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> dvd_mult_div_cancel<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">^</span><span class="numeral">3</span> <span class="main">*</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">*</span><span class="var">?g</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">^</span><span class="numeral">3</span> <span class="main">*</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="var">?c</span><span class="main">*</span><span class="var">?g</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> cgz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">z</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> zgab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?g</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> g0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword2"><span class="keyword">and</span></span> xyz0 <span class="keyword2"><span class="keyword">and</span></span> cgz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="var">?c</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="comment1">― ‹make both sides even›</span>
  <span class="keyword1"><span class="command">from</span></span> ab <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="main">(</span><span class="skolem">a</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">u</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="bound">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="bound">w</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="bound">u</span><span class="main">*</span><span class="bound">v</span><span class="main">*</span><span class="bound">w</span><span class="main">≠</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">∧</span> even <span class="bound">w</span> <span class="main">∧</span> coprime <span class="bound">u</span> <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="free">w</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="free">u</span><span class="main">*</span><span class="free">v</span><span class="main">*</span><span class="free">w</span><span class="main">≠</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">∧</span> even <span class="free">w</span> <span class="main">∧</span> coprime <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">a</span> <span class="main">∨</span> even <span class="skolem">b</span> <span class="main">∨</span> even <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>even <span class="skolem">a</span> <span class="main">∨</span> even <span class="skolem">b</span> <span class="main">∨</span> even <span class="var">?c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> aodd<span class="main">:</span> <span class="quoted"><span class="quoted">"odd <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"odd <span class="skolem">b</span> <span class="main">∧</span> odd <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="var">?c</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> abc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">^</span><span class="numeral">3</span><span class="main">-</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> aodd <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span><span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> uvwabc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∧</span> even <span class="skolem">w</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> abc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">*</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">w</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> uvw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span><span class="main">=</span><span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> uvwabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">*</span><span class="skolem">b</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> abc <span class="keyword2"><span class="keyword">and</span></span> uvwabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="main">(</span><span class="skolem">a</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> hu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> uvwabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="var">?c</span><span class="main">*</span><span class="var">?c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_mult2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> abc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> power_Suc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> hu uvwabc <span class="keyword1"><span class="command">have</span></span> hb3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">*</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span><span class="main">-</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> power_Suc <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> dvd_diff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> hb3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> power_Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹even <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> 
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> uvwabc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> even <span class="skolem">w</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> abc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">*</span><span class="skolem">v</span><span class="main">*</span><span class="skolem">w</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> uvw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span><span class="main">=</span><span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> uvwabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">*</span><span class="skolem">a</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span><span class="main">*</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="var">?c</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> abc <span class="keyword2"><span class="keyword">and</span></span> uvwabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">w</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"coprime <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹coprime <span class="main">(</span><span class="skolem">a</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">^</span> <span class="numeral">3</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> coprime_imp_coprime<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
        <span class="keyword3"><span class="command">assume</span></span> hu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> uvwabc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="var">?c</span><span class="main">*</span><span class="var">?c</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> dvd_mult2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> abc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> power_Suc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> hu uvwabc <span class="keyword1"><span class="command">have</span></span> hb3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">*</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span><span class="main">+</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span><span class="main">-</span><span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> power_Suc <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> dvd_diff <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">^</span> <span class="numeral">3</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> hb3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="keyword1">dvd</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> power_Suc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹even <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> 
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"even <span class="var">?c</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> uvwabc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">∧</span> even <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> abc ab <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">w</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="bound">v</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="bound">w</span><span class="main">^</span><span class="numeral">3</span> <span class="main">∧</span> <span class="bound">u</span><span class="main">*</span><span class="bound">v</span><span class="main">*</span><span class="bound">w</span> <span class="main">≠</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="main">∧</span> even <span class="bound">w</span> <span class="main">∧</span> coprime <span class="bound">u</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="comment1">― ‹show contradiction using the earlier result›</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> no_rewritten_fermat3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> fermat_mult3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span><span class="free">n</span> <span class="main">+</span> <span class="free">y</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">z</span><span class="main">^</span><span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="keyword1">dvd</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">*</span><span class="free">z</span><span class="main">=</span><span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="skolem">m</span><span class="main">*</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> dvd_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> xyz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> power_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">z</span><span class="main">^</span><span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fermat_3<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>