<div id="Arrow_Utility">
<div class="head">
<h1>Theory Arrow_Utility</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2002  *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Arrow's Theorem for Utility Functions"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Arrow_Utility <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory formalizes the first proof due to
Geanakoplos~\cite{Geanakoplos05}.  In contrast to the standard model
of preferences as linear orders, we model preferences as \emph{utility
functions} mapping each alternative to a real number. The type of
alternatives and voters is assumed to be finite.›</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> alt
<span class="keyword1"><span class="command">typedecl</span></span> indi

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  alt3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">::</span>alt<span class="main">.</span> distinct<span class="main">[</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  finite_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>UNIV<span class="main">::</span> alt set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>

  finite_indi<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>UNIV<span class="main">::</span> indi set<span class="main">)</span>"</span></span>

<span class="keyword1" id="Arrow_Utility-third_alt"><span class="command">lemma</span></span> third_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">::</span>alt<span class="main">.</span> distinct<span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="bound">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> alt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">metis</span>

<span class="keyword1" id="Arrow_Utility-alt2"><span class="command">lemma</span></span> alt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">::</span>alt<span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> alt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">type_synonym</span></span> pref <span class="main">=</span> <span class="quoted"><span class="quoted">"alt <span class="main">⇒</span> real"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> prof <span class="main">=</span> <span class="quoted"><span class="quoted">"indi <span class="main">⇒</span> pref"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">&lt;⋅</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">&lt;⋅</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>  <span class="main">≡</span>  <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"alt <span class="main">⇒</span> pref <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⋅&lt;</span>"</span> 60<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main"><span class="free">⋅&lt;</span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>  <span class="main">≡</span>  <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">a</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">extreme</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">extreme</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>  <span class="main">≡</span>  <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⋅&lt;</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&lt;⋅</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Extreme</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">==</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> extreme <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;=</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">s</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">&lt;</span> <span class="free">s</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&lt;=</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">s</span><span class="main">+</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">&lt;</span> <span class="free">s</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main">+</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">-</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">&lt;</span> <span class="free">r</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1" id="Arrow_Utility-less_if_bot"><span class="command">lemma</span></span> less_if_bot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">p</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>bot_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">p</span> <span class="main">&lt;⋅</span> <span class="free">b</span><span class="main">;</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">p</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>top_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;⋅</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> top <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>eq_sym_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow_Utility-not_less_if_bot"><span class="command">lemma</span></span> not_less_if_bot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> bot <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>eq_sym_conv<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow_Utility-top_impl_not_bot"><span class="command">lemma</span></span> top_impl_not_bot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;⋅</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold</span> bot_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>alt2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="free">p</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="free">p</span> <span class="main">&lt;⋅</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> extreme_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>top_impl_not_bot<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"extreme <span class="free">p</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">&lt;⋅</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> extreme_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>top_impl_not_bot<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Auxiliary construction to hide details of preference model.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">mktop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> pref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">mktop</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">:=</span> Max<span class="main">(</span>range <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">mkbot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> pref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">mkbot</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">:=</span> Min<span class="main">(</span>range <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">between</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> alt <span class="main">⇒</span> alt <span class="main">⇒</span> pref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">between</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">:=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹To make things simpler:›</span></span>
<span class="keyword1"><span class="command">declare</span></span> between_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> mktop <span class="free">p</span> <span class="free">b</span> <span class="free">a</span> <span class="main">=</span> <span class="free">p</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mktop_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> mkbot <span class="free">p</span> <span class="free">b</span> <span class="free">a</span> <span class="main">=</span> <span class="free">p</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mkbot_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">p</span> <span class="free">a</span> <span class="main">&lt;</span> mktop <span class="free">p</span> <span class="free">b</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mktop_def finite_alt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> mkbot <span class="free">p</span> <span class="free">b</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mkbot_def finite_alt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mktop <span class="free">p</span> <span class="free">b</span> <span class="main">&lt;⋅</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mktop_def top_def finite_alt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">b</span> <span class="main">⋅&lt;</span> mktop <span class="free">p</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mktop_def bot_def alt2 finite_alt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="free">p</span> <span class="free">a</span> <span class="main">&lt;</span> mkbot <span class="main">(</span><span class="free">P</span> <span class="free">p</span><span class="main">)</span> <span class="free">b</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mkbot_def finite_alt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="free">p</span> <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">P</span> <span class="free">p</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="free">p</span> <span class="free">a</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="free">P</span> <span class="free">p</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The proof starts here.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> arrow <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"prof <span class="main">⇒</span> pref"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> unanimity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">P</span> <span class="bound">i</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">F</span> <span class="free">P</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="free">P</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> IIA<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">i</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">P</span> <span class="bound">i</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P'</span> <span class="bound">i</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">P'</span> <span class="bound">i</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="main">(</span><span class="free">F</span> <span class="free">P</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="free">P</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">F</span> <span class="free">P'</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="free">P'</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> IIA' <span class="main">=</span> IIA<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">dictates</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"indi <span class="main">⇒</span> alt <span class="main">⇒</span> alt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">dictates</span> _ <span class="keyword1">&lt;</span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1"><span class="free">dictates</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">&lt;</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="main">∀</span><span class="bound">P</span><span class="main">.</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟶</span> <span class="free">F</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> <span class="free">F</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">dictates2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"indi <span class="main">⇒</span> alt <span class="main">⇒</span> alt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">dictates</span> _<span class="keyword1">,</span>_"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1"><span class="free">dictates</span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">dictates</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">dictates</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">dictatesx</span><span class="main">::</span> <span class="quoted"><span class="quoted">"indi <span class="main">⇒</span> alt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">dictates'_except</span> _"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1"><span class="free">dictates_except</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">≡</span>  <span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∉</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">dictates</span> <span class="bound">a</span><span class="main">&lt;</span><span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">dictator</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"indi <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">dictator</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>  <span class="main">≡</span>  <span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="keyword1">dictates</span> <span class="bound">a</span><span class="main">&lt;</span><span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">pivotal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"indi <span class="main">⇒</span> alt <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pivotal</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span>
 <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> Extreme <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>  <span class="main">∧</span>  <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⋅&lt;</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>  <span class="main">∧</span>  <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⋅&lt;</span> <span class="free">F</span> <span class="bound">P</span>  <span class="main">∧</span>
     <span class="free">F</span> <span class="main">(</span><span class="bound">P</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">:=</span> mktop <span class="main">(</span><span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;⋅</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1" id="Arrow_Utility-all_top"><span class="command">lemma</span></span> all_top<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">&lt;⋅</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">F</span> <span class="free">P</span> <span class="main">&lt;⋅</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> top_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unanimity<span class="main">)</span>

<span class="keyword1" id="Arrow_Utility-not_extreme"><span class="command">lemma</span></span> not_extreme<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> extreme <span class="free">p</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">c</span><span class="main">.</span> distinct<span class="main">[</span><span class="bound">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="bound">c</span><span class="main">]</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">p</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">p</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">p</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">p</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nex <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> extreme_def top_def bot_def<span class="main">)</span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct<span class="main">[</span><span class="skolem">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="skolem">d</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abc third_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="skolem">d</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> abc d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> db<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">p</span> <span class="skolem">d</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
      <span class="keyword1"><span class="command">from</span></span> d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct<span class="main">[</span><span class="skolem">d</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>ac eq_sym_conv<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> abc db <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow_Utility-extremal"><span class="command">lemma</span></span> extremal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> extremes<span class="main">:</span> <span class="quoted"><span class="quoted">"Extreme <span class="free">P</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"extreme <span class="main">(</span><span class="free">F</span> <span class="free">P</span><span class="main">)</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> nec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> extreme <span class="main">(</span><span class="free">F</span> <span class="free">P</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">c</span><span class="main">.</span> distinct<span class="main">[</span><span class="bound">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="bound">c</span><span class="main">]</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">F</span> <span class="free">P</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="free">P</span> <span class="free">b</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">F</span> <span class="free">P</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="free">P</span> <span class="bound">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> not_extreme<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct<span class="main">[</span><span class="skolem">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">F</span> <span class="free">P</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="free">P</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">F</span> <span class="free">P</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="free">P</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">&lt;⋅</span> <span class="free">b</span> <span class="keyword1">then</span> between <span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="free">b</span>
                <span class="keyword1">else</span> <span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span><span class="main">(</span><span class="skolem">c</span> <span class="main">:=</span> <span class="free">P</span> <span class="bound">i</span> <span class="skolem">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">F</span> <span class="var">?P</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="var">?P</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> extremes d <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>IIA<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">P</span></span><span class="main"><span class="main">]</span></span> ab<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">F</span> <span class="var">?P</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="var">?P</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> extremes d <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>IIA<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">P</span></span><span class="main"><span class="main">]</span></span> bc eq_sym_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="var">?P</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="var">?P</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> unanimity<span class="main">)</span><span class="main">(</span><span class="operator">insert</span> d<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Arrow_Utility-pivotal_ind"><span class="command">lemma</span></span> pivotal_ind<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">D</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">D</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">b</span> <span class="main">⋅&lt;</span> <span class="bound">P</span> <span class="bound">i</span><span class="main">}</span><span class="main">;</span> Extreme <span class="bound">P</span> <span class="free">b</span><span class="main">;</span> <span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">F</span> <span class="bound">P</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> pivotal <span class="bound">i</span> <span class="free">b</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="var">?D</span> <span class="free">D</span> <span class="bound">P</span> <span class="main">⟹</span> <span class="var">?E</span> <span class="bound">P</span> <span class="main">⟹</span> <span class="var">?B</span> <span class="bound">P</span> <span class="main">⟹</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> fin
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>empty <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> empty<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">&lt;⋅</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">P</span> <span class="main">&lt;⋅</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> empty <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>top_impl_not_bot<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">D</span> <span class="skolem">i</span> <span class="skolem">P</span>
  <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="var">?D</span> <span class="skolem">D</span> <span class="bound">P</span> <span class="main">⟹</span> <span class="var">?E</span> <span class="bound">P</span> <span class="main">⟹</span> <span class="var">?B</span> <span class="bound">P</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> pivotal <span class="bound">i</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> insert<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">i</span> <span class="skolem">D</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">b</span> <span class="main">⋅&lt;</span> <span class="skolem">P</span> <span class="bound">i</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> <span class="skolem">D</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="skolem">P</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> mktop <span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> pivotal <span class="bound">i</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="var">?P</span> <span class="main">&lt;⋅</span> <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pivotal <span class="skolem">i</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?E</span> <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?B</span> <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="skolem">P</span> <span class="skolem">i</span>›</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold</span> pivotal_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="free">b</span> <span class="main">⋅&lt;</span> <span class="var">?P</span> <span class="bound">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∉</span> <span class="skolem">D</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Extreme <span class="var">?P</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?E</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>extreme_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">F</span> <span class="var">?P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> extremal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹Extreme <span class="var">?P</span> <span class="free">b</span>›</span></span><span class="main">]</span> False <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>fun_upd_apply<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow_Utility-pivotal_exists"><span class="command">lemma</span></span> pivotal_exists<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> pivotal <span class="bound">i</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span><span class="main">=</span><span class="free">b</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span><span class="main">::</span>prof"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Extreme <span class="var">?P</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>extreme_def bot_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">F</span> <span class="var">?P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>bot_def unanimity <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> less_if_bot not_less_if_bot<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> pivotal <span class="bound">i</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pivotal_ind<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> subset_UNIV finite_indi<span class="main"><span class="main">]</span></span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Arrow_Utility-pivotal_xdictates"><span class="command">lemma</span></span> pivotal_xdictates<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> pivo<span class="main">:</span> <span class="quoted"><span class="quoted">"pivotal <span class="free">i</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="keyword1">dictates_except</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">c</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">;</span> <span class="free">b</span> <span class="main">≠</span> <span class="bound">c</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">i</span> <span class="keyword1">dictates</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="bound">c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> dictates_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">c</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">P</span><span class="main">::</span><span class="quoted">prof</span>
    <span class="keyword3"><span class="command">assume</span></span> abc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="free">i</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">P</span> <span class="free">i</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">P</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="skolem">P</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"Extreme <span class="skolem">P1</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">F</span> <span class="skolem">P1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="skolem">P1</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">P2</span> <span class="main">&lt;⋅</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">=</span> <span class="skolem">P1</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> mktop <span class="main">(</span><span class="skolem">P1</span> <span class="free">i</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pivo <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pivotal_def<span class="main">)</span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">j</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">j</span><span class="main">=</span><span class="free">i</span> <span class="keyword1">then</span> between <span class="main">(</span><span class="skolem">P</span> <span class="bound">j</span><span class="main">)</span> <span class="skolem">a</span> <span class="free">b</span> <span class="skolem">c</span>
                    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">P1</span> <span class="bound">j</span> <span class="main">&lt;⋅</span> <span class="free">b</span> <span class="keyword1">then</span> mktop <span class="main">(</span><span class="skolem">P</span> <span class="bound">j</span><span class="main">)</span> <span class="free">b</span> <span class="keyword1">else</span> mkbot <span class="main">(</span><span class="skolem">P</span> <span class="bound">j</span><span class="main">)</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="skolem">P</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="skolem">P</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">F</span> <span class="var">?P</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="var">?P</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> abc <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> IIA<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="var">?P</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="var">?P</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IIA'<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P2</span> <span class="skolem">j</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">P2</span> <span class="skolem">j</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">j</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="var">?P</span> <span class="skolem">j</span> <span class="free">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Extreme <span class="skolem">P1</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ac<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">P2</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="skolem">P2</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="skolem">P2</span> <span class="main">&lt;⋅</span> <span class="free">b</span>›</span></span> abc <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="var">?P</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> IIA'<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P1</span> <span class="skolem">j</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="skolem">P1</span> <span class="skolem">j</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?P</span> <span class="skolem">j</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="var">?P</span> <span class="skolem">j</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Extreme <span class="skolem">P1</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="skolem">P1</span> <span class="free">i</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ac<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">P1</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="skolem">P1</span> <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">F</span> <span class="skolem">P1</span>›</span></span> abc <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_sym_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold</span> dictatesx_def<span class="main">)</span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arrow_Utility-pivotal_is_dictator"><span class="command">lemma</span></span> pivotal_is_dictator<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pivo<span class="main">:</span> <span class="quoted"><span class="quoted">"pivotal <span class="free">i</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="keyword1">dictates</span> <span class="free">a</span><span class="main">,</span><span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> pd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P1</span></span> <span class="skolem"><span class="skolem">P2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Extreme <span class="skolem">P1</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">F</span> <span class="skolem">P1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">P2</span> <span class="main">&lt;⋅</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    P2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">=</span> <span class="skolem">P1</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> mktop <span class="main">(</span><span class="skolem">P1</span> <span class="free">i</span><span class="main">)</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pivo <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> pivotal_def<span class="main">)</span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span><span class="main">(</span><span class="skolem">P1</span> <span class="free">j</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="skolem">P1</span> <span class="free">j</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="var">?ab</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">P1</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="skolem">P1</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dictates_def dictates2_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">⋅&lt;</span> <span class="free">F</span> <span class="skolem">P1</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="free">j</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="skolem">P1</span> <span class="free">j</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Extreme <span class="skolem">P1</span> <span class="free">b</span>›</span></span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">j</span></span><span class="main">]</span> ab
    <span class="keyword1"><span class="command">unfolding</span></span> extreme_def top_def bot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="free">j</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="skolem">P2</span> <span class="free">j</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>P2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">P2</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">F</span> <span class="skolem">P2</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dictates_def dictates2_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="skolem">P2</span> <span class="main">&lt;⋅</span> <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> dictator<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> dictator <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> pivotal_exists<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> pivo<span class="main">:</span> <span class="quoted"><span class="quoted">"pivotal <span class="skolem">i</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="keyword1">dictates</span> <span class="skolem">a</span><span class="main">,</span><span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct<span class="main">[</span><span class="skolem">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> neq third_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"pivotal <span class="skolem">j</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pivotal_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">dictates_except</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> pivotal_xdictates<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="keyword1">dictates</span> <span class="skolem">a</span><span class="main">,</span><span class="free">b</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> dist <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dictatesx_def dictates2_def eq_sym_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> pivo neq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> pivotal_is_dictator<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> pivotal_xdictates<span class="main">[</span><span class="operator">OF</span> pivo<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dictator <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dictates_def dictatesx_def dictates2_def dictator_def<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> less_le<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Arrow_Order">
<div class="head">
<h1>Theory Arrow_Order</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow, 2007  *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Arrow's Theorem for Strict Linear Orders"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Arrow_Order <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory formalizes the third proof due to
Geanakoplos~\cite{Geanakoplos05}.  Preferences are modeled as strict
linear orderings. The set of alternatives need not be finite.

Individuals are assumed to be finite but are not a priori identified with an
initial segment of the naturals. In retrospect this generality appears
gratuitous and complicates some of the low-level reasoning where we use a
bijection with such an initial segment.›</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> alt
<span class="keyword1"><span class="command">typedecl</span></span> indi

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">==</span> <span class="main">(</span>UNIV<span class="main">::</span>indi set<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">axiomatization</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  alt3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">::</span>alt<span class="main">.</span> distinct<span class="main">[</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  finite_indi<span class="main">:</span> <span class="quoted"><span class="quoted">"finite I"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="main">==</span> card I"</span></span>

<span class="keyword1" id="Arrow_Order-third_alt"><span class="command">lemma</span></span> third_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">::</span>alt<span class="main">.</span> distinct<span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="bound">c</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> alt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">metis</span>

<span class="keyword1" id="Arrow_Order-alt2"><span class="command">lemma</span></span> alt2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">::</span>alt<span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> alt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">type_synonym</span></span> pref <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>alt <span class="main">*</span> alt<span class="main">)</span>set"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Lin</span> <span class="main">==</span> <span class="main">{</span><span class="bound">L</span><span class="main">::</span>pref<span class="main">.</span> strict_linear_order <span class="bound">L</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> slo_defs <span class="main">=</span> Lin_def strict_linear_order_on_def total_on_def irrefl_def

<span class="keyword1" id="Arrow_Order-notin_Lin_iff"><span class="command">lemma</span></span> notin_Lin_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">:</span> Lin <span class="main">⟹</span> <span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∉</span> <span class="free">L</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">:</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> slo_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> trans_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Arrow_Order-converse_in_Lin"><span class="command">lemma</span></span> converse_in_Lin<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span><span class="main">¯</span> <span class="main">:</span> Lin <span class="main">⟷</span> <span class="free">L</span> <span class="main">:</span> Lin"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> slo_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Arrow_Order-Lin_irrefl"><span class="command">lemma</span></span> Lin_irrefl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span><span class="main">:</span>Lin <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">:</span><span class="free">L</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">:</span><span class="free">L</span> <span class="main">⟹</span> False"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>slo_defs<span class="main">)</span><span class="main">(</span><span class="operator">metis</span> trans_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> linear_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">L</span><span class="main">::</span>pref<span class="main">.</span> <span class="bound">L</span> <span class="main">:</span> Lin"</span></span>
<span class="keyword1"><span class="command">using</span></span> well_order_on<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="tfree">'a</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"alt"</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted">UNIV</span><span class="main">]</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>well_order_on_def Lin_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> strict_linear_order_on_diff_Id<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
 <span class="entity">rem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> pref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rem</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">mktop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> pref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">mktop</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> rem <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">mkbot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> pref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">mkbot</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> rem <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">below</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> alt <span class="main">⇒</span> pref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">below</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> rem <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span>
  <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">above</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pref <span class="main">⇒</span> alt <span class="main">⇒</span> alt <span class="main">⇒</span> pref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">above</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> rem <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span>
  <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">∧</span> <span class="bound">x</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">|</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">∧</span> <span class="bound">y</span><span class="main">≠</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Arrow_Order-in_mktop"><span class="command">lemma</span></span> in_mktop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> mktop <span class="free">L</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">≠</span><span class="free">z</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">y</span><span class="main">=</span><span class="free">z</span> <span class="keyword1">then</span> <span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mktop_def<span class="main">)</span>

<span class="keyword1" id="Arrow_Order-in_mkbot"><span class="command">lemma</span></span> in_mkbot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> mkbot <span class="free">L</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">≠</span><span class="free">z</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span><span class="main">=</span><span class="free">z</span> <span class="keyword1">then</span> <span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>mkbot_def<span class="main">)</span>

<span class="keyword1" id="Arrow_Order-in_above"><span class="command">lemma</span></span> in_above<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">⟹</span> <span class="free">L</span><span class="main">:</span>Lin <span class="main">⟹</span>
  <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">:</span> above <span class="free">L</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">∧</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span><span class="main">=</span><span class="free">b</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">:</span> <span class="free">L</span> <span class="keyword1">else</span>
   <span class="keyword1">if</span> <span class="free">y</span><span class="main">=</span><span class="free">b</span> <span class="keyword1">then</span> <span class="free">x</span><span class="main">=</span><span class="free">a</span> <span class="main">|</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">L</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">:</span> <span class="free">L</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>above_def slo_defs<span class="main">)</span>

<span class="keyword1" id="Arrow_Order-in_below"><span class="command">lemma</span></span> in_below<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">⟹</span> <span class="free">L</span><span class="main">:</span>Lin <span class="main">⟹</span>
  <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">:</span> below <span class="free">L</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">∧</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">y</span><span class="main">=</span><span class="free">a</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">L</span> <span class="keyword1">else</span>
   <span class="keyword1">if</span> <span class="free">x</span><span class="main">=</span><span class="free">a</span> <span class="keyword1">then</span> <span class="free">y</span><span class="main">=</span><span class="free">b</span> <span class="main">|</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">:</span> <span class="free">L</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">:</span> <span class="free">L</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>below_def slo_defs<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 2<span class="main">]</span><span class="main">]</span>

<span class="keyword1" id="Arrow_Order-mktop_Lin"><span class="command">lemma</span></span> mktop_Lin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">:</span> Lin <span class="main">⟹</span> mktop <span class="free">L</span> <span class="free">x</span> <span class="main">:</span> Lin"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>slo_defs mktop_def trans_def<span class="main">)</span>
<span class="keyword1" id="Arrow_Order-mkbot_Lin"><span class="command">lemma</span></span> mkbot_Lin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">:</span> Lin <span class="main">⟹</span> mkbot <span class="free">L</span> <span class="free">x</span> <span class="main">:</span> Lin"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>slo_defs trans_def mkbot_def<span class="main">)</span>

<span class="keyword1" id="Arrow_Order-below_Lin"><span class="command">lemma</span></span> below_Lin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">⟹</span> <span class="free">L</span> <span class="main">:</span> Lin <span class="main">⟹</span> below <span class="free">L</span> <span class="free">x</span> <span class="free">y</span> <span class="main">:</span> Lin"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> slo_defs below_def trans_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Arrow_Order-above_Lin"><span class="command">lemma</span></span> above_Lin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">≠</span><span class="free">y</span> <span class="main">⟹</span> <span class="free">L</span> <span class="main">:</span> Lin <span class="main">⟹</span> above <span class="free">L</span> <span class="free">x</span> <span class="free">y</span> <span class="main">:</span> Lin"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> slo_defs above_def trans_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simp_depth_limit</span> <span class="main"><span class="main">=</span></span> 50<span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">lessLin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"alt <span class="main">⇒</span> pref <span class="main">⇒</span> alt <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">&lt;⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> &lt;<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">L</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">:</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Prof</span> <span class="main">=</span> I <span class="main">→</span> Lin"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">SWF</span> <span class="main">==</span> Prof <span class="main">→</span> Lin"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">unanimity</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">==</span> <span class="main">∀</span><span class="bound">P</span><span class="main">∈</span>Prof<span class="main">.</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">a</span> &lt;<span class="hidden">⇘</span><sub><span class="bound">P</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟶</span>  <span class="bound">a</span> &lt;<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">P</span></sub><span class="hidden">⇙</span> <span class="bound">b</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">IIA</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">==</span> <span class="main">∀</span><span class="bound">P</span><span class="main">∈</span>Prof<span class="main">.</span><span class="main">∀</span><span class="bound">P'</span><span class="main">∈</span>Prof<span class="main">.</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">a</span> &lt;<span class="hidden">⇘</span><sub><span class="bound">P</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="bound">a</span> &lt;<span class="hidden">⇘</span><sub><span class="bound">P'</span> <span class="bound">i</span></sub><span class="hidden">⇙</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span> &lt;<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">P</span></sub><span class="hidden">⇙</span> <span class="bound">b</span> <span class="main">⟷</span> <span class="bound">a</span> &lt;<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">P'</span></sub><span class="hidden">⇙</span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">dictator</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">==</span> <span class="main">∀</span><span class="bound">P</span><span class="main">∈</span>Prof<span class="main">.</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">P</span> <span class="main">=</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1" id="Arrow_Order-dictatorI"><span class="command">lemma</span></span> dictatorI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">:</span> SWF <span class="main">⟹</span>
  <span class="main">∀</span><span class="bound">P</span><span class="main">∈</span>Prof<span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">:</span> <span class="bound">P</span> <span class="free">i</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="bound">P</span> <span class="main">⟹</span> dictator <span class="free">F</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dictator_def Prof_def Pi_def Lin_def strict_linear_order_on_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>total_on_def irrefl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> trans_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> irrefl_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Arrow_Order-const_Lin_Prof"><span class="command">lemma</span></span> const_Lin_Prof<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span><span class="main">:</span>Lin <span class="main">⟹</span> <span class="main">(</span><span class="main">%</span><span class="bound">p</span><span class="main">.</span> <span class="free">L</span><span class="main">)</span> <span class="main">:</span> Prof"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def<span class="main">)</span>

<span class="keyword1" id="Arrow_Order-complete_Lin"><span class="command">lemma</span></span> complete_Lin<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≠</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">L</span><span class="main">∈</span>Lin<span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">:</span> <span class="bound">L</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> linear_alt <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">:</span>Lin"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms in_mkbot mkbot_Lin<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> Let_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1"><span class="command">theorem</span></span> Arrow<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">:</span> SWF"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"unanimity <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"IIA <span class="free">F</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> dictator <span class="free">F</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">P</span> <span class="skolem">P'</span>
    <span class="keyword3"><span class="command">assume</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">≠</span><span class="skolem">b'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="skolem">a'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">:</span> Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">:</span> Prof"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P'</span> <span class="bound">i</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">L</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a</span><span class="main">=</span><span class="skolem">a'</span> <span class="keyword1">then</span> <span class="skolem">P</span> <span class="skolem">i</span> <span class="keyword1">else</span> below <span class="main">(</span><span class="skolem">P</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">a'</span> <span class="skolem">a</span><span class="main">)</span>
              <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="skolem">b</span><span class="main">=</span><span class="skolem">b'</span> <span class="keyword1">then</span> <span class="bound">L</span> <span class="keyword1">else</span> above <span class="bound">L</span> <span class="skolem">b</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">:</span> Prof"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Q_def Prof_def Pi_def above_Lin below_Lin<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="skolem">Q</span> <span class="main">:</span> Lin"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">:</span> SWF›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">Q</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_above in_below Q_def Prof_def Pi_def below_Lin<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P</span>›</span></span> <span class="quoted"><span class="quoted">‹IIA <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">:</span> Prof›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> IIA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">a'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">Q</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_above in_below Q_def Prof_def Pi_def below_Lin<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">:</span> Prof›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unanimity_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">Q</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_above in_below Q_def Prof_def Pi_def below_Lin<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">:</span> Prof›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unanimity_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="skolem">Q</span> <span class="main">:</span> Lin›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> slo_defs trans_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">Q</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P'</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d1 d2 <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span> 1
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Q_def in_below in_above Prof_def Pi_def below_Lin<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹IIA <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P'</span> <span class="main">:</span> Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">:</span> Prof›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> IIA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> 1 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">P</span> <span class="skolem">P'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">≠</span><span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">:</span> Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">:</span> Prof"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P'</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> 2 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">P</span> <span class="skolem">P'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">:</span> Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">:</span> Prof"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P'</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct<span class="main">[</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> third_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">p</span><span class="main">.</span> below <span class="main">(</span><span class="skolem">P</span> <span class="bound">p</span><span class="main">)</span> <span class="skolem">c</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">p</span><span class="main">.</span> below <span class="main">(</span><span class="var">?Q</span> <span class="bound">p</span><span class="main">)</span> <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">p</span><span class="main">.</span> below <span class="main">(</span><span class="var">?R</span> <span class="bound">p</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">:</span> Prof"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span> dist
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def below_Lin<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">:</span> Prof"</span></span> <span class="keyword1"><span class="command">using</span></span> dist <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def below_Lin<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">:</span> Prof"</span></span> <span class="keyword1"><span class="command">using</span></span> dist <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def below_Lin<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="var">?Q</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span> dist
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_below Prof_def Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">:</span> Prof›</span></span> dist<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="var">?Q</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="var">?R</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span> dist
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_below Prof_def Pi_def below_Lin<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> ac<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?Q</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">:</span> Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span> <span class="main">:</span> Prof›</span></span> dist<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="var">?R</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="var">?S</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span> dist
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_below Prof_def Pi_def below_Lin<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> bc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?R</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span> <span class="main">:</span> Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">:</span> Prof›</span></span> dist<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> 2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="var">?S</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span> dist
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>in_below Prof_def Pi_def below_Lin<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="var">?S</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P'</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> ba<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?S</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹IIA <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P'</span> <span class="main">:</span> Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?S</span> <span class="main">:</span> Prof›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> IIA_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> ab ac bc ba <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> 3 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">P</span> <span class="skolem">P'</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">:</span> Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">:</span> Prof"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P'</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>converse <span class="keyword1">o</span> <span class="skolem">P</span><span class="main">)</span><span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P'</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> cP<span class="main">:</span> <span class="quoted"><span class="quoted">"converse <span class="keyword1">o</span> <span class="skolem">P</span> <span class="main">:</span> Prof"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span><span class="main">(</span>converse <span class="keyword1">o</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A 2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span><span class="main">(</span>converse <span class="keyword1">o</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span> cP<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> 4 <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="main">::</span> <span class="quoted">alt</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">P</span> <span class="skolem">P'</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span><span class="main">≠</span><span class="skolem">b'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">:</span> Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">:</span> Prof"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P'</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a'</span><span class="main">,</span><span class="skolem">b'</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b'</span> <span class="main">&amp;</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">b'</span> <span class="main">&amp;</span> <span class="skolem">b</span><span class="main">≠</span><span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4 A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b'</span> <span class="main">&amp;</span> <span class="skolem">b</span><span class="main">=</span><span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4 A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">b'</span> <span class="main">&amp;</span> <span class="skolem">b</span><span class="main">=</span><span class="skolem">a'</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> pairwise_neutrality <span class="main">=</span> this
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"indi <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    injh<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> surjh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> I <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>N<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> ex_bij_betw_finite_nat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_indi<span class="main"><span class="main">]</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="main">::</span> <span class="quoted">alt</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> alt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Lab</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">Lab</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Lab</span><span class="main">:</span>Lin"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complete_Lin<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">Lab</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>slo_defs trans_def<span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Lba</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">Lba</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Lba</span><span class="main">:</span>Lin"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complete_Lin<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">Lba</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>slo_defs trans_def<span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Pi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">n</span><span class="main">.</span> <span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="skolem">Lab</span> <span class="keyword1">else</span> <span class="skolem">Lba</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> PiProf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">n</span><span class="main">.</span> <span class="var">?Pi</span> <span class="bound">n</span> <span class="main">:</span> Prof"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Lab</span><span class="main">:</span>Lin›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Lba</span><span class="main">:</span>Lin›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Prof_def Pi_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&lt;</span>N<span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">&amp;</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span><span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">n</span><span class="main">.</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span> <span class="bound">n</span><span class="main">)</span> <span class="main">:</span> Lin"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">:</span> SWF›</span></span> PiProf <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Lba</span><span class="main">)</span><span class="main">:</span>Lin"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">:</span>SWF›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Lba</span><span class="main">:</span>Lin›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">Lba</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Lba</span><span class="main">:</span>Lin›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Lba</span><span class="main">:</span>Lin›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unanimity_def notin_Lin_iff const_Lin_Prof<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Pi</span> N <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">p</span><span class="main">.</span> <span class="skolem">Lab</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> surjh <span class="main">[</span><span class="operator">THEN</span> equalityD1<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span><span class="main">(</span><span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Lab</span><span class="main">)</span><span class="main">:</span>Lin"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">:</span>SWF›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Lab</span><span class="main">:</span>Lin›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span> N<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">Lab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Lab</span><span class="main">:</span>Lin›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unanimity_def const_Lin_Prof<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ex_least_nat_less<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">]</span> 1 2 notin_Lin_iff<span class="main">[</span><span class="operator">OF</span> 0 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;</span>N"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≤</span><span class="skolem">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dictator <span class="free">F</span> <span class="main">(</span>inv <span class="skolem">h</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dictatorI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">:</span> SWF›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">≠</span><span class="skolem">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">(</span>inv <span class="skolem">h</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct<span class="main">[</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">e</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> third_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="keyword1">then</span> mktop <span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">e</span> <span class="keyword1">else</span>
                  <span class="keyword1">if</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">then</span> above <span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">c</span> <span class="skolem">e</span> <span class="keyword1">else</span> mkbot <span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?W</span> <span class="main">:</span> Prof"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span> dist
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pi_def Prof_def mkbot_Lin mktop_Lin above_Lin<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">:</span> <span class="var">?W</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_above in_mkbot in_mktop Prof_def Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> PW<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="skolem">P</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?W</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹IIA <span class="free">F</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> IIA_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?W</span><span class="main">:</span>Prof›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span> <span class="main">:</span> <span class="var">?W</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="var">?Pi</span> <span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dist <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">:</span><span class="skolem">Lab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span><span class="main">∉</span><span class="skolem">Lba</span>›</span></span>
        in_mkbot in_mktop in_above Prof_def Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?W</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pairwise_neutrality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="quoted"><span class="quoted">"<span class="var">?Pi</span><span class="main">(</span><span class="skolem">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span> dist <span class="quoted"><span class="quoted">‹<span class="var">?W</span> <span class="main">:</span> Prof›</span></span> PiProf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">:</span> <span class="var">?W</span> <span class="bound">i</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="var">?Pi</span> <span class="skolem">n</span> <span class="bound">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dist <span class="quoted"><span class="quoted">‹<span class="skolem">P</span> <span class="main">:</span> Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P</span><span class="main">(</span>inv <span class="skolem">h</span> <span class="skolem">n</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹inj <span class="skolem">h</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">:</span><span class="skolem">Lba</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span><span class="main">∉</span><span class="skolem">Lab</span>›</span></span>
        in_mkbot in_mktop in_above Prof_def Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?W</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span><span class="main">(</span><span class="var">?Pi</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pairwise_neutrality<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="var"><span class="quoted"><span class="var">?W</span></span></span> <span class="quoted"><span class="quoted">"<span class="var">?Pi</span> <span class="skolem">n</span>"</span></span><span class="main">]</span>
        <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span> dist <span class="quoted"><span class="quoted">‹<span class="var">?W</span> <span class="main">:</span> Prof›</span></span> PiProf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span> <span class="main">:</span> <span class="free">F</span> <span class="var">?W</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?W</span> <span class="main">:</span> Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span><span class="main">:</span>SWF›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span> <span class="var">?W</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Pi_def slo_defs trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PW <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="GS">
<div class="head">
<h1>Theory GS</h1>
</div>
<pre class="source"><span class="comment1">(*
    Author:     Tobias Nipkow, 2008
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"The Gibbard-Satterthwaite Theorem"</span></span>

<span class="keyword1"><span class="command">theory</span></span> GS <span class="keyword2"><span class="keyword">imports</span></span> <a href="Arrow_Order.html">Arrow_Order</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The Gibbard-Satterthwaite theorem as a corollary to Arrow's
theorem. The proof follows Nisan~\cite{NisanRTV07}.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">manipulable</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">==</span> <span class="main">∃</span><span class="bound">P</span><span class="main">∈</span>Prof<span class="main">.</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">L</span><span class="main">∈</span>Lin<span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">P</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">(</span><span class="bound">P</span><span class="main">(</span><span class="bound">i</span><span class="main">:=</span><span class="bound">L</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="bound">P</span> <span class="bound">i</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">dict</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">==</span> <span class="main">∀</span><span class="bound">P</span><span class="main">∈</span>Prof<span class="main">.</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">P</span><span class="main">)</span> <span class="main">:</span> <span class="bound">P</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">Top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"alt set <span class="main">⇒</span> pref <span class="main">⇒</span> pref"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Top</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>
             <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="GS-Top_in_Lin"><span class="command">lemma</span></span> Top_in_Lin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span><span class="main">:</span>Lin <span class="main">⟹</span> Top <span class="free">S</span> <span class="free">L</span> <span class="main">:</span> Lin"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Top_def slo_defs Sigma_def<span class="main">)</span>
<span class="keyword1"><span class="command">unfolding</span></span> trans_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="GS-Top_in_Prof"><span class="command">lemma</span></span> Top_in_Prof<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">:</span>Prof <span class="main">⟹</span> Top <span class="free">S</span> <span class="keyword1">o</span> <span class="free">P</span> <span class="main">:</span> Prof"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def Top_in_Lin<span class="main">)</span>

<span class="keyword1" id="GS-not_manipulable"><span class="command">lemma</span></span> not_manipulable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> manipulable <span class="free">f</span> <span class="main">⟷</span>
 <span class="main">(</span><span class="main">∀</span><span class="bound">P</span><span class="main">∈</span>Prof<span class="main">.</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span><span class="main">∀</span><span class="bound">L</span><span class="main">∈</span>Lin<span class="main">.</span> <span class="free">f</span> <span class="bound">P</span> <span class="main">≠</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">(</span><span class="bound">i</span><span class="main">:=</span><span class="bound">L</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="bound">L</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">f</span> <span class="bound">P</span><span class="main">)</span> <span class="main">:</span> <span class="bound">P</span> <span class="bound">i</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="bound">P</span><span class="main">,</span> <span class="free">f</span><span class="main">(</span><span class="bound">P</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="bound">L</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="bound">L</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">i</span> <span class="skolem">L</span> <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> Lin"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">P</span> <span class="main">≠</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">P</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">i</span><span class="main">:</span> Lin"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">(</span><span class="skolem">i</span><span class="main">:=</span><span class="skolem">L</span><span class="main">)</span><span class="main">:</span> Prof"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">P</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">f</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="skolem">i</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?A</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> manipulable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> notin_Lin_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="skolem">P</span><span class="main">,</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">P</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">L</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 0 1 fun_upd_upd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> fun_upd_triv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> fun_upd_same<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?A</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> manipulable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> notin_Lin_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">∧</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>manipulable_def<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">i</span> <span class="skolem">L</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">∈</span> Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">L</span> <span class="main">∈</span> Lin"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="skolem">P</span><span class="main">,</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">P</span><span class="main">(</span><span class="skolem">i</span> <span class="main">:=</span> <span class="skolem">L</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">i</span><span class="main">:</span> Lin"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> Lin_irrefl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">swf</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">(</span>Top <span class="main">{</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">}</span> <span class="keyword1">o</span> <span class="bound">P</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> GS <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span>
<span class="keyword2"><span class="keyword">assumes</span></span> not_manip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> manipulable <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> onto<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> Prof <span class="main">=</span> UNIV"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="GS-nonmanip"><span class="command">lemma</span></span> nonmanip<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">:</span>Prof <span class="main">⟹</span> <span class="free">L</span><span class="main">:</span>Lin <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="free">L</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">P</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="free">L</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">f</span> <span class="free">P</span><span class="main">)</span> <span class="main">:</span> <span class="free">P</span> <span class="free">i</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="free">P</span><span class="main">,</span> <span class="free">f</span><span class="main">(</span><span class="free">P</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="free">L</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">:</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> not_manip <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> not_manipulable<span class="main">)</span>

<span class="keyword1" id="GS-mono"><span class="command">lemma</span></span> mono<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">∈</span>Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P'</span><span class="main">∈</span>Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="free">f</span> <span class="free">P</span><span class="main">)</span> <span class="main">:</span> <span class="free">P</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="free">f</span> <span class="free">P</span><span class="main">)</span> <span class="main">:</span> <span class="free">P'</span> <span class="bound">i</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">P'</span> <span class="main">=</span> <span class="free">f</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"indi <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    injh<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> surjh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> I <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>N<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> ex_bij_betw_finite_nat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_indi<span class="main"><span class="main">]</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">n</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="keyword1">then</span> <span class="free">P'</span> <span class="bound">i</span> <span class="keyword1">else</span> <span class="free">P</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="main">&lt;</span> N"</span></span> <span class="keyword1"><span class="command">using</span></span> surjh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> MProf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">n</span><span class="main">.</span> <span class="var">?M</span> <span class="bound">n</span> <span class="main">:</span> Prof"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P'Lin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">i</span> <span class="main">:</span> Lin"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span><span class="main">:</span>Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P'</span><span class="main">:</span>Prof›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;=</span>N <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="var">?M</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?up</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?M</span> <span class="skolem">n</span><span class="main">)</span><span class="main">(</span>inv <span class="skolem">h</span> <span class="skolem">n</span> <span class="main">:=</span> <span class="free">P'</span> <span class="main">(</span>inv <span class="skolem">h</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?up</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> surjh Suc<span class="main">(</span>2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fun_eq_iff f_inv_into_f<span class="main">)</span>
          <span class="main">(</span><span class="operator">metis</span> injh inv_f_f less_antisym<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?case</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?M</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?up</span>›</span></span> Suc <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?up</span> <span class="main">≠</span> <span class="free">f</span><span class="main">(</span><span class="var">?M</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> nonmanip<span class="main">[</span><span class="operator">OF</span> MProf P'Lin 0<span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> N surjh Suc Lin_irrefl<span class="main">[</span><span class="operator">OF</span> P'Lin<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_inv_into_f<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted">N</span><span class="main">]</span> N <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">P'</span> <span class="main">=</span> <span class="free">f</span> <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GS-una_Top"><span class="command">lemma</span></span> una_Top<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">:</span>Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Top <span class="free">S</span> <span class="keyword1">o</span> <span class="free">P</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"indi <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    injh<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> surjh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">`</span> I <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>N<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> ex_bij_betw_finite_nat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_indi<span class="main"><span class="main">]</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">:</span><span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> onto <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Pa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Pa</span><span class="main">:</span>Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">Pa</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> inv_into_into UNIV_I f_inv_into_f<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">n</span> <span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="keyword1">then</span> Top <span class="free">S</span> <span class="main">(</span><span class="free">P</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">Pa</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">i</span> <span class="main">&lt;</span> N"</span></span> <span class="keyword1"><span class="command">using</span></span> surjh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> MProf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">n</span><span class="main">.</span> <span class="var">?M</span> <span class="bound">n</span> <span class="main">:</span> Prof"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">P</span><span class="main">:</span>Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Pa</span><span class="main">:</span>Prof›</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def Top_in_Lin mktop_Lin<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">&lt;=</span>N <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="var">?M</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">:</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">Pa</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">:</span><span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="var">?M</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span><span class="main">(</span><span class="var">?M</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?up</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?M</span> <span class="skolem">n</span><span class="main">)</span><span class="main">(</span>inv <span class="skolem">h</span> <span class="skolem">n</span> <span class="main">:=</span> Top <span class="free">S</span> <span class="main">(</span><span class="free">P</span><span class="main">(</span>inv <span class="skolem">h</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="var">?M</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">f</span><span class="main">(</span><span class="var">?M</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?up</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> surjh Suc
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fun_eq_iff f_inv_into_f<span class="main">)</span>
            <span class="main">(</span><span class="operator">metis</span> injh inv_f_eq less_antisym<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="var">?M</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">f</span><span class="main">(</span><span class="var">?up</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> nonmanip<span class="main">[</span><span class="operator">OF</span> MProf Top_in_Lin n<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> Suc eq <span class="quoted"><span class="quoted">‹<span class="free">P</span><span class="main">:</span>Prof›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Top_def Prof_def Pi_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted">N</span><span class="main">]</span> N <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>comp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GS-SWF_swf"><span class="command">lemma</span></span> SWF_swf<span class="main">:</span> <span class="quoted"><span class="quoted">"swf <span class="free">f</span> <span class="main">:</span> SWF"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Pi_I<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">:</span> Prof"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"swf <span class="free">f</span> <span class="skolem">P</span> <span class="main">:</span> Lin"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> Lin_def strict_linear_order_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"total<span class="main">(</span>swf <span class="free">f</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> total_on_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">alt</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> swf <span class="free">f</span> <span class="skolem">P</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> swf <span class="free">f</span> <span class="skolem">P</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> swf_def <span class="keyword1"><span class="command">using</span></span> una_Top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main">(</span><span class="operator">metis</span> insert_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irrefl<span class="main">(</span>swf <span class="free">f</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> irrefl_def swf_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"trans<span class="main">(</span>swf <span class="free">f</span> <span class="skolem">P</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>trans_def swf_def insert_commute<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Top<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Top<span class="main">{</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> 3 <span class="main">=</span> Top_in_Prof<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Top<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> mono<span class="main">[</span><span class="operator">OF</span> 3 Top_in_Prof<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Top_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">(</span>Top<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Top<span class="main">{</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> mono<span class="main">[</span><span class="operator">OF</span> 3 Top_in_Prof<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Top_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span><span class="main">(</span>Top<span class="main">{</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span><span class="main">≠</span><span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> una_Top<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Top<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> mono<span class="main">[</span><span class="operator">OF</span> 3 Top_in_Prof<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">c</span><span class="main">}</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Top_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span> <span class="main">∧</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GS-Top_top"><span class="command">lemma</span></span> Top_top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">L</span><span class="main">:</span>Lin <span class="main">⟹</span> <span class="main">(</span><span class="main">!!</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">≠</span><span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">L</span><span class="main">)</span> <span class="main">⟹</span> Top <span class="main">{</span><span class="free">b</span><span class="main">}</span> <span class="free">L</span> <span class="main">=</span> <span class="free">L</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Top_def slo_defs<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> trans_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> trans_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="GS-una_swf"><span class="command">lemma</span></span> una_swf<span class="main">:</span> <span class="quoted"><span class="quoted">"unanimity<span class="main">(</span>swf <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>swf_def unanimity_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">:</span>Prof"</span></span> <span class="keyword2"><span class="keyword">and</span></span> abP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def slo_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?abP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?abP</span> <span class="main">:</span> Prof"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def Top_in_Lin<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span> <span class="bound">c</span><span class="main">.</span> <span class="skolem">b</span><span class="main">≠</span><span class="bound">c</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">:</span> Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">(</span><span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abP <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Top_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Top <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="keyword1">o</span> <span class="var">?abP</span> <span class="main">=</span> <span class="var">?abP</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fun_eq_iff top Top_top Prof_def Pi_def Top_in_Lin<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span>Top <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="keyword1">o</span> <span class="var">?abP</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> una_Top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?abP</span> <span class="main">:</span> Prof›</span></span><span class="main"><span class="main">]</span></span> empty_not_insert singletonE<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="var">?abP</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">∧</span> <span class="free">f</span> <span class="var">?abP</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GS-IIA_swf"><span class="command">lemma</span></span> IIA_swf<span class="main">:</span> <span class="quoted"><span class="quoted">"IIA<span class="main">(</span>swf <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> IIA_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">P'</span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">:</span>Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span><span class="main">:</span>Prof"</span></span> <span class="keyword2"><span class="keyword">and</span></span> iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">i</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">~:</span> <span class="skolem">P</span> <span class="bound">i</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">~:</span> <span class="skolem">P'</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Prof_def Pi_def slo_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> iff'<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="skolem">b</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">P'</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iff <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">P'</span><span class="main">:</span>Prof›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Prof_def Pi_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> iff notin_Lin_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?abP</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="keyword1">o</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?abP'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="keyword1">o</span> <span class="skolem">P'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="free">f</span> <span class="var">?abP</span><span class="main">)</span> <span class="main">:</span> <span class="var">?abP</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="free">f</span> <span class="var">?abP</span><span class="main">)</span> <span class="main">:</span> <span class="var">?abP'</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> una_Top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span><span class="main">]</span> iff iff' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Top_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span>Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Top_in_Prof<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span><span class="main">]</span> Top_in_Prof<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P'</span><span class="main">:</span>Prof›</span></span><span class="main">]</span>
          mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> &lt;<span class="hidden">⇘</span><sub>swf <span class="free">f</span> <span class="skolem">P</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> &lt;<span class="hidden">⇘</span><sub>swf <span class="free">f</span> <span class="skolem">P'</span></sub><span class="hidden">⇙</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> swf_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="GS-dict_swf"><span class="command">lemma</span></span> dict_swf<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dictator <span class="main">(</span>swf <span class="free">f</span><span class="main">)</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dict <span class="free">f</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>dict_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span><span class="main">:</span>Prof"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">≠</span><span class="free">f</span> <span class="skolem">P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>Top <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="free">f</span> <span class="skolem">P</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">P</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mono<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span> Top_in_Prof<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span><span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="free">f</span> <span class="skolem">P</span><span class="main">}</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Top_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="free">i</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span><span class="main">≠</span><span class="bound">b</span> <span class="main">∧</span> <span class="free">f</span><span class="main">(</span>Top <span class="main">{</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">}</span> <span class="main">∘</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">P</span><span class="main">:</span>Prof›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dictator_def swf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="free">f</span> <span class="skolem">P</span><span class="main">)</span> <span class="main">:</span> <span class="skolem">P</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">≠</span><span class="free">f</span> <span class="skolem">P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> Gibbard_Satterthwaite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> dict <span class="free">f</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Arrow SWF_swf una_swf IIA_swf dict_swf<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Gibbard_Satterthwaite<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> manipulable <span class="free">f</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span><span class="main">∃</span><span class="bound">P</span><span class="main">∈</span>Prof<span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">P</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">i</span><span class="main">.</span> dict <span class="free">f</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> GS.Gibbard_Satterthwaite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span><span class="operator">unfolded</span> GS_def<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>