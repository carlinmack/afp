<div id="Disjoint_Set_Forests">
<div class="head">
<h1>Theory Disjoint_Set_Forests</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Disjoint-Set Forests
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Disjoint_Set_Forests

<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Hoare/Hoare_Logic.html">HOL-Hoare.Hoare_Logic</a>"</span>
  <a href="../Stone_Kleene_Relation_Algebras/Kleene_Relation_Algebras.html">Stone_Kleene_Relation_Algebras.Kleene_Relation_Algebras</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span>
  trancl <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>+</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
An arc in a Stone relation algebra corresponds to an atom in a relation algebra and represents a single edge in a graph.
A point represents a set of nodes.
A rectangle represents the Cartesian product of two sets of nodes \cite{BerghammerStruth2010}.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> times_top
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rectangle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rectangle</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> top <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> stone_relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-arc_rectangle"><span class="command">lemma</span></span> arc_rectangle<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">x</span> <span class="main">⟹</span> rectangle <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arc_top_arc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Relation-Algebraic Semantics of Associative Array Access›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following two operations model updating array $x$ at index $y$ to value $z$, 
and reading the content of array $x$ at index $y$, respectively.
The read operation uses double brackets to avoid ambiguity with list syntax.
The remainder of this section shows basic properties of these operations.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rel_update</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">[</span>_<span class="keyword1">⟼</span>_<span class="keyword1">]</span><span class="keyword3">)</span>"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">,</span> 65<span class="main">]</span> 61<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="free">⟼</span></span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">rel_access</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(2</span>_<span class="keyword1">[[</span>_<span class="keyword1">]]</span><span class="keyword3">)</span>"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">]</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">[[</span></span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="free">]]</span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.1›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_univalent"><span class="command">lemma</span></span> update_univalent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"univalent <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"univalent <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> inf_commute univalent_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> covector_inf_comp_3 inf.sup_monoid.add_assoc inf.sup_monoid.add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"vector <span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> vector_complement_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> conv_complement covector_inf_comp_3 inf.sup_monoid.add_assoc inf.sup_monoid.add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"univalent <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> inf_commute univalent_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.2›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_total"><span class="command">lemma</span></span> update_total<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"total <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"surjective <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"total <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span> <span class="main">*</span> top <span class="main">=</span> <span class="free">x</span><span class="main">*</span>top<span class="main">[</span><span class="free">y</span><span class="main">⟼</span>top<span class="main">*</span><span class="free">z</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> semiring.distrib_right vector_complement_closed vector_inf_comp conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top<span class="main">[</span><span class="free">y</span><span class="main">⟼</span>top<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> regular_complement_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.3›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_mapping"><span class="command">lemma</span></span> update_mapping<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mapping <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mapping <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms update_univalent update_total <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.4›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-read_injective"><span class="command">lemma</span></span> read_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="free">x</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms injective_mult_closed univalent_conv_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.5›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-read_surjective"><span class="command">lemma</span></span> read_surjective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"surjective <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"total <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"surjective <span class="main">(</span><span class="free">x</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms surjective_mult_closed total_conv_surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.6›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-read_bijective"><span class="command">lemma</span></span> read_bijective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mapping <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bijective <span class="main">(</span><span class="free">x</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms read_injective read_surjective<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.7›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-read_point"><span class="command">lemma</span></span> read_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mapping <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"point <span class="main">(</span><span class="free">x</span><span class="main">[[</span><span class="free">p</span><span class="main">]]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms comp_associative read_injective read_surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.8›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_postcondition"><span class="command">lemma</span></span> update_postcondition<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⟷</span> <span class="free">p</span><span class="main">[[</span><span class="free">x</span><span class="main">]]</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_associative conv_dist_comp conv_involutive covector_inf_comp_3 equivalence_top_closed vector_covector<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms conv_dist_comp conv_involutive inf.boundedI inf.cobounded1 vector_covector vector_restrict_comp_conv<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms comp_associative conv_dist_comp conv_involutive covector_restrict_comp_conv dense_conv_closed equivalence_top_closed inf.boundedI shunt_mapping vector_covector preorder_idempotent<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Back and von Wright's array independence requirements \cite{BackWright1998}, 
  later also lens laws \cite{FosterGreenwaldMoorePierceSchmitt2007}›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-put_get"><span class="command">lemma</span></span> put_get<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"surjective <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_inf conv_dist_sup mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> covector_inf_comp_3 inf_commute conv_complement mult_right_zero p_inf vector_complement_closed<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms covector_inf_comp_3 inf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-put_put"><span class="command">lemma</span></span> put_put<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span> <span class="main">=</span> <span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_absorb2 inf_commute inf_le1 inf_sup_distrib1 maddux_3_13 sup_inf_absorb<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-get_put"><span class="command">lemma</span></span> get_put<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">x</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">]</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">x</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms vector_inf_comp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms vector_covector<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms comp_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms vector_restrict_comp_conv<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"regular <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms bijective_regular <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_monoid.add_commute maddux_3_11_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_inf"><span class="command">lemma</span></span> update_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">u</span> <span class="main">=</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> comp_inf.mult_right_dist_sup comp_inf.semiring.mult_zero_right inf.left_commute inf.sup_monoid.add_assoc inf_absorb2 p_inf sup_bot_right inf.sup_monoid.add_commute<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-update_inf_same"><span class="command">lemma</span></span> update_inf_same<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> update_inf<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-update_inf_different"><span class="command">lemma</span></span> update_inf_different<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">u</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> inf.right_idem inf.sup_monoid.add_commute inf.sup_relative_same_increasing inf_import_p maddux_3_13 sup.cobounded2 update_inf_same<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Relation-Algebraic Semantics of Disjoint-Set Forests›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A disjoint-set forest represents a partition of a set into equivalence classes.
We take the represented equivalence relation as the semantics of a forest.
It is obtained by operation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>fc›</span></span></span></span> below.
Additionally, operation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>wcc›</span></span></span></span> giving the weakly connected components of a graph will be used for the semantics of the union of two disjoint sets.
Finally, operation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>root›</span></span></span></span> yields the root of a component tree, that is, the representative of a set containing a given element.
This section defines these operations and derives their properties.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> stone_kleene_relation_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4.2›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-omit_redundant_points"><span class="command">lemma</span></span> omit_redundant_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="var">?p</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> top <span class="main">*</span> <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_left_isotone mult_right_isotone top.extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms injective_codomain vector_inf_one_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms comp_associative vector_inf_one_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_right_isotone star.circ_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_isotone star.circ_plus_same star.left_plus_below_circ mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf.mult_right_dist_sup mult_left_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bijective_regular inf.absorb2 inf.cobounded1 inf.sup_monoid.add_commute shunting_p<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_left_dist_sup mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_right_induct <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans le_supI mult_left_sub_dist_sup_left mult_sub_right_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊔</span> <span class="var">?p</span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative semiring.distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms vector_inf_one_comp<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⊓</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_isotone inf.boundedI inf.cobounded1 inf.coboundedI2 inf.sup_monoid.add_commute le_supI star.circ_increasing star.circ_transitive_equal star_isotone star_left_unfold_equal sup.cobounded1 vector_export_comp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Weakly connected components›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">wcc</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 5.1›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_equivalence"><span class="command">lemma</span></span> wcc_equivalence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"equivalence <span class="main">(</span>wcc <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_reflexive<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup conv_star_commute sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 5.2›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_increasing"><span class="command">lemma</span></span> wcc_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> wcc <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_sub_dist_1<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_isotone"><span class="command">lemma</span></span> wcc_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> wcc <span class="free">x</span> <span class="main">≤</span> wcc <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conv_isotone star_isotone sup_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_idempotent"><span class="command">lemma</span></span> wcc_idempotent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wcc <span class="main">(</span>wcc <span class="free">x</span><span class="main">)</span> <span class="main">=</span> wcc <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> star_involutive wcc_equivalence <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 5.3›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_below_wcc"><span class="command">lemma</span></span> wcc_below_wcc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> wcc <span class="free">y</span> <span class="main">⟹</span> wcc <span class="free">x</span> <span class="main">≤</span> wcc <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wcc_idempotent wcc_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 5.4›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_bot"><span class="command">lemma</span></span> wcc_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wcc bot <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_zero<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_one"><span class="command">lemma</span></span> wcc_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wcc <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_one<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 5.5›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_top"><span class="command">lemma</span></span> wcc_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wcc top <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_top<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 5.6›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_with_loops"><span class="command">lemma</span></span> wcc_with_loops<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wcc <span class="free">x</span> <span class="main">=</span> wcc <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_sup star_decompose_1 star_sup_one sup_commute symmetric_one_closed<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-wcc_without_loops"><span class="command">lemma</span></span> wcc_without_loops<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wcc <span class="free">x</span> <span class="main">=</span> wcc <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_star_commute star_sum reachable_without_loops<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-forest_components_wcc"><span class="command">lemma</span></span> forest_components_wcc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">x</span> <span class="main">⟹</span> wcc <span class="free">x</span> <span class="main">=</span> forest_components <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cancel_separate_1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Components of a forest, which is represented using edges directed towards the roots›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">fc</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.1›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_equivalence"><span class="command">lemma</span></span> fc_equivalence<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">x</span> <span class="main">⟹</span> equivalence <span class="main">(</span>fc <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflexive_mult_closed star.circ_reflexive<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cancel_separate_1 eq_iff star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_star_commute<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.2›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_increasing"><span class="command">lemma</span></span> fc_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> fc <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supE mult_left_isotone star.circ_back_loop_fixpoint star.circ_increasing<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.3›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_isotone"><span class="command">lemma</span></span> fc_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> fc <span class="free">x</span> <span class="main">≤</span> fc <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone conv_isotone star_isotone<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.4›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_idempotent"><span class="command">lemma</span></span> fc_idempotent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">x</span> <span class="main">⟹</span> fc <span class="main">(</span>fc <span class="free">x</span><span class="main">)</span> <span class="main">=</span> fc <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fc_equivalence cancel_separate_1 star.circ_transitive_equal star_involutive<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.5›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_star"><span class="command">lemma</span></span> fc_star<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span>fc <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> fc <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> fc_equivalence fc_idempotent star.circ_transitive_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_plus"><span class="command">lemma</span></span> fc_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span>fc <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> fc <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fc_star star.circ_decompose_9<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.6›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_bot"><span class="command">lemma</span></span> fc_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fc bot <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_zero<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_one"><span class="command">lemma</span></span> fc_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fc <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_one<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.7›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_top"><span class="command">lemma</span></span> fc_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fc top <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_top<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 5.7›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_wcc"><span class="command">lemma</span></span> fc_wcc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">x</span> <span class="main">⟹</span> wcc <span class="free">x</span> <span class="main">=</span> fc <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fc_star star_decompose_1<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-fc_via_root"><span class="command">lemma</span></span> fc_via_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"total <span class="main">(</span><span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">=</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms comp_associative conv_dist_comp conv_star_commute coreflexive_idempotent coreflexive_symmetric inf.cobounded2 total_var<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_one mult_left_isotone mult_right_isotone mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_transitive_equal mult_assoc<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> fc <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_isotone inf.cobounded2 mult_1_right order.refl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4.1›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_acyclic_1"><span class="command">lemma</span></span> update_acyclic_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reachable_without_loops <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI2 inf.sup_monoid.add_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_plus_without_loops<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> vector_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_inf.mult_semi_associative sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_back_loop_fixpoint sup.right_idem<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_isotone star.circ_transitive_equal star.left_plus_circ star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_acyclic_2"><span class="command">lemma</span></span> update_acyclic_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">[</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_left_dist_sup star.circ_loop_fixpoint<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">)</span></span> comp_right_one le_supI le_supI2 mult_left_isotone star.circ_loop_fixpoint star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span> bijective_reverse conv_star_commute comp_associative star_left_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> vector_mult_closed update_acyclic_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_acyclic_3"><span class="command">lemma</span></span> update_acyclic_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms bijective_reverse conv_star_commute update_acyclic_1<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-rectangle_star_rectangle"><span class="command">lemma</span></span> rectangle_star_rectangle<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rectangle <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_isotone mult_right_isotone top.extremum<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-arc_star_arc"><span class="command">lemma</span></span> arc_star_arc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arc_top_arc rectangle_star_rectangle <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Disjoint_Set_Forests-star_rectangle_decompose"><span class="command">lemma</span></span> star_rectangle_decompose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rectangle <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_reflexive sup.coboundedI1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative semiring.combine_common_factor semiring.distrib_left sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rectangle_star_rectangle <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone sup_absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative star.circ_loop_fixpoint sup_assoc sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star.left_plus_below_circ sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_one le_supI star_left_induct<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_isotone le_supE le_supI star.circ_increasing star.circ_transitive_equal star_isotone sup_ge2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-star_arc_decompose"><span class="command">lemma</span></span> star_arc_decompose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arc_top_arc star_rectangle_decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Disjoint_Set_Forests-plus_rectangle_decompose"><span class="command">lemma</span></span> plus_rectangle_decompose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rectangle <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms star_rectangle_decompose<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative semiring.combine_common_factor semiring.distrib_left sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms rectangle_star_rectangle <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone sup_absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative star.circ_loop_fixpoint sup_assoc sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 6.1›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-plus_arc_decompose"><span class="command">lemma</span></span> plus_arc_decompose<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arc_top_arc plus_rectangle_decompose <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 6.2›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_acyclic_4"><span class="command">lemma</span></span> update_acyclic_4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> comp_associative pseudo_complement schroeder_3_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative comp_commute_below_diversity star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.mult_right_dist_sup dual_order.trans inf.cobounded1 inf.coboundedI2 inf.sup_monoid.add_assoc le_supI sup.cobounded1 sup_ge2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_covector<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone star_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> plus_arc_decompose points_arc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊔</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> reachable_without_loops <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 6.3›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_acyclic_5"><span class="command">lemma</span></span> update_acyclic_5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.mult_right_dist_sup inf.cobounded2 inf.sup_monoid.add_assoc sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.covector_complement_closed equivalence_top_closed inf_top.right_neutral maddux_3_13 pseudo_complement regular_closed_top regular_one_closed vector_covector vector_top_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> acyclic_down_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Root of the tree containing point $x$ in the disjoint-set forest $p$›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">root</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 3.1›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-root_var"><span class="command">lemma</span></span> root_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_comp_top_inf inf_commute mult_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 3.2›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-root_successor_loop"><span class="command">lemma</span></span> root_successor_loop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">p</span> <span class="main">⟹</span> root <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span><span class="main">[[</span>root <span class="free">p</span> <span class="free">x</span><span class="main">]]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> root_var injective_codomain comp_associative conv_dist_inf coreflexive_symmetric equivalence_one_closed inf.cobounded2 univalent_conv_injective<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-root_transitive_successor_loop"><span class="command">lemma</span></span> root_transitive_successor_loop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"univalent <span class="free">p</span> <span class="main">⟹</span> root <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span>root <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_1_right star_one star_simulation_right_equal root_successor_loop<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The root of a tree of a node belongs to the same component as the node.›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-root_same_component"><span class="command">lemma</span></span> root_same_component<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">x</span> <span class="main">⟹</span> root <span class="free">p</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> fc <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative coreflexive_comp_top_inf eq_refl inf.sup_left_divisibility inf.sup_monoid.add_commute mult_isotone star.circ_circ_mult star.circ_right_top star.circ_transitive_equal star_one star_outer_increasing test_preserves_equation top_greatest<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-root_vector"><span class="command">lemma</span></span> root_vector<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> vector <span class="main">(</span>root <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_mult_closed root_var<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-root_vector_inf"><span class="command">lemma</span></span> root_vector_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vector <span class="free">x</span> <span class="main">⟹</span> root <span class="free">p</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> root <span class="free">p</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vector_covector root_vector<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-root_same_component_vector"><span class="command">lemma</span></span> root_same_component_vector<span class="main">:</span>
  <span class="quoted"><span class="quoted">"injective <span class="free">x</span> <span class="main">⟹</span> vector <span class="free">x</span> <span class="main">⟹</span> root <span class="free">p</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> fc <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> root_same_component root_vector_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Disjoint_Set_Forests-univalent_root_successors"><span class="command">lemma</span></span> univalent_root_successors<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comp_inf.mult_semi_associative conv_dist_comp conv_dist_inf conv_order equivalence_one_closed inf.absorb1 inf.sup_monoid.add_assoc injective_codomain<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> star_right_induct_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coreflexive_idempotent inf_le1 inf_le2 mult_right_isotone order_trans star.circ_increasing<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-same_component_same_root_sub"><span class="command">lemma</span></span> same_component_same_root_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> fc <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">≤</span> root <span class="free">p</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> mult_isotone mult_assoc root_var fc_plus fc_star eq_iff univalent_root_successors<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> shunt_bijective root_var<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-same_component_same_root"><span class="command">lemma</span></span> same_component_same_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bijective <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> fc <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> root <span class="free">p</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">≤</span> root <span class="free">p</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> same_component_same_root_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> fc <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> fc_equivalence conv_dist_comp conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">y</span> <span class="main">≤</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> same_component_same_root_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-same_roots_sub"><span class="command">lemma</span></span> same_roots_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">q</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">≤</span> fc <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> mult_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> fc <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_left_isotone mult_right_isotone star.circ_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> fc <span class="free">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> mult_left_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_dist_comp conv_dist_inf conv_star_commute inf_commute one_inf_conv symmetric_one_closed mult_assoc univalent_root_successors<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-same_roots"><span class="command">lemma</span></span> same_roots<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">=</span> fc <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms conv_dist_comp conv_dist_inf conv_involutive conv_star_commute inf_commute one_inf_conv symmetric_one_closed root_var univalent_root_successors<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-same_root"><span class="command">lemma</span></span> same_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">=</span> fc <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> root <span class="free">q</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mult_assoc root_var univalent_root_successors<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-loop_root"><span class="command">lemma</span></span> loop_root<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">p</span><span class="main">[[</span><span class="free">x</span><span class="main">]]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_associative comp_right_one conv_order equivalence_one_closed ex231c inf.orderE inf.sup_monoid.add_commute mult_left_isotone mult_right_isotone one_inf_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_absorb2 injective_comp_right_dist_inf<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> coreflexive_comp_top_inf inf.boundedI inf.cobounded1 inf.cobounded2 mult_isotone star.circ_increasing<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> le_infI1 star_left_induct_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-one_loop"><span class="command">lemma</span></span> one_loop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> test_comp_test_top<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI2 mult_left_isotone star.circ_mult_upper_bound star.circ_reflexive star.left_plus_below_circ<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> conv_dist_comp conv_dist_inf conv_star_commute inf_commute one_inf_conv symmetric_one_closed univalent_root_successors<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p_antitone p_antitone_iff p_shunting_swap <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> triple_schroeder_p p_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_symmetric le_bot<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_complement conv_dist_comp conv_dist_inf conv_star_commute inf_absorb1 star.circ_plus_same symmetric_one_closed reachable_without_loops star_plus_without_loops<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-root_root"><span class="command">lemma</span></span> root_root<span class="main">:</span>
  <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> root <span class="free">p</span> <span class="main">(</span>root <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> comp_associative comp_inf.mult_right_sub_dist_sup_right dual_order.eq_iff inf.cobounded1 inf.cobounded2 inf.orderE mult_right_isotone star.circ_loop_fixpoint star.circ_transitive_equal root_var<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-loop_root_2"><span class="command">lemma</span></span> loop_root_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_injective_below_complement inf.orderE mult_1_left regular_one_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> inf_commute mult_right_dist_sup one_inf_conv plus_reachable_without_loops<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_complement conv_dist_inf conv_isotone conv_plus_commute mult_left_isotone semiring.add_right_mono symmetric_one_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_isotone inf.coboundedI2 star.circ_reflexive sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> root <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 inf.boundedI inf.order_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_left_divisibility <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_left_dist_sup star.circ_loop_fixpoint sup_commute reachable_without_loops root_var<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coreflexive_comp_top_inf inf.cobounded2 mult_right_isotone semiring.add_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> one_loop root_var mult_assoc semiring.mult_not_zero sup_bot_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> stone_relation_algebra_tarski
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4.3 <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>distinct_points›</span></span></span></span> has been moved to theory <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Relation_Algebras›</span></span></span></span> in entry <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Stone_Relation_Algebras›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Back and von Wright's array independence requirements \cite{BackWright1998}›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-put_get_different_vector"><span class="command">lemma</span></span> put_get_different_vector<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">=</span> <span class="free">x</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_inf conv_dist_sup mult_right_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conv_complement covector_inf_comp_3 inf_commute vector_complement_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf.absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span> <span class="main">*</span> bot <span class="main">⊔</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_inf.semiring.mult_zero_right inf.absorb1 inf.sup_monoid.add_assoc p_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-put_get_different"><span class="command">lemma</span></span> put_get_different<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"point <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">=</span> <span class="free">x</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms distinct_points <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> put_get_different_vector<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-put_put_different_vector"><span class="command">lemma</span></span> put_put_different_vector<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">v</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">v</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">v</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf.semiring.distrib_left inf_assoc sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf_commute inf_import_p p_inf selection_closed_id<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms distinct_points pseudo_complement inf.absorb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">v</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf.semiring.distrib_left inf_assoc sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-put_put_different"><span class="command">lemma</span></span> put_put_different<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"point <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">v</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">[</span><span class="free">v</span><span class="main">⟼</span><span class="free">w</span><span class="main">]</span><span class="main">)</span><span class="main">[</span><span class="free">y</span><span class="main">⟼</span><span class="free">z</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms distinct_points put_put_different_vector <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Verifying Operations on Disjoint-Set Forests›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we verify the make-set, find-set and union-sets operations of disjoint-set forests.
We start by introducing syntax for updating arrays in programs.
Updating the value at a given array index means updating the whole array.
›</span></span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_rel_update"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> com"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(2</span>_<span class="keyword1">[</span>_<span class="keyword1">]</span> <span class="keyword1">:=</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>70<span class="main">,</span> 65<span class="main">,</span> 65<span class="main">]</span> 61<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">x</span><span class="main">[</span><span class="free">y</span><span class="main">]</span> <span class="main">:=</span> <span class="free">z</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="keyword1">CONST</span> uminus <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The finiteness requirement in the following class is used for proving that the operations terminate.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> finite_regular_p_algebra <span class="main">=</span> p_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_regular<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> regular <span class="bound">x</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> stone_kleene_relation_algebra_tarski <span class="main">=</span> stone_kleene_relation_algebra <span class="main">+</span> stone_relation_algebra_tarski

<span class="keyword1"><span class="command">class</span></span> stone_kleene_relation_algebra_tarski_finite_regular <span class="main">=</span> stone_kleene_relation_algebra_tarski <span class="main">+</span> finite_regular_p_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Make-Set›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We prove two correctness results about make-set.
The first shows that the forest changes only to the extent of making one node the root of a tree.
The second result adds that only singleton sets are created.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">make_set_postcondition</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">∧</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> make_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound">p</span></span></span>
  <span class="main">[</span> point <span class="free">x</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">]</span>
  <span class="bound">p</span><span class="main">[</span><span class="free"><span class="free">x</span></span><span class="main">]</span> <span class="main">:=</span> <span class="free">x</span>
  <span class="main">[</span> make_set_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="free">p0</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc_simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_set_postcondition_def inf_sup_distrib1 inf_assoc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> vector_covector<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> make_set_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound">p</span></span></span>
  <span class="main">[</span> point <span class="free">x</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">]</span>
  <span class="bound">p</span><span class="main">[</span><span class="free"><span class="free">x</span></span><span class="main">]</span> <span class="main">:=</span> <span class="free">x</span>
  <span class="main">[</span> make_set_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="free">p0</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">vcg_tc</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">x</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"make_set_postcondition <span class="main">(</span><span class="skolem">p</span><span class="main">[</span><span class="free">x</span><span class="main">⟼</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">x</span> <span class="free">p0</span> <span class="main">∧</span> <span class="skolem">p</span><span class="main">[</span><span class="free">x</span><span class="main">⟼</span><span class="free">x</span><span class="main">]</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"make_set_postcondition <span class="main">(</span><span class="skolem">p</span><span class="main">[</span><span class="free">x</span><span class="main">⟼</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="free">x</span> <span class="free">p0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> make_set_postcondition_def inf_sup_distrib1 inf_assoc<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> vector_covector<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">[</span><span class="free">x</span><span class="main">⟼</span><span class="free">x</span><span class="main">]</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> coreflexive_sup_closed dual_order.trans inf.cobounded2 vector_covector<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The above total-correctness proof allows us to extract a function, which can be used in other implementations below.
This is a technique of \cite{Guttmann2018c}.
›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-make_set_exists"><span class="command">lemma</span></span> make_set_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"point <span class="free">x</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p'</span> <span class="main">.</span> make_set_postcondition <span class="bound">p'</span> <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tc_extract_function make_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">make_set</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p'</span> <span class="main">.</span> make_set_postcondition <span class="bound">p'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-make_set_function"><span class="command">lemma</span></span> make_set_function<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">=</span> make_set <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"make_set_postcondition <span class="free">p'</span> <span class="free">x</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p'</span> <span class="main">.</span> make_set_postcondition <span class="bound">p'</span> <span class="free">x</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">z</span> <span class="main">.</span> <span class="var">?P</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> make_set_exists <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> someI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> make_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Find-Set›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Disjoint-set forests are represented by their parent mapping.
It is a forest except each root of a component tree points to itself.

We prove that find-set returns the root of the component tree of the given node.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">disjoint_set_forest</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> mapping <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> acyclic <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">find_set_precondition</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> disjoint_set_forest <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">find_set_invariant</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> find_set_precondition <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">find_set_postcondition</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> point <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> root <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_1"><span class="command">lemma</span></span> find_set_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_set_precondition <span class="free">p</span> <span class="free">x</span> <span class="main">⟹</span> find_set_invariant <span class="free">p</span> <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> find_set_invariant_def<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> mult_left_isotone star.circ_reflexive find_set_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_2"><span class="command">lemma</span></span> find_set_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_set_invariant <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span> <span class="main">⟹</span> find_set_invariant <span class="free">p</span> <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span> <span class="main">}</span> <span class="main">&lt;</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"find_set_invariant <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 read_point find_set_invariant_def find_set_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"find_set_invariant <span class="free">p</span> <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span> <span class="main">∧</span> card <span class="var">?t</span> <span class="main">&lt;</span> card <span class="var">?s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> find_set_invariant_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"find_set_precondition <span class="free">p</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 find_set_invariant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"surjective <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">)</span></span> find_set_invariant_def comp_associative comp_isotone star.circ_increasing star.circ_transitive_equal<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?t</span> <span class="main">&lt;</span> card <span class="var">?s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone mult_right_isotone star.left_plus_below_circ<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> maddux_3_11_pp mult_right_dist_sup regular_one_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_left_subdist_inf mult_1_left semiring.add_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2 find_set_invariant_def distinct_points <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.antisym_conv inf.eq_refl inf_le1 mult_left_isotone star_plus mult_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_isotone order_refl star.left_plus_below_circ star_plus mult_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">⊆</span> <span class="var">?s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="var">?s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 find_set_invariant_def bijective_regular mult_left_isotone star.circ_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">y</span> <span class="main">∈</span> <span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="var">?t</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_without_loops mem_Collect_eq order_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 find_set_invariant_def shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> find_set_invariant_def find_set_precondition_def conv_dist_comp conv_dist_inf conv_isotone conv_star_commute equivalence_one_closed star.circ_plus_same symmetric_complement_closed<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> find_set_invariant_def comp_inf.coreflexive_idempotent conv_complement covector_vector_comp inf.absorb1 inf.sup_monoid.add_commute pseudo_complement surjective_conv_total top.extremum vector_top_closed regular_closed_top<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?t</span> <span class="main">&lt;</span> card <span class="var">?s</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> psubset_card_mono<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_regular <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 5 6 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_3"><span class="command">lemma</span></span> find_set_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_set_invariant <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span> <span class="main">⟹</span> find_set_postcondition <span class="free">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"find_set_invariant <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"find_set_postcondition <span class="free">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> find_set_postcondition_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 find_set_invariant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> find_set_invariant_def find_set_precondition_def shunt_bijective shunt_mapping top_right_mult_increasing<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 find_set_invariant_def le_infI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> find_set_invariant_def order_lesseq_imp shunt_bijective top_right_mult_increasing mult_assoc<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 find_set_invariant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 find_set_invariant_def find_set_precondition_def bijective_reverse conv_star_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">y</span><span class="main">]]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_left_dist_sup star.circ_loop_fixpoint<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> find_set_invariant_def find_set_precondition_def comp_isotone mult_left_sub_dist_sup semiring.add_right_mono star.circ_back_loop_fixpoint star.circ_circ_mult star.circ_top star.circ_transitive_equal star_involutive star_one<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_loop_fixpoint sup.left_idem sup_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative star_left_induct<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> comp_associative coreflexive_comp_top_inf inf_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.cobounded2 inf.sup_monoid.add_commute mult_left_isotone one_inf_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 find_set_invariant_def find_set_precondition_def mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> find_set_invariant_def shunting_p bijective_regular<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> find_set_invariant_def find_set_precondition_def N_top comp_isotone coreflexive_idempotent inf.cobounded2 inf.sup_monoid.add_commute inf_assoc one_inf_conv shunt_mapping<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top <span class="main">≤</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_commute mult_isotone one_inf_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative inf.sup_monoid.add_commute p_antitone p_antitone_iff schroeder_3_p<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span> <span class="main">*</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 dual_order.trans le_supI sup_ge2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> find_set_invariant_def shunting_p bijective_regular<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> find_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">y</span></span></span></span></span></span></span>
  <span class="main">[</span> find_set_precondition <span class="free">p</span> <span class="free">x</span> <span class="main">]</span>
  y <span class="main">:=</span> <span class="free">x</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">p</span><span class="main">[[</span><span class="bound">y</span><span class="main">]]</span>
    <span class="keyword1">INV</span> <span class="main">{</span> find_set_invariant <span class="free">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="bound">y</span> <span class="main">}</span> <span class="main">}</span>
     <span class="keyword1">DO</span> y <span class="main">:=</span> <span class="free">p</span><span class="main">[[</span><span class="bound">y</span><span class="main">]]</span>
     <span class="keyword1">OD</span>
  <span class="main">[</span> find_set_postcondition <span class="free">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc_simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> find_set_1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> find_set_2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> find_set_3<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_exists"><span class="command">lemma</span></span> find_set_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_set_precondition <span class="free">p</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> find_set_postcondition <span class="free">p</span> <span class="free">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tc_extract_function find_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The root of a component tree is a point, that is, represents a singleton set of nodes.
This could be proved from the definitions using Kleene-relation algebraic calculations.
But they can be avoided because the property directly follows from the postcondition of the previous correctness proof.
The corresponding algorithm shows how to obtain the root.
We therefore have an essentially constructive proof of the following result.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 3.3›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-root_point"><span class="command">lemma</span></span> root_point<span class="main">:</span>
  <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p</span> <span class="main">⟹</span> point <span class="free">x</span> <span class="main">⟹</span> point <span class="main">(</span>root <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> find_set_exists find_set_precondition_def find_set_postcondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">find_set</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span> <span class="main">.</span> find_set_postcondition <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_function"><span class="command">lemma</span></span> find_set_function<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_set_precondition <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> find_set <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"find_set_postcondition <span class="free">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms find_set_def find_set_exists someI<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Path Compression›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The path-compression technique is frequently implemented in recursive implementations of find-set 
modifying the tree on the way out from recursive calls. Here we implement it using a second while-loop, 
which iterates over the same path to the root and changes edges to point to the root of the component, 
which is known after the while-loop in find-set completes. We prove that path compression preserves 
the equivalence-relational semantics of the disjoint-set forest and also preserves the roots of the 
component trees. Additionally we prove the exact effect of path compression.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">path_compression_precondition</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> disjoint_set_forest <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> root <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">path_compression_invariant</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> 
  path_compression_precondition <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> 
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">[[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≤</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">∧</span> fc <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> fc <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="main">∧</span>
  root <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">[[</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">]]</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≤</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">[[</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">]]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span><span class="main">[[</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">]]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">p0</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p0</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">⟼</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span>
  disjoint_set_forest <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> root <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">path_compression_postcondition</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="main">≡</span> 
  path_compression_precondition <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">∧</span> fc <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> fc <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="main">∧</span>
  <span class="free"><span class="bound"><span class="entity">p0</span></span></span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">p0</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⟼</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first consider a variant that achieves the effect as a single update.
The parents of all nodes reachable from x are simultaneously updated to the root of the component of x.
›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-path_compression_exact"><span class="command">lemma</span></span> path_compression_exact<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_compression_precondition <span class="free">p0</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">=</span> fc <span class="free">p0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> root <span class="free">p0</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path_compression_precondition_def assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 a2 bijective_regular mapping_regular regular_closed_star regular_conv_closed regular_mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> inf_sup_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">p0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> coreflexive_comp_top_inf_one inf.absorb_iff2 inf.cobounded2 inf.sup_monoid.add_assoc root_var<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">p0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1 a4 conv_dist_inf coreflexive_symmetric inf.absorb2 inf.cobounded2 inf.sup_monoid.add_assoc root_var symmetric_one_closed<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf.le_sup_iff order.refl<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a4 coreflexive_comp_top_inf_one inf.cobounded1 inf_assoc inf_le2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> conv_dist_inf coreflexive_symmetric inf.absorb_iff2 inf.cobounded2 inf.sup_monoid.add_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_monoid.add_commute inf_sup_distrib1 maddux_3_11_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">=</span> fc <span class="free">p0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"univalent <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1 a2 a3 update_univalent mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fc_increasing inf.order_trans sup.cobounded2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_involutive conv_star_commute dedekind<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative inf.boundedI inf.cobounded2 inf_le1 mult_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> top <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_associative comp_inf.mult_right_isotone mult_isotone star.right_plus_below_circ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 symmetric_top_closed vector_covector vector_inf_comp vector_mult_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 antisym comp_inf.top_right_mult_increasing conv_involutive dedekind_1 inf.sup_left_divisibility inf.sup_monoid.add_commute mult_right_isotone surjective_conv_total mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 a3 vector_covector vector_inf_comp vector_mult_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_comp conv_dist_inf conv_star_commute inf_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> conv_isotone dual_order.trans mult_isotone star.circ_increasing sup.cobounded1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 le_supI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute maddux_3_11_pp<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 fc_idempotent fc_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p0</span> <span class="main">≤</span> fc <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> star_sup_2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"transitive <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a2 comp_associative mult_right_isotone rectangle_star_rectangle <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transitive <span class="main">(</span><span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a3 conv_dist_comp inf.eq_refl mult_assoc<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"transitive <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 transitive_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 mult_right_isotone top_greatest mult_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_inf mult_left_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 a4 root_successor_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> conv_dist_comp conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 5 comp_left_subdist_inf inf_mono order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p0</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone star_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a2 a3 vector_covector vector_mult_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a4 coreflexive_symmetric inf.cobounded2 root_var comp_associative conv_dist_comp conv_involutive conv_star_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">1</span> <span class="main">*</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a2 mult_left_isotone mult_right_isotone semiring.add_left_mono sup_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a1 cancel_separate_eq mult_right_dist_sup<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> univalent_root_successors a1 conv_dist_comp conv_dist_inf coreflexive_idempotent coreflexive_symmetric inf.cobounded2 injective_codomain loop_root root_transitive_successor_loop symmetric_one_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_left_divisibility inf_commute sup.left_idem sup_commute sup_relative_same_increasing<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.cobounded2 inf_commute order.refl order_lesseq_imp star.circ_mult_upper_bound star.circ_reflexive star.circ_transitive_equal sup.boundedI sup_monoid.add_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_transitive_equal<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">≤</span> fc <span class="free">p0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_order conv_star_commute mult_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-update_acyclic_6"><span class="command">lemma</span></span> update_acyclic_6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">[</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">*</span><span class="free">x</span><span class="main">⟼</span>root <span class="free">p</span> <span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms root_point root_successor_loop update_acyclic_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> path_compression_assign<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound">p</span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound">t</span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound">w</span></span></span></span>
  <span class="main">[</span> path_compression_precondition <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">]</span>
  <span class="bound">p</span><span class="main">[</span><span class="bound"><span class="bound">p</span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free"><span class="free">x</span></span><span class="main">]</span> <span class="main">:=</span> <span class="free">y</span>
  <span class="main">[</span> path_compression_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc_simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> path_compression_precondition_def path_compression_postcondition_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> update_univalent mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> bijective_regular mapping_regular regular_closed_star regular_conv_closed regular_mult_closed update_mapping mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> update_acyclic_6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> same_root path_compression_exact path_compression_precondition_def update_univalent vector_mult_closed<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> path_compression_exact<span class="main">(</span>1<span class="main">)</span> path_compression_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> path_compression_exact<span class="main">(</span>2<span class="main">)</span> path_compression_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We next look at implementing these updates using a loop.
›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-path_compression_1a"><span class="command">lemma</span></span> path_compression_1a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms bijective_regular mapping_regular regular_closed_star regular_conv_closed regular_mult_closed vector_mult_closed point_in_vector_or_complement_2 loop_root_2<span class="main">)</span>

<span class="keyword1" id="Disjoint_Set_Forests-path_compression_1b"><span class="command">lemma</span></span> path_compression_1b<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_left_isotone star.circ_reflexive <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Disjoint_Set_Forests-path_compression_1"><span class="command">lemma</span></span> path_compression_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_compression_precondition <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> path_compression_invariant <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_compression_invariant_def path_compression_precondition_def loop_root path_compression_1a path_compression_1b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Disjoint_Set_Forests-path_compression_2"><span class="command">lemma</span></span> path_compression_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_compression_invariant <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span> <span class="free">w</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">⟹</span> path_compression_invariant <span class="main">(</span><span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">}</span> <span class="main">&lt;</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[</span><span class="free">w</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"path_compression_invariant <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span> <span class="free">w</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i3<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 path_compression_invariant_def path_compression_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> i5<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">p</span><span class="main">[[</span><span class="free">x</span><span class="main">]]</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i9<span class="main">:</span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">=</span> fc <span class="free">p0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i10<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">w</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">=</span> <span class="free">p0</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 path_compression_invariant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> i14<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> root <span class="free">p0</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 path_compression_invariant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i1 i5 read_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_compression_invariant <span class="var">?p</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">∧</span> card <span class="var">?t</span> <span class="main">&lt;</span> card <span class="var">?s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> path_compression_invariant_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"mapping <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i1 i3 i5 bijective_regular update_total update_univalent<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 i1 i4 root_successor_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i3 i5 distinct_points<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pseudo_complement schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i5 i6 shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_plus_without_loops<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i5 shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i5 point_arc arc_in_partition <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1 i5 mapping_regular regular_conv_closed regular_closed_star regular_mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.mult_right_dist_sup maddux_3_11_pp mult_right_dist_sup regular_one_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_complement conv_dist_inf conv_plus_commute equivalence_one_closed reachable_without_loops<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> i1 sup_right_isotone inf.sup_left_isotone conv_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> top <span class="main">⊓</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_inf.comp_isotone coreflexive_comp_top_inf equivalence_one_closed inf.cobounded1 inf.cobounded2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> coreflexive_comp_top_inf_one<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i5 shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 epm_3 mult_semi_associative<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> 4 i11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_antitone_iff pseudo_complement schroeder_4_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone mult_left_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone mult_left_isotone star_isotone mult_right_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_plus mult_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> i5 covector_inf_comp_3 mult_assoc conv_dist_comp conv_star_commute covector_bot_closed equivalence_top_closed inf.le_iff_sup mult_left_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_unique mult_right_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone star.left_plus_below_circ<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative star.circ_loop_fixpoint star_left_induct sup_commute sup_least sup_left_divisibility<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf.sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> conv_isotone mult_left_isotone star_isotone inf.sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_plus<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> bot"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> i5 covector_inf_comp_3 mult_assoc conv_dist_comp covector_bot_closed equivalence_top_closed inf.le_iff_sup mult_left_isotone bot_least inf.absorb1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 bijective_regular conv_dist_sup inf.sup_monoid.add_commute maddux_3_11_pp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_right_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> semiring.add_right_mono comp_isotone conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone mult_left_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_isotone star.left_plus_below_circ<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative star.circ_loop_fixpoint star_left_induct sup_commute sup_least sup_left_divisibility<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_simulation_right_equal mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i1 i10 i3 i5 inf_le1 update_acyclic_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">[[</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">]]</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i3 inf_vector_comp vector_inf_comp<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">[[</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">]]</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_complement conv_dist_inf conv_dist_sup mult_right_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sup_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_left_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> semiring.add_left_mono mult_left_isotone mult_right_isotone star.left_plus_below_circ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_absorb2<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> star_left_induct <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone star.circ_mult_increasing<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> dual_order.trans mult_left_isotone star.left_plus_below_circ <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">[[</span><span class="free">x</span><span class="main">]]</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">∧</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">[[</span><span class="free">x</span><span class="main">]]</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_inf conv_dist_sup mult_right_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 conv_complement covector_inf_comp_3 inf.sup_monoid.add_commute vector_complement_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i5 covector_inf_comp_3 inf.sup_monoid.add_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i3 i5 comp_associative<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 8 12 True pseudo_complement inf.sup_monoid.add_commute order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">[[</span><span class="free">x</span><span class="main">]]</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_inf conv_dist_sup mult_right_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 conv_complement covector_inf_comp_3 inf_commute vector_complement_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i2 i5 False distinct_points <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i2 i5 i7 False distinct_points inf.absorb2 pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 12 False i7 dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">⟶</span> <span class="var">?p</span><span class="main">[[</span><span class="free">x</span><span class="main">]]</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">∧</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 13 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_inf conv_dist_sup mult_right_dist_sup sup_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_left_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1 i10 root_successor_loop sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_left_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i3 comp_associative sup.idem<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_left_induct<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">≤</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 13 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_isotone star.circ_increasing star.circ_loop_fixpoint sup.boundedI sup_ge2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> root <span class="var">?p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i4 comp_associative root_var<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> coreflexive_idempotent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i4 root_var<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> i4 comp_right_one mult_left_isotone mult_right_isotone star.circ_reflexive root_var<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="var">?p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 14 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_assoc root_var<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2 semiring.distrib_right<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.left_commute inf.sup_monoid.add_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i3 covector_inf_comp_3<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i5 inf_assoc vector_complement_closed vector_inf_comp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 16 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 17 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.absorb2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 5 inf.sup_monoid.add_commute le_iff_inf pseudo_complement sup_monoid.add_0_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_compression_precondition <span class="var">?p</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 10 15 i2 i3 path_compression_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"injective <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"surjective <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊓</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.boundedE inf.boundedI inf.cobounded1 inf.cobounded2 one_inf_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i5 vector_covector<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⊓</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI2 inf.sup_monoid.add_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> conv_dist_inf coreflexive_symmetric inf.absorb1 inf.boundedE inf.cobounded2 pseudo_complement star.circ_mult_increasing<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5 antisymmetric_bot_closed asymmetric_bot_closed comp_inf.schroeder_2 inf.absorb1 one_inf_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> 18<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 i8 bijective_regular inf.sup_monoid.add_commute inf_sup_distrib2 maddux_3_11_pp<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> 19<span class="main">:</span> <span class="quoted"><span class="quoted">"fc <span class="var">?p</span> <span class="main">=</span> fc <span class="free">p0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i3 i5 i6 bijective_reverse conv_star_commute inf.absorb1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i5 vector_inf_comp mult_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i5 omit_redundant_points<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative mult_left_dist_sup mult_right_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> semiring.add_right_mono comp_isotone eq_iff inf.cobounded1 inf.sup_monoid.add_commute mult_1_right<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1 i4 root_successor_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> comp_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i1 comp_associative eq_refl shunt_mapping sup_right_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_loop_fixpoint sup.left_idem sup_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative mult_left_dist_sup star.circ_loop_fixpoint sup_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1 i4 root_successor_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> comp_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i1 comp_associative eq_refl shunt_mapping sup_right_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> star.circ_loop_fixpoint sup.left_idem sup_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 20 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative star_left_induct<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 comp_right_one covector_inf_comp_3 inf.sup_monoid.add_commute one_inf_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_right_subdist_inf inf.boundedE inf.sup_monoid.add_commute one_inf_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone star.circ_mult_increasing_2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 21 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_dist_inf conv_involutive conv_isotone conv_star_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i5 vector_inf_comp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_isotone mult_right_isotone star_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="var">?p</span> <span class="main">*</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> fc <span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_left_isotone star.circ_increasing<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 22<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">≤</span> fc <span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">≤</span> <span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> fc <span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fc_increasing<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">w</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">≤</span> fc <span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 22 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf.semiring.distrib_left inf.sup_monoid.add_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> fc <span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 bijective_regular inf.sup_monoid.add_commute inf_sup_distrib1 maddux_3_11_pp<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 23<span class="main">:</span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">≤</span> fc <span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 fc_idempotent fc_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">⊔</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">w</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊔</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i3 i5 vector_covector<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">⊔</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> i5 i6 conv_dist_comp conv_involutive conv_isotone conv_star_commute le_supI shunt_bijective star.circ_increasing sup_absorb1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> fc <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fc_increasing star.circ_back_loop_prefixpoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fc <span class="var">?p</span> <span class="main">≤</span> fc <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i1 fc_idempotent fc_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 23 i9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">[[</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span> <span class="main">=</span> <span class="free">p0</span><span class="main">[[</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">[[</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span> <span class="main">=</span> <span class="free">p</span><span class="main">[[</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 4 i5 i11 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> put_get_different<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="main">[[</span><span class="free">p0</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i12<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span><span class="main">)</span><span class="main">[[</span><span class="free">p0</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i13 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="main">[[</span><span class="free">p0</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf.coboundedI2 mult_left_isotone p_antitone p_antitone_iff star.circ_increasing<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> i2 i5 put_get_different_vector vector_complement_closed vector_inf_closed vector_mult_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="main">[[</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i12<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> 24<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="var">?p</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">=</span> root <span class="free">p0</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 18 19 i14 same_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> root <span class="free">p0</span> <span class="main">(</span><span class="free">p0</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i12<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 25<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> root <span class="free">p0</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 i14 conv_involutive forest_components_increasing mult_left_isotone shunt_bijective injective_mult_closed read_surjective same_component_same_root<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> 26<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="var">?p</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i1 i10 i14 i8 i9 same_root<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟶</span> <span class="var">?p</span><span class="main">[[</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span> <span class="main">≠</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">∧</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 27<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">[[</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span> <span class="main">≠</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">∧</span> <span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="main">[[</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]]</span> <span class="main">≠</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 26 27 loop_root <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 3 10 26 27 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_compression_1a<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"univalent <span class="free">p0</span>"</span></span> <span class="quoted"><span class="quoted">"total <span class="free">p0</span>"</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="free">p0</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i14<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> root <span class="free">p0</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i15<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i12 i16 mult_isotone star.circ_increasing star.circ_transitive_equal mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span><span class="main">)</span><span class="main">⟼</span><span class="free">y</span><span class="main">]</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 28<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">⊔</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> comp_associative star.circ_loop_fixpoint sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 29<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 24 25 26 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i12 i14 i5 inf.orderE maddux_3_13 path_compression_1a<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i12 inf_le2 star_plus mult.assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i16<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 30<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊓</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> update_inf update_inf_same<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i12 comp_associative inf.cobounded2 p_antitone_iff star.circ_plus_same update_inf_different<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 29 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i13 inf.cobounded2 inf.sup_monoid.add_assoc p_antitone_iff update_inf_different<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 29 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> update_inf_different<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 28 30 31 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_distrib1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 33<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 29 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i12 inf.sup_right_isotone mult.semigroup_axioms p_antitone_inf star_plus semigroup.assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_assoc update_inf<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i13 inf_assoc update_inf_same<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI2 p_antitone path_compression_1b inf_assoc update_inf_different<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> 34<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> i14 i5 bijective_regular mapping_regular regular_closed_star regular_conv_closed regular_mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i16 comp_associative mult_right_isotone star.circ_transitive_equal<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf.semiring.distrib_left inf.absorb2<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 34 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_distrib1 maddux_3_11_pp<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> 35<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 32 33 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_distrib1<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 36<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> i14 i2 bijective_regular mapping_regular regular_closed_star regular_conv_closed regular_mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i16 p_antitone<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i13 p_antitone_inf update_inf_different<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 35 36 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> maddux_3_11_pp<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?t</span> <span class="main">&lt;</span> card <span class="var">?s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conv_complement conv_dist_inf conv_dist_sup mult_right_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_left_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_left_isotone star.left_plus_below_circ sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> semiring.add_right_mono mult_left_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> top <span class="main">⊔</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative le_supI1 mult_right_isotone<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i3 i6 sup_absorb2<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.trans star.circ_loop_fixpoint sup_commute sup_ge2 mult_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 37<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">⊆</span> <span class="var">?s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> order_lesseq_imp mult_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 38<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="var">?s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i5 bijective_regular path_compression_1b<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 39<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">w</span> <span class="main">∈</span> <span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="var">?t</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> 40<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> reachable_without_loops <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">≤</span> <span class="main">(</span><span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> i5 bijective_reverse conv_star_commute reachable_without_loops<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> i1 i4 root_transitive_successor_loop <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conv_dist_comp conv_involutive conv_star_commute<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 inf.idem inf.sup_monoid.add_commute mult_left_zero schroeder_1 vector_inf_comp<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 41<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> bot"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_inf.mult_right_dist_sup mult_right_dist_sup<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">p</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_le1 inf_le2 mult_left_isotone order_trans sup_right_isotone<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> mult_left_isotone star.left_plus_below_circ sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf_le1 inf_le2 mult_left_isotone order_trans sup_left_isotone<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 41 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative le_supI star.circ_loop_fixpoint sup_ge2 star_left_induct<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 11 40 reachable_without_loops star_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> 4 i1 i10 i5 loop_root_2 star.circ_plus_same <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?t</span> <span class="main">&lt;</span> card <span class="var">?s</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> psubset_card_mono<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_regular <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> 37 38 39 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-path_compression_3a"><span class="command">lemma</span></span> path_compression_3a<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_compression_invariant <span class="free">p</span> <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="free">p0</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">]</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">⟼</span><span class="var">?y</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i3<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="var">?y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">=</span> root <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms path_compression_invariant_def path_compression_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> i5<span class="main">:</span> <span class="quoted"><span class="quoted">"point <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">≤</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">p</span><span class="main">[[</span><span class="free">x</span><span class="main">]]</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">∧</span> <span class="var">?y</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i9<span class="main">:</span> <span class="quoted"><span class="quoted">"fc <span class="free">p</span> <span class="main">=</span> fc <span class="free">p0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i10<span class="main">:</span> <span class="quoted"><span class="quoted">"root <span class="free">p</span> <span class="free">w</span> <span class="main">=</span> <span class="var">?y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="var">?y</span> <span class="main">⟶</span> <span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span> <span class="main">=</span> <span class="free">p0</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="main">[</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">⟼</span><span class="var">?y</span><span class="main">]</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> i14<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">=</span> root <span class="free">p0</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms path_compression_invariant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="var">?y</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="var">?y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i1 i15 i3 i4 get_put inf_le1 root_successor_loop update_inf update_inf_same<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i5 i12 i16 get_put update_inf update_inf_same<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">=</span> root <span class="free">p0</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i1 i10 i14 i8 i9 same_root<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w</span> <span class="main">⊔</span> <span class="var">?y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i12 i14 root_transitive_successor_loop star.circ_loop_fixpoint star_plus sup_monoid.add_commute mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span> <span class="main">≤</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i16 comp_associative mult_right_isotone star.circ_transitive_equal<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i13 inf_le1 update_inf update_inf_same<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i14 i5 bijective_regular mapping_regular regular_closed_star regular_conv_closed regular_mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> inf_sup_distrib1 maddux_3_11_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> i13 inf.sup_monoid.add_commute inf_import_p inf_sup_absorb le_iff_inf p_dist_inf update_inf_different inf.idem p_antitone_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="free">p0</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> i14 i2 bijective_regular mapping_regular regular_closed_star regular_conv_closed regular_mult_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> inf_sup_distrib1 maddux_3_11_pp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-path_compression_3"><span class="command">lemma</span></span> path_compression_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_compression_invariant <span class="free">p</span> <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="free">p0</span> <span class="free">w</span> <span class="main">⟹</span> path_compression_postcondition <span class="free">p</span> <span class="free">x</span> <span class="main">(</span><span class="free">p</span><span class="main">[[</span><span class="free">w</span><span class="main">]]</span><span class="main">)</span> <span class="free">p0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> path_compression_invariant_def path_compression_postcondition_def path_compression_precondition_def path_compression_3a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> path_compression<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">t</span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">w</span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">[</span> path_compression_precondition <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">]</span>
  w <span class="main">:=</span> <span class="free">x</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="free">y</span> <span class="main">≠</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">w</span><span class="main">]]</span>
    <span class="keyword1">INV</span> <span class="main">{</span> path_compression_invariant <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span> <span class="bound">w</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="bound">w</span> <span class="main">}</span> <span class="main">}</span>
     <span class="keyword1">DO</span> t <span class="main">:=</span> <span class="bound">w</span><span class="main">;</span>
        w <span class="main">:=</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">w</span><span class="main">]]</span><span class="main">;</span>
        <span class="bound">p</span><span class="main">[</span><span class="bound"><span class="bound">t</span></span><span class="main">]</span> <span class="main">:=</span> <span class="free">y</span>
     <span class="keyword1">OD</span>
  <span class="main">[</span> path_compression_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc_simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> path_compression_1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> path_compression_2<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> path_compression_3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Disjoint_Set_Forests-path_compression_exists"><span class="command">lemma</span></span> path_compression_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_compression_precondition <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p'</span> <span class="main">.</span> path_compression_postcondition <span class="bound">p'</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tc_extract_function path_compression <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">path_compression</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p'</span> <span class="main">.</span> path_compression_postcondition <span class="bound">p'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-path_compression_function"><span class="command">lemma</span></span> path_compression_function<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_compression_precondition <span class="free">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">=</span> path_compression <span class="free">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="free">p'</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms path_compression_def path_compression_exists someI<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Find-Set with Path Compression›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We sequentially combine find-set and path compression.
We consider implementations which use the previously derived functions and implementations which unfold their definitions.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> find_set_path_compression<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">y</span></span></span></span></span>
  <span class="main">[</span> find_set_precondition <span class="bound">p</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">]</span>
  y <span class="main">:=</span> find_set <span class="bound">p</span> <span class="free">x</span><span class="main">;</span>
  p <span class="main">:=</span> path_compression <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span>
  <span class="main">[</span> path_compression_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="free">p0</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc_simp</span>
  <span class="keyword1"><span class="command">using</span></span> find_set_function find_set_postcondition_def find_set_precondition_def path_compression_function path_compression_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">theorem</span></span> find_set_path_compression_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">t</span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">w</span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">y</span></span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">[</span> find_set_precondition <span class="bound">p</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">]</span>
  y <span class="main">:=</span> find_set <span class="bound">p</span> <span class="free">x</span><span class="main">;</span>
  w <span class="main">:=</span> <span class="free">x</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">y</span> <span class="main">≠</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">w</span><span class="main">]]</span>
    <span class="keyword1">INV</span> <span class="main">{</span> path_compression_invariant <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="free">p0</span> <span class="bound">w</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="bound">w</span> <span class="main">}</span> <span class="main">}</span>
     <span class="keyword1">DO</span> t <span class="main">:=</span> <span class="bound">w</span><span class="main">;</span>
        w <span class="main">:=</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">w</span><span class="main">]]</span><span class="main">;</span>
        <span class="bound">p</span><span class="main">[</span><span class="bound"><span class="bound">t</span></span><span class="main">]</span> <span class="main">:=</span> <span class="bound">y</span>
     <span class="keyword1">OD</span>
  <span class="main">[</span> path_compression_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="free">p0</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc_simp</span>
    <span class="keyword1"><span class="command">using</span></span> find_set_function find_set_postcondition_def find_set_precondition_def path_compression_1 path_compression_precondition_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> path_compression_2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> path_compression_3<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> find_set_path_compression_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">y</span></span></span></span></span></span></span></span></span>
  <span class="main">[</span> find_set_precondition <span class="bound">p</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">]</span>
  y <span class="main">:=</span> <span class="free">x</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">y</span> <span class="main">≠</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">y</span><span class="main">]]</span>
    <span class="keyword1">INV</span> <span class="main">{</span> find_set_invariant <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="bound">y</span> <span class="main">}</span> <span class="main">}</span>
     <span class="keyword1">DO</span> y <span class="main">:=</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">y</span><span class="main">]]</span>
     <span class="keyword1">OD</span><span class="main">;</span>
  p <span class="main">:=</span> path_compression <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span>
  <span class="main">[</span> path_compression_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="free">p0</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc_simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> find_set_1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> find_set_2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> find_set_3 find_set_invariant_def find_set_postcondition_def find_set_precondition_def path_compression_function path_compression_precondition_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> find_set_path_compression_3<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">t</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">w</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">y</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">[</span> find_set_precondition <span class="bound">p</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">]</span>
  y <span class="main">:=</span> <span class="free">x</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">y</span> <span class="main">≠</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">y</span><span class="main">]]</span>
    <span class="keyword1">INV</span> <span class="main">{</span> find_set_invariant <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="bound">y</span> <span class="main">}</span> <span class="main">}</span>
     <span class="keyword1">DO</span> y <span class="main">:=</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">y</span><span class="main">]]</span>
     <span class="keyword1">OD</span><span class="main">;</span>
  w <span class="main">:=</span> <span class="free">x</span><span class="main">;</span>
  <span class="keyword1">WHILE</span> <span class="bound">y</span> <span class="main">≠</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">w</span><span class="main">]]</span>
    <span class="keyword1">INV</span> <span class="main">{</span> path_compression_invariant <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="free">p0</span> <span class="bound">w</span> <span class="main">}</span>
    <span class="keyword1">VAR</span> <span class="main">{</span> card <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">z</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">p</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="bound">w</span> <span class="main">}</span> <span class="main">}</span>
     <span class="keyword1">DO</span> t <span class="main">:=</span> <span class="bound">w</span><span class="main">;</span>
        w <span class="main">:=</span> <span class="bound">p</span><span class="main">[[</span><span class="bound">w</span><span class="main">]]</span><span class="main">;</span>
        <span class="bound">p</span><span class="main">[</span><span class="bound"><span class="bound">t</span></span><span class="main">]</span> <span class="main">:=</span> <span class="bound">y</span>
     <span class="keyword1">OD</span>
  <span class="main">[</span> path_compression_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="bound">y</span> <span class="free">p0</span> <span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">vcg_tc_simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_set_1<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> find_set_2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> find_set_3 find_set_invariant_def find_set_postcondition_def find_set_precondition_def path_compression_1 path_compression_precondition_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> path_compression_2<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> path_compression_3<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Find-set with path compression returns two results: the representative of the tree and the modified disjoint-set forest.
›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_path_compression_exists"><span class="command">lemma</span></span> find_set_path_compression_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"find_set_precondition <span class="free">p</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p'</span> <span class="bound">y</span> <span class="main">.</span> path_compression_postcondition <span class="bound">p'</span> <span class="free">x</span> <span class="bound">y</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tc_extract_function find_set_path_compression <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">find_set_path_compression</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="main">(</span><span class="bound">p'</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> path_compression_postcondition <span class="bound">p'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_path_compression_function"><span class="command">lemma</span></span> find_set_path_compression_function<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_set_precondition <span class="free">p</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p'</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> find_set_path_compression <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="free">p'</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">p'</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> path_compression_postcondition <span class="bound">p'</span> <span class="free">x</span> <span class="bound">y</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">z</span> <span class="main">.</span> <span class="var">?P</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> some_eq_ex<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> find_set_path_compression_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> find_set_path_compression_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We prove that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>find_set_path_compression›</span></span></span></span> returns the same representative as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>find_set›</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_path_compression_find_set"><span class="command">lemma</span></span> find_set_path_compression_find_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_set_precondition <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"find_set <span class="free">p</span> <span class="free">x</span> <span class="main">=</span> snd <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"find_set <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"find_set_postcondition <span class="free">p</span> <span class="free">x</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms find_set_function<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="var">?p</span> <span class="free">x</span> <span class="var">?y</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms find_set_path_compression_function prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms same_root find_set_precondition_def find_set_postcondition_def path_compression_precondition_def path_compression_postcondition_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A weaker postcondition suffices to prove that the two forests have the same semantics; that is, they describe the same disjoint sets and have the same roots.
›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_path_compression_path_compression_semantics"><span class="command">lemma</span></span> find_set_path_compression_path_compression_semantics<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_set_precondition <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fc <span class="main">(</span>path_compression <span class="free">p</span> <span class="free">x</span> <span class="main">(</span>find_set <span class="free">p</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fc <span class="main">(</span>fst <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path_compression <span class="free">p</span> <span class="free">x</span> <span class="main">(</span>find_set <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> fst <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"find_set <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"path_compression <span class="free">p</span> <span class="free">x</span> <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="main">(</span>path_compression <span class="free">p</span> <span class="free">x</span> <span class="var">?r</span><span class="main">)</span> <span class="free">x</span> <span class="var">?r</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms find_set_function find_set_postcondition_def find_set_precondition_def path_compression_function path_compression_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="var">?p</span> <span class="free">x</span> <span class="var">?y</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms find_set_path_compression_function prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fc <span class="var">?q</span> <span class="main">=</span> fc <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_compression_postcondition_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_compression_postcondition_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
With the current, stronger postcondition of path compression describing the precise effect of how links change, we can prove that the two forests are actually equal.
›</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-find_set_path_compression_find_set_pathcompression"><span class="command">lemma</span></span> find_set_path_compression_find_set_pathcompression<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_set_precondition <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_compression <span class="free">p</span> <span class="free">x</span> <span class="main">(</span>find_set <span class="free">p</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"find_set <span class="free">p</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"path_compression <span class="free">p</span> <span class="free">x</span> <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>find_set_path_compression <span class="free">p</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="main">(</span>path_compression <span class="free">p</span> <span class="free">x</span> <span class="var">?r</span><span class="main">)</span> <span class="free">x</span> <span class="var">?r</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms find_set_function find_set_postcondition_def find_set_precondition_def path_compression_function path_compression_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="var">?p</span> <span class="free">x</span> <span class="var">?y</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms find_set_path_compression_function prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms find_set_path_compression_find_set<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_compression_postcondition_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Union-Sets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We only consider a naive union-sets operation (without ranks).
The semantics is the equivalence closure obtained after adding the link between the two given nodes, 
which requires those two elements to be in the same set.
The implementation uses temporary variable <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>t›</span></span></span></span> to store the two results returned by find-set with path compression.
The disjoint-set forest, which keeps being updated, is threaded through the sequence of operations.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">union_sets_precondition</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> disjoint_set_forest <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> point <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">union_sets_postcondition</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="main">≡</span> union_sets_precondition <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> fc <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> wcc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p0</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-union_sets_1"><span class="command">lemma</span></span> union_sets_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"union_sets_precondition <span class="free">p0</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="free">p1</span> <span class="free">x</span> <span class="free">r</span> <span class="free">p0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="free">p2</span> <span class="free">y</span> <span class="free">s</span> <span class="free">p1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"union_sets_postcondition <span class="main">(</span><span class="free">p2</span><span class="main">[</span><span class="free">r</span><span class="main">⟼</span><span class="free">s</span><span class="main">]</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> union_sets_postcondition_def union_sets_precondition_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p2</span><span class="main">[</span><span class="free">r</span><span class="main">⟼</span><span class="free">s</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p1</span> <span class="main">∧</span> point <span class="free">r</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">=</span> root <span class="free">p1</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">p1</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">p0</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">∧</span> fc <span class="free">p1</span> <span class="main">=</span> fc <span class="free">p0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> path_compression_precondition_def path_compression_postcondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"disjoint_set_forest <span class="free">p2</span> <span class="main">∧</span> point <span class="free">s</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> root <span class="free">p2</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">p2</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">=</span> <span class="free">p1</span> <span class="main">⊓</span> <span class="main">1</span> <span class="main">∧</span> fc <span class="free">p2</span> <span class="main">=</span> fc <span class="free">p1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> path_compression_precondition_def path_compression_postcondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"fc <span class="free">p2</span> <span class="main">=</span> fc <span class="free">p0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"univalent <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 update_univalent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"total <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 bijective_regular update_total <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"acyclic <span class="main">(</span><span class="var">?p</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">s</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 update_acyclic_5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">=</span> <span class="free">r</span> <span class="main">⊓</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 distinct_points <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span> <span class="main">⊓</span> <span class="free">p2</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> root_transitive_successor_loop<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊓</span> <span class="free">p2</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">r</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> schroeder_1 conv_star_commute inf.sup_monoid.add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 update_acyclic_4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_sets_precondition_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_sets_precondition_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"surjective <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_sets_precondition_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vector <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_sets_precondition_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"injective <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_sets_precondition_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"surjective <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_sets_precondition_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fc <span class="var">?p</span> <span class="main">=</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="free">p1</span><span class="main">[[</span><span class="free">r</span><span class="main">]]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> root_successor_loop<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p1</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 eq_refl shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 conv_order coreflexive_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p1</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 inf.boundedI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p2</span> <span class="main">⊓</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">p2</span> <span class="main">*</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p2</span><span class="main">[[</span><span class="free">r</span><span class="main">]]</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 shunt_mapping <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊓</span> <span class="free">p2</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">*</span> <span class="main">(</span>top <span class="main">⊓</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dedekind_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">p2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_associative conv_dist_comp conv_involutive conv_order mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">⊓</span> <span class="free">p2</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span> <span class="main">≤</span> wcc <span class="free">p0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_sub_dist_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wcc <span class="free">p2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_decompose_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wcc <span class="free">p2</span> <span class="main">=</span> wcc <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">p2</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">p2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bijective_regular inf.sup_monoid.add_commute maddux_3_11_pp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">p2</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 6 wcc_isotone sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wcc <span class="main">(</span><span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wcc_with_loops <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wcc_isotone sup_ge2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p0</span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">p1</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p1</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> shunt_bijective union_sets_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p1</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> conv_dist_comp conv_order conv_star_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="free">p1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_sub_dist<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wcc <span class="free">p2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fc_wcc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 star.circ_sub_dist_1 sup_assoc vector_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">p2</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p2</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> shunt_bijective union_sets_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="free">p2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> star_isotone sup_ge2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">r</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 shunt_bijective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">x</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">r</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">s</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_isotone conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="free">r</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">r</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">s</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="var">?p</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 10 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_isotone mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="var">?p</span> <span class="main">*</span> wcc <span class="var">?p</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_isotone mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="var">?p</span> <span class="main">*</span> wcc <span class="var">?p</span> <span class="main">*</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 13 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_transitive_equal<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">≤</span> wcc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wcc_below_wcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">≤</span> fc <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 4 fc_wcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">p2</span> <span class="main">≤</span> wcc <span class="free">p2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI2 star.circ_sub_dist_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wcc <span class="free">p0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_decompose_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wcc_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">r</span> <span class="main">⊓</span> <span class="free">p2</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> wcc <span class="free">p1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 9 inf.order_trans star.circ_sub_dist sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wcc <span class="free">p0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_decompose_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wcc_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 15<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 16<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_supE star.circ_sub_dist_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">p2</span><span class="main"><span class="hidden">⇧</span><sup>⋆</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 12 conv_dist_comp conv_order conv_star_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="free">p2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> star.circ_sub_dist sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wcc <span class="free">p0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star_decompose_1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wcc_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 17<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">s</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> shunt_bijective union_sets_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">≤</span> <span class="free">r</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp_isotone conv_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">r</span> <span class="main">*</span> <span class="free">x</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span> <span class="main">*</span> <span class="free">y</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_associative conv_dist_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 15 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_isotone mult_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">s</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 16 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_left_isotone mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span> <span class="main">*</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 17 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_right_isotone<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> star.circ_transitive_equal<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 14 vector_covector <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"wcc <span class="var">?p</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wcc_below_wcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fc <span class="var">?p</span> <span class="main">≤</span> wcc <span class="main">(</span><span class="free">p0</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="keyword1"><span class="hidden">⇧</span><sup>T</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 4 fc_wcc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> union_sets<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">r</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">s</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">t</span></span></span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">[</span> union_sets_precondition <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">]</span>
  t <span class="main">:=</span> find_set_path_compression <span class="bound">p</span> <span class="free">x</span><span class="main">;</span>
  p <span class="main">:=</span> fst <span class="bound">t</span><span class="main">;</span>
  r <span class="main">:=</span> snd <span class="bound">t</span><span class="main">;</span>
  t <span class="main">:=</span> find_set_path_compression <span class="bound">p</span> <span class="free">y</span><span class="main">;</span>
  p <span class="main">:=</span> fst <span class="bound">t</span><span class="main">;</span>
  s <span class="main">:=</span> snd <span class="bound">t</span><span class="main">;</span>
  <span class="bound">p</span><span class="main">[</span><span class="bound"><span class="bound">r</span></span><span class="main">]</span> <span class="main">:=</span> <span class="bound">s</span>
  <span class="main">[</span> union_sets_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">vcg_tc_simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"find_set_path_compression <span class="free">p0</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?t1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="var">?t1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"find_set_path_compression <span class="var">?p1</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?t2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="var">?t2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?p2</span><span class="main">[</span><span class="var">?r</span><span class="main">⟼</span><span class="var">?s</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"union_sets_precondition <span class="free">p0</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="var">?p1</span> <span class="free">x</span> <span class="var">?r</span> <span class="free">p0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> find_set_precondition_def union_sets_precondition_def find_set_path_compression_function<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="var">?p2</span> <span class="free">y</span> <span class="var">?s</span> <span class="var">?p1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> find_set_precondition_def union_sets_precondition_def find_set_path_compression_function path_compression_postcondition_def path_compression_precondition_def prod.collapse<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"union_sets_postcondition <span class="main">(</span><span class="var">?p2</span><span class="main">[</span><span class="var">?r</span><span class="main">⟼</span><span class="var">?s</span><span class="main">]</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_sets_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-union_sets_exists"><span class="command">lemma</span></span> union_sets_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"union_sets_precondition <span class="free">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p'</span> <span class="main">.</span> union_sets_postcondition <span class="bound">p'</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tc_extract_function union_sets <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">union_sets</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p'</span> <span class="main">.</span> union_sets_postcondition <span class="bound">p'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Disjoint_Set_Forests-union_sets_function"><span class="command">lemma</span></span> union_sets_function<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"union_sets_precondition <span class="free">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">=</span> union_sets <span class="free">p</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"union_sets_postcondition <span class="free">p'</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms union_sets_def union_sets_exists someI<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> union_sets_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">VARS</span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">p</span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">r</span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">s</span></span></span></span></span></span></span></span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound"><span class="bound">t</span></span></span></span></span></span></span></span></span></span></span></span>
  <span class="main">[</span> union_sets_precondition <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">p0</span> <span class="main">=</span> <span class="bound">p</span> <span class="main">]</span>
  r <span class="main">:=</span> find_set <span class="bound">p</span> <span class="free">x</span><span class="main">;</span>
  p <span class="main">:=</span> path_compression <span class="bound">p</span> <span class="free">x</span> <span class="bound">r</span><span class="main">;</span>
  s <span class="main">:=</span> find_set <span class="bound">p</span> <span class="free">y</span><span class="main">;</span>
  p <span class="main">:=</span> path_compression <span class="bound">p</span> <span class="free">y</span> <span class="bound">s</span><span class="main">;</span>
  <span class="bound">p</span><span class="main">[</span><span class="bound"><span class="bound">r</span></span><span class="main">]</span> <span class="main">:=</span> <span class="bound">s</span>
  <span class="main">[</span> union_sets_postcondition <span class="bound">p</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">vcg_tc_simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"find_set <span class="free">p0</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"path_compression <span class="free">p0</span> <span class="free">x</span> <span class="var">?r</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"find_set <span class="var">?p1</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"path_compression <span class="var">?p1</span> <span class="free">y</span> <span class="var">?s</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"union_sets_precondition <span class="free">p0</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="var">?p1</span> <span class="free">x</span> <span class="var">?r</span> <span class="free">p0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> find_set_function find_set_postcondition_def find_set_precondition_def path_compression_function path_compression_precondition_def union_sets_precondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"path_compression_postcondition <span class="var">?p2</span> <span class="free">y</span> <span class="var">?s</span> <span class="var">?p1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 find_set_function find_set_postcondition_def find_set_precondition_def path_compression_function path_compression_precondition_def union_sets_precondition_def path_compression_postcondition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"union_sets_postcondition <span class="main">(</span><span class="var">?p2</span><span class="main">[</span><span class="var">?r</span><span class="main">⟼</span><span class="var">?s</span><span class="main">]</span><span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="free">p0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> union_sets_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>