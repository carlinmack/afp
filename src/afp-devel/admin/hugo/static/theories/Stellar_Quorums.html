<div id="Stellar_Quorums">
<div class="head">
<h1>Theory Stellar_Quorums</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">text</span></span> 
<span class="quoted"><span class="plain_text">‹This theory formalizes some of the results appearing in the paper "Stellar Consensus By Reduction"\cite{disc_paper}.
We prove static properties of personal Byzantine quorum systems and Stellar quorum systems.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Stellar_Quorums
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Personal Byzantine quorum systems"</span></span>

<span class="keyword1"><span class="command">locale</span></span> personal_quorums <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">quorum_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span> set <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> quorum_assm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">p'</span> <span class="main">.</span> <span class="main">⟦</span><span class="free">quorum_of</span> <span class="bound">p</span> <span class="free">Q</span><span class="main">;</span> <span class="bound">p'</span> <span class="main">∈</span> <span class="free">Q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">quorum_of</span> <span class="bound">p'</span> <span class="free">Q</span>"</span></span>
    <span class="comment1">― ‹In other words, a quorum (of some participant) is a quorum of all its members.›</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">blocks</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">― ‹Set <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">R</span></span><span class="antiquote">}</span></span> blocks participant <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">p</span></span><span class="antiquote">}</span></span>.›</span>
  <span class="quoted"><span class="quoted">"<span class="free">blocks</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">Q</span> <span class="main">.</span> <span class="free">quorum_of</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">Q</span> <span class="main">⟶</span> <span class="bound">Q</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">blocked_by</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">blocked_by</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">p</span> <span class="main">.</span> blocks <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">p</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> blocked_blocked_subset_blocked<span class="main">:</span>
  <span class="quoted"><span class="quoted">"blocked_by <span class="main">(</span>blocked_by <span class="free">R</span><span class="main">)</span> <span class="main">⊆</span> blocked_by <span class="free">R</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> blocked_by <span class="main">(</span>blocked_by <span class="free">R</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> blocked_by <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∩</span> blocked_by <span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">quorum_of</span> <span class="skolem">p</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Q</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> blocked_by <span class="main">(</span>blocked_by <span class="free">R</span><span class="main">)</span>›</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> blocks_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∩</span> <span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">" <span class="free">quorum_of</span> <span class="skolem">p</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Q</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> blocked_by <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_emptyI <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> <span class="free">quorum_of</span> <span class="skolem">p</span> <span class="bound">Q</span> <span class="main">⟹</span> <span class="bound">Q</span> <span class="main">∩</span> blocked_by <span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">quorum_of</span> <span class="skolem">p</span> <span class="skolem">Q</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">quorum_of</span> <span class="skolem">p'</span> <span class="skolem">Q</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> quorum_assm that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">∈</span> blocked_by <span class="free">R</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∩</span> <span class="free">R</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> blocks_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> blocked_by <span class="free">R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> blocks_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"blocked_by <span class="main">(</span>blocked_by <span class="free">R</span><span class="main">)</span> <span class="main">⊆</span> blocked_by <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now add the set of correct participants to the model.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> with_w <span class="main">=</span> personal_quorums <span class="quoted"><span class="free">quorum_of</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">quorum_of</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span> set <span class="main">⇒</span> bool"</span></span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">W</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'node</span> set"</span></span> <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">W</span></span><span class="antiquote">}</span></span> is the set of correct participants›</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">B</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≡</span> <span class="main">-</span><span class="free">W</span>"</span></span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">B</span></span><span class="antiquote">}</span></span> is the set of malicious participants.›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quorum_of_set</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quorum_of_set</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">∃</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">.</span> <span class="free">quorum_of</span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The set of participants not blocked by malicious participants"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">L</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">L</span> <span class="main">≡</span> <span class="free">W</span> <span class="main">-</span> <span class="main">(</span>blocked_by B<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> L <span class="main">⟹</span> <span class="main">∃</span> <span class="bound"><span class="bound">Q</span></span>  <span class="main">⊆</span> <span class="free">W</span><span class="main">.</span> <span class="free">quorum_of</span> <span class="free">p</span> <span class="bound">Q</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> L_def blocks_def <span class="keyword1"><span class="command">using</span></span> DiffD2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1"><span class="command">lemma</span></span> l3<span class="main">:</span> <span class="comment1">―  ‹If a participant is not blocked by the malicious participants, then it has a quorum consisting exclusively of correct 
participants which are not blocked by the malicious participants.›</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> L"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">⊆</span> L <span class="main">.</span> <span class="free">quorum_of</span> <span class="free">p</span> <span class="bound">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">Q</span> <span class="main">.</span> <span class="free">quorum_of</span> <span class="free">p</span> <span class="bound">Q</span> <span class="main">⟹</span> <span class="bound">Q</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span>L<span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quorum_of</span> <span class="free">p</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> l2 <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> L›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span>L<span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">quorum_of</span> <span class="free">p</span> <span class="skolem">Q</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">∩</span> <span class="main">(</span><span class="main">-</span>L<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">quorum_of</span> <span class="skolem">p'</span> <span class="skolem">Q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">∩</span> <span class="main">-</span> L <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">quorum_of</span> <span class="free">p</span> <span class="skolem">Q</span>›</span></span> inf.left_idem quorum_assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∩</span> B <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_def
      <span class="keyword1"><span class="command">using</span></span> CollectD Compl_Diff_eq Int_iff inf_le1 personal_quorums.blocks_def personal_quorums_axioms subset_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">⊆</span> <span class="free">W</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_eq_subset_Compl double_complement<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Consensus clusters and intact sets"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_intertwined</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">― ‹This definition is not used in this theory,
    but we include it to formalize the notion of intertwined set appearing in the DISC paper.›</span>
  <span class="quoted"><span class="quoted">"<span class="free">is_intertwined</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> <span class="free">W</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">Q</span> <span class="bound">Q'</span> <span class="main">.</span> quorum_of_set <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">Q</span> <span class="main">∧</span> quorum_of_set <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">Q'</span> <span class="main">⟶</span> <span class="free">W</span> <span class="main">∩</span> <span class="bound">Q</span> <span class="main">∩</span> <span class="bound">Q'</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_cons_cluster</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">― ‹Consensus clusters›</span>
  <span class="quoted"><span class="quoted">"<span class="free">is_cons_cluster</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⊆</span> <span class="free">W</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">.</span> <span class="main">∃</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">.</span> <span class="free">quorum_of</span> <span class="bound">p</span> <span class="bound">Q</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">Q</span> <span class="bound">Q'</span> <span class="main">.</span> quorum_of_set <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">Q</span> <span class="main">∧</span> quorum_of_set <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">Q'</span> <span class="main">⟶</span> <span class="free">W</span> <span class="main">∩</span> <span class="bound">Q</span> <span class="main">∩</span> <span class="bound">Q'</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strong_consensus_cluster</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strong_consensus_cluster</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">⊆</span> <span class="free">W</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">.</span> <span class="main">∃</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">.</span> <span class="free">quorum_of</span> <span class="bound">p</span> <span class="bound">Q</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">Q</span> <span class="bound">Q'</span> <span class="main">.</span> quorum_of_set <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">Q</span> <span class="main">∧</span> quorum_of_set <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">Q'</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∩</span> <span class="bound">Q</span> <span class="main">∩</span> <span class="bound">Q'</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> strong_consensus_cluster_imp_cons_cluster<span class="main">:</span>
<span class="comment1">― ‹Every intact set is a consensus cluster›</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strong_consensus_cluster <span class="free">I</span> <span class="main">⟹</span> is_cons_cluster <span class="free">I</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> strong_consensus_cluster_def is_cons_cluster_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">lemma</span></span> cons_cluster_neq_cons_cluster<span class="main">:</span>
  <span class="comment1">― ‹Some consensus clusters are not strong consensus clusters and have no superset that is a strong consensus cluster.›</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">J</span> <span class="main">.</span> <span class="free">I</span> <span class="main">⊆</span> <span class="bound">J</span> <span class="main">⟶</span> <span class="main">¬</span>strong_consensus_cluster <span class="bound">J</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">nitpick</span></span><span class="main">[</span>falsify<span class="main">=</span>false<span class="main">,</span> card <span class="tfree">'node</span><span class="main">=</span>3<span class="main">,</span> expect<span class="main">=</span>genuine<span class="main">]</span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that the union of two consensus clusters that intersect is a consensus cluster.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> cluster_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> is_cons_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">.</span> <span class="free">quorum_of</span> <span class="bound">p</span> <span class="bound">Q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_cons_cluster <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹is_cons_cluster <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UnE le_supI1 le_supI2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∨</span> <span class="skolem">C</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">C</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_cons_cluster <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹is_cons_cluster <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹quorum_of_set <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹quorum_of_set <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> that
      <span class="keyword1"><span class="command">unfolding</span></span> quorum_of_set_def is_cons_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="free">W</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="comment1">― ‹We generalize to avoid repeating the argument twice›</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quorum_of</span> <span class="skolem">p</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹is_cons_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_cons_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">quorum_of</span> <span class="skolem">p</span> <span class="skolem">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def quorum_of_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_assoc Int_iff inf_bot_right<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">⊆</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> quorum_assm <span class="keyword1"><span class="command">unfolding</span></span> quorum_of_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_cons_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">unfolding</span></span> quorum_of_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Similarly, the union of two strong consensus clusters is a strong consensus cluster.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> strong_cluster_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strong_consensus_cluster <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"strong_consensus_cluster <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strong_consensus_cluster <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∪</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> strong_consensus_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">.</span> <span class="free">quorum_of</span> <span class="bound">p</span> <span class="bound">Q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strong_consensus_cluster <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹strong_consensus_cluster <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strong_consensus_cluster_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UnE le_supI1 le_supI2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∨</span> <span class="skolem">C</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">C</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strong_consensus_cluster <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹strong_consensus_cluster <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> that
      <span class="keyword1"><span class="command">unfolding</span></span> quorum_of_set_def strong_consensus_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∨</span> <span class="skolem">C</span> <span class="main">=</span> <span class="free">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">C</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib2 disjoint_eq_subset_Compl sup.boundedE that<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"strong_consensus_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"strong_consensus_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="comment1">― ‹We generalize to avoid repeating the argument twice›</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quorum_of</span> <span class="skolem">p</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹strong_consensus_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strong_consensus_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strong_consensus_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">quorum_of</span> <span class="skolem">p</span> <span class="skolem">Q</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> strong_consensus_cluster_def quorum_of_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_assoc Int_iff inf_bot_right<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">⊆</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> quorum_assm <span class="keyword1"><span class="command">unfolding</span></span> quorum_of_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strong_consensus_cluster <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹quorum_of_set <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> strong_consensus_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">unfolding</span></span> quorum_of_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> strong_consensus_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Stellar quorum systems"</span></span>

<span class="keyword1"><span class="command">locale</span></span> stellar <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">slices</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> <span class="main">⇒</span> <span class="tfree">'node</span> set set"</span></span> <span class="comment1">― ‹the quorum slices›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'node</span> set"</span></span> <span class="comment1">― ‹the well-behaved nodes›</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> slices_ne<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">W</span> <span class="main">⟹</span> <span class="free">slices</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quorum</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">quorum</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∩</span> <span class="free">W</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="bound">p</span> <span class="main">.</span> <span class="bound">Sl</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quorum_of</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quorum_of</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> quorum <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∉</span> <span class="free">W</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">.</span> <span class="bound">Sl</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹TODO: <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">p</span><span class="main">∉</span><span class="free">W</span>"</span><span class="antiquote">}</span></span> needed?›</span>

<span class="keyword1"><span class="command">lemma</span></span> quorum_union<span class="main">:</span><span class="quoted"><span class="quoted">"quorum <span class="free">Q</span> <span class="main">⟹</span> quorum <span class="free">Q'</span> <span class="main">⟹</span> quorum <span class="main">(</span><span class="free">Q</span> <span class="main">∪</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quorum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntE Int_iff UnE inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup.coboundedI1 sup.coboundedI2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound"><span class="bound">Q</span></span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">.</span> quorum_of <span class="bound">p</span> <span class="bound">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> quorum_of_def quorum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff subset_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_pbqs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">∈</span> <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p'</span> <span class="free">Q</span>"</span></span> 
  <span class="comment1">― ‹This is the property required of a PBQS.›</span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quorum_def quorum_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> with_w <span class="quoted">quorum_of</span> 
  <span class="comment1">― ‹Stellar quorums form a personal quorum system.›</span>
  <span class="keyword1"><span class="command">unfolding</span></span> with_w_def personal_quorums_def 
  quorum_def quorum_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> quorum_is_quorum_of_some_slice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> <span class="free">slices</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p'</span> <span class="main">.</span> <span class="bound">p'</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">⟹</span> quorum_of <span class="bound">p'</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> quorum_def quorum_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">C</span> <span class="main">⟹</span> quorum <span class="free">C</span>"</span></span> 
  <span class="comment1">― ‹Every consensus cluster is a quorum.›</span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.order_iff l1 quorum_of_def stellar.quorum_def stellar_axioms<span class="main">)</span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of blocking sets›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">blocking_min</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">― ‹This is the set of correct participants that are eventually blocked by a set <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">R</span></span><span class="antiquote">}</span></span> when byzantine processors do not take steps.›</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∈</span> <span class="free">W</span><span class="main">;</span> <span class="main">∀</span> <span class="bound">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> <span class="bound">Sl</span><span class="main">∩</span><span class="free">W</span> <span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∨</span> <span class="free">blocking_min</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">blocking_min</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> blocking_min_elim<span class="main">:</span><span class="quoted"><span class="quoted">"blocking_min <span class="free">R</span> <span class="free">p</span>"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">blocking_max</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="comment1">― ‹This is the set of participants that are eventually blocked by a set <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">R</span></span><span class="antiquote">}</span></span> when byzantine processors help epidemic propagation.›</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∈</span> <span class="free">W</span><span class="main">;</span> <span class="main">∀</span> <span class="bound">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">q</span> <span class="main">∈</span> <span class="bound">Sl</span> <span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main">∪</span>B <span class="main">∨</span> <span class="free">blocking_max</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">q</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">blocking_max</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> <span class="quoted"><span class="quoted">"blocking_max <span class="free">R</span> <span class="free">p</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">R</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> blocks <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> belongs to a consensus cluster <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">S</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">R</span></span> <span class="main"><span class="main">∩</span></span> <span class="free"><span class="free">S</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">{}</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We first prove two auxiliary lemmas:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cons_cluster_wb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> is_cons_cluster <span class="free">C</span> <span class="main">⟹</span> <span class="free">p</span><span class="main">∈</span><span class="free">W</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_cons_cluster_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

<span class="keyword1"><span class="command">lemma</span></span> cons_cluster_has_ne_slices<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span><span class="free">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="free">p</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sl</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def quorum_of_set_def quorum_of_def quorum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff inf_bot_left inf_bot_right subset_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> cons_cluster_has_cons_cluster_slice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span><span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">Sl</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sl</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def quorum_of_set_def quorum_of_def quorum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute  empty_iff inf.order_iff  inf_bot_right le_infI1<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> blocking_max_intersects_intact<span class="main">:</span>
  <span class="comment1">― ‹if <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">R</span>›</span><span class="antiquote">}</span></span> blocks <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">p</span>›</span><span class="antiquote">}</span></span> when malicious participants help epidemic propagation, 
and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">p</span></span><span class="antiquote">}</span></span> belongs to a consensus cluster <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">C</span></span><span class="antiquote">}</span></span>, then <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">R</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">≠</span> <span class="main">{}</span>›</span><span class="antiquote">}</span></span>›</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"blocking_max <span class="free">R</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span> <span class="skolem">R</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Sl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Sl</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cons_cluster_has_cons_cluster_slice
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Sl</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> calculation<span class="main">(</span>2<span class="main">)</span> is_cons_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.hyps"</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now we show that if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">p</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">C</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a consensus cluster, and quorum <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Q</span></span> <span class="main"><span class="main">∩</span></span> <span class="free"><span class="free">C</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">{}</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
    then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">Q</span></span> <span class="main"><span class="main">∩</span></span> <span class="free"><span class="free">W</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> blocks <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 

We start by defining the set of participants reachable from a participant through correct participants.
Their union trivially forms a quorum. 
Moreover, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not blocked by a set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">R</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
then we show that the set of participants reachable from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and not blocked by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">R</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> forms a quorum disjoint from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">R</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
It follows that if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="antiquote"><span class="antiquote">}</span></span></span></span> is a member of a consensus cluster <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a quorum of a member of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Q</span></span><span class="main"><span class="main">∩</span></span><span class="free"><span class="free">W</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
 must block <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, as otherwise quorum intersection would be violated. ›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">not_blocked</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">p</span> <span class="entity">R</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">Sl</span></span></span> <span class="main">∈</span> <span class="free">slices</span> <span class="free">p</span><span class="main">;</span> <span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Sl</span></span></span><span class="main">∩</span><span class="free">W</span> <span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">¬</span>blocking_min <span class="free">R</span> <span class="bound">q</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Sl</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">not_blocked</span> <span class="free">p</span> <span class="free">R</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">not_blocked</span> <span class="free">p</span> <span class="free">R</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span> <span class="main">∈</span> <span class="free">W</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Sl</span></span></span> <span class="main">∈</span> <span class="free">slices</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">;</span> <span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Sl</span></span></span><span class="main">∩</span><span class="free">W</span> <span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">¬</span>blocking_min <span class="free">R</span> <span class="bound">q</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Sl</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">not_blocked</span> <span class="free">p</span> <span class="free">R</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>
<span class="keyword1"><span class="command">inductive_cases</span></span> not_blocked_cases<span class="main">:</span><span class="quoted"><span class="quoted">"not_blocked <span class="free">p</span> <span class="free">R</span> <span class="free">q</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> l4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Q</span> <span class="free">p</span> <span class="free">R</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">q</span> <span class="main">.</span> not_blocked <span class="free">p</span> <span class="free">R</span> <span class="bound">q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quorum <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">slices</span> <span class="skolem">n</span> <span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span><span class="free">Q</span><span class="main">∩</span><span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"not_blocked <span class="free">p</span> <span class="free">R</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>blocking_min <span class="free">R</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff not_blocked.simps that<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> blocking_min.intros not_blocked.intros<span class="main">(</span>2<span class="main">)</span> that <span class="keyword1"><span class="command">unfolding</span></span> Q_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">metis</span> mem_Collect_eq subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quorum_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> l5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Q</span> <span class="free">p</span> <span class="free">R</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">q</span> <span class="main">.</span> not_blocked <span class="free">p</span> <span class="free">R</span> <span class="bound">q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span>blocking_min <span class="free">R</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">∈</span><span class="free">C</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹is_cons_cluster <span class="free">C</span>›</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p</span> <span class="free">Q</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span><span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> cons_cluster_wb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Sl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> <span class="skolem">Sl</span><span class="main">∩</span><span class="free">W</span> <span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">¬</span>blocking_min <span class="free">R</span> <span class="bound">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">W</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> blocking_min.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Sl</span> <span class="main">⊆</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">using</span></span> not_blocked.intros<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> l4 <span class="quoted"><span class="quoted">‹<span class="skolem">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Q_def  quorum_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cons_cluster_ne_slices<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span><span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sl</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms cons_cluster_has_ne_slices cons_cluster_wb stellar.quorum_of_def stellar_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> l6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Q</span> <span class="free">p</span> <span class="free">R</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">q</span> <span class="main">.</span> not_blocked <span class="free">p</span> <span class="free">R</span> <span class="bound">q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∩</span> <span class="free">R</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∉</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"not_blocked <span class="free">p</span> <span class="free">R</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span> <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff not_blocked.simps<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Q_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> quorum_blocks_cons_cluster<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="free">C</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span><span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"blocking_min <span class="main">(</span><span class="free">Q</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> blocking_min <span class="main">(</span><span class="free">Q</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">∈</span><span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> is_cons_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">q</span> <span class="main">.</span> not_blocked <span class="free">p</span> <span class="main">(</span><span class="free">Q</span><span class="main">∩</span><span class="free">W</span><span class="main">)</span> <span class="bound">q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p</span> <span class="skolem">Q'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q'_def <span class="quoted"><span class="quoted">‹<span class="main">¬</span> blocking_min <span class="main">(</span><span class="free">Q</span> <span class="main">∩</span> <span class="free">W</span><span class="main">)</span> <span class="free">p</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> l5<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">∩</span> <span class="free">Q</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Q'_def l6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute inf_sup_aci<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> quorum_of_set_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reachability through a set›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we define the part of a quorum <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that is reachable through correct
participants from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. We show that if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are members of the same consensus cluster and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a quorum of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
 and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a quorum of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
then the intersection <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Q</span></span><span class="main"><span class="main">∩</span></span><span class="free"><span class="free">Q'</span></span><span class="main"><span class="main">∩</span></span><span class="free"><span class="free">W</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is reachable from both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p'</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> through the consensus cluster.›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">reachable_through</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">p</span> <span class="entity">S</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reachable_through</span> <span class="free">p</span> <span class="free">S</span> <span class="free">p</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">reachable_through</span> <span class="free">p</span> <span class="free">S</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span> <span class="main">∈</span> <span class="free">W</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Sl</span></span></span> <span class="main">∈</span> <span class="free">slices</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Sl</span></span></span> <span class="main">⊆</span> <span class="free">S</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">p''</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Sl</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">reachable_through</span> <span class="free">p</span> <span class="free">S</span> <span class="free"><span class="bound"><span class="entity">p''</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">truncation</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">truncation</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">p'</span> <span class="main">.</span> reachable_through <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">p'</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> l13<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"reachable_through <span class="free">p</span> <span class="free">Q</span> <span class="free">p'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p'</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> quorum_assm reachable_through.cases
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_pbqs subset_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> l14<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quorum <span class="main">(</span>truncation <span class="free">p</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">slices</span> <span class="skolem">p'</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">q</span> <span class="main">∈</span> <span class="bound">S</span> <span class="main">.</span> reachable_through <span class="free">p</span> <span class="free">Q</span> <span class="bound">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"reachable_through <span class="free">p</span> <span class="free">Q</span> <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p'</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms l13 quorum_is_quorum_of_some_slice stellar.reachable_through.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> stellar_axioms that<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntE mem_Collect_eq stellar.quorum_def stellar_axioms subsetI truncation_def<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> l15<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_cons_cluster <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p</span> <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of <span class="free">p'</span> <span class="free">Q'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p'</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">∩</span> <span class="free">Q'</span> <span class="main">∩</span> <span class="free">W</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∩</span> <span class="main">(</span>truncation <span class="free">p</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>truncation <span class="free">p'</span> <span class="free">Q'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quorum <span class="main">(</span>truncation <span class="free">p</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum <span class="main">(</span>truncation <span class="free">p'</span> <span class="free">Q'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> l14 assms is_cons_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="free">I</span> <span class="main">(</span>truncation <span class="free">p</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum_of_set <span class="free">I</span> <span class="main">(</span>truncation <span class="free">p'</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> calculation mem_Collect_eq quorum_def quorum_of_def quorum_of_set_def reachable_through.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> truncation_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹is_cons_cluster <span class="free">I</span>›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_cons_cluster_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Elementary quorums"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section we define the notion of elementary quorum, which is a quorum that has no strict subset that is a quorum.
  It follows directly from the definition that every finite quorum contains an elementary quorum. Moreover, we show 
that if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an elementary quorum and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are members of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is reachable from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
in the directed graph over participants defined as the set of edges <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">n</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">m</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a member of a slice of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
This lemma is used in the companion paper to show that probabilistic leader-election is feasible.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> elementary <span class="main">=</span> stellar
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">elementary</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">elementary</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> quorum <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s'</span> <span class="main">.</span> <span class="bound">s'</span> <span class="main">⊂</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟶</span> <span class="main">¬</span>quorum <span class="bound">s'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finite_subset_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">X</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊂</span> <span class="bound">Y</span> <span class="main">∧</span> finite <span class="bound">Y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_psubset_def wf_finite_psubset<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quorum_contains_elementary<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> elementary <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"quorum <span class="free">s</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s'</span> <span class="main">.</span> <span class="bound">s'</span> <span class="main">⊂</span> <span class="free">s</span> <span class="main">∧</span> elementary <span class="bound">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>wf_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?r</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">X</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">Y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">X</span></span> <span class="main"><span class="main">⊂</span></span> <span class="bound"><span class="bound">Y</span></span> <span class="main"><span class="main">∧</span></span> finite <span class="bound"><span class="bound">Y</span></span><span class="main"><span class="main">}</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_subset_wf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> elementary_def finite_psubset_def finite_subset in_finite_psubset less_le psubset_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">path</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">path</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="main">.</span> <span class="free">path</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span> <span class="bound">n</span> <span class="main">.</span> <span class="main">⟦</span><span class="free">path</span> <span class="bound">l</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span>hd <span class="bound">l</span><span class="main">)</span><span class="main">;</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">path</span> <span class="main">(</span><span class="bound">n</span><span class="main">#</span><span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> elementary_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"elementary <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∈</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span> <span class="main">.</span> hd <span class="main">(</span>rev <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> hd <span class="bound">l</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∧</span> path <span class="bound">l</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?P</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">n</span></span> <span class="main">∈</span> <span class="free">s</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">l</span> <span class="main">.</span> <span class="bound">l</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="main">(</span>rev <span class="bound">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∧</span> hd <span class="bound">l</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">∧</span> path <span class="bound">l</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∉</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="var">?P</span>›</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> path.intros<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quorum <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span> <span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="free">slices</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="free">slices</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹elementary <span class="free">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>elementary_def quorum_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∉</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>rev <span class="skolem">l'</span><span class="main">)</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path <span class="skolem">l'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">x</span>›</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">l'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹path <span class="skolem">l'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span><span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="free">slices</span> <span class="skolem">n</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="skolem">l'</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span>
                <span class="keyword1"><span class="command">using</span></span> path.intros<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>rev <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">l'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹hd <span class="main">(</span>rev <span class="skolem">l'</span><span class="main">)</span> <span class="main">=</span> <span class="free">n<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="free">s</span>›</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∉</span> <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="free">slices</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff quorum_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊂</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∉</span> <span class="skolem">x</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹elementary <span class="free">s</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> elementary_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The intact sets of the Stellar Whitepaper›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">project</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">project</span> <span class="free"><span class="bound"><span class="entity">slices</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">Sl</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">|</span> <span class="bound">Sl</span> <span class="main">.</span> <span class="bound">Sl</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">slices</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">}</span>"</span></span> 
  <span class="comment1">― ‹Projecting on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span> is the same as deleting the complement of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span>, where deleting is understood as in the Stellar Whitepaper.›</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Intact and the Cascade Theorem›</span></span>

<span class="keyword1"><span class="command">locale</span></span> intact <span class="main">=</span> <span class="comment1">― ‹Here we fix an intact set <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">I</span></span><span class="antiquote">}</span></span> and prove the cascade theorem.›</span>
  orig<span class="main">:</span>stellar <span class="quoted"><span class="free">slices</span></span> <span class="quoted"><span class="free">W</span></span> 
  <span class="main">+</span> proj<span class="main">:</span>stellar <span class="quoted"><span class="quoted">"project <span class="free">slices</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="free">W</span></span> <span class="comment1">― ‹We consider the projection of the system on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">I</span></span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">slices</span> <span class="free">W</span> <span class="free">I</span> <span class="main">+</span>  <span class="comment1">― ‹An intact set is a set <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">I</span></span><span class="antiquote">}</span></span> satisfying the three assumptions below:›</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> intact_wb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> q_avail<span class="main">:</span><span class="quoted"><span class="quoted">"orig.quorum <span class="free">I</span>"</span></span> <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">I</span></span><span class="antiquote">}</span></span> is a quorum in the original system.›</span>
    <span class="keyword2"><span class="keyword">and</span></span> q_inter<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">Q</span> <span class="bound">Q'</span> <span class="main">.</span> <span class="main">⟦</span>proj.quorum <span class="bound">Q</span><span class="main">;</span> proj.quorum <span class="bound">Q'</span><span class="main">;</span> <span class="bound">Q</span> <span class="main">∩</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">;</span> <span class="bound">Q'</span> <span class="main">∩</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">⟧</span>  <span class="main">⟹</span> <span class="bound">Q</span> <span class="main">∩</span> <span class="bound">Q'</span> <span class="main">∩</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="comment1">― ‹Any two sets that intersect <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">I</span></span><span class="antiquote">}</span></span> and that are quorums in the projected system intersect in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">I</span></span><span class="antiquote">}</span></span>.
Note that requiring that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">‹Q ∩ Q' ≠ {}›</span><span class="antiquote">}</span></span> instead of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">‹Q ∩ Q' ∩ I ≠ {}›</span><span class="antiquote">}</span></span> would be equivalent.›</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> blocking_safe<span class="main">:</span> <span class="comment1">― ‹A set that blocks an intact node contains an intact node. 
If this were not the case, quorum availability would trivially be violated.›</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="free">n</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">Sl</span><span class="main">∈</span> <span class="free">slices</span> <span class="free">n</span> <span class="main">.</span><span class="bound">Sl</span><span class="main">∩</span><span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms q_avail intact_wb <span class="keyword1"><span class="command">unfolding</span></span> orig.quorum_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> inf.absorb_iff2 inf_assoc inf_bot_right inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 

<span class="keyword1"><span class="command">theorem</span></span> cascade<span class="main">:</span>
<span class="comment1">― ‹If <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">U</span></span><span class="antiquote">}</span></span> is a quorum of an intact node and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span> is a super-set of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">U</span></span><span class="antiquote">}</span></span>, then either <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span> includes 
all intact nodes or there is an intact node outside of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span> which is blocked by the intact members of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">S</span></span><span class="antiquote">}</span></span>.
This shows that, in SCP, once the intact members of a quorum accept a statement, 
a cascading effect occurs and all intact nodes eventually accept it regardless of what befouled and faulty nodes do.›</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span> <span class="free">S</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"orig.quorum <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∩</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">-</span> <span class="free">S</span> <span class="main">.</span> <span class="main">∀</span> <span class="bound">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">Sl</span> <span class="main">∩</span> <span class="free">S</span> <span class="main">∩</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword2"><span class="keyword">if</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">-</span> <span class="free">S</span> <span class="main">.</span> <span class="main">∃</span> <span class="bound">Sl</span> <span class="main">∈</span> <span class="free">slices</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">Sl</span> <span class="main">∩</span> <span class="free">S</span> <span class="main">∩</span> <span class="free">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">I</span> <span class="main">⊆</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="free"><span class="free">I</span></span><span class="main"><span class="main">-</span></span><span class="free"><span class="free">S</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a quorum in the projected system. This is immediate from the definition of quorum and assumption 1.›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj.quorum <span class="main">(</span><span class="free">I</span><span class="main">-</span><span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1
      <span class="keyword1"><span class="command">unfolding</span></span> proj.quorum_def project_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">smt</span> DiffI Diff_Compl Diff_Int_distrib Diff_eq Diff_eq_empty_iff Int_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Then we show that U is also a quorum in the projected system:›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj.quorum <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹orig.quorum <span class="free">U</span>›</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> proj.quorum_def orig.quorum_def project_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">meson</span> Int_commute inf.coboundedI2<span class="main">)</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Since quorums of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> must intersect, we get a contradiction:›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">∩</span> <span class="free">I</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="free">I</span><span class="main">⊆</span><span class="free">S</span><span class="main">)</span>›</span></span> q_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"The Union Theorem"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Here we prove that the union of two intact sets that intersect is intact.
This implies that maximal intact sets are disjoint.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> intersecting_intact <span class="main">=</span> 
  i1<span class="main">:</span>intact <span class="quoted"><span class="free">slices</span></span> <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">+</span> i2<span class="main">:</span>intact <span class="quoted"><span class="free">slices</span></span> <span class="quoted"><span class="free">W</span></span> <span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="comment1">― ‹We fix two intersecting intact sets <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span></span><span class="antiquote">}</span></span> and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span></span><span class="antiquote">}</span></span>.›</span>
  <span class="main">+</span> proj<span class="main">:</span>stellar <span class="quoted"><span class="quoted">"project <span class="free">slices</span> <span class="main">(</span><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">W</span></span> <span class="comment1">― ‹We consider the projection of the system on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span>.›</span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">slices</span> <span class="free">W</span> <span class="free">I<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> inter<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">I<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> union_quorum<span class="main">:</span> <span class="quoted"><span class="quoted">"i1.orig.quorum <span class="main">(</span><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>"</span></span> <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> is a quorum in the original system.›</span>
  <span class="keyword1"><span class="command">using</span></span> i1.intact_axioms i2.intact_axioms
  <span class="keyword1"><span class="command">unfolding</span></span>  intact_def stellar_def intact_axioms_def i1.orig.quorum_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff Un_iff le_supI1 le_supI2<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> union_quorum_intersection<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="comment1">― ‹Any two sets that intersect <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> and that are quorums in the system projected on <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span> intersect in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span>›</span><span class="antiquote">}</span></span>.›</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are quorums in the projections on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i1.proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> i1.proj.quorum_def proj.quorum_def project_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib Int_iff Un_subset_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i2.proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> i2.proj.quorum_def proj.quorum_def project_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib Int_iff Un_subset_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i2.proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj.quorum_def i2.proj.quorum_def project_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib Int_iff Un_subset_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i1.proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹proj.quorum <span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> proj.quorum_def i1.proj.quorum_def project_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> Int_Un_distrib Int_iff Un_subset_iff<span class="main">)</span> 
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> intersect if they are quorums of, respectively, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
This is the only interesting part of the proof.›</span></span> 
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"i1.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"i2.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"i2.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i1.proj.quorum <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"i1.orig.quorum <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i2.q_avail<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> i1.orig.quorum_def i1.proj.quorum_def project_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">meson</span> Int_commute Int_iff inf_le2 subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹i1.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i1.q_inter inter <span class="quoted"><span class="quoted">‹<span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹i2.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>›</span></span>  
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹i2.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i2.q_inter <span class="quoted"><span class="quoted">‹<span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next  we show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q<span class="hidden">⇩</span><sub>1</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q<span class="hidden">⇩</span><sub>2</sub></span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> intersect if they are quorums of the same intact set. This is obvious.›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"i1.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"i1.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib i1.q_inter that<span class="main">)</span>  
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="main">(</span><span class="free">I<span class="hidden">⇩</span><sub>1</sub></span><span class="main">∪</span><span class="free">I<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"i2.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"i2.proj.quorum <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">∩</span> <span class="free">I<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q<span class="hidden">⇩</span><sub>2</sub></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib i2.q_inter that<span class="main">)</span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Finally we have covered all the cases and get the final result:›</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Int_Un_distrib Int_commute assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span> sup_bot.right_neutral<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>